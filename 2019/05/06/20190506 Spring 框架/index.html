<!DOCTYPE html>





<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="1 Spring 简介  Spring 是一个轻量级控制反转（IOC）和面向切面（AOP）的容器框架 IOC：Inversion of  Control   控制反转  DI AOP：Aspect of program      面向切面编程  Aspect  1.1 常用 jar 包   Spring 常用jar包 说明    spring-aop 提供AOP（面向切面编程）实现   sprin">
<meta name="keywords" content="spring">
<meta property="og:type" content="article">
<meta property="og:title" content="20190506 Spring 框架">
<meta property="og:url" content="http://zwer.xyz/2019/05/06/20190506 Spring 框架/index.html">
<meta property="og:site_name" content="zwer 的博客空间">
<meta property="og:description" content="1 Spring 简介  Spring 是一个轻量级控制反转（IOC）和面向切面（AOP）的容器框架 IOC：Inversion of  Control   控制反转  DI AOP：Aspect of program      面向切面编程  Aspect  1.1 常用 jar 包   Spring 常用jar包 说明    spring-aop 提供AOP（面向切面编程）实现   sprin">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-05-10T04:04:09.288Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="20190506 Spring 框架">
<meta name="twitter:description" content="1 Spring 简介  Spring 是一个轻量级控制反转（IOC）和面向切面（AOP）的容器框架 IOC：Inversion of  Control   控制反转  DI AOP：Aspect of program      面向切面编程  Aspect  1.1 常用 jar 包   Spring 常用jar包 说明    spring-aop 提供AOP（面向切面编程）实现   sprin">
  <link rel="canonical" href="http://zwer.xyz/2019/05/06/20190506 Spring 框架/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>20190506 Spring 框架 | zwer 的博客空间</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zwer 的博客空间</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">上善若水 自强不息</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/06/20190506 Spring 框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">20190506 Spring 框架

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-06 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-06T00:00:00+08:00">2019-05-06</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-10 12:04:09" itemprop="dateModified" datetime="2019-05-10T12:04:09+08:00">2019-05-10</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="1-Spring-简介"><a href="#1-Spring-简介" class="headerlink" title="1 Spring 简介"></a>1 Spring 简介</h1><blockquote>
<p> Spring 是一个轻量级控制反转（IOC）和面向切面（AOP）的容器框架</p>
<p>IOC：Inversion of  Control   控制反转  DI</p>
<p>AOP：Aspect of program      面向切面编程  Aspect</p>
</blockquote>
<h2 id="1-1-常用-jar-包"><a href="#1-1-常用-jar-包" class="headerlink" title="1.1 常用 jar 包"></a>1.1 常用 jar 包</h2><table>
<thead>
<tr>
<th align="center">Spring 常用jar包</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">spring-aop</td>
<td align="center">提供AOP（面向切面编程）实现</td>
</tr>
<tr>
<td align="center">spring-aspect</td>
<td align="center">spring提供对AspectJ 框架的整合</td>
</tr>
<tr>
<td align="center">spring-beans</td>
<td align="center">提供IoC（控制反转）的基础实现</td>
</tr>
<tr>
<td align="center">spring-context-support</td>
<td align="center">对Spring-context 的扩展支持</td>
</tr>
<tr>
<td align="center">spring-context</td>
<td align="center">Spring提供在IoC 基础功能上的扩展服务</td>
</tr>
<tr>
<td align="center">spring-core</td>
<td align="center">spring 的核心组件</td>
</tr>
<tr>
<td align="center">spring-expression</td>
<td align="center">spring 表达式语言</td>
</tr>
<tr>
<td align="center">spring-jdbc</td>
<td align="center">spring 提供的对 JDBC 支持包</td>
</tr>
<tr>
<td align="center">spring-orm</td>
<td align="center">整合第三方的ORM框架</td>
</tr>
<tr>
<td align="center">spring-test</td>
<td align="center">对单元测试和继承测试的简单封装</td>
</tr>
<tr>
<td align="center">spring-tx</td>
<td align="center">对事务管理的封装</td>
</tr>
<tr>
<td align="center">spring-web</td>
<td align="center">SpringMVC支持WEB端应用部署架构</td>
</tr>
<tr>
<td align="center">spring-webmvc</td>
<td align="center">REST Web 服务和Web 应用的视图控制器的实现</td>
</tr>
</tbody></table>
<h2 id="1-2-Spring-版本差异"><a href="#1-2-Spring-版本差异" class="headerlink" title="1.2 Spring 版本差异"></a>1.2 Spring 版本差异</h2><p>sprin 4  支持 JavaEE 7 </p>
<p>spring 5 支持 JavaEE 8，Junit 5</p>
<h1 id="2-Spring-之-IOC-控制反转"><a href="#2-Spring-之-IOC-控制反转" class="headerlink" title="2 Spring 之 IOC 控制反转"></a>2 Spring 之 IOC 控制反转</h1><blockquote>
<p>IOC 控制反转：将对象的控制权(对象的创建、初始化、销毁等操作)由原先的调用者交给 Spring 容器管理。</p>
<p>DI 依赖注入：  若一个对象需要调用另一个对象，无须在代码中创建被调用者，而是依赖于外部容器，由外部容器创建后传递给程序。</p>
<p>IoC 是一个概念，一种思想， DI 是其中实现之一。</p>
</blockquote>
<h2 id="2-1-第一个-spring-程序"><a href="#2-1-第一个-spring-程序" class="headerlink" title="2.1  第一个 spring 程序"></a>2.1  第一个 spring 程序</h2><h3 id="2-2-1-导入-jar-包"><a href="#2-2-1-导入-jar-包" class="headerlink" title="2.2.1 导入 jar 包"></a>2.2.1 导入 jar 包</h3><blockquote>
<p>导入 jar 包</p>
<p>com.springsource.junit-3.8.2.jar<br>com.springsource.org.apache.commons.logging-1.1.1.jar<br>com.springsource.org.apache.log4j-1.2.15.jar<br>spring-beans-4.1.6.RELEASE.jar<br>spring-context-4.1.6.RELEASE.jar<br>spring-context-support-4.1.6.RELEASE.jar<br>spring-core-4.1.6.RELEASE.jar<br>spring-expression-4.1.6.RELEASE.jar</p>
<p>查找 约束文档的位置 spring-framework-4.1.6.RELEASE-dist/spring-framework-4.1.6.RELEASE/docs/spring-framework-reference/html/xsd-config.html</p>
</blockquote>
<h3 id="2-2-2-创建-spring-配置文件"><a href="#2-2-2-创建-spring-配置文件" class="headerlink" title="2.2.2 创建 spring 配置文件"></a>2.2.2 创建 spring 配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">   </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-3-Bean-的定义与注册"><a href="#2-2-3-Bean-的定义与注册" class="headerlink" title="2.2.3 Bean 的定义与注册"></a>2.2.3 Bean 的定义与注册</h3><blockquote>
<p>在 beans 标签中添加下面的语句</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 定义 bean 对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"com.szxy.spring.TestSpring"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-4-从-spring-容器中获取-Bean"><a href="#2-2-4-从-spring-容器中获取-Bean" class="headerlink" title="2.2.4 从 spring 容器中获取 Bean"></a>2.2.4 从 spring 容器中获取 Bean</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.szxy.spring.TestSpring;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 测试类与 service 实现类 耦合</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">traditionalTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">		SomeServiceImpl service = <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line">		service.someMethod();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">///Spring 测试类与 service 实现类 解耦合</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ClassPathXmlApplicationContext context = </span><br><span class="line">				<span class="keyword">new</span>  ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		TestSpring t1 = (TestSpring)context.getBean(<span class="string">"bean1"</span>);</span><br><span class="line">		t1.testMethod();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-BeanFactory-与-ApplicationContext"><a href="#2-2-BeanFactory-与-ApplicationContext" class="headerlink" title="2.2 BeanFactory 与 ApplicationContext"></a>2.2 BeanFactory 与 ApplicationContext</h2><blockquote>
<p>ApplicationContext 在加载配置文件时，对容器中所有 bean 进行对象创建及初始化操作。</p>
<p>BeanFactory 在执行 getBean 时，对容器中指定的 bean 进行对象的创建及初始化操作。</p>
<p>另外： BeanFactory  父接口，ApplicationContext  是 BeanFactory   的子接口</p>
<p>​        </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ApplicationContext context = </span><br><span class="line">				<span class="keyword">new</span>  ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		<span class="comment">//TestSpring t1 = (TestSpring)context.getBean("bean1");</span></span><br><span class="line">		TestSpring t1 =  context.getBean(<span class="string">"bean1"</span>,TestSpring.class);</span><br><span class="line">		t1.testMethod();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//使用 断点调试，区别 BeanFactory 与  ApplicationContext 的区别</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		BeanFactory bf = <span class="keyword">new</span> XmlBeanFactory(<span class="keyword">new</span> ClassPathResource(<span class="string">"applicationContext.xml"</span>));</span><br><span class="line">		TestSpring t1 =  bf.getBean(<span class="string">"bean1"</span>,TestSpring.class);</span><br><span class="line">		t1.testMethod();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-bean-装配"><a href="#2-3-bean-装配" class="headerlink" title="2.3  bean 装配"></a>2.3  bean 装配</h2><blockquote>
<p>Bean 装配指对象的创建方式</p>
<ol>
<li>默认装配方式（构造方法）</li>
<li>动态/实例工厂模式</li>
<li>静态工厂模式</li>
</ol>
</blockquote>
<h3 id="2-3-1-dynamicFactory"><a href="#2-3-1-dynamicFactory" class="headerlink" title="2.3.1 dynamicFactory"></a>2.3.1 dynamicFactory</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 动态/实例工厂模式 </span></span><br><span class="line"><span class="comment">   相当于 	SomeDynamicFactory factory = new SomeDynamicFactory();</span></span><br><span class="line"><span class="comment">    SomeService service = factory.getSomeService();</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"someDynamicFactory"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dynamicFactory.SomeDynamicFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"somServiceByDyFactory"</span> <span class="attr">factory-bean</span>=<span class="string">"someDynamicFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getSomeService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-staticFactory"><a href="#2-3-2-staticFactory" class="headerlink" title="2.3.2  staticFactory"></a>2.3.2  staticFactory</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 静态工厂模式</span></span><br><span class="line"><span class="comment">    相当于 SomeService service = SomeStaticFactory.getSomeService();</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"someServiceByStaticFactory"</span>  <span class="attr">class</span>=<span class="string">"com.szxy.staticFactory.SomeStaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getSomeService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-4-bean-作用域"><a href="#2-4-bean-作用域" class="headerlink" title="2.4 bean 作用域"></a>2.4 bean 作用域</h2><blockquote>
<p>单列模式 singleton</p>
<p>默认采用单例模式，每次使用getBean 方法获取相同 ID 类对象只获取同一个对象</p>
<p>原型列 prototype 每次都获取一个新的对象</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 默认单列模式</span></span><br><span class="line"><span class="comment">  每次从容器获取同一个的对象</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"service1"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.SomeServiceImpl"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 原型列模式</span></span><br><span class="line"><span class="comment">  每次从容器获取一个新的对象</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"service2"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.SomeServiceImpl"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-5-基于XML-方式的-DI"><a href="#2-5-基于XML-方式的-DI" class="headerlink" title="2.5 基于XML 方式的 DI"></a>2.5 基于XML 方式的 DI</h2><blockquote>
<p>依赖注入：为对象的属性赋值,通过 setter 方法。</p>
</blockquote>
<h3 id="2-5-1-设值注入"><a href="#2-5-1-设值注入" class="headerlink" title="2.5.1 设值注入"></a>2.5.1 设值注入</h3><blockquote>
<ol>
<li><p>简单数据类型注入和引用数据类型注入通过 property 标签</p>
</li>
<li><p>集合 Collection 属性的注入 （array、set、list、map、property）</p>
</li>
<li><p>域属性自动注入（autoWire = “by Mame” 方式 、autWiire = “by Type ”；全局/局部）</p>
<p>注意：</p>
<ol>
<li><p>byName 方式 注入的对象的属性名必须与它的id 名称相同</p>
</li>
<li><p>byType 方式注入自动注入：spring 配置文件中查询与属性类型一致的的bean并进行注入.</p>
</li>
</ol>
</li>
<li><p>注入 null 或 空串</p>
</li>
</ol>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">default-autowire</span>=<span class="string">"byType"</span> &gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span> <span class="comment">&lt;!-- 全局配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>/&gt;</span>  <span class="comment">&lt;!--注入空串--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">null</span>/&gt;</span>  <span class="comment">&lt;!--  null --&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">    xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">"</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">         http://www.springframework.org/schema/beans/spring-beans.xsd"</span></span><br><span class="line">         <span class="keyword">default</span>-autowire=<span class="string">"byType"</span> &gt; &lt;!-- 全局自动注入 --&gt;</span><br><span class="line">         </span><br><span class="line">     &lt;!-- 定义 bean 对象 --&gt;</span><br><span class="line">     &lt;!-- <span class="number">1</span>. 简单类型注入和引用类型注入 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"student"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="张三"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="score" value="90"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 引用类型注入 --&gt;</span><br><span class="line">		&lt;property name="teacher" ref="teacher"&gt;&lt;/property&gt; </span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;bean id=<span class="string">"teacher"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Teacher"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="雷老师"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">&lt;!-- 	&lt;bean id=<span class="string">"teacher1"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Teacher"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="马老师"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"teacher2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Teacher"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="曹老师"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt; --&gt;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	&lt;!-- <span class="number">2</span>. 集合类型注入  --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"collect"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.CollectionDI"</span>&gt;</span><br><span class="line">		&lt;property name=<span class="string">"myArray"</span>&gt;</span><br><span class="line">			&lt;array &gt;</span><br><span class="line">					&lt;value&gt;蜡笔小新&lt;/value&gt;</span><br><span class="line">					&lt;value&gt;美少女战士&lt;/value&gt;</span><br><span class="line">					&lt;value&gt;路飞&lt;/value&gt;</span><br><span class="line">			&lt;/array&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;property name=<span class="string">"mySet"</span>&gt;</span><br><span class="line">			&lt;set&gt;</span><br><span class="line">				&lt;ref bean="teacher"&gt;&lt;/ref&gt; </span><br><span class="line">			&lt;!-- 	&lt;ref bean="teacher1"&gt;&lt;/ref&gt;</span><br><span class="line">				&lt;ref bean="teacher2"&gt;&lt;/ref&gt; --&gt;</span><br><span class="line">			&lt;/set&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;property name=<span class="string">"myList"</span>&gt;</span><br><span class="line">			&lt;list&gt;</span><br><span class="line">				&lt;ref bean=<span class="string">"student"</span>/&gt;</span><br><span class="line">			&lt;/list&gt;</span><br><span class="line">		&lt;/property&gt;		</span><br><span class="line">		&lt;property name=<span class="string">"myMap"</span>&gt;</span><br><span class="line">			&lt;map&gt;</span><br><span class="line">				&lt;entry key="一"  value="1"&gt;&lt;/entry&gt;</span><br><span class="line">				&lt;entry key="二"  value="2"&gt;&lt;/entry&gt;</span><br><span class="line">				&lt;entry key="三"  value="3"&gt;&lt;/entry&gt;</span><br><span class="line">			&lt;/map&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;property name=<span class="string">"myProp"</span>&gt;</span><br><span class="line">			&lt;props&gt;</span><br><span class="line">				&lt;prop key="1"&gt;一是一&lt;/prop&gt;</span><br><span class="line">				&lt;prop key="2"&gt;二是二&lt;/prop&gt;</span><br><span class="line">			&lt;/props&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">   </span><br><span class="line">   	&lt;!-- <span class="number">3</span>. 域类型自动注入 --&gt;</span><br><span class="line">   	&lt;!-- 域类型自动注入 byName  byType  --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"student1"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span> autowire=<span class="string">"byName"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="张三"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="score" value="90"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 引用类型注入 --&gt;</span><br><span class="line">		&lt;!-- &lt;property name="teacher" ref="teacher"&gt;&lt;/property&gt;  --&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;!-- </span><br><span class="line">		 域属性自动注入值 byType </span><br><span class="line">		No qualifying bean of type [com.szxy.bean.Teacher] is defined: </span><br><span class="line">		expected single matching bean but found <span class="number">3</span>: teacher,teacher1,teacher2</span><br><span class="line">		</span><br><span class="line">		即使用 byType 作为自动注入，不能注册 多个  bean 是同一个类的，这样会导致 spring 容器不知道选择哪一个，因为类型都相同。</span><br><span class="line"> </span><br><span class="line">	 --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"student2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span> autowire=<span class="string">"byType"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="张三2"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="score" value="60"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 全局自动注入 --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"student3"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="张三3"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="score" value="100"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	&lt;!-- <span class="number">4</span>. 空串或 <span class="keyword">null</span> 注入 --&gt;</span><br><span class="line">	 &lt;bean id=<span class="string">"student4"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span><br><span class="line">		&lt;property name="name"&gt;&lt;value/&gt;&lt;/property&gt;&lt;!-- 空串注入 --&gt;</span><br><span class="line">		&lt;property name="score" value="0"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	 &lt;bean id=<span class="string">"student5"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span><br><span class="line">		&lt;property name="name"&gt;&lt;null/&gt;&lt;/property&gt;&lt;!--  null注入  --&gt;</span><br><span class="line">		&lt;property name="score" value="0"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-2-构造注入"><a href="#2-5-2-构造注入" class="headerlink" title="2.5.2 构造注入"></a>2.5.2 构造注入</h3><p>要求：在 bean 对象中要有参构造方法，同时注意添加无参构造方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 构造注入 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1.1 构造注入 按照名称 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student6"</span> <span class="attr">class</span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"小方"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"score"</span> <span class="attr">value</span>=<span class="string">"90"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"teacher"</span> <span class="attr">ref</span>=<span class="string">"teacher"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1.2 构造注入 按照索引--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student7"</span> <span class="attr">class</span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"小方2"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"90"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"2"</span> <span class="attr">ref</span>=<span class="string">"teacher"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1.3 构造注入 按照默认位置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student8"</span> <span class="attr">class</span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">value</span>=<span class="string">"小方3 "</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">value</span>=<span class="string">"100"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">ref</span>=<span class="string">"teacher1"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-6-基于注解-annotation-方式DI"><a href="#2-6-基于注解-annotation-方式DI" class="headerlink" title="2.6 基于注解 annotation 方式DI"></a>2.6 基于注解 annotation 方式DI</h2><h3 id="2-6-1-环境搭建"><a href="#2-6-1-环境搭建" class="headerlink" title="2.6.1 环境搭建"></a>2.6.1 环境搭建</h3><blockquote>
<p>导入 aop 包，添加 context 约束头信息(组件扫描器)</p>
</blockquote>
<h2 id="2-6-2-常用注解"><a href="#2-6-2-常用注解" class="headerlink" title="2.6.2 常用注解"></a>2.6.2 常用注解</h2><blockquote>
<p> @Component  表名当前类交给Spring容器管理 </p>
<p> @Repository  该注解添加在Dao 中</p>
<p>@Service  该注解添加在 Service 中 </p>
<p>@Controller  该注解添加在 Controller </p>
<p>@Autowired   引用数据类型注入，默认byType</p>
<p>@Qualifier(“id”)   与@Autowired 联合使用 byName 方式注入</p>
<p>@Value  简单数据类型注入</p>
<p>@Resource  引用数据类型默认使用 byName 方式，</p>
<p>若找不到名称匹配的 bean ，才会采用 byType 方式</p>
<p>@Scope()  表明作用域</p>
</blockquote>
<ul>
<li>xml 文档约束</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 使用注解方式 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.bean"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>栗子</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Scope;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">//表明将当前类交给 Spring 容器管理</span></span><br><span class="line"><span class="meta">@Component</span>(<span class="string">"student"</span>)  </span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"小白2"</span>)</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"100"</span>)</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> score;</span><br><span class="line">	<span class="comment">/*	</span></span><br><span class="line"><span class="comment">	@Autowired  //默认以 byType 方式自动注入</span></span><br><span class="line"><span class="comment">	@Qualifier("teacher")  //与 @Autowired 联合使用，以byName 方式自动注入</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="meta">@Resource</span>    <span class="comment">//默认以 byName 方式，若找不到，则以byType 查找</span></span><br><span class="line">	<span class="keyword">private</span> Teacher teacher; <span class="comment">//引用对象</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, <span class="keyword">int</span> score, Teacher teacher)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.score = score;</span><br><span class="line">		<span class="keyword">this</span>.teacher = teacher;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, <span class="keyword">int</span> score)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.score = score;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getScore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> score;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScore</span><span class="params">(<span class="keyword">int</span> score)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.score = score;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Teacher <span class="title">getTeacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> teacher;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeacher</span><span class="params">(Teacher teacher)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.teacher = teacher;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Student [name="</span> + name + <span class="string">", score="</span> + score + <span class="string">", teacher="</span></span><br><span class="line">				+ teacher + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-AOP"><a href="#3-AOP" class="headerlink" title="3  AOP"></a>3  AOP</h1><blockquote>
<p>AOP 面向切面编程(编程思想)，是将交叉业务逻辑封装成切面，利用AOP的功能将切面织入主业务逻辑中。</p>
<p>交叉业务逻辑是值，通用的、与主业务无关的代码，如安全检查、事务、日志等。</p>
<p>切面：泛指交叉业务逻辑。</p>
<p>织入：将切面代码插入到目标对象的过程。</p>
<p>连接点：切面可以织入的位置。</p>
<p>切入点：切面具体织入的位置。注意：切入点的范围比连接点的范围小</p>
<p>通知（advice）： 切面的一种实现，是在目标方法执行前或后，切入。</p>
<p>顾问（advisor）： 不仅指定了切入时间点，还指定具体的    切入点</p>
</blockquote>
<h2 id="3-1-三种代理方式"><a href="#3-1-三种代理方式" class="headerlink" title="3.1 三种代理方式"></a>3.1 三种代理方式</h2><blockquote>
<p>应用场景:</p>
<ul>
<li>可以隐藏目标类的具体实现</li>
<li>在不修改目标类代码的情况下能够对其功能进行增强</li>
</ul>
</blockquote>
<h3 id="3-1-1-静态代理"><a href="#3-1-1-静态代理" class="headerlink" title="3.1.1 静态代理"></a>3.1.1 静态代理</h3><blockquote>
<p>测试静态代理，写一个接口，一个目标实现类，再写一个代理类也实现该接口，并将目标类对象传入代理类中，代理类调用目标类对象的方法。最后测试。</p>
<p>注意： 代理类与目标类实现相同的接口</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.staticProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.service.SomeService;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestStaticProxy</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 目标类</span></span><br><span class="line">		SomeService target= <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line">		<span class="comment">// 代理类</span></span><br><span class="line">		SomeProxy proxy = <span class="keyword">new</span> SomeProxy(target);</span><br><span class="line">		<span class="comment">//调用 代理类，获取返回值</span></span><br><span class="line">		String result = proxy.someMethod();</span><br><span class="line">		System.out.println(result);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-2-JDK动态代理"><a href="#3-1-2-JDK动态代理" class="headerlink" title="3.1.2  JDK动态代理"></a>3.1.2  JDK动态代理</h3><blockquote>
<p>动态代理不在程序中声明代理类代码，而是在运行中使用 Proxy 类 动态执行代理类的方法。</p>
<p>应用场景：目标类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.dynamicProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.service.SomeService;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * JDK 动态代理方式</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDynamicProxy</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//目标类</span></span><br><span class="line">		<span class="comment">//内部类调用外部类中的对象时，要求外部类中的对象必须由 final 关键字 修饰</span></span><br><span class="line">		<span class="keyword">final</span> SomeService target = <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line">		<span class="comment">//代理类</span></span><br><span class="line">		SomeService proxy = </span><br><span class="line">				(SomeService) Proxy.newProxyInstance(target.getClass().getClassLoader(), <span class="comment">//获取目标类类加载器</span></span><br><span class="line">							   target.getClass().getInterfaces(), <span class="comment">//获取目标类实现的接口类</span></span><br><span class="line">							   <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">								</span><br><span class="line">								<span class="comment">/**</span></span><br><span class="line"><span class="comment">								 *   proxy : 代理对象</span></span><br><span class="line"><span class="comment">								 *   method: 目标方法</span></span><br><span class="line"><span class="comment">								 *   args: 目标参数 </span></span><br><span class="line"><span class="comment">								 */</span></span><br><span class="line">								<span class="meta">@Override</span></span><br><span class="line">								<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span></span><br><span class="line"><span class="function">										<span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">									    <span class="comment">//执行目标类的方法</span></span><br><span class="line">										String  result = (String)method.invoke(target, args); </span><br><span class="line">										<span class="keyword">return</span>  result.toLowerCase();</span><br><span class="line">								&#125;</span><br><span class="line">							&#125;);</span><br><span class="line">		<span class="comment">//调用目标类的方法</span></span><br><span class="line">		String result = proxy.someMethod();</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-3-CGLIB-代理"><a href="#3-1-3-CGLIB-代理" class="headerlink" title="3.1.3 CGLIB 代理"></a>3.1.3 CGLIB 代理</h3><blockquote>
<p>应用场景： 实现目标类没有实现目标接口</p>
<p>注意： CGLIB 代理需要引入 cglib 架包</p>
</blockquote>
<ol>
<li><h4 id="CGLIB-代理类工厂"><a href="#CGLIB-代理类工厂" class="headerlink" title="CGLIB 代理类工厂"></a>CGLIB 代理类工厂</h4></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.cglibDynamicProxy.SomeService2;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.asm.Type;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.transform.impl.InterceptFieldFilter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  CGLIB 动态代理工厂</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> *  实现 MethodInterceptore 接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CGLIBProxyFactory</span>  <span class="keyword">implements</span> <span class="title">MethodInterceptor</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span>  SomeService2 target;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CGLIBProxyFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CGLIBProxyFactory</span><span class="params">(SomeService2 target)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.target = target;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> SomeService2 <span class="title">createProxy</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建增强类对象</span></span><br><span class="line">		Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">		<span class="comment">//指定父类对象，即目标类</span></span><br><span class="line">		enhancer.setSuperclass(SomeService2.class);</span><br><span class="line">		<span class="comment">//指定回调接口的对象</span></span><br><span class="line">		enhancer.setCallback(<span class="keyword">this</span>);</span><br><span class="line">		<span class="comment">//创建 cglib 代理类对象</span></span><br><span class="line">		<span class="keyword">return</span> (SomeService2) enhancer.create();</span><br><span class="line">	&#125;	</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *    ojb：     目标对象</span></span><br><span class="line"><span class="comment">	 *    method：  目标方法</span></span><br><span class="line"><span class="comment">	 */</span>	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object obj, Method method, Object[] args,</span></span></span><br><span class="line"><span class="function"><span class="params">			MethodProxy arg3)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">			</span><br><span class="line">			String result = (String)method.invoke(target, args);</span><br><span class="line">			<span class="keyword">return</span> result.toLowerCase();</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.cglibDynamicProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.factory.CGLIBProxyFactory;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCGLIBProxy</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建目标类对象</span></span><br><span class="line">		SomeService2 target = <span class="keyword">new</span> SomeService2();</span><br><span class="line">		<span class="comment">//创建CGLIB 工厂</span></span><br><span class="line">		SomeService2 proxy = <span class="keyword">new</span>  CGLIBProxyFactory(target).createProxy();</span><br><span class="line">		<span class="comment">//调用 代理类方法</span></span><br><span class="line">		String result = proxy.someMethod();</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-基于Schema-based方式之通知"><a href="#3-2-基于Schema-based方式之通知" class="headerlink" title="3.2 基于Schema-based方式之通知"></a>3.2 基于Schema-based方式之通知</h2><blockquote>
<p>导入 两个 jar 包（aop \ aopalliance）</p>
<p>MethodBeforeAdivce</p>
<p>AfterReturningAdvice</p>
<p>MethodInterceptor</p>
</blockquote>
<blockquote>
<p>Eclipse 小技巧： Ctrl+Shirt+I  根据类名查找类所在位置</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">    xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">"</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">         http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span><br><span class="line">        </span><br><span class="line">    &lt;!-- 注册 bean对象，默认通过无参构造方法初始化 bean 对象 </span><br><span class="line">    	 相当于 SomeService service = <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line">    --&gt;</span><br><span class="line">	&lt;bean id="someService" class="com.szxy.service.impl.SomeServiceImpl"&gt;&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 注册切面：前置通知 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"methodBeforeAdviceImpl2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.aspects.MethodBeforeAdviceImpl2"</span>/&gt;</span><br><span class="line">	&lt;!-- 注册切面：后置通知 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"myMethodBeforeAdivce"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.aspects.MyMethodBeforeAdivce"</span>/&gt;</span><br><span class="line">	&lt;!-- 注册切面：环绕通知 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"myMethodInterceptor"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.aspects.MyMethodInterceptor"</span>/&gt;</span><br><span class="line">	&lt;!-- 注册切面：异常通知 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"myThrowAdvice"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.aspects.MyThrowAdvice"</span>/&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 注册代理类对象 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"ProxyFactoryBean"</span>  <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;</span><br><span class="line">		&lt;!-- 指明目标类对象 --&gt;</span><br><span class="line">		&lt;property name="target" ref="someService"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 指明目标类所有接口 --&gt;</span><br><span class="line">		&lt;property name="interfaces" value="com.szxy.service.SomeService"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 指明切面 --&gt;</span><br><span class="line">		&lt;property name="interceptorNames"  value="myThrowAdvice"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-3-基于-AspectJ-方式之通知"><a href="#3-3-基于-AspectJ-方式之通知" class="headerlink" title="3.3  基于 AspectJ 方式之通知"></a>3.3  基于 AspectJ 方式之通知</h2><blockquote>
<p>支持注解式开发</p>
<p>最终通知：无论程序执行是否正常，该通知都会执行。</p>
</blockquote>
<h3 id="3-3-1-切入点表达式"><a href="#3-3-1-切入点表达式" class="headerlink" title="3.3.1 切入点表达式"></a>3.3.1 切入点表达式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">execution( </span><br><span class="line">	[modifiers-pattern]  访问权限类型</span><br><span class="line">	ret-type-pattern   返回值类型 </span><br><span class="line">	[deciaring-type-pattern]   全限定类名</span><br><span class="line">	name-pattern(param-pattern) 方法名（参数名）</span><br><span class="line">    [<span class="keyword">throws</span>-pattern]   抛出异常类型</span><br><span class="line">)</span><br><span class="line">   </span><br><span class="line">  * 表示 <span class="number">0</span>个或多个任意字符</span><br><span class="line">  </span><br><span class="line">  .. 用在方法参数前，表示任意多个参数</span><br><span class="line">     用在包名后，表示当前包及其子包路径</span><br><span class="line">     </span><br><span class="line">  +  用在类名后，表示当前类及其子类</span><br><span class="line">  	 用在接口后，表示当前接口及其实现类</span><br><span class="line">    </span><br><span class="line">execution(* *..service.*.*(..))</span><br><span class="line">指定所有包下的 service 子包下所有类(接口) 中的所有方法为切入点</span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-基于注解方式通知"><a href="#3-3-2-基于注解方式通知" class="headerlink" title="3.3.2 基于注解方式通知"></a>3.3.2 基于注解方式通知</h3><blockquote>
<p>@Aspect              表明当前类为切面</p>
<p>@Before              表明前置通知</p>
<p>@AfterReturning(value=””,returning=””)   表明后置通知</p>
<p>@Around               表明环绕通知</p>
<p>@AfterThrowing(value=””,throwing=””)      表明异常通知</p>
<p>@After  表明最终通知(不论程序是否正常运行，都执行该通知)</p>
</blockquote>
<ul>
<li>测试通知类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.aspects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//将当前作为切面</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspects</span> </span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	//前置通知</span></span><br><span class="line"><span class="comment">	@Before("execution(* *..service.*.someMethod(..))") </span></span><br><span class="line"><span class="comment">	public void methodBefore()&#123;</span></span><br><span class="line"><span class="comment">		System.out.println("前置通知...");</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	//后置通知  </span></span><br><span class="line"><span class="comment">	//注意：后置通知方法中的参数名与注解中的返回值参数名保持一致</span></span><br><span class="line"><span class="comment">	@AfterReturning(value="execution(* *..service.*.doOthers(..))",returning="result")</span></span><br><span class="line"><span class="comment">	public void afterMethod(Object result)&#123;</span></span><br><span class="line"><span class="comment">		</span></span><br><span class="line"><span class="comment">		System.out.println("后置通知... 目标方法的返回值:"+result);</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	//环绕通知</span></span><br><span class="line"><span class="comment">	@Around(value="execution(* *..service.*.doOthers(..))")</span></span><br><span class="line"><span class="comment">	public Object  aroundMethod(ProceedingJoinPoint joinPoint) throws Throwable&#123;</span></span><br><span class="line"><span class="comment">		System.out.println("环绕通知前 ..");</span></span><br><span class="line"><span class="comment">		//执行目标方法</span></span><br><span class="line"><span class="comment">		String result = (String)joinPoint.proceed();</span></span><br><span class="line"><span class="comment">		if(result != null)&#123;</span></span><br><span class="line"><span class="comment">			result = result.toUpperCase();//转换为大写</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">		System.out.println("环绕通知后 ..");</span></span><br><span class="line"><span class="comment">		return result;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="comment">//异常通知</span></span><br><span class="line">	<span class="meta">@AfterThrowing</span>(value=<span class="string">"execution(* *..service.*.someMethod(..))"</span>,throwing=<span class="string">"e"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testThrowing</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"异常通知..."</span>+e);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//最终通知</span></span><br><span class="line">	<span class="meta">@After</span>(<span class="string">"execution(* *..service.*.someMethod(..))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLastAdvice</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"最终通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>applicationContext.xml 文档配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">&lt;!-- 注册 bean对象，默认通过无参构造方法初始化 bean 对象 </span></span><br><span class="line"><span class="comment">    	 相当于 SomeService service = new SomeServiceImpl();</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"someService"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.SomeServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 注册切面 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspects"</span> <span class="attr">class</span>=<span class="string">"com.szxy.aspects.MyAspects"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--  aspectJ  自动代理 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-3-基于-XML-方式通知"><a href="#3-3-3-基于-XML-方式通知" class="headerlink" title="3.3.3 基于 XML 方式通知"></a>3.3.3 基于 XML 方式通知</h3><ul>
<li>applicationContext.xml 配置，注意配置前置带参数通知参数类型所导入的包</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">&lt;!-- 注册 bean对象，默认通过无参构造方法初始化 bean 对象 </span></span><br><span class="line"><span class="comment">    	 相当于 SomeService service = new SomeServiceImpl();</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"someService"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.SomeServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 注册切面 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspects"</span> <span class="attr">class</span>=<span class="string">"com.szxy.aspects.MyAspects"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- AOP 配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 目标方法 --&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* *..service.*.someMethod(..))"</span> <span class="attr">id</span>=<span class="string">"someMethodPC"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* *..service.*.doOthers(..))"</span> <span class="attr">id</span>=<span class="string">"doOthersPC"</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 定义切面 --&gt;</span></span><br><span class="line">	</span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspects"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 前置通知 --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- &lt;aop:before method="methodBefore" pointcut-ref="someMethodPC"/&gt; --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 带参数的前置通知 </span></span><br><span class="line"><span class="comment">				 方法名写参数的类型的全限定路径类名  org.aspectj.lang.JoinPoint		 </span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"methodBefore(org.aspectj.lang.JoinPoint)"</span> <span class="attr">pointcut-ref</span>=<span class="string">"someMethodPC"</span>/&gt;</span> </span><br><span class="line">			<span class="comment">&lt;!-- 后置通知 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"afterMethod(java.lang.Object)"</span>  <span class="attr">pointcut-ref</span>=<span class="string">"doOthersPC"</span> <span class="attr">returning</span>=<span class="string">"result"</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 环绕通知 </span></span><br><span class="line"><span class="comment">				 org.aspectj.lang.ProceedingJoinPoint  默认参数类型可以选择不加</span></span><br><span class="line"><span class="comment">			 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"aroundMethod(org.aspectj.lang.ProceedingJoinPoint)"</span> <span class="attr">pointcut-ref</span>=<span class="string">"doOthersPC"</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 异常通知 </span></span><br><span class="line"><span class="comment">				 带参数的异常通知  方法中写参数类型的全限定路径名 </span></span><br><span class="line"><span class="comment">				 throwing="e" 中的指定的参数 e 与 方法名中参数名一致</span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"testThrowing(java.lang.Exception)"</span> <span class="attr">pointcut-ref</span>=<span class="string">"someMethodPC"</span> <span class="attr">throwing</span>=<span class="string">"e"</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 最终通知 </span></span><br><span class="line"><span class="comment">				 不论程序是否发生问题，都要执行</span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"testLastAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"someMethodPC"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>切面测试类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.aspects;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;  <span class="comment">//导入这个包，别导错了 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  切入类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspects</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//前置通知</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">methodBefore</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"前置通知..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">methodBefore</span><span class="params">(JoinPoint jp)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"前置通知... jp:"</span>+jp);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//后置通知  </span></span><br><span class="line">	<span class="comment">//注意：后置通知方法中的参数名与注解中的返回值参数名保持一致</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterMethod</span><span class="params">(Object result)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"后置通知... 目标方法的返回值:"</span>+result);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//环绕通知</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object  <span class="title">aroundMethod</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"环绕通知前 .."</span>);</span><br><span class="line">		<span class="comment">//执行目标方法</span></span><br><span class="line">		String result = (String)joinPoint.proceed();</span><br><span class="line">		<span class="keyword">if</span>(result != <span class="keyword">null</span>)&#123;</span><br><span class="line">			result = result.toUpperCase();<span class="comment">//转换为大写</span></span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"环绕通知后 .."</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//异常通知</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testThrowing</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"异常通知..."</span>+e);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//最终通知</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLastAdvice</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"最终通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-Spring-事务管理"><a href="#4-Spring-事务管理" class="headerlink" title="4 Spring 事务管理"></a>4 Spring 事务管理</h1><blockquote>
<p>一般情况下，将事务从 dao 层提升到业务层，目的是运用事务的特性（ACID），便于管理具体的业务</p>
</blockquote>
<h2 id="4-1-Spring-事务管理API"><a href="#4-1-Spring-事务管理API" class="headerlink" title="4.1 Spring 事务管理API"></a>4.1 Spring 事务管理API</h2><p>PlatformTransctionManager 接口作为事务管理的对象。</p>
<p>其主要用于完成事务的提交、回滚、获取事务的状态信息</p>
<p>DataSourceTransactionManager 实现类  用于 jdbc 、mybatis </p>
<p>Spring 回滚方式：发生运行异常时回滚，发生受检查异常时提交。</p>
<p>事务定义接口 TransactionDefinition 中定义了事务描述相关变量：</p>
<ul>
<li>事务隔离级别</li>
<li>事务传播行为</li>
<li>事务默认超时时限</li>
<li>对上述事务的操作</li>
</ul>
<p>事务传播行为：处于不同事务中的方法在相互调用时，执行期间事务的维护情况。</p>
<p>REQUIRED: 指定方法必须在事务内执行</p>
<h2 id="4-2-使用-AspectJ-的AOP-配置管理事务"><a href="#4-2-使用-AspectJ-的AOP-配置管理事务" class="headerlink" title="4.2 使用 AspectJ 的AOP 配置管理事务"></a>4.2 使用 AspectJ 的AOP 配置管理事务</h2><blockquote>
<ol>
<li>注册事务管理器，依赖于数据源 dataSource</li>
<li>注册事务通知，设置连接的事务描述</li>
<li>AOP 配置</li>
</ol>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd "</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">     <span class="comment">&lt;!-- 加载数据库配置文件 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"db.properties"</span>/&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 加载数据源 ,使用 c3p0 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   	 </span><br><span class="line">   	 <span class="comment">&lt;!-- 账户  --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.AccountDaoImpl"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 基金 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fundDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.FundDaoImpl"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 基金业务层 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fundServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.FundServiceImpl"</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">ref</span>=<span class="string">"accountDaoImpl"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fundDaoImpl"</span> <span class="attr">ref</span>=<span class="string">"fundDaoImpl"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- 注册事务管理器 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">	 	 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- 注册事务通知 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- 连接点方法事务属性配置 --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"open*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	 			  注意：  rollback-for 的属性值是 异常类名</span></span><br><span class="line"><span class="comment">	 		 --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"buy*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"FundException"</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- AOP 配置 --&gt;</span>	</span><br><span class="line">	 <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!-- 切入点 --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* *..service.*.buyFund(..))"</span> <span class="attr">id</span>=<span class="string">"buyFundPC"</span>/&gt;</span>	</span><br><span class="line">	 		<span class="comment">&lt;!-- 通知 --&gt;</span>		</span><br><span class="line">		 	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"buyFundPC"</span>/&gt;</span> </span><br><span class="line">	 <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-3-AOP-事务注解方式"><a href="#4-3-AOP-事务注解方式" class="headerlink" title="4.3  AOP 事务注解方式"></a>4.3  AOP 事务注解方式</h2><ul>
<li>修改 代码，添加注释</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用 AOP 注解方式管理事务</span></span><br><span class="line"><span class="meta">@Transactional</span>(rollbackFor=FundException.class) </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buyFund</span><span class="params">(String aname, <span class="keyword">double</span> money, String fname, <span class="keyword">int</span> count)</span> <span class="keyword">throws</span> FundException </span>&#123;</span><br><span class="line">    accountDaoImpl.update(aname, money);</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span>==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FundException(<span class="string">"购买基金异常"</span>);			</span><br><span class="line">    &#125;</span><br><span class="line">    fundDaoImpl.update(fname, count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>applicationContext.xml  配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd "</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">     <span class="comment">&lt;!-- 加载数据库配置文件 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"db.properties"</span>/&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 加载数据源 ,使用 c3p0 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   	 </span><br><span class="line">   	 <span class="comment">&lt;!-- 账户  --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.AccountDaoImpl"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 基金 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fundDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.FundDaoImpl"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 基金业务层 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fundServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.FundServiceImpl"</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">ref</span>=<span class="string">"accountDaoImpl"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fundDaoImpl"</span> <span class="attr">ref</span>=<span class="string">"fundDaoImpl"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- 注册事务管理器 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">	 	 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- 注册事务通知 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- 连接点方法事务属性配置 --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"open*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	 			  注意：  rollback-for 的属性值是 异常类名</span></span><br><span class="line"><span class="comment">	 		 --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"buy*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"FundException"</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- AOP 配置 --&gt;</span>	</span><br><span class="line">	<span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">	 &lt;aop:config&gt;</span></span><br><span class="line"><span class="comment">	 		切入点</span></span><br><span class="line"><span class="comment">	 		&lt;aop:pointcut expression="execution(* *..service.*.buyFund(..))" id="buyFundPC"/&gt;	</span></span><br><span class="line"><span class="comment">	 		通知		</span></span><br><span class="line"><span class="comment">		 	&lt;aop:advisor advice-ref="txAdvice" pointcut-ref="buyFundPC"/&gt; </span></span><br><span class="line"><span class="comment">	 &lt;/aop:config&gt;</span></span><br><span class="line"><span class="comment">	  --&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!-- 使用 AOP 注解 --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>FundException 异常类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.exceptions;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  基金异常类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FundException</span> <span class="keyword">extends</span>  <span class="title">Exception</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">FundException</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	 </span><br><span class="line">	 <span class="function"><span class="keyword">public</span> <span class="title">FundException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">	        <span class="keyword">super</span>(message);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/spring/" rel="tag"># spring</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/04/04/20190404 OA管理系统开发/" rel="next" title="20190404 OA管理系统开发">
                  <i class="fa fa-chevron-left"></i> 20190404 OA管理系统开发
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/05/08/20190508 SpringMVC 框架/" rel="prev" title="20190508 SpringMVC 框架">
                  20190508 SpringMVC 框架 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-Spring-简介"><span class="nav-number">1.</span> <span class="nav-text">1 Spring 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-常用-jar-包"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 常用 jar 包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-Spring-版本差异"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 Spring 版本差异</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-Spring-之-IOC-控制反转"><span class="nav-number">2.</span> <span class="nav-text">2 Spring 之 IOC 控制反转</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-第一个-spring-程序"><span class="nav-number">2.1.</span> <span class="nav-text">2.1  第一个 spring 程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-导入-jar-包"><span class="nav-number">2.1.1.</span> <span class="nav-text">2.2.1 导入 jar 包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-创建-spring-配置文件"><span class="nav-number">2.1.2.</span> <span class="nav-text">2.2.2 创建 spring 配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-3-Bean-的定义与注册"><span class="nav-number">2.1.3.</span> <span class="nav-text">2.2.3 Bean 的定义与注册</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-4-从-spring-容器中获取-Bean"><span class="nav-number">2.1.4.</span> <span class="nav-text">2.2.4 从 spring 容器中获取 Bean</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-BeanFactory-与-ApplicationContext"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 BeanFactory 与 ApplicationContext</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-bean-装配"><span class="nav-number">2.3.</span> <span class="nav-text">2.3  bean 装配</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-1-dynamicFactory"><span class="nav-number">2.3.1.</span> <span class="nav-text">2.3.1 dynamicFactory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-2-staticFactory"><span class="nav-number">2.3.2.</span> <span class="nav-text">2.3.2  staticFactory</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-bean-作用域"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 bean 作用域</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-基于XML-方式的-DI"><span class="nav-number">2.5.</span> <span class="nav-text">2.5 基于XML 方式的 DI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-1-设值注入"><span class="nav-number">2.5.1.</span> <span class="nav-text">2.5.1 设值注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-2-构造注入"><span class="nav-number">2.5.2.</span> <span class="nav-text">2.5.2 构造注入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-基于注解-annotation-方式DI"><span class="nav-number">2.6.</span> <span class="nav-text">2.6 基于注解 annotation 方式DI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-1-环境搭建"><span class="nav-number">2.6.1.</span> <span class="nav-text">2.6.1 环境搭建</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-2-常用注解"><span class="nav-number">2.7.</span> <span class="nav-text">2.6.2 常用注解</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-AOP"><span class="nav-number">3.</span> <span class="nav-text">3  AOP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-三种代理方式"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 三种代理方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-1-静态代理"><span class="nav-number">3.1.1.</span> <span class="nav-text">3.1.1 静态代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-2-JDK动态代理"><span class="nav-number">3.1.2.</span> <span class="nav-text">3.1.2  JDK动态代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-3-CGLIB-代理"><span class="nav-number">3.1.3.</span> <span class="nav-text">3.1.3 CGLIB 代理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CGLIB-代理类工厂"><span class="nav-number">3.1.3.1.</span> <span class="nav-text">CGLIB 代理类工厂</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#测试"><span class="nav-number">3.1.3.2.</span> <span class="nav-text">测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-基于Schema-based方式之通知"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 基于Schema-based方式之通知</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-基于-AspectJ-方式之通知"><span class="nav-number">3.3.</span> <span class="nav-text">3.3  基于 AspectJ 方式之通知</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-切入点表达式"><span class="nav-number">3.3.1.</span> <span class="nav-text">3.3.1 切入点表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-基于注解方式通知"><span class="nav-number">3.3.2.</span> <span class="nav-text">3.3.2 基于注解方式通知</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-3-基于-XML-方式通知"><span class="nav-number">3.3.3.</span> <span class="nav-text">3.3.3 基于 XML 方式通知</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-Spring-事务管理"><span class="nav-number">4.</span> <span class="nav-text">4 Spring 事务管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-Spring-事务管理API"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 Spring 事务管理API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-使用-AspectJ-的AOP-配置管理事务"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 使用 AspectJ 的AOP 配置管理事务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-AOP-事务注解方式"><span class="nav-number">4.3.</span> <span class="nav-text">4.3  AOP 事务注解方式</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zwer</p>
  <div class="site-description" itemprop="description">记录学习的日常</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">74</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span>
        
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">tags</span>
        
      </div>
    
  </nav>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zwer</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.4.0</div>

        












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/muse.js?v=7.4.0"></script>
<script src="/js/next-boot.js?v=7.4.0"></script>



  





















  

  

  

</body>
</html>
