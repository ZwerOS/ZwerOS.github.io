<!DOCTYPE html>





<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="1 项目概况  2 搭建项目框架1 设置工作空间的编码，设置 workspace 的编码为 utf-8 2  创建包和文件，注意可以不同文件夹创建相同的包，但是不能建相同类名的类 ​    system 人事 、 duty 、 expense  、 inout 收支 3 导入 jar 包 和 工具类以及配置文件  4 导入 SQL 脚本 3 部门模块3.1 Junit 测试 使用注解@Test进行">
<meta name="keywords" content="OA系统">
<meta property="og:type" content="article">
<meta property="og:title" content="20190404 OA管理系统开发">
<meta property="og:url" content="http://zwer.xyz/2019/04/04/20190404 OA管理系统开发/index.html">
<meta property="og:site_name" content="zwer 的博客空间">
<meta property="og:description" content="1 项目概况  2 搭建项目框架1 设置工作空间的编码，设置 workspace 的编码为 utf-8 2  创建包和文件，注意可以不同文件夹创建相同的包，但是不能建相同类名的类 ​    system 人事 、 duty 、 expense  、 inout 收支 3 导入 jar 包 和 工具类以及配置文件  4 导入 SQL 脚本 3 部门模块3.1 Junit 测试 使用注解@Test进行">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://www.zwer.xyz/picGo/20190404213006.png">
<meta property="og:image" content="http://www.zwer.xyz/picGo/%E5%AE%A1%E6%A0%B8%E6%B5%81%E7%A8%8B%E5%9B%BE1.png">
<meta property="og:image" content="http://www.zwer.xyz/picGo/20190428205130.png">
<meta property="og:image" content="http://www.zwer.xyz/picGo/20190506083256.png">
<meta property="og:image" content="http://www.zwer.xyz/picGo/20190506083833.png">
<meta property="og:image" content="http://www.zwer.xyz/picGo/20190506083935.png">
<meta property="og:image" content="http://www.zwer.xyz/picGo/20190506083951.png">
<meta property="og:updated_time" content="2019-05-09T02:02:43.777Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="20190404 OA管理系统开发">
<meta name="twitter:description" content="1 项目概况  2 搭建项目框架1 设置工作空间的编码，设置 workspace 的编码为 utf-8 2  创建包和文件，注意可以不同文件夹创建相同的包，但是不能建相同类名的类 ​    system 人事 、 duty 、 expense  、 inout 收支 3 导入 jar 包 和 工具类以及配置文件  4 导入 SQL 脚本 3 部门模块3.1 Junit 测试 使用注解@Test进行">
<meta name="twitter:image" content="http://www.zwer.xyz/picGo/20190404213006.png">
  <link rel="canonical" href="http://zwer.xyz/2019/04/04/20190404 OA管理系统开发/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>20190404 OA管理系统开发 | zwer 的博客空间</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zwer 的博客空间</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">上善若水 自强不息</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/04/04/20190404 OA管理系统开发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">20190404 OA管理系统开发

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-04-04 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-04T00:00:00+08:00">2019-04-04</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-09 10:02:43" itemprop="dateModified" datetime="2019-05-09T10:02:43+08:00">2019-05-09</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="1-项目概况"><a href="#1-项目概况" class="headerlink" title="1 项目概况"></a>1 项目概况</h1><blockquote>
</blockquote>
<h1 id="2-搭建项目框架"><a href="#2-搭建项目框架" class="headerlink" title="2 搭建项目框架"></a>2 搭建项目框架</h1><p>1 设置工作空间的编码，设置 workspace 的编码为 utf-8</p>
<p>2  创建包和文件，注意可以不同文件夹创建相同的包，但是不能建相同类名的类</p>
<p>​    system 人事 、 duty 、 expense  、 inout 收支</p>
<p>3 导入 jar 包 和 工具类以及配置文件 </p>
<p>4 导入 SQL 脚本</p>
<h1 id="3-部门模块"><a href="#3-部门模块" class="headerlink" title="3 部门模块"></a>3 部门模块</h1><h2 id="3-1-Junit-测试"><a href="#3-1-Junit-测试" class="headerlink" title="3.1 Junit 测试"></a>3.1 Junit 测试</h2><blockquote>
<p>使用注解<code>@Test</code>进行测试</p>
<p>​                <code>@ignore</code>取消该方法的测试</p>
<p>建议测试方法名<code>testMethod()</code></p>
</blockquote>
<h2 id="3-2-重定向和请求转发"><a href="#3-2-重定向和请求转发" class="headerlink" title="3.2  重定向和请求转发"></a>3.2  重定向和请求转发</h2><blockquote>
<p>建议在提交表单后，使用重定向，防止表单重复提交，保护第一次请求数据。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.getContextPath()  <span class="comment">//动态获取上下文路径</span></span><br></pre></td></tr></table></figure>

<h2 id="3-3-断点调试"><a href="#3-3-断点调试" class="headerlink" title="3.3 断点调试"></a>3.3 断点调试</h2><blockquote>
<p>在 servlet 中，设置断点，然后在客户端执行相应的操作，查看代码的运行过程。</p>
</blockquote>
<ol>
<li>以 dubug 模式开启 server 服务器</li>
<li>设置断点</li>
<li>查看运行过程</li>
</ol>
<h2 id="3-3-时序图"><a href="#3-3-时序图" class="headerlink" title="3.3 时序图"></a>3.3 时序图</h2><h3 id="3-3-1-添加部门信息"><a href="#3-3-1-添加部门信息" class="headerlink" title="3.3.1 添加部门信息"></a>3.3.1 添加部门信息</h3><p><img src="http://www.zwer.xyz/picGo/20190404213006.png" alt></p>
<h3 id="3-3-2-部门信息更新操作"><a href="#3-3-2-部门信息更新操作" class="headerlink" title="3.3.2 部门信息更新操作"></a>3.3.2 部门信息更新操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">title: 更新操作</span><br><span class="line"></span><br><span class="line">participant deptList.jsp</span><br><span class="line">participant deptUpdate.jsp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DeparmentServlet -&gt; DepartmentService:调用 findDeptById(req,resp)方法</span><br><span class="line">DepartmentService -&gt; DepartmentDao:调用 findDeptById(int deptno)方法</span><br><span class="line">DepartmentDao -&gt; DBUtil:调用 findDeptById(int deptno)方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DBUtil - &gt; DepartmentDao: return dept</span><br><span class="line">DepartmentDao -&gt; DepartmentService: return dept </span><br><span class="line">DepartmentService-&gt; DeparmentServlet: return dept </span><br><span class="line">DeparmentServlet -&gt; deptUpdate.jsp:显示</span><br><span class="line"></span><br><span class="line">deptUpdate.jsp -&gt; DeparmentServlet: 发送请求update(Department dept)</span><br><span class="line">DeparmentServlet -&gt;DepartmentService: 调用update(Department dept)</span><br><span class="line">DepartmentService -&gt; DepartmentDao:调用 update(Department dept) </span><br><span class="line">DepartmentDao-&gt;DBUtil:调用 update(Department dept) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DBUtil - &gt; DepartmentDao: return dept</span><br><span class="line">DepartmentDao -&gt; DepartmentService: return dept </span><br><span class="line">DepartmentService-&gt; DeparmentServlet: return dept </span><br><span class="line">DeparmentServlet -&gt; deptList.jsp:显示</span><br></pre></td></tr></table></figure>

<h2 id="3-4-属性关联"><a href="#3-4-属性关联" class="headerlink" title="3.4  属性关联"></a>3.4  属性关联</h2><blockquote>
<p>用于实体类一对多关系</p>
<p>将表中的外键关系，在 java 语言用 类与类之间的关系表表示</p>
<p>new  java.sql.Date(().getTime);</p>
<p>如何表示员工所属一个部门、一个岗位、一个上级、甚至多个下级的信息？</p>
<p>在数据库中通过外键来实现： deptno、posid、mgrid</p>
<p>在 Java 类中通过属性关联来实现，即通过添加类有私有属性完成。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一对多的联系</span></span><br><span class="line"><span class="comment"> * 在 Java 类中通过属性关联的方式实现</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 	private Department dept;// 所在部门的信息</span></span><br><span class="line"><span class="comment">	private Position pos; //所在岗位的信息</span></span><br><span class="line"><span class="comment">	private Employee mgr; //上级领导</span></span><br><span class="line"><span class="comment">	private List&lt;Employee&gt; empList = new ArrayList&lt;&gt;(); //下级员工</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String empId;</span><br><span class="line">	<span class="keyword">private</span> String passWord;</span><br><span class="line">	<span class="keyword">private</span> String realName;</span><br><span class="line">	<span class="keyword">private</span> String sex;</span><br><span class="line">	<span class="keyword">private</span> Date birthDate; <span class="comment">//出生日期</span></span><br><span class="line">	<span class="keyword">private</span> Date hireDate;  <span class="comment">//入职日期</span></span><br><span class="line">	<span class="keyword">private</span> Date leaveDate; <span class="comment">//离职日期</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> onduty; <span class="comment">//   0-离职  1-在职         </span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> emptype;<span class="comment">//   1.普通员工  2.管理人员 含经理、总监、总裁等  3.管理员 	</span></span><br><span class="line">	<span class="keyword">private</span> String phone;</span><br><span class="line">	<span class="keyword">private</span> String qq;</span><br><span class="line">	<span class="keyword">private</span> String emerContactPerson;<span class="comment">//紧急联系人</span></span><br><span class="line">	<span class="keyword">private</span> String idCard; <span class="comment">// 身份证号</span></span><br><span class="line">	<span class="keyword">private</span> Department dept;<span class="comment">// 所在部门的信息</span></span><br><span class="line">	<span class="keyword">private</span> Position pos; <span class="comment">//所在岗位的信息</span></span><br><span class="line">	<span class="keyword">private</span> Employee mgr; <span class="comment">//上级领导</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Employee&gt; empList = <span class="keyword">new</span> ArrayList&lt;&gt;(); <span class="comment">//下级员工</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(String empId, String passWord, String realName, String sex,</span></span></span><br><span class="line"><span class="function"><span class="params">			Date birthDate, Date hireDate, Date leaveDate, <span class="keyword">int</span> onduty,</span></span></span><br><span class="line"><span class="function"><span class="params">			<span class="keyword">int</span> emptype, String phone, String qq, String emerContactPerson,</span></span></span><br><span class="line"><span class="function"><span class="params">			String idCard, Department dept, Position pos, Employee mgr,</span></span></span><br><span class="line"><span class="function"><span class="params">			List&lt;Employee&gt; empList)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.empId = empId;</span><br><span class="line">		<span class="keyword">this</span>.passWord = passWord;</span><br><span class="line">		<span class="keyword">this</span>.realName = realName;</span><br><span class="line">		<span class="keyword">this</span>.sex = sex;</span><br><span class="line">		<span class="keyword">this</span>.birthDate = birthDate;</span><br><span class="line">		<span class="keyword">this</span>.hireDate = hireDate;</span><br><span class="line">		<span class="keyword">this</span>.leaveDate = leaveDate;</span><br><span class="line">		<span class="keyword">this</span>.onduty = onduty;</span><br><span class="line">		<span class="keyword">this</span>.emptype = emptype;</span><br><span class="line">		<span class="keyword">this</span>.phone = phone;</span><br><span class="line">		<span class="keyword">this</span>.qq = qq;</span><br><span class="line">		<span class="keyword">this</span>.emerContactPerson = emerContactPerson;</span><br><span class="line">		<span class="keyword">this</span>.idCard = idCard;</span><br><span class="line">		<span class="keyword">this</span>.dept = dept;</span><br><span class="line">		<span class="keyword">this</span>.pos = pos;</span><br><span class="line">		<span class="keyword">this</span>.mgr = mgr;</span><br><span class="line">		<span class="keyword">this</span>.empList = empList;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(String empId, String passWord, String realName, String sex,</span></span></span><br><span class="line"><span class="function"><span class="params">			Date birthDate, Date hireDate, Date leaveDate, <span class="keyword">int</span> onduty,</span></span></span><br><span class="line"><span class="function"><span class="params">			<span class="keyword">int</span> emptype, String phone, String qq, String emerContactPerson,</span></span></span><br><span class="line"><span class="function"><span class="params">			String idCard, Department dept, Position pos, Employee mgr)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.empId = empId;</span><br><span class="line">		<span class="keyword">this</span>.passWord = passWord;</span><br><span class="line">		<span class="keyword">this</span>.realName = realName;</span><br><span class="line">		<span class="keyword">this</span>.sex = sex;</span><br><span class="line">		<span class="keyword">this</span>.birthDate = birthDate;</span><br><span class="line">		<span class="keyword">this</span>.hireDate = hireDate;</span><br><span class="line">		<span class="keyword">this</span>.leaveDate = leaveDate;</span><br><span class="line">		<span class="keyword">this</span>.onduty = onduty;</span><br><span class="line">		<span class="keyword">this</span>.emptype = emptype;</span><br><span class="line">		<span class="keyword">this</span>.phone = phone;</span><br><span class="line">		<span class="keyword">this</span>.qq = qq;</span><br><span class="line">		<span class="keyword">this</span>.emerContactPerson = emerContactPerson;</span><br><span class="line">		<span class="keyword">this</span>.idCard = idCard;</span><br><span class="line">		<span class="keyword">this</span>.dept = dept;</span><br><span class="line">		<span class="keyword">this</span>.pos = pos;</span><br><span class="line">		<span class="keyword">this</span>.mgr = mgr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmpId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> empId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmpId</span><span class="params">(String empId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.empId = empId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassWord</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> passWord;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassWord</span><span class="params">(String passWord)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.passWord = passWord;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getRealName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> realName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRealName</span><span class="params">(String realName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.realName = realName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sex = sex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getBirthDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> birthDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthDate</span><span class="params">(Date birthDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.birthDate = birthDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getHireDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> hireDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHireDate</span><span class="params">(Date hireDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.hireDate = hireDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getLeaveDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> leaveDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeaveDate</span><span class="params">(Date leaveDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.leaveDate = leaveDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOnduty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> onduty;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnduty</span><span class="params">(<span class="keyword">int</span> onduty)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.onduty = onduty;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getEmptype</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> emptype;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmptype</span><span class="params">(<span class="keyword">int</span> emptype)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.emptype = emptype;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPhone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> phone;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPhone</span><span class="params">(String phone)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.phone = phone;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getQq</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> qq;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQq</span><span class="params">(String qq)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.qq = qq;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmerContactPerson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> emerContactPerson;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmerContactPerson</span><span class="params">(String emerContactPerson)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.emerContactPerson = emerContactPerson;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getIdCard</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> idCard;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIdCard</span><span class="params">(String idCard)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.idCard = idCard;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Department <span class="title">getDept</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dept;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDept</span><span class="params">(Department dept)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.dept = dept;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Position <span class="title">getPos</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pos;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPos</span><span class="params">(Position pos)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pos = pos;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Employee <span class="title">getMgr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mgr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMgr</span><span class="params">(Employee mgr)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mgr = mgr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> empList;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmpList</span><span class="params">(List&lt;Employee&gt; empList)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.empList = empList;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="keyword">int</span> prime = <span class="number">31</span>;</span><br><span class="line">		<span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((birthDate == <span class="keyword">null</span>) ? <span class="number">0</span> : birthDate.hashCode());</span><br><span class="line">		result = prime * result + ((dept == <span class="keyword">null</span>) ? <span class="number">0</span> : dept.hashCode());</span><br><span class="line">		result = prime</span><br><span class="line">				* result</span><br><span class="line">				+ ((emerContactPerson == <span class="keyword">null</span>) ? <span class="number">0</span> : emerContactPerson</span><br><span class="line">						.hashCode());</span><br><span class="line">		result = prime * result + ((empId == <span class="keyword">null</span>) ? <span class="number">0</span> : empId.hashCode());</span><br><span class="line">		result = prime * result + ((empList == <span class="keyword">null</span>) ? <span class="number">0</span> : empList.hashCode());</span><br><span class="line">		result = prime * result + emptype;</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((hireDate == <span class="keyword">null</span>) ? <span class="number">0</span> : hireDate.hashCode());</span><br><span class="line">		result = prime * result + ((idCard == <span class="keyword">null</span>) ? <span class="number">0</span> : idCard.hashCode());</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((leaveDate == <span class="keyword">null</span>) ? <span class="number">0</span> : leaveDate.hashCode());</span><br><span class="line">		result = prime * result + ((mgr == <span class="keyword">null</span>) ? <span class="number">0</span> : mgr.hashCode());</span><br><span class="line">		result = prime * result + onduty;</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((passWord == <span class="keyword">null</span>) ? <span class="number">0</span> : passWord.hashCode());</span><br><span class="line">		result = prime * result + ((phone == <span class="keyword">null</span>) ? <span class="number">0</span> : phone.hashCode());</span><br><span class="line">		result = prime * result + ((pos == <span class="keyword">null</span>) ? <span class="number">0</span> : pos.hashCode());</span><br><span class="line">		result = prime * result + ((qq == <span class="keyword">null</span>) ? <span class="number">0</span> : qq.hashCode());</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((realName == <span class="keyword">null</span>) ? <span class="number">0</span> : realName.hashCode());</span><br><span class="line">		result = prime * result + ((sex == <span class="keyword">null</span>) ? <span class="number">0</span> : sex.hashCode());</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span> == obj)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		<span class="keyword">if</span> (obj == <span class="keyword">null</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (getClass() != obj.getClass())</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		Employee other = (Employee) obj;</span><br><span class="line">		<span class="keyword">if</span> (birthDate == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.birthDate != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!birthDate.equals(other.birthDate))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (dept == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.dept != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!dept.equals(other.dept))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (emerContactPerson == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.emerContactPerson != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!emerContactPerson.equals(other.emerContactPerson))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (empId == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.empId != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!empId.equals(other.empId))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (empList == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.empList != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!empList.equals(other.empList))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (emptype != other.emptype)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (hireDate == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.hireDate != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!hireDate.equals(other.hireDate))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (idCard == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.idCard != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!idCard.equals(other.idCard))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (leaveDate == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.leaveDate != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!leaveDate.equals(other.leaveDate))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (mgr == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.mgr != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!mgr.equals(other.mgr))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (onduty != other.onduty)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (passWord == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.passWord != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!passWord.equals(other.passWord))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (phone == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.phone != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!phone.equals(other.phone))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (pos == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.pos != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!pos.equals(other.pos))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (qq == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.qq != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!qq.equals(other.qq))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (realName == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.realName != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!realName.equals(other.realName))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (sex == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.sex != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!sex.equals(other.sex))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Employee [empId="</span> + empId + <span class="string">", passWord="</span> + passWord</span><br><span class="line">				+ <span class="string">", realName="</span> + realName + <span class="string">", sex="</span> + sex + <span class="string">", birthDate="</span></span><br><span class="line">				+ birthDate + <span class="string">", hireDate="</span> + hireDate + <span class="string">", leaveDate="</span></span><br><span class="line">				+ leaveDate + <span class="string">", onduty="</span> + onduty + <span class="string">", emptype="</span> + emptype</span><br><span class="line">				+ <span class="string">", phone="</span> + phone + <span class="string">", qq="</span> + qq + <span class="string">", emerContactPerson="</span></span><br><span class="line">				+ emerContactPerson + <span class="string">", idCard="</span> + idCard + <span class="string">", dept="</span> + dept</span><br><span class="line">				+ <span class="string">", pos="</span> + pos + <span class="string">", mgr="</span> + mgr + <span class="string">", empList="</span> + empList</span><br><span class="line">				+ <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-5-日历插件"><a href="#3-5-日历插件" class="headerlink" title="3.5  日历插件"></a>3.5  日历插件</h2><blockquote>
<p>使用日历插件的步骤</p>
<p>导入日历插件的Js文件，对 input 输入框添加焦点事件，使用 WdatePicker()函数，</p>
<p>配置使用参数 Json 格式 {属性名：属性值}</p>
</blockquote>
<ol>
<li>导入日历插件的 Js 文件</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入日历插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"My97DatePicker/WdatePicker.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>添加鼠标事件，使用日历插件</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>出生日期<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"dfinput"</span> 		       <span class="attr">onfocus</span>=<span class="string">"WdatePicker(&#123;lang:'en',skin:'whyGreen'&#125;)"</span>/&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">i</span>&gt;</span>也可以根据身份证号自动获取<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>调整日历插件的配置,使用 json 格式</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WdatePicker(&#123;lang:'en',skin:'whyGreen'&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="3-6-富文本编辑器"><a href="#3-6-富文本编辑器" class="headerlink" title="3.6 富文本编辑器"></a>3.6 富文本编辑器</h2><blockquote>
<p>使用富文本编辑器 KindEditor</p>
</blockquote>
<ol>
<li>导入富文本编辑器 JS 文件</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入富文本编辑器插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"editor/kindeditor.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>绑定 ID</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>紧急联系人信息<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">""</span>  <span class="attr">id</span>=<span class="string">"ecp"</span> <span class="attr">cols</span>=<span class="string">""</span> <span class="attr">rows</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"textinput"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改配置</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">		<span class="comment">// 注意：要选择 id 键，指明在哪里使用富文本编辑器</span></span></span><br><span class="line"><span class="javascript">		KE.show(&#123;<span class="attr">id</span>:<span class="string">"ecp"</span>,<span class="attr">width</span>:<span class="string">"500px"</span>,<span class="attr">height</span>:<span class="string">"300px;"</span>,<span class="attr">resizeType</span>:<span class="number">1</span>,<span class="attr">skinType</span>:<span class="string">"tinymce"</span>,</span></span><br><span class="line">			items:[</span><br><span class="line"><span class="javascript">		        <span class="string">'source'</span>, <span class="string">'|'</span>, <span class="string">'undo'</span>, <span class="string">'redo'</span>, <span class="string">'|'</span>, <span class="string">'preview'</span>, <span class="string">'print'</span>, <span class="string">'template'</span>, <span class="string">'code'</span>, <span class="string">'cut'</span>, <span class="string">'copy'</span>, <span class="string">'paste'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'plainpaste'</span>, <span class="string">'wordpaste'</span>, <span class="string">'|'</span>, <span class="string">'justifyleft'</span>, <span class="string">'justifycenter'</span>, <span class="string">'justifyright'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'justifyfull'</span>, <span class="string">'insertorderedlist'</span>, <span class="string">'insertunorderedlist'</span>, <span class="string">'indent'</span>, <span class="string">'outdent'</span>, <span class="string">'subscript'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'superscript'</span>, <span class="string">'clearhtml'</span>, <span class="string">'quickformat'</span>, <span class="string">'selectall'</span>, <span class="string">'|'</span>, <span class="string">'fullscreen'</span>, <span class="string">'/'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'formatblock'</span>, <span class="string">'fontname'</span>, <span class="string">'fontsize'</span>, <span class="string">'|'</span>, <span class="string">'forecolor'</span>, <span class="string">'hilitecolor'</span>, <span class="string">'bold'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'italic'</span>, <span class="string">'underline'</span>, <span class="string">'strikethrough'</span>, <span class="string">'lineheight'</span>, <span class="string">'removeformat'</span>, <span class="string">'|'</span>, <span class="string">'image'</span>, <span class="string">'multiimage'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'flash'</span>, <span class="string">'media'</span>, <span class="string">'insertfile'</span>, <span class="string">'table'</span>, <span class="string">'hr'</span>, <span class="string">'emoticons'</span>, <span class="string">'baidumap'</span>, <span class="string">'pagebreak'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'anchor'</span>, <span class="string">'link'</span>, <span class="string">'unlink'</span>, <span class="string">'|'</span>, <span class="string">'about'</span></span></span><br><span class="line">		]</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-8-一对多查询"><a href="#3-8-一对多查询" class="headerlink" title="3.8  一对多查询"></a>3.8  一对多查询</h2><blockquote>
<p>SQL 语句采用多表连接的方式，按需求将所需数据查找出来。</p>
<p>不建议采用 调用其他 dao 层 对象查找所需数据，再组合起来，这样耦合性高，查询效率不理想。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">findAllEmpsInfoService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Connection conn = <span class="keyword">null</span>;</span><br><span class="line">		PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">		ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">		List&lt;Employee&gt; emps = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			conn = DBUtil.getConnection();</span><br><span class="line">			<span class="comment">/*String sql = "select * from employee";*/</span></span><br><span class="line">			String sql = <span class="string">"select  e.*,d.deptname,d.location,p.pname,mgr.empid,mgr.realname"</span>+</span><br><span class="line">						 <span class="string">"	from employee e"</span>+</span><br><span class="line">						 <span class="string">"	left join dept d"</span>+</span><br><span class="line">						 <span class="string">"	on e.deptno = d.deptno"</span>+</span><br><span class="line">						 <span class="string">"	left join position p"</span>+</span><br><span class="line">						 <span class="string">"	on e.posid = p.posid"</span>+</span><br><span class="line">						 <span class="string">"	left join employee mgr"</span>+</span><br><span class="line">						 <span class="string">"	on e.mgrid = mgr.empid"</span>;</span><br><span class="line">			ps = conn.prepareStatement(sql);</span><br><span class="line">			rs = ps.executeQuery();</span><br><span class="line">			emps = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">			<span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">				Employee emp = <span class="keyword">new</span> Employee();</span><br><span class="line">				emp.setEmpId(rs.getString(<span class="string">"empid"</span>));</span><br><span class="line">				emp.setRealName(rs.getString(<span class="string">"realname"</span>));</span><br><span class="line">				emp.setPassWord(rs.getString(<span class="string">"password"</span>));</span><br><span class="line">				emp.setSex(rs.getString(<span class="string">"sex"</span>));</span><br><span class="line">				emp.setHireDate(rs.getDate(<span class="string">"hiredate"</span>));</span><br><span class="line">				emp.setBirthDate(rs.getDate(<span class="string">"birthdate"</span>));</span><br><span class="line">				emp.setLeaveDate(rs.getDate(<span class="string">"leavedate"</span>));</span><br><span class="line">				emp.setPhone(rs.getString(<span class="string">"phone"</span>));</span><br><span class="line">				emp.setEmptype(rs.getInt(<span class="string">"emptype"</span>));</span><br><span class="line">				emp.setOnduty(rs.getInt(<span class="string">"onduty"</span>));</span><br><span class="line">				emp.setQq(rs.getString(<span class="string">"qq"</span>));</span><br><span class="line">				emp.setEmerContactPerson(rs.getString(<span class="string">"emercontactperson"</span>));</span><br><span class="line">				emp.setIdCard(rs.getString(<span class="string">"idcard"</span>));</span><br><span class="line">				</span><br><span class="line">				Department dept = <span class="keyword">new</span> Department();</span><br><span class="line">				dept.setDeptno(rs.getInt(<span class="string">"deptno"</span>));</span><br><span class="line">				dept.setDeptName(rs.getString(<span class="string">"deptName"</span>));</span><br><span class="line">				emp.setDept(dept);</span><br><span class="line">				</span><br><span class="line">				Position pos = <span class="keyword">new</span> Position();</span><br><span class="line">				pos.setPosid(rs.getInt(<span class="string">"posid"</span>));</span><br><span class="line">				pos.setPosName(rs.getString(<span class="string">"pname"</span>));</span><br><span class="line">				emp.setPos(pos);</span><br><span class="line">				</span><br><span class="line">				Employee mgr = <span class="keyword">new</span> Employee();</span><br><span class="line">				mgr.setEmpId(rs.getString(<span class="string">"empid"</span>));</span><br><span class="line">				mgr.setRealName(rs.getString(<span class="string">"realname"</span>));</span><br><span class="line">				emp.setMgr(mgr);</span><br><span class="line">				</span><br><span class="line">				<span class="comment">// 耦合性太高，而且查询速度慢</span></span><br><span class="line">			<span class="comment">/*	//调用 DepartmentDao</span></span><br><span class="line"><span class="comment">				DepartmentDao deptDao = new DepartmentDaoImpl();</span></span><br><span class="line"><span class="comment">				Department dept = deptDao.findDeptInfoByIdDao(rs.getInt("emptype")); </span></span><br><span class="line"><span class="comment">				emp.setDept(dept);</span></span><br><span class="line"><span class="comment">				//调用 PositionDao </span></span><br><span class="line"><span class="comment">				PositionDao posDao = new PositionDaoImpl();</span></span><br><span class="line"><span class="comment">				Position pos = posDao.findPosInfoById(rs.getString("posid"));</span></span><br><span class="line"><span class="comment">				emp.setPos(pos);</span></span><br><span class="line"><span class="comment">				//调用 this ,查找该员工的上级信息</span></span><br><span class="line"><span class="comment">				Employee mgr = this.findEmpInfoByIdDao(rs.getString("mgrid"));</span></span><br><span class="line"><span class="comment">				emp.setMgr(mgr);</span></span><br><span class="line"><span class="comment">				//调用 this ，查找该员工的所有下级信息</span></span><br><span class="line"><span class="comment">				List&lt;Employee&gt; empList = this.findEmpsInfoByMgrDao(rs.getString("mgrid"));</span></span><br><span class="line"><span class="comment">				emp.setEmpList(empList);*/</span></span><br><span class="line">						</span><br><span class="line">				emps.add(emp);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			DBUtil.closeAll(rs, ps, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> emps; </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-9-动态-SQL语句"><a href="#3-9-动态-SQL语句" class="headerlink" title="3.9  动态 SQL语句"></a>3.9  动态 SQL语句</h2><blockquote>
<p>使用 <code>StringBuilder</code> 类中 <code>append</code> 方法，j加上 if  条件动态控制 where 子句的查询条件的选择</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*String sql = "select * from employee";*/</span></span><br><span class="line">StringBuilder sql = <span class="keyword">new</span> StringBuilder(<span class="string">"select  e.*,d.deptname,d.location,p.pname,mgr.empid,mgr.realname mgrRealName"</span>+</span><br><span class="line">				<span class="string">" from employee e"</span>+</span><br><span class="line">				<span class="string">" left join dept d"</span>+</span><br><span class="line">				<span class="string">" on e.deptno = d.deptno"</span>+</span><br><span class="line">				<span class="string">" left join position p"</span>+</span><br><span class="line">				<span class="string">" on e.posid = p.posid"</span>+</span><br><span class="line">				<span class="string">" left join employee mgr"</span>+</span><br><span class="line">				<span class="string">" on e.mgrid = mgr.empid where 1=1"</span>);</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(empId !=<span class="keyword">null</span>&amp;&amp;!empId.equals(<span class="string">""</span>))&#123;</span><br><span class="line">					sql.append(<span class="string">" and e.empid like '%"</span>+empId+<span class="string">"%'"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(deptNO !=<span class="keyword">null</span> &amp;&amp; !deptNO.equals(<span class="string">"0"</span>))&#123;</span><br><span class="line">					sql.append(<span class="string">" and e.deptno ="</span>+deptNO);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(onDuty !=<span class="keyword">null</span> &amp;&amp; !empId.equals(<span class="string">""</span>))&#123;</span><br><span class="line">					sql.append(<span class="string">" and e.onDuty ="</span>+onDuty);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				</span><br><span class="line">				System.out.println(sql.toString());</span><br><span class="line">				ps = conn.prepareStatement(sql.toString());</span><br></pre></td></tr></table></figure>

<h2 id="3-10-servlet-接受表单数据预处理"><a href="#3-10-servlet-接受表单数据预处理" class="headerlink" title="3.10 servlet 接受表单数据预处理"></a>3.10 servlet 接受表单数据预处理</h2><blockquote>
<p>通过预先对传入的数据进行 null 值判断。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转换日期格式</span></span><br><span class="line">SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-mm-dd"</span>);</span><br><span class="line">Date birthDate = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    birthDate = sdf.parse(sBirthDay);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(hireDate !=<span class="keyword">null</span> &amp;&amp; !hireDate.equals(<span class="string">""</span>))&#123;</span><br><span class="line">    Date date = <span class="keyword">new</span> java.sql.Date(hireDate.getTime());</span><br><span class="line">    sql.append(<span class="string">" and to_char(e.hiredate,'yyyy-MM-dd') &gt;='"</span>+date+<span class="string">"'"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-11-获取同名列的问题"><a href="#3-11-获取同名列的问题" class="headerlink" title="3.11 获取同名列的问题"></a>3.11 获取同名列的问题</h2><blockquote>
<p>解决方法：为同名列起别名，区分不同同名列。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">StringBuilder sql = </span><br><span class="line"> 	<span class="keyword">new</span> StringBuilder(<span class="string">"select  e.*,d.deptname,d.location,p.pname,mgr.empid,mgr.realname mgrRealName"</span>+</span><br><span class="line">                      <span class="string">" from employee e"</span>+</span><br><span class="line">                      <span class="string">" left join dept d"</span>+</span><br><span class="line">                      <span class="string">" on e.deptno = d.deptno"</span>+</span><br><span class="line">                      <span class="string">" left join position p"</span>+</span><br><span class="line">                      <span class="string">" on e.posid = p.posid"</span>+</span><br><span class="line">                      <span class="string">" left join employee mgr"</span>+</span><br><span class="line">                      <span class="string">" on e.mgrid = mgr.empid where 1=1"</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-12-form表单提交问题"><a href="#3-12-form表单提交问题" class="headerlink" title="3.12 form表单提交问题"></a>3.12 form表单提交问题</h2><blockquote>
<p>注意：写明提交方式，否则 action 后面附带的参数不提交。</p>
</blockquote>
<h2 id="3-13-删除员工"><a href="#3-13-删除员工" class="headerlink" title="3.13 删除员工"></a>3.13 删除员工</h2><blockquote>
<p>不删除员工，将员工设为离职状态</p>
</blockquote>
<h2 id="3-14-更新员工信息"><a href="#3-14-更新员工信息" class="headerlink" title="3.14 更新员工信息"></a>3.14 更新员工信息</h2><blockquote>
<p>设置员工的用户名不可修改</p>
<p>寻找插件将输入的用户名中文转为收汉语拼音</p>
</blockquote>
<h1 id="4-考勤模块"><a href="#4-考勤模块" class="headerlink" title="4 考勤模块"></a>4 考勤模块</h1><h2 id="4-1-登录模块"><a href="#4-1-登录模块" class="headerlink" title="4.1 登录模块"></a>4.1 登录模块</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"pwd"</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"loginpwd"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">onclick</span>=<span class="string">"JavaScript:this.value=''"</span>/&gt;</span>  <span class="comment">&lt;!-- 单击清空输入框  -&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-1-1-菜单分栏"><a href="#4-1-1-菜单分栏" class="headerlink" title="4.1.1 菜单分栏"></a>4.1.1 菜单分栏</h3><blockquote>
<p>根据用户的类型，显示不同的菜单。</p>
</blockquote>
<h3 id="4-1-2-验证码"><a href="#4-1-2-验证码" class="headerlink" title="4.1.2 验证码"></a>4.1.2 验证码</h3><blockquote>
<p>登录验证码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.Font;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 在内存中创建图象</span></span><br><span class="line">		<span class="keyword">int</span> width = <span class="number">110</span>, height = <span class="number">30</span>;</span><br><span class="line">		BufferedImage image = <span class="keyword">new</span> BufferedImage(width, height,</span><br><span class="line">				BufferedImage.TYPE_INT_RGB);</span><br><span class="line">		<span class="comment">// 获取图形上下文</span></span><br><span class="line">		Graphics g = image.getGraphics();</span><br><span class="line">		<span class="comment">// 生成随机类</span></span><br><span class="line">		Random random = <span class="keyword">new</span> Random();</span><br><span class="line">		<span class="comment">// 设定背景色</span></span><br><span class="line">		g.setColor(getRandColor(<span class="number">200</span>, <span class="number">250</span>));</span><br><span class="line">		g.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">		<span class="comment">// 设定字体</span></span><br><span class="line">		g.setFont(<span class="keyword">new</span> Font(<span class="string">"Times New Roman"</span>, Font.PLAIN, <span class="number">20</span>));</span><br><span class="line">		<span class="comment">// 随机产生155条干扰线，使图象中的认证码不易被其它程序探测到</span></span><br><span class="line">		g.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">155</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">int</span> x = random.nextInt(width);</span><br><span class="line">			<span class="keyword">int</span> y = random.nextInt(height);</span><br><span class="line">			<span class="keyword">int</span> xl = random.nextInt(<span class="number">12</span>);</span><br><span class="line">			<span class="keyword">int</span> yl = random.nextInt(<span class="number">12</span>);</span><br><span class="line">			g.drawLine(x, y, x + xl, y + yl);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 取随机产生的认证码(6位数字)</span></span><br><span class="line">		String sRand = <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">			String rand = String.valueOf(random.nextInt(<span class="number">10</span>));</span><br><span class="line">			sRand += rand;</span><br><span class="line">			<span class="comment">// 将认证码显示到图象中</span></span><br><span class="line">			g.setColor(<span class="keyword">new</span> Color(<span class="number">20</span> + random.nextInt(<span class="number">110</span>), <span class="number">20</span> + random</span><br><span class="line">					.nextInt(<span class="number">110</span>), <span class="number">20</span> + random.nextInt(<span class="number">110</span>)));</span><br><span class="line">			<span class="comment">// 调用函数出来的颜色相同，可能是因为种子太接近，所以只能直接生成</span></span><br><span class="line">			g.drawString(rand, <span class="number">13</span> * i + <span class="number">6</span>, <span class="number">16</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 图象生效</span></span><br><span class="line">		g.dispose();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			ImageIO.write(image, <span class="string">"JPEG"</span>, response.getOutputStream());</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			System.out.println(<span class="string">"验证码图片产生出现错误："</span> + e.toString());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//保存验证码到Session</span></span><br><span class="line">		request.getSession().setAttribute(<span class="string">"randStr"</span>, sRand);</span><br><span class="line">	<span class="comment">/*	System.out.println("randStr"+sRand);*/</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>.doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 给定范围获得随机颜色</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Color <span class="title">getRandColor</span><span class="params">(<span class="keyword">int</span> fc, <span class="keyword">int</span> bc)</span> </span>&#123;</span><br><span class="line">		Random random = <span class="keyword">new</span> Random();</span><br><span class="line">		<span class="keyword">if</span> (fc &gt; <span class="number">255</span>)</span><br><span class="line">			fc = <span class="number">255</span>;</span><br><span class="line">		<span class="keyword">if</span> (bc &gt; <span class="number">255</span>)</span><br><span class="line">			bc = <span class="number">255</span>;</span><br><span class="line">		<span class="keyword">int</span> r = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">int</span> g = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">int</span> b = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Color(r, g, b);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-5-查看考勤信息模块"><a href="#4-5-查看考勤信息模块" class="headerlink" title="4.5 查看考勤信息模块"></a>4.5 查看考勤信息模块</h2><h3 id="4-5-1-动态-SQL"><a href="#4-5-1-动态-SQL" class="headerlink" title="4.5.1  动态 SQL"></a>4.5.1  动态 SQL</h3><blockquote>
<p>注意：拼接 字符串SQL 时，注意两边需要加单引号</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">StringBuilder  sql = <span class="keyword">new</span> StringBuilder(<span class="string">"select dt.*,e.realname,d.deptno deptno,d.deptname"</span>+</span><br><span class="line">						<span class="string">" from duty  dt"</span>+</span><br><span class="line">						<span class="string">" join employee e"</span>+</span><br><span class="line">						<span class="string">" on dt.emprid = e.empid"</span>+</span><br><span class="line">						<span class="string">" join dept d"</span>+</span><br><span class="line">						<span class="string">" on e.deptno = d.deptno"</span>+</span><br><span class="line">						<span class="string">" where 1=1"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(empId!=<span class="keyword">null</span>&amp;&amp;!<span class="string">""</span>.equals(empId))&#123;</span><br><span class="line">				sql.append(<span class="string">"and dt.emprid = '"</span>+empId+<span class="string">"'"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(deptNo!=<span class="number">0</span>)&#123;</span><br><span class="line">				sql.append(<span class="string">"and d.deptno = "</span>+deptNo);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(dtDate!=<span class="keyword">null</span>&amp;!<span class="string">""</span>.equals(dtDate))&#123;</span><br><span class="line">				sql.append(<span class="string">"and to_char(dt.dtdate,'yyyy-MM-dd') &gt;='"</span>+dtDate+<span class="string">"'"</span>);</span><br><span class="line">			</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(sql.toString());</span><br></pre></td></tr></table></figure>

<h3 id="4-5-2-PIO"><a href="#4-5-2-PIO" class="headerlink" title="4.5.2 PIO"></a>4.5.2 PIO</h3><blockquote>
<p><a href="https://baike.baidu.com/item/Apache/6265" target="_blank" rel="noopener">Apache</a> POI 是用<a href="https://baike.baidu.com/item/Java/85979" target="_blank" rel="noopener">Java</a>编写的免费开源的跨平台的 Java API，Apache POI提供API给Java程式对[Microsoft Office](<a href="https://baike.baidu.com/item/Microsoft" target="_blank" rel="noopener">https://baike.baidu.com/item/Microsoft</a> Office)格式档案读和写的功能。POI为“Poor Obfuscation Implementation”的首字母缩写，意为“简洁版的模糊实现”。</p>
</blockquote>
<ul>
<li><p>栗子</p>
<p>将考勤信息导出为 xls 格式的文档，然后通过浏览器下载到本地保存</p>
<p>注意：将xls格式的文档通过流的方式发送给客户端，并且要设置响应数据的格式和响应头</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据条件查询考勤信息</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllDutyInfoByCondition</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException, ServletException</span>&#123;</span><br><span class="line">		<span class="comment">//获取请求处理参数</span></span><br><span class="line">		String empId = req.getParameter(<span class="string">"empId"</span>);</span><br><span class="line">		</span><br><span class="line">		String sdeptNo = req.getParameter(<span class="string">"deptNo"</span>);</span><br><span class="line">		<span class="keyword">int</span> deptNo = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			deptNo = Integer.valueOf(sdeptNo); <span class="comment">// null 、非法字符</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(NumberFormatException e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		String sdtDate = req.getParameter(<span class="string">"dtDate"</span>);</span><br><span class="line">		Date dtDate = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			DateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">			dtDate = sdf.parse(sdtDate);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//调用业务层对象</span></span><br><span class="line">		List&lt;Duty&gt; dutyList = dutyService.findAllDutyInfoByConditionService(empId,deptNo,dtDate);</span><br><span class="line">		<span class="comment">//响应处理结果</span></span><br><span class="line">		Gson gson = <span class="keyword">new</span> GsonBuilder().setDateFormat(<span class="string">"yyyy-MM-dd"</span>).create();<span class="comment">//日期格式化</span></span><br><span class="line">		resp.getWriter().print(gson.toJson(dutyList));<span class="comment">//使用 ajax ，直接响应</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 导出 考勤信息 xls 文档</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exportXls</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException, ServletException</span>&#123;</span><br><span class="line">		<span class="comment">//获取请求处理参数</span></span><br><span class="line">		String empId = req.getParameter(<span class="string">"empId"</span>);</span><br><span class="line">		</span><br><span class="line">		String sdeptNo = req.getParameter(<span class="string">"deptNo"</span>);</span><br><span class="line">		<span class="keyword">int</span> deptNo = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			deptNo = Integer.valueOf(sdeptNo); <span class="comment">// null 、非法字符</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(NumberFormatException e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		String sdtDate = req.getParameter(<span class="string">"dtDate"</span>);</span><br><span class="line">		Date dtDate = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			DateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">			dtDate = sdf.parse(sdtDate);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//调用业务层对象</span></span><br><span class="line">		List&lt;Duty&gt; dutyList = dutyService.findAllDutyInfoByConditionService(empId,deptNo,dtDate);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//响应处理结果</span></span><br><span class="line">		createExcel(dutyList,resp);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createExcel</span><span class="params">(List&lt;Duty&gt; list,HttpServletResponse resp)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建一个Excel文件</span></span><br><span class="line">        HSSFWorkbook workbook = <span class="keyword">new</span> HSSFWorkbook();</span><br><span class="line">        <span class="comment">// 创建一个工作表</span></span><br><span class="line">        HSSFSheet sheet = workbook.createSheet(<span class="string">"考勤表一"</span>);</span><br><span class="line">        </span><br><span class="line">        CellRangeAddress region = <span class="keyword">new</span> CellRangeAddress(<span class="number">0</span>, <span class="comment">// first row</span></span><br><span class="line">                <span class="number">0</span>, <span class="comment">// last row</span></span><br><span class="line">                <span class="number">0</span>, <span class="comment">// first column</span></span><br><span class="line">                <span class="number">2</span> <span class="comment">// last column</span></span><br><span class="line">        );</span><br><span class="line">        sheet.addMergedRegion(region);</span><br><span class="line">        </span><br><span class="line">        HSSFRow hssfRow = sheet.createRow(<span class="number">0</span>);</span><br><span class="line">        HSSFCell headCell = hssfRow.createCell(<span class="number">0</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"OA系统之考勤列表"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置单元格格式居中</span></span><br><span class="line">        HSSFCellStyle cellStyle = workbook.createCellStyle();</span><br><span class="line">    	cellStyle.setAlignment(HSSFCellStyle.ALIGN_CENTER);</span><br><span class="line">      </span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加表头行</span></span><br><span class="line">        hssfRow = sheet.createRow(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 添加表头内容</span></span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">0</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"用户名"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">1</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"真实姓名"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">2</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"所属部门"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line">        </span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">3</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"出勤日期"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line">        </span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">4</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"签到时间"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line">        </span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">5</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"签退时间"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加数据内容</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            hssfRow = sheet.createRow((<span class="keyword">int</span>) i + <span class="number">2</span>);</span><br><span class="line">            Duty duty = list.get(i);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建单元格，并设置值</span></span><br><span class="line">            HSSFCell cell = hssfRow.createCell(<span class="number">0</span>);</span><br><span class="line">            cell.setCellValue(duty.getEmpId());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">            cell = hssfRow.createCell(<span class="number">1</span>);</span><br><span class="line">            cell.setCellValue(duty.getEmp().getRealName());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">            cell = hssfRow.createCell(<span class="number">2</span>);</span><br><span class="line">            cell.setCellValue(duty.getEmp().getDept().getDeptName());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line">            </span><br><span class="line">            cell = hssfRow.createCell(<span class="number">3</span>);</span><br><span class="line">            cell.setCellValue(duty.getDtDate());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line">            </span><br><span class="line">            cell = hssfRow.createCell(<span class="number">4</span>);</span><br><span class="line">            cell.setCellValue(duty.getSignInTime());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line">            </span><br><span class="line">            cell = hssfRow.createCell(<span class="number">5</span>);</span><br><span class="line">            cell.setCellValue(duty.getSignOutTime());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存Excel文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">/* OutputStream outputStream = new FileOutputStream("D:/students.xls");*/</span> <span class="comment">//保存到本地（即服务器）</span></span><br><span class="line">        		<span class="comment">//设置响应数据格式</span></span><br><span class="line">        		resp.setContentType(<span class="string">"application/vnd.ms-excel"</span>);</span><br><span class="line">        		resp.setHeader(<span class="string">"Content-disposition"</span>, <span class="string">"attachment; fileName=duty.xls"</span>);</span><br><span class="line">        		OutputStream outputStream  = resp.getOutputStream();</span><br><span class="line">	            workbook.write(outputStream);</span><br><span class="line">	            outputStream.close();</span><br><span class="line">	        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	            e.printStackTrace();</span><br><span class="line">	        &#125;</span><br><span class="line">	    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="5-报销模块"><a href="#5-报销模块" class="headerlink" title="5 报销模块"></a>5 报销模块</h1><p>注意： Oracle 不能获取 char 类型的字符     </p>
<h2 id="5-1-自定义异常"><a href="#5-1-自定义异常" class="headerlink" title="5.1 自定义异常"></a>5.1 自定义异常</h2><blockquote>
<p>直接异常的结果抛给调用该类的上级处理</p>
</blockquote>
<h3 id="5-5-1-自定义异常类"><a href="#5-5-1-自定义异常类" class="headerlink" title="5.5.1 自定义异常类"></a>5.5.1 自定义异常类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.util;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义异常信息</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">super</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">super</span>(message);</span><br><span class="line">		&#125;</span><br><span class="line">	  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-1-2-DBUtil-使用自定义异常类"><a href="#5-1-2-DBUtil-使用自定义异常类" class="headerlink" title="5.1.2 DBUtil 使用自定义异常类"></a>5.1.2 DBUtil 使用自定义异常类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">executeDML</span><span class="params">(String sql,Object...objs)</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">				Connection conn = <span class="keyword">null</span>;</span><br><span class="line">				PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">				<span class="keyword">int</span> i = -<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">	</span><br><span class="line">					conn = DBUtil.getConnection();</span><br><span class="line"></span><br><span class="line">					conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">					ps = conn.prepareStatement(sql);</span><br><span class="line">					<span class="keyword">if</span>(objs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">						<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;objs.length;j++)&#123;</span><br><span class="line">							ps.setObject(j+<span class="number">1</span>,objs[j]);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				</span><br><span class="line">					i = ps.executeUpdate();</span><br><span class="line">					conn.commit();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						conn.rollback();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e1.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">					<span class="comment">//抛出给上级调用者</span></span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> MyException(e.toString());</span><br><span class="line">				&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">					DBUtil.closeAll(<span class="keyword">null</span>, ps, conn);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> i;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-servlet-中调用业务层发生错误的处理办法"><a href="#5-2-servlet-中调用业务层发生错误的处理办法" class="headerlink" title="5.2 servlet 中调用业务层发生错误的处理办法"></a>5.2 servlet 中调用业务层发生错误的处理办法</h2><blockquote>
<p>使用 try{}catch{}语句,若调业务层发生错误，则直接打印错误信息，并把错误信息返回给客户端</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">				expenseService.add(exp); <span class="comment">//不接受返回值	</span></span><br><span class="line">				<span class="comment">//响应处理结果</span></span><br><span class="line">				resp.sendRedirect(req.getContextPath()+<span class="string">"/expense/myExpense.jsp"</span>);</span><br><span class="line">			&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">				<span class="comment">//业务层发生错误，则重定向到添加报销单界面，并携带错误信息</span></span><br><span class="line">				req.setAttribute(<span class="string">"error"</span>, <span class="string">"添加报销单失败"</span>);</span><br><span class="line">				req.getRequestDispatcher(<span class="string">"/expense/expenseAdd.jsp"</span>).forward(req, resp);</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-3-service-层事务处理"><a href="#5-3-service-层事务处理" class="headerlink" title="5.3 service 层事务处理"></a>5.3 service 层事务处理</h2><blockquote>
<p>在 dao 层，一个DML操作就相当于一个事务。</p>
<p>但是当 service 层，调用两个不同 dao 层，就相当于执行不同两个事务。</p>
<p>问题：将 两个 dao 层的事务，在 service 层合并成一个事务操作？</p>
<p>解决：</p>
<p>在 service 层，先关闭事务的自动提交，并在DML 操作成功执行完毕后 commit 提交，否则 rollback 。    </p>
<p>​    1. 在 service 创建 Connection 连接对象，将该对象传入 DML 操作中。 缺点：过于麻烦</p>
<p>​    2.修改 DBUtil 工具类，改用 TreadLocal 类获取 Connection 连接对象。</p>
<p>注意：保证两个不同 dao 层的 DML 操作使用同一个 Connection 连接对象。 </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.ExpenseDao;</span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.ExpenseItemDao;</span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.impl.ExpenseDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.impl.ExpenseItemDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.Expense;</span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.ExpenseItem;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.ExpenseService;</span><br><span class="line"><span class="keyword">import</span> com.szxy.util.DBUtil;</span><br><span class="line"><span class="keyword">import</span> com.szxy.util.DBUtil2;</span><br><span class="line"><span class="keyword">import</span> com.szxy.util.MyException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 	报销单类</span></span><br><span class="line"><span class="comment"> * 	</span></span><br><span class="line"><span class="comment"> * 问题：怎么获取当前报销单编号？ </span></span><br><span class="line"><span class="comment"> * 解决：获取当前序列的值</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 在 dao 层，一个DML操作就相当于一个事务。</span></span><br><span class="line"><span class="comment"> * 但是当 service 层，调用两个不同 dao 层，就相当于执行不同两个事务。</span></span><br><span class="line"><span class="comment"> * 问题：将 两个 dao 层的事务，在 service 层合并成一个事务操作？</span></span><br><span class="line"><span class="comment"> * 解决：</span></span><br><span class="line"><span class="comment"> * 		在 service 层，先关闭事务的自动提交，并在DML 操作成功执行完毕后 commit 提交，否则 rollback 。	</span></span><br><span class="line"><span class="comment"> * 		1. 在 service 创建 Connection 连接对象，将该对象传入 DML 操作中。 缺点：过于麻烦</span></span><br><span class="line"><span class="comment"> * 		2. 修改 DBUtil 工具类，改用 TreadLocal 类获取 Connection 连接对象。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 注意：保证两个不同 dao 层的 DML 操作使用同一个 Connection 连接对象。 </span></span><br><span class="line"><span class="comment"> * 	</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExpenseServiceImpl</span> <span class="keyword">implements</span> <span class="title">ExpenseService</span></span>&#123;</span><br><span class="line">	ExpenseDao  expenseDao = <span class="keyword">new</span> ExpenseDaoImpl();</span><br><span class="line">	ExpenseItemDao itemDao = <span class="keyword">new</span> ExpenseItemDaoImpl();</span><br><span class="line">	<span class="comment">//添加报销单信息s</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Expense exp)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取当前序列的值</span></span><br><span class="line">		<span class="keyword">int</span> nextVal = expenseDao.getExpidNextval();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取 数据库连接 对象</span></span><br><span class="line">		Connection conn = DBUtil2.getConnection();</span><br><span class="line">		<span class="comment">//关闭事务自动提交</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">			<span class="comment">//保存报销单主表</span></span><br><span class="line">			java.sql.Date exptime = <span class="keyword">new</span> java.sql.Date(exp.getExptime().getTime());</span><br><span class="line">			Expense expense = </span><br><span class="line">			<span class="keyword">new</span> Expense(nextVal,exp.getEmpId(), exp.getTotalAmount(),exptime , exp.getExpdesc(), exp.getNextAuditor(), exp.getLastResult(), exp.getStatus());</span><br><span class="line">			expenseDao.save(expense);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//保存报销单明细</span></span><br><span class="line">			List&lt;ExpenseItem&gt; itemList = exp.getItemList();</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; itemList.size(); i++) &#123;</span><br><span class="line">				ExpenseItem item = </span><br><span class="line">				<span class="keyword">new</span> ExpenseItem(nextVal,itemList.get(i).getType(), itemList.get(i).getAmount(), itemList.get(i).getItemdesc());</span><br><span class="line">				itemDao.save(item);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//成功执行上面的 DML 操作后，提交事务</span></span><br><span class="line">			conn.commit(); </span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="comment">//抛出给上级调用者</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MyException(e.toString());</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="comment">//关闭数据库连接</span></span><br><span class="line">			DBUtil2.closeAll(<span class="keyword">null</span>, <span class="keyword">null</span>, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">			</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-4-使用浏览器地址栏上的信息"><a href="#5-4-使用浏览器地址栏上的信息" class="headerlink" title="5.4 使用浏览器地址栏上的信息"></a>5.4 使用浏览器地址栏上的信息</h2><blockquote>
<p>不通过 servlet 转发，采用 EL 表达式实现 </p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">$&#123;param.地址栏上带有的参数名&#125;</span> "/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 相当于 req.getParameter("参数名") --&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-5-关闭子窗口，刷新父窗口"><a href="#5-5-关闭子窗口，刷新父窗口" class="headerlink" title="5.5 关闭子窗口，刷新父窗口"></a>5.5 关闭子窗口，刷新父窗口</h2><blockquote>
<p> <code>window.close();</code>//关闭当前窗口<br><code>window.opener.location.reload();</code>    //刷新父窗口</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">$.ajax(&#123;</span></span><br><span class="line"><span class="javascript">    url:<span class="string">"expense"</span>,</span></span><br><span class="line"><span class="javascript">    data:&#123;<span class="attr">method</span>:<span class="string">"audit"</span>,<span class="attr">expId</span>:expId,<span class="attr">result</span>:result,<span class="attr">auditDesc</span>:auditDesc&#125;,</span></span><br><span class="line"><span class="javascript">    type:<span class="string">"POST"</span>,</span></span><br><span class="line"><span class="javascript">    success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(data == <span class="string">"success"</span>)&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">"审核成功"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.close(); <span class="comment">//关闭当前窗口</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.opener.location.reload();    <span class="comment">//刷新父窗口</span></span></span><br><span class="line"><span class="javascript">             <span class="comment">/* 	window.location.reload(); //刷新当前窗口 */</span></span></span><br><span class="line"><span class="javascript">        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">"审核失败"</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-6-画业务流程图"><a href="#5-6-画业务流程图" class="headerlink" title="5.6  画业务流程图"></a>5.6  画业务流程图</h2><p><img src="http://www.zwer.xyz/picGo/%E5%AE%A1%E6%A0%B8%E6%B5%81%E7%A8%8B%E5%9B%BE1.png" alt></p>
<h3 id="5-6-1-第一步"><a href="#5-6-1-第一步" class="headerlink" title="5.6.1 第一步"></a>5.6.1 第一步</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *   审核报销单</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">audit</span><span class="params">(Auditing audit)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//根据业务流程图，写出大概步骤</span></span><br><span class="line">		<span class="keyword">if</span>(是财务)&#123;<span class="comment">//是财务</span></span><br><span class="line">			<span class="comment">//添加财务支出信息</span></span><br><span class="line">			<span class="comment">//修改报销单状态</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;<span class="comment">//不是财务</span></span><br><span class="line">			<span class="keyword">if</span>(审核通过)&#123;<span class="comment">//审核通过</span></span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(&gt;<span class="number">2500</span>)&#123;</span><br><span class="line">					<span class="keyword">if</span>(总裁)&#123; <span class="comment">//是总裁</span></span><br><span class="line">						<span class="comment">//添加审核记录</span></span><br><span class="line">						<span class="comment">//修改报销单状态</span></span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">						<span class="comment">//添加审核记录</span></span><br><span class="line">						<span class="comment">//修改报销单状态</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;<span class="comment">//小于 2500</span></span><br><span class="line">					<span class="comment">//添加审核记录</span></span><br><span class="line">					<span class="comment">//修改报销单状态</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;<span class="comment">//审核没通过</span></span><br><span class="line">				<span class="comment">//添加审核记录</span></span><br><span class="line">				<span class="comment">//修改报销单状态</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-6-2-第二步"><a href="#5-6-2-第二步" class="headerlink" title="5.6.2 第二步"></a>5.6.2 第二步</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">audit</span><span class="params">(Auditing audit)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//获取当前数据库连接</span></span><br><span class="line">		Connection conn = DBUtil2.getConnection();</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			conn.setAutoCommit(<span class="keyword">false</span>); <span class="comment">//关闭自动提交</span></span><br><span class="line">			<span class="comment">//根据业务流程图，写出大概步骤</span></span><br><span class="line">			String empId = audit.getEmpId();<span class="comment">//审核人的ID </span></span><br><span class="line">			<span class="keyword">if</span>(empId.equals(Constants.POSITION_CFO))&#123;<span class="comment">//是财务</span></span><br><span class="line">				<span class="comment">//添加财务支出信息</span></span><br><span class="line">				<span class="comment">//修改报销单状态</span></span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;<span class="comment">//不是财务</span></span><br><span class="line">				String result = audit.getResult();</span><br><span class="line">				<span class="keyword">if</span>(result.equals(<span class="string">"通过"</span>))&#123;<span class="comment">//审核通过</span></span><br><span class="line">					Expense expense = expenseDao.findExpenseByExpId(audit.getExpId());</span><br><span class="line">					<span class="keyword">double</span> totalAmount = expense.getTotalAmount();</span><br><span class="line">					<span class="keyword">if</span>(totalAmount &gt; <span class="number">2500</span>)&#123;</span><br><span class="line">						<span class="keyword">if</span>(empId.equals(Constants.POSITION_CEO))&#123; <span class="comment">//是总裁</span></span><br><span class="line">							<span class="comment">//添加审核记录</span></span><br><span class="line">							auditDao.save(audit);</span><br><span class="line">							</span><br><span class="line">							Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">							exp.setExpId(audit.getExpId());</span><br><span class="line">							exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">							exp.setLastResult(<span class="string">"审核通过"</span>);</span><br><span class="line">							exp.setStatus(Constants.EXPENSE_STATUS_AUDITED); 						</span><br><span class="line">							<span class="comment">//修改报销单状态</span></span><br><span class="line">							expenseDao.update(exp);</span><br><span class="line">						&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">							<span class="comment">//添加审核记录</span></span><br><span class="line">							auditDao.save(audit);</span><br><span class="line">							</span><br><span class="line">							Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">							exp.setExpId(audit.getExpId());</span><br><span class="line">							exp.setNextAuditor(<span class="string">"gaoqi"</span>);   <span class="comment">//交给下一个审核人，简化难度</span></span><br><span class="line">							exp.setNextAuditor(audit.getExp().getNextAuditor());  </span><br><span class="line">							exp.setLastResult(Constants.EXPENSE_STATUS_AUDITING);</span><br><span class="line">							exp.setStatus(<span class="string">"1"</span>);</span><br><span class="line">							<span class="comment">//修改报销单状态</span></span><br><span class="line">							expenseDao.update(exp);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;<span class="comment">//小于 2500</span></span><br><span class="line">						<span class="comment">//添加审核记录</span></span><br><span class="line">						auditDao.save(audit);</span><br><span class="line">						Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">						exp.setExpId(audit.getExpId());</span><br><span class="line">						exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">						exp.setLastResult(<span class="string">"审核通过"</span>);</span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_AUDITED); 						</span><br><span class="line">						<span class="comment">//修改报销单状态</span></span><br><span class="line">						expenseDao.update(exp);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;<span class="comment">//审核没通过 ，一种是打回，一种是拒绝</span></span><br><span class="line">					</span><br><span class="line">					<span class="comment">//添加审核记录</span></span><br><span class="line">					auditDao.save(audit);</span><br><span class="line">					</span><br><span class="line">					Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">					exp.setExpId(audit.getExpId());</span><br><span class="line">					exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">					exp.setLastResult(<span class="string">"未通过"</span>);</span><br><span class="line">					<span class="keyword">if</span>(<span class="string">"打回"</span>.equals(audit.getResult()))&#123;</span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_BACK); 						</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;<span class="comment">//拒绝</span></span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_REJECT); 						</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="comment">//修改报销单状态</span></span><br><span class="line">					expenseDao.update(exp);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			conn.commit(); <span class="comment">//提交事务</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			<span class="comment">//回滚</span></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				conn.rollback();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">				e1.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MyException(e.toString());</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			DBUtil2.closeAll(<span class="keyword">null</span>, <span class="keyword">null</span>, conn);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;*/</span><br></pre></td></tr></table></figure>

<h3 id="5-6-3-第三步优化"><a href="#5-6-3-第三步优化" class="headerlink" title="5.6.3 第三步优化"></a>5.6.3 第三步优化</h3><blockquote>
<p>使用常量类，及合并多余代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">audit</span><span class="params">(Auditing audit)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//添加审核记录</span></span><br><span class="line">		auditDao.save(audit);</span><br><span class="line">		<span class="comment">//添加报销单信息</span></span><br><span class="line">		Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">		exp.setExpId(audit.getExpId());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取当前数据库连接</span></span><br><span class="line">		Connection conn = DBUtil2.getConnection();</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			conn.setAutoCommit(<span class="keyword">false</span>); <span class="comment">//关闭自动提交</span></span><br><span class="line">			<span class="comment">//根据业务流程图，写出大概步骤</span></span><br><span class="line">			String empId = audit.getEmpId();<span class="comment">//审核人的ID </span></span><br><span class="line">			<span class="keyword">if</span>(empId.equals(Constants.POSITION_CFO))&#123;<span class="comment">//是财务</span></span><br><span class="line">				<span class="comment">//添加财务支出信息</span></span><br><span class="line">				<span class="comment">//修改报销单状态</span></span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;<span class="comment">//不是财务</span></span><br><span class="line">				String result = audit.getResult();</span><br><span class="line">				<span class="keyword">if</span>(result.equals(<span class="string">"通过"</span>))&#123;<span class="comment">//审核通过</span></span><br><span class="line">					Expense expense = expenseDao.findExpenseByExpId(audit.getExpId());</span><br><span class="line">					<span class="keyword">double</span> totalAmount = expense.getTotalAmount();</span><br><span class="line">					<span class="keyword">if</span>(totalAmount &gt; <span class="number">2500</span>)&#123;</span><br><span class="line">						<span class="keyword">if</span>(empId.equals(Constants.POSITION_CEO))&#123; <span class="comment">//是总裁</span></span><br><span class="line">							<span class="comment">//添加审核记录</span></span><br><span class="line">							exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">							exp.setLastResult(<span class="string">"审核通过"</span>);</span><br><span class="line">							exp.setStatus(Constants.EXPENSE_STATUS_AUDITED); 						</span><br><span class="line">						&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">							<span class="comment">//添加审核记录</span></span><br><span class="line">							exp.setNextAuditor(<span class="string">"gaoqi"</span>);   <span class="comment">//交给下一个审核人，简化难度</span></span><br><span class="line">							<span class="comment">/*exp.setNextAuditor(audit.getExp().getNextAuditor()); */</span> </span><br><span class="line">							exp.setLastResult(Constants.EXPENSE_STATUS_AUDITING);</span><br><span class="line">							exp.setStatus(<span class="string">"1"</span>);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;<span class="comment">//小于 2500</span></span><br><span class="line">						exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">						exp.setLastResult(<span class="string">"审核通过"</span>);</span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_AUDITED); 						</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;<span class="comment">//审核没通过 ，一种是打回，一种是拒绝</span></span><br><span class="line">					exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">					exp.setLastResult(<span class="string">"未通过"</span>);</span><br><span class="line">					<span class="keyword">if</span>(<span class="string">"打回"</span>.equals(audit.getResult()))&#123;</span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_BACK); 						</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;<span class="comment">//拒绝</span></span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_REJECT); 						</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			expenseDao.update(exp); <span class="comment">//修改报销单状态</span></span><br><span class="line">			conn.commit();    <span class="comment">//提交事务</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			<span class="comment">//回滚</span></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				conn.rollback();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">				e1.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MyException(e.toString());</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			DBUtil2.closeAll(<span class="keyword">null</span>, <span class="keyword">null</span>, conn);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-7-使用常量类"><a href="#5-7-使用常量类" class="headerlink" title="5.7 使用常量类"></a>5.7 使用常量类</h2><blockquote>
<p>替代直接使用变量</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.util;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 常量类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//审核状态</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_AUDITING = <span class="string">"1"</span>;  <span class="comment">// 审核中</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_AUDITED = <span class="string">"2"</span>;   <span class="comment">// 审核完成</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_BACK = <span class="string">"3"</span>;      <span class="comment">// 打回</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_REJECT = <span class="string">"4"</span>;    <span class="comment">// 拒绝</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_CASHED = <span class="string">"5"</span>;    <span class="comment">// 打款</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//部门特殊职位姓名</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String POSITION_CEO = <span class="string">"gaoqi"</span>;    <span class="comment">//总裁</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String POSITION_CFO = <span class="string">"lifuying"</span>; <span class="comment">//首席账务官</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-8-bug之数据库连接关闭"><a href="#5-8-bug之数据库连接关闭" class="headerlink" title="5.8  bug之数据库连接关闭"></a>5.8  bug之数据库连接关闭</h2><blockquote>
<p>问题描述：最开始是使用一个用户处理报销单操作，审核没有问题，但是换到下一个用户时再处理报销单操作，出现审核失败，原因是数据库连接被关闭，但是数据库连接对象并没有被销毁。</p>
<p>解决：</p>
<p>在DBUtil2中，获取数据库连接方法中判断 conn 对象是否关闭 isClose()，若关闭则重新创建新的数据连接对象。</p>
<p>问题推测：可能是切换用户时，出现了数据库连接关闭或者 使用 ThreadLocal 管理 conn 对象的原因。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Connection conn=<span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 从 ThreadLocal 中获取 Connection 数据库连接对象</span></span><br><span class="line">		conn = threadLocal.get();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>( conn == <span class="keyword">null</span> || conn.isClosed())&#123;  <span class="comment">//第一次创建 Connection 数据库连接对象,并且判断当前数据库是否关闭，若关闭需要重新创建</span></span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					conn = DriverManager.getConnection(url, username, password);</span><br><span class="line">					<span class="comment">//将 conn 放入 ThreadLocal 中</span></span><br><span class="line">					threadLocal.set(conn);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">					<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/*try &#123;</span></span><br><span class="line"><span class="comment">			System.out.println("conn的状态："+conn.isClosed());</span></span><br><span class="line"><span class="comment">		&#125; catch (SQLException e1) &#123;</span></span><br><span class="line"><span class="comment">			// TODO Auto-generated catch block</span></span><br><span class="line"><span class="comment">			e1.printStackTrace();</span></span><br><span class="line"><span class="comment">		&#125;*/</span></span><br><span class="line">		<span class="keyword">return</span> conn;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h1 id="6-收支管理"><a href="#6-收支管理" class="headerlink" title="6 收支管理"></a>6 收支管理</h1><h2 id="6-1-echart-（Enterprise-charts-商业产品图标库）入门"><a href="#6-1-echart-（Enterprise-charts-商业产品图标库）入门" class="headerlink" title="6.1  echart （Enterprise charts 商业产品图标库）入门"></a>6.1  echart （Enterprise charts 商业产品图标库）入门</h2><blockquote>
<p>ECharts，一个使用 JavaScript 实现的开源可视化库，可以流畅的运行在 PC 和移动设备上，兼容当前绝大部分浏览器（IE8/9/10/11，Chrome，Firefox，Safari等），底层依赖轻量级的矢量图形库 <a href="https://github.com/ecomfe/zrender" target="_blank" rel="noopener">ZRender</a>，提供直观，交互丰富，可高度个性化定制的数据可视化图表。</p>
</blockquote>
<h3 id="6-1-1-特性"><a href="#6-1-1-特性" class="headerlink" title="6.1.1  特性"></a>6.1.1  特性</h3><ol>
<li><p>丰富的可视化类型</p>
<p>ECharts 提供了常规的<a href="https://echarts.baidu.com/option.html#series-line" target="_blank" rel="noopener">折线图</a>、<a href="https://echarts.baidu.com/option.html#series-line" target="_blank" rel="noopener">柱状图</a>、<a href="https://echarts.baidu.com/option.html#series-scatter" target="_blank" rel="noopener">散点图</a>、<a href="https://echarts.baidu.com/option.html#series-pie" target="_blank" rel="noopener">饼图</a>、<a href="https://echarts.baidu.com/option.html#series-candlestick" target="_blank" rel="noopener">K线图</a>，用于统计的<a href="https://echarts.baidu.com/option.html#series-boxplot" target="_blank" rel="noopener">盒形图</a>，用于地理数据可视化的<a href="https://echarts.baidu.com/option.html#series-map" target="_blank" rel="noopener">地图</a>、<a href="https://echarts.baidu.com/option.html#series-heatmap" target="_blank" rel="noopener">热力图</a>、<a href="https://echarts.baidu.com/option.html#series-lines" target="_blank" rel="noopener">线图</a>，用于关系数据可视化的<a href="https://echarts.baidu.com/option.html#series-graph" target="_blank" rel="noopener">关系图</a>、<a href="https://echarts.baidu.com/option.html#series-treemap" target="_blank" rel="noopener">treemap</a>、<a href="https://echarts.baidu.com/option.html#series-sunburst" target="_blank" rel="noopener">旭日图</a>，多维数据可视化的<a href="https://echarts.baidu.com/option.html#series-parallel" target="_blank" rel="noopener">平行坐标</a>，还有用于 BI 的<a href="https://echarts.baidu.com/option.html#series-funnel" target="_blank" rel="noopener">漏斗图</a>，<a href="https://echarts.baidu.com/option.html#series-gauge" target="_blank" rel="noopener">仪表盘</a>，并且支持图与图之间的混搭。</p>
</li>
<li><p>多种数据格式无需转换直接使用</p>
<p>ECharts 内置的 dataset 属性（4.0+）支持直接传入包括二维表，key-value 等多种格式的数据源，通过简单的设置 encode 属性就可以完成从数据到图形的映射，这种方式更符合可视化的直觉，省去了大部分场景下数据转换的步骤，而且多个组件能够共享一份数据而不用克隆</p>
</li>
</ol>
<h3 id="6-1-2-使用"><a href="#6-1-2-使用" class="headerlink" title="6.1.2 使用"></a>6.1.2 使用</h3><ul>
<li>导入 eCharts.js 文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入 eCharts 文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/echarts.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>新建一个 div ，并设置图标的格式和数据</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>eCharts 图标入门<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"pragma"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"cache-control"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"expires"</span> <span class="attr">content</span>=<span class="string">"0"</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"keywords"</span> <span class="attr">content</span>=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">"This is my page"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	&lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 导入 Jquery  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 导入 eCharts 文件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/echarts.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  	</span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">   		  <span class="comment">&lt;!-- 为 ECharts 准备一个具备大小（宽高）的 DOM --&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"main"</span> <span class="attr">style</span>=<span class="string">"width: 600px;height:400px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    	</span><br><span class="line">    	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">	        <span class="comment">// 基于准备好的dom，初始化echarts实例</span></span></span><br><span class="line"><span class="javascript">	        <span class="keyword">var</span> myChart = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">'main'</span>));</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">	        <span class="comment">// 指定图表的配置项和数据</span></span></span><br><span class="line"><span class="javascript">	        <span class="keyword">var</span> option = &#123;</span></span><br><span class="line">	            title: &#123;</span><br><span class="line"><span class="javascript">	                text: <span class="string">'ECharts 入门示例'</span></span></span><br><span class="line">	            &#125;,</span><br><span class="line">	            tooltip: &#123;&#125;,</span><br><span class="line">	            legend: &#123;</span><br><span class="line"><span class="javascript">	                data:[<span class="string">'销量'</span>]</span></span><br><span class="line">	            &#125;,</span><br><span class="line">	            xAxis: &#123;</span><br><span class="line"><span class="javascript">	                data: [<span class="string">"衬衫"</span>,<span class="string">"羊毛衫"</span>,<span class="string">"雪纺衫"</span>,<span class="string">"裤子"</span>,<span class="string">"高跟鞋"</span>,<span class="string">"袜子"</span>]</span></span><br><span class="line">	            &#125;,</span><br><span class="line">	            yAxis: &#123;&#125;,</span><br><span class="line">	            series: [&#123;</span><br><span class="line"><span class="javascript">	                name: <span class="string">'销量'</span>,</span></span><br><span class="line"><span class="javascript">	                type: <span class="string">'bar'</span>,  <span class="comment">//表示柱状图</span></span></span><br><span class="line">	                data: [5, 20, 36, 10, 10, 20]</span><br><span class="line">	            &#125;]</span><br><span class="line">	        &#125;;</span><br><span class="line">	</span><br><span class="line"><span class="javascript">	        <span class="comment">// 使用刚指定的配置项和数据显示图表。</span></span></span><br><span class="line">	        myChart.setOption(option);</span><br><span class="line">	   	 <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-1-3-效果"><a href="#6-1-3-效果" class="headerlink" title="6.1.3 效果"></a>6.1.3 效果</h3><p><img src="http://www.zwer.xyz/picGo/20190428205130.png" alt></p>
<h1 id="7-项目总结"><a href="#7-项目总结" class="headerlink" title="7 项目总结"></a>7 项目总结</h1><h2 id="7-1-项目核心知识点"><a href="#7-1-项目核心知识点" class="headerlink" title="7.1 项目核心知识点"></a>7.1 项目核心知识点</h2><ol>
<li>ServletAPI 的使用</li>
<li>JSP 四个作用域</li>
<li>JSTL 标签库与 EL 表达式</li>
</ol>
<h2 id="7-2-分层功能分配"><a href="#7-2-分层功能分配" class="headerlink" title="7.2 分层功能分配"></a>7.2 分层功能分配</h2><ul>
<li>实体类、dao 层基本上与数据库表相对应</li>
<li>业务层、控制层、视图层更倾向于按照模块划分</li>
</ul>
<h1 id="8-分页功能"><a href="#8-分页功能" class="headerlink" title="8 分页功能"></a>8 分页功能</h1><h2 id="8-1-分页的意义"><a href="#8-1-分页的意义" class="headerlink" title="8.1 分页的意义"></a>8.1 分页的意义</h2><ol>
<li>数据量较大，一次加载所需的时间长</li>
<li>数据量较大，浏览器页面不能全局显示，采用分页，数据更加清晰明了</li>
</ol>
<h2 id="8-2-PageBean-分页工具类"><a href="#8-2-PageBean-分页工具类" class="headerlink" title="8.2  PageBean 分页工具类"></a>8.2  PageBean 分页工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页的三个基本属性</span></span><br><span class="line"><span class="comment"> * 1.每页几条记录size  可以有默认值5</span></span><br><span class="line"><span class="comment"> * 2.当前页号  index    可以有默认值1</span></span><br><span class="line"><span class="comment"> * 3.记录总数totalCount：不可能有默认值，需要查询数据库获取真正的记录总数</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 4.一共多少页 ：totalPageCount=totalCount/size+1</span></span><br><span class="line"><span class="comment"> * 		5  30  31 32 33 34 35  </span></span><br><span class="line"><span class="comment"> * 5.上一页    index-1  当前页1，上一页1</span></span><br><span class="line"><span class="comment"> * 6.下一页   index+1  当前页是最后一页  下一页：还是最后一页</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 扩展</span></span><br><span class="line"><span class="comment"> * 分页Bean还可以放要查询的数据  protected List&lt;T&gt; list;</span></span><br><span class="line"><span class="comment"> * 分页Bean还可以放页码列表     [1]  2  3  4  5   private int[] numbers;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageBean</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">5</span>;<span class="comment">//每页显示记录  //</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> index = <span class="number">1</span>;<span class="comment">// 当前页号      </span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> totalCount = <span class="number">0</span>;<span class="comment">// 记录总数      ok</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> totalPageCount = <span class="number">1</span>;<span class="comment">// 总页数   ok</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span>[] numbers;<span class="comment">//展示页数集合  //ok</span></span><br><span class="line">	<span class="keyword">protected</span> List&lt;T&gt; list;<span class="comment">//要显示到页面的数据集  </span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 得到开始记录</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStartRow</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> (index - <span class="number">1</span>) * size;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 得到结束记录</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getEndRow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> index * size;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the size.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;		</span><br><span class="line">		<span class="keyword">return</span> size;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> size</span></span><br><span class="line"><span class="comment">	 * The size to set.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSize</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.size = size;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the currentPageNo.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (totalPageCount == <span class="number">0</span>) &#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> index;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> currentPageNo</span></span><br><span class="line"><span class="comment">	 * The currentPageNo to set.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.index = index;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the totalCount.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> totalCount;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> totalCount</span></span><br><span class="line"><span class="comment">	 *  The totalCount to set.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalCount</span><span class="params">(<span class="keyword">int</span> totalCount)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (totalCount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.totalCount = totalCount;</span><br><span class="line">			setTotalPageCountByRs();<span class="comment">//根据总记录数计算总页�?</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPageCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.totalPageCount;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据总记录数计算总页�?</span></span><br><span class="line"><span class="comment">	 * 5   </span></span><br><span class="line"><span class="comment">	 * 20    4</span></span><br><span class="line"><span class="comment">	 * 23    5</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setTotalPageCountByRs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.size &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.totalCount &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.totalCount % <span class="keyword">this</span>.size == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.totalPageCount = <span class="keyword">this</span>.totalCount / <span class="keyword">this</span>.size;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.size &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.totalCount &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.totalCount % <span class="keyword">this</span>.size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.totalPageCount = (<span class="keyword">this</span>.totalCount / <span class="keyword">this</span>.size) + <span class="number">1</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">this</span>.totalPageCount = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		setNumbers(totalPageCount);<span class="comment">//获取展示页数集合</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span>[] getNumbers() &#123;</span><br><span class="line">		<span class="keyword">return</span> numbers;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置显示页数集合</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * 默认显示10个页码</span></span><br><span class="line"><span class="comment">	 * 41  42  43  44    [45 ]   46  47  48  49  50</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 *  [1] 2  3 4  5 6 7 8  9  10</span></span><br><span class="line"><span class="comment">	 *  </span></span><br><span class="line"><span class="comment">	 *  41  42  43  44    45    46  47  [48]  49  50</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> totalPageCount</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumbers</span><span class="params">(<span class="keyword">int</span> totalPageCount)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(totalPageCount&gt;<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="comment">//!.当前数组的长度</span></span><br><span class="line">			<span class="keyword">int</span>[] numbers = <span class="keyword">new</span> <span class="keyword">int</span>[totalPageCount&gt;<span class="number">10</span>?<span class="number">10</span>:totalPageCount];<span class="comment">//页面要显示的页数集合</span></span><br><span class="line">			<span class="keyword">int</span> k =<span class="number">0</span>;</span><br><span class="line">			<span class="comment">//</span></span><br><span class="line">			<span class="comment">//1.数组长度&lt;10   1 2 3 4 ....   7</span></span><br><span class="line">			<span class="comment">//2.数组长度&gt;=10</span></span><br><span class="line">			<span class="comment">//     当前页&lt;=6  1 2 3 4    10</span></span><br><span class="line">			<span class="comment">//     当前页&gt;=总页数-5           ......12 13 14 15  </span></span><br><span class="line">			<span class="comment">//     其他                                5  6  7 8   9 当前页(10)  10  11 12  13</span></span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; totalPageCount;i++)&#123;</span><br><span class="line">				<span class="comment">//保证当前页为集合的中�?</span></span><br><span class="line">				<span class="keyword">if</span>((i&gt;=index- (numbers.length/<span class="number">2</span>+<span class="number">1</span>) || i &gt;= totalPageCount-numbers.length) &amp;&amp; k&lt;numbers.length)&#123;</span><br><span class="line">					numbers[k] = i+<span class="number">1</span>;</span><br><span class="line">					k++;</span><br><span class="line">				&#125;<span class="keyword">else</span> <span class="keyword">if</span>(k&gt;=numbers.length)&#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;				</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">this</span>.numbers = numbers;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumbers</span><span class="params">(<span class="keyword">int</span>[] numbers)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.numbers = numbers;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">getList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setList</span><span class="params">(List&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.list = list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	public static int getTotalPageCount(int iTotalRecordCount, int iPageSize) &#123;</span></span><br><span class="line"><span class="comment">		if (iPageSize == 0) &#123;</span></span><br><span class="line"><span class="comment">			return 0;</span></span><br><span class="line"><span class="comment">		&#125; else &#123;</span></span><br><span class="line"><span class="comment">			return (iTotalRecordCount % iPageSize) == 0 ? (iTotalRecordCount / iPageSize) : (iTotalRecordCount / iPageSize) + 1;</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">	&#125;*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-3-数据库分页"><a href="#8-3-数据库分页" class="headerlink" title="8.3 数据库分页"></a>8.3 数据库分页</h3><h3 id="8-3-1-Oracle-分页"><a href="#8-3-1-Oracle-分页" class="headerlink" title="8.3.1 Oracle 分页"></a>8.3.1 Oracle 分页</h3><blockquote>
<p>需要用到三层子查询，注意 rownum 不能使用 大于，否则查询不到记录。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span>(</span><br><span class="line">  <span class="keyword">select</span> <span class="keyword">rownum</span> rn,t.* <span class="keyword">from</span>(</span><br><span class="line">  <span class="keyword">select</span> * <span class="keyword">from</span> student  <span class="keyword">order</span> <span class="keyword">by</span> score <span class="keyword">desc</span> )t  </span><br><span class="line">  <span class="keyword">where</span> <span class="keyword">rownum</span> &lt;= <span class="number">10</span> <span class="comment">-- end 结束位置</span></span><br><span class="line">  )stu </span><br><span class="line">  <span class="keyword">where</span> rn &gt; <span class="number">5</span>  <span class="comment">-- 开始位置</span></span><br></pre></td></tr></table></figure>

<h3 id="8-3-2-MySql-分页"><a href="#8-3-2-MySql-分页" class="headerlink" title="8.3.2 MySql 分页"></a>8.3.2 MySql 分页</h3><blockquote>
<p>较为简单，只需使用 limit 子句</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- select * from tbl_book limit a,b ; </span></span><br><span class="line"><span class="comment">-- 第一参数 a(a&gt;=0) 表示从那条记录开始，第二个参数表示从索引 a(a&gt;=0)  开始以后的 b(b&gt;1) 条记录</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl_book <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">5</span>; </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl_book <span class="keyword">limit</span> <span class="number">5</span>,<span class="number">5</span>;  </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl_book <span class="keyword">limit</span> <span class="number">10</span>,<span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<h2 id="8-4-通过函数提交表单"><a href="#8-4-通过函数提交表单" class="headerlink" title="8.4  通过函数提交表单"></a>8.4  通过函数提交表单</h2><ol>
<li>使用 Js 方式提交表单数据</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;sciprt&gt;</span><br><span class="line"><span class="comment">//修改每页显示的记录数  可行</span></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex2</span>(<span class="params">size,index</span>)</span>&#123;</span><br><span class="line">			<span class="comment">//获取第一个表单的 action 属性</span></span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].action = <span class="string">"servlet/SizeServlet?size="</span>+size+<span class="string">"&amp;index="</span>+index;</span><br><span class="line">			</span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); <span class="comment">//提交表单</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//修改每页显示的记录数 可行</span></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex</span>(<span class="params">size,index</span>)</span>&#123;</span><br><span class="line">			<span class="comment">//赋值 当前表单项的 name 属性键的值</span></span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].size.value = size;</span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].index.value = index;</span><br><span class="line">			<span class="comment">//获取表单</span></span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); <span class="comment">//提交表单</span></span><br><span class="line">		&#125;</span><br><span class="line">&lt;<span class="regexp">/sciprt&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>栗子</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@taglib</span> <span class="attr">prefix</span>=<span class="string">"c"</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/core"</span>%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>查询并显示所有学生信息<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"pragma"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"cache-control"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"expires"</span> <span class="attr">content</span>=<span class="string">"0"</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"keywords"</span> <span class="attr">content</span>=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">"This is my page"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	&lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">		<span class="comment">//跳转到指定页码</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">chageIndex</span>(<span class="params">index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">/* window.location.href="servlet/ShowAllServlet?index="+index; */</span></span></span><br><span class="line"><span class="javascript">			<span class="built_in">window</span>.location.href=<span class="string">"servlet/SizeServlet?size="</span>+size+<span class="string">"&amp;index="</span>+index;</span></span><br><span class="line">		&#125;</span><br><span class="line"><span class="javascript">		<span class="comment">//修改每页显示的记录数   有问题</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex3</span>(<span class="params">size,index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> name = $(<span class="string">"input[name=name]"</span>).val();</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> score = $(<span class="string">"input[name=score]"</span>).val();</span></span><br><span class="line"><span class="javascript">			<span class="comment">//window.location.href="servlet/SizeServlet?size="+size+"&amp;index="+index+"&amp;name="+name+"&amp;score="+score;</span></span></span><br><span class="line">		&#125;</span><br><span class="line"><span class="javascript">		<span class="comment">//修改每页显示的记录数  可行</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex2</span>(<span class="params">size,index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//获取第一个表单的 action 属性</span></span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].action = <span class="string">"servlet/SizeServlet?size="</span>+size+<span class="string">"&amp;index="</span>+index;</span></span><br><span class="line">			</span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); <span class="comment">//提交表单</span></span></span><br><span class="line">		&#125;</span><br><span class="line"><span class="javascript">		<span class="comment">//修改每页显示的记录数 可行</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex</span>(<span class="params">size,index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//赋值 当前表单项的 name 属性键的值</span></span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].size.value = size;</span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].index.value = index;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//获取表单</span></span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); <span class="comment">//提交表单</span></span></span><br><span class="line">		&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">  	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">align</span>=<span class="string">"center"</span> <span class="attr">style</span>=<span class="string">"font-size:20px;font-weight: 400;margin-bottom:50px;"</span>&gt;</span>查询和分页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"servlet/SizeServlet"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"size"</span> <span class="attr">value</span>=<span class="string">"$&#123;pageBean.size&#125;"</span>&gt;</span></span><br><span class="line">  	    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"index"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">	  	姓名<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">"$&#123;student.name&#125;"</span>/&gt;</span>&amp;nbsp;&amp;nbsp;</span><br><span class="line">	  	<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;student.score == 0.0&#125;"</span>&gt;</span></span><br><span class="line">		  	成绩&gt;=<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"score"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">	  	<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">	  	<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;student.score != 0.0 &#125;"</span>&gt;</span></span><br><span class="line">		  	成绩&gt;=<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"score"</span> <span class="attr">value</span>=<span class="string">"$&#123;student.score&#125;"</span> /&gt;</span></span><br><span class="line">	  	<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">  	    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"查询"</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 显示所有学生   /stumanager/    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">align</span>=<span class="string">"center"</span> <span class="attr">border</span>=<span class="string">"1"</span> <span class="attr">width</span>=<span class="string">"60%"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>学生 编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>学生姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>学生年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>学生成绩<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>vs.index<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>更新操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>删除操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;pageBean.list&#125;"</span> <span class="attr">var</span>=<span class="string">"stu"</span> <span class="attr">varStatus</span>=<span class="string">"vs"</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.id &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.name &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.age &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.score &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;vs.index &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/stumanager/servlet/StudentServlet?operate=preupdate&amp;sid=$&#123;stu.id&#125;"</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/stumanager/servlet/StudentServlet?operate=delete&amp;sid=$&#123;stu.id&#125;"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">"6"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,1)"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.index-1 &gt;= 1&#125;"</span>&gt;</span></span><br><span class="line">	    			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;pageBean.index-1&#125;)"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.index-1 &lt; 1&#125;"</span>&gt;</span></span><br><span class="line">	    				上一页</span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;pageBean.numbers&#125;"</span> <span class="attr">var</span>=<span class="string">"nums"</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;nums == pageBean.index &#125;"</span>&gt;</span></span><br><span class="line">	    				[<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;nums&#125;)"</span>&gt;</span>$&#123;nums&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>]</span><br><span class="line">    				<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;nums != pageBean.index &#125;"</span>&gt;</span></span><br><span class="line">	    				<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;nums&#125;)"</span>&gt;</span>$&#123;nums&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.index+1 &lt;=pageBean.totalPageCount&#125;"</span>&gt;</span></span><br><span class="line">	    			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;pageBean.index+1&#125;)"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span>   </span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span>  			</span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.index+1 &gt; pageBean.totalPageCount&#125;"</span>&gt;</span></span><br><span class="line">	    				下一页							</span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span>  </span><br><span class="line">    			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;pageBean.totalPageCount&#125;)"</span>&gt;</span>尾页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    			每页显示多少条记录数  </span><br><span class="line">    			<span class="tag">&lt;<span class="name">%--</span> 明天开始任务 <span class="attr">--</span>%&gt;</span></span><br><span class="line">   				<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">onchange</span>=<span class="string">"changeSizeAndIndex(this.value,$&#123;pageBean.index&#125;)"</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">begin</span>=<span class="string">"5"</span> <span class="attr">end</span>=<span class="string">"25"</span> <span class="attr">step</span>=<span class="string">"5"</span> <span class="attr">var</span>=<span class="string">"i"</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.size == i&#125;"</span>&gt;</span></span><br><span class="line">	    					<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;i&#125;"</span> <span class="attr">selected</span>=<span class="string">"selected"</span>&gt;</span>$&#123;i&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.size != i&#125;"</span>&gt;</span></span><br><span class="line">	    					<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;i&#125;"</span>&gt;</span>$&#123;i&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">   				<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    			<span class="comment">&lt;!-- 跳转到第几页  --&gt;</span></span><br><span class="line">    			跳转到</span><br><span class="line">    			<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">onchange</span>=<span class="string">"changeSizeAndIndex($&#123;pageBean.size&#125;,this.value)"</span> &gt;</span></span><br><span class="line">	    			<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;pageBean.numbers&#125;"</span> <span class="attr">var</span>=<span class="string">"num"</span>&gt;</span></span><br><span class="line">	    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;num == pageBean.index&#125;"</span>&gt;</span></span><br><span class="line">	    					<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;num&#125;"</span> <span class="attr">selected</span>=<span class="string">"selected"</span>&gt;</span>$&#123;num &#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span>	    					</span><br><span class="line">	    				<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">	    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;num != pageBean.index&#125;"</span>&gt;</span></span><br><span class="line">	    					<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;num&#125;"</span>&gt;</span>$&#123;num &#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span>	    					</span><br><span class="line">	    				<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    			</span><br><span class="line">    	</span><br><span class="line">    			共有$&#123;pageBean.totalCount&#125; 条记录</span><br><span class="line">    		<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="9-文件上传与下载"><a href="#9-文件上传与下载" class="headerlink" title="9 文件上传与下载"></a>9 文件上传与下载</h1><h2 id="9-1-导入-jar-包"><a href="#9-1-导入-jar-包" class="headerlink" title="9.1 导入 jar 包"></a>9.1 导入 jar 包</h2><p>commons-fileupload.jar 依赖于下面的 commons-io.jar 。<br>commons-io.jar</p>
<h2 id="9-2-文件上传"><a href="#9-2-文件上传" class="headerlink" title="9.2 文件上传"></a>9.2 文件上传</h2><h3 id="9-2-1-获取动态上下文地址"><a href="#9-2-1-获取动态上下文地址" class="headerlink" title="9.2.1 获取动态上下文地址"></a>9.2.1 获取动态上下文地址</h3><blockquote>
<p>用于获取服务端存储文件的位置</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//File dir = new File("D:\\upload\\"); //这里指服务器的目录下</span></span><br><span class="line"><span class="comment">//File dir = new File("D:\\Program Files\\apache-tomcat-7.0.69-windows-x64\\apache-tomcat-7.0.69\\webapps\\updownload1\\WEB-INF\\upload"); //这里指服务器的目录下</span></span><br><span class="line"><span class="comment">//完善2：动态获取上下文路径</span></span><br><span class="line">File dir = <span class="keyword">new</span> File(<span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"upload"</span>));</span><br></pre></td></tr></table></figure>

<h3 id="9-2-2-上传文件的中文乱码问题"><a href="#9-2-2-上传文件的中文乱码问题" class="headerlink" title="9.2.2 上传文件的中文乱码问题"></a>9.2.2 上传文件的中文乱码问题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line"></span><br><span class="line">ServletFileUpload fileUpload = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">fileUpload.setHeaderEncoding(<span class="string">"utf-8"</span>);  <span class="comment">//设置上传文件的名字编码格式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//name </span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">"name"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">    name = fileItem.getString(<span class="string">"utf-8"</span>); <span class="comment">//按 utf-8 格式编码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-3-限制文件上传的类型"><a href="#9-2-3-限制文件上传的类型" class="headerlink" title="9.2.3  限制文件上传的类型"></a>9.2.3  限制文件上传的类型</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//完善4：限制上传文件的类型</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="string">"image/png"</span>.equals(photoType))&#123;</span><br><span class="line">    request.setAttribute(<span class="string">"mess"</span>, <span class="string">"文件的类型不正确，应为 png 格式的图片"</span>);</span><br><span class="line">    request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request,response);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-4-限制文件上传的大小"><a href="#9-2-4-限制文件上传的大小" class="headerlink" title="9.2.4 限制文件上传的大小"></a>9.2.4 限制文件上传的大小</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//完善3：限制上传文件的大小</span></span><br><span class="line">    <span class="comment">//设置单个上传文件的大小</span></span><br><span class="line">    fileUpload.setFileSizeMax(<span class="number">200</span>*<span class="number">1024</span>); <span class="comment">//限制的单个文件的大小为 200KB</span></span><br><span class="line">    <span class="comment">//设置上传文件的总大小</span></span><br><span class="line">    fileUpload.setSizeMax(<span class="number">5</span>*<span class="number">200</span>*<span class="number">1024</span>); <span class="comment">//限制上传文件的总大小为 1000KB</span></span><br><span class="line">    <span class="comment">//将表单数据封装到 FileItem 对象中</span></span><br><span class="line">    itemList = fileUpload.parseRequest(request);</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileUploadException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="comment">//若超出文件大小，则 itemList 为 null,直接返回客户端错误信息</span></span><br><span class="line">    request.setAttribute(<span class="string">"mess"</span>, <span class="string">"单个文件大小超过限制 200KB"</span>);</span><br><span class="line">    request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request,response);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-5-使用UUID"><a href="#9-2-5-使用UUID" class="headerlink" title="9.2.5 使用UUID"></a>9.2.5 使用UUID</h3><blockquote>
<p>用于图片名称，防止图片名重复。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UUID uuid = UUID.randomUUID(); <span class="comment">//获取32位的16进制的数</span></span><br><span class="line">String ufileName = uuid.toString(); <span class="comment">//图片 uuid 名</span></span><br><span class="line">String extName = </span><br><span class="line">realName.substring(realName.lastIndexOf(<span class="string">"."</span>)+<span class="number">1</span>).toLowerCase();<span class="comment">//图片格式扩展名</span></span><br><span class="line">photoName = ufileName+<span class="string">"."</span>+extName;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-6-栗子"><a href="#9-2-6-栗子" class="headerlink" title="9.2.6 栗子"></a>9.2.6 栗子</h3><blockquote>
<ol>
<li>创建 FileItemFactory 工厂</li>
<li>创建  ServletFileUpload 上传类</li>
<li>解析 request 对象，获取 FileItem集合 </li>
<li>遍历 FileItem 集合，获取表单数据和非表单数据</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItem;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileUploadException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.bjsxt.entity.Student;</span><br><span class="line"><span class="keyword">import</span> com.bjsxt.service.StudentService;</span><br><span class="line"><span class="keyword">import</span> com.bjsxt.service.impl.StudentServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doPost(request, response);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        <span class="comment">//创建 FileItemFactory 工厂</span></span><br><span class="line">        FileItemFactory factory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建  ServletFileUpload 上传类</span></span><br><span class="line">        ServletFileUpload fileUpload = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">        fileUpload.setHeaderEncoding(<span class="string">"utf-8"</span>);  <span class="comment">//设置上传文件的名字编码格式</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//解析 request 对象，获取 FileItem集合 </span></span><br><span class="line">        List&lt;FileItem&gt; itemList  = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//完善3：限制上传文件的大小</span></span><br><span class="line">            <span class="comment">//设置单个上传文件的大小</span></span><br><span class="line">            fileUpload.setFileSizeMax(<span class="number">200</span>*<span class="number">1024</span>); <span class="comment">//限制的单个文件的大小为 200KB</span></span><br><span class="line">            <span class="comment">//设置上传文件的总大小</span></span><br><span class="line">            fileUpload.setSizeMax(<span class="number">5</span>*<span class="number">200</span>*<span class="number">1024</span>); <span class="comment">//限制上传文件的总大小为 1000KB</span></span><br><span class="line">            <span class="comment">//将表单数据封装到 FileItem 对象中</span></span><br><span class="line">            itemList = fileUpload.parseRequest(request);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileUploadException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">//若超出文件大小，则 itemList 为 null,直接返回客户端错误信息</span></span><br><span class="line">            request.setAttribute(<span class="string">"mess"</span>, <span class="string">"单个文件大小超过限制 200KB"</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String name = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> age =  <span class="number">0</span>;</span><br><span class="line">        Double score = <span class="number">0.0</span>;</span><br><span class="line">        String realName = <span class="keyword">null</span>;  <span class="comment">//图片真实名称</span></span><br><span class="line">        String photoName = <span class="keyword">null</span>; <span class="comment">//图片名称</span></span><br><span class="line">        String photoType = <span class="keyword">null</span>; <span class="comment">//图片格式类型</span></span><br><span class="line">        <span class="comment">//遍历 FileItem 集合</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; itemList.size(); i++) &#123;</span><br><span class="line">            FileItem fileItem = itemList.get(i);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(fileItem.isFormField())&#123; <span class="comment">//是非 file 表单项</span></span><br><span class="line">                <span class="comment">//name </span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"name"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">                    name = fileItem.getString(<span class="string">"utf-8"</span>); <span class="comment">//按 utf-8 格式编码</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//age</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"age"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">                    age = Integer.valueOf(fileItem.getString());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//score</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"score"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">                    String sScore = fileItem.getString();</span><br><span class="line">                    score = Double.valueOf(sScore);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;<span class="comment">// 是 file 表单项</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"photo"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">                    realName = fileItem.getName();  <span class="comment">//获取上传图片名称</span></span><br><span class="line">                    photoType = fileItem.getContentType(); <span class="comment">//获取上传图片的类型</span></span><br><span class="line">                    <span class="comment">//String is = fileItem.getString(); //获取上传图片的资源</span></span><br><span class="line">                    <span class="comment">//System.out.println(photoName+"\t"+photoType+"\t");</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//完善4：限制上传文件的类型</span></span><br><span class="line">                    <span class="keyword">if</span>(!<span class="string">"image/png"</span>.equals(photoType))&#123;</span><br><span class="line">                        request.setAttribute(<span class="string">"mess"</span>, <span class="string">"文件的类型不正确，应为 png 格式的图片"</span>);</span><br><span class="line">                        request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request,response);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//File dir = new File("D:\\upload\\"); //这里指服务器的目录下</span></span><br><span class="line">                    <span class="comment">//File dir = new File("D:\\Program Files\\apache-tomcat-7.0.69-windows-x64\\apache-tomcat-7.0.69\\webapps\\updownload1\\WEB-INF\\upload"); //这里指服务器的目录下</span></span><br><span class="line">                    <span class="comment">//完善2：动态获取上下文路径</span></span><br><span class="line">                    File dir = <span class="keyword">new</span> File(<span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"upload"</span>));</span><br><span class="line">                    <span class="comment">//完善1：若文件夹不存在则创建该文件夹</span></span><br><span class="line">                    <span class="keyword">if</span>(!dir.exists())&#123;</span><br><span class="line">                        dir.mkdirs();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//完善5：使用UUID 作为图片名</span></span><br><span class="line">                    UUID uuid = UUID.randomUUID(); <span class="comment">//获取32位的16进制的数</span></span><br><span class="line">                    String ufileName = uuid.toString(); <span class="comment">//图片 uuid 名</span></span><br><span class="line">                    String extName = realName.substring(realName.lastIndexOf(<span class="string">"."</span>)+<span class="number">1</span>).toLowerCase();<span class="comment">//图片格式扩展名</span></span><br><span class="line">                    photoName = ufileName+<span class="string">"."</span>+extName;</span><br><span class="line">                    <span class="comment">//System.out.println("图片格式扩展名："+extName);</span></span><br><span class="line"></span><br><span class="line">                    File  file = <span class="keyword">new</span> File(dir,photoName);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//上传到指定的目录下</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        fileItem.write(file);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//System.out.println(name+"\t"+age+"\t"+score);</span></span><br><span class="line"></span><br><span class="line">        StudentService service = <span class="keyword">new</span> StudentServiceImpl();</span><br><span class="line">        Student stu = <span class="keyword">new</span> Student(name, age, score, realName, photoName, photoType);</span><br><span class="line">        <span class="keyword">int</span> n = service.save(stu) ; <span class="comment">//保存学生信息</span></span><br><span class="line">        <span class="comment">//页面跳转</span></span><br><span class="line">        <span class="keyword">if</span>(n!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//重定向:/后面要跟上下文路径  /stumgr   /stumgr2</span></span><br><span class="line"></span><br><span class="line">            response.sendRedirect(request.getContextPath()+<span class="string">"/servlet/ShowAllServlet"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            request.setAttribute(<span class="string">"mess"</span>, <span class="string">"添加失败!"</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request, response);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-3-文件下载"><a href="#9-3-文件下载" class="headerlink" title="9.3 文件下载"></a>9.3 文件下载</h2><blockquote>
<p>使用IO流的方式将服务器的文件资源发送给客户端</p>
<p>中间使用 IOUtils 工具类（org.apache.commons.io.IOUtils）。</p>
<p>注意：流使用后要关闭。</p>
<p>​          添加响应头说明该文件是的大小、类型及文件名</p>
</blockquote>
<h3 id="9-3-1-下载中文名乱码问题"><a href="#9-3-1-下载中文名乱码问题" class="headerlink" title="9.3.1 下载中文名乱码问题"></a>9.3.1 下载中文名乱码问题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">String realName = stu.getRealName();</span><br><span class="line"><span class="comment">/*byte[] bytes = realName.getBytes("utf-8");</span></span><br><span class="line"><span class="comment">			String realName2 = new String(bytes,"utf-8");*/</span> </span><br><span class="line">String realName2 = <span class="keyword">null</span>;</span><br><span class="line">String userAgent = req.getHeader(<span class="string">"User-Agent"</span>).toLowerCase();</span><br><span class="line"><span class="keyword">if</span>(userAgent.indexOf(<span class="string">"trident"</span>) &gt;= <span class="number">0</span>)&#123;<span class="comment">//如果是 IE 浏览器</span></span><br><span class="line">    realName2 = URLEncoder.encode(realName,<span class="string">"utf-8"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    realName2 = <span class="keyword">new</span> String(realName.getBytes(<span class="string">"utf-8"</span>),<span class="string">"iso-8859-1"</span>); <span class="comment">//服务器发送给客户端，Get 编码方式反过来</span></span><br><span class="line">&#125;</span><br><span class="line">resp.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span>+realName2);</span><br><span class="line">OutputStream out = resp.getOutputStream();</span><br></pre></td></tr></table></figure>

<h3 id="9-3-2-栗子"><a href="#9-3-2-栗子" class="headerlink" title="9.3.2 栗子"></a>9.3.2 栗子</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.bjsxt.entity.Student;</span><br><span class="line"><span class="keyword">import</span> com.bjsxt.service.StudentService;</span><br><span class="line"><span class="keyword">import</span> com.bjsxt.service.impl.StudentServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">			<span class="comment">//1. 接受请求数据，学生的ID</span></span><br><span class="line">			String sId = req.getParameter(<span class="string">"id"</span>);</span><br><span class="line">			<span class="keyword">int</span> id = -<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				id = Integer.valueOf(sId);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//2. 处理请求数据</span></span><br><span class="line">			StudentService service = <span class="keyword">new</span> StudentServiceImpl();</span><br><span class="line">			Student stu = service.findById(id);</span><br><span class="line">			<span class="comment">//3. 响应请求数据      使用IO流的方式</span></span><br><span class="line">			<span class="comment">//3.1  获取输入输出流</span></span><br><span class="line">			String realPath = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"upload"</span>);</span><br><span class="line">			File file = <span class="keyword">new</span> File(realPath+<span class="string">"/"</span>+stu.getPhotoName());</span><br><span class="line">			InputStream is  = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">			<span class="comment">// 添加响应头信息</span></span><br><span class="line">			resp.setContentLength((<span class="keyword">int</span>)file.length()); <span class="comment">//设置响应内容的长度</span></span><br><span class="line">			resp.setContentType(stu.getPhotoType()); <span class="comment">//设置响应内容的格式</span></span><br><span class="line">			<span class="comment">//处理图片真实名称中文乱码问题</span></span><br><span class="line">			String realName = stu.getRealName();</span><br><span class="line">			<span class="comment">/*byte[] bytes = realName.getBytes("utf-8");</span></span><br><span class="line"><span class="comment">			String realName2 = new String(bytes,"utf-8");*/</span> </span><br><span class="line">			String realName2 = <span class="keyword">null</span>;</span><br><span class="line">			String userAgent = req.getHeader(<span class="string">"User-Agent"</span>).toLowerCase();</span><br><span class="line">			<span class="keyword">if</span>(userAgent.indexOf(<span class="string">"trident"</span>) &gt;= <span class="number">0</span>)&#123;<span class="comment">//如果是 IE 浏览器</span></span><br><span class="line">				realName2 = URLEncoder.encode(realName,<span class="string">"utf-8"</span>);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				realName2 = <span class="keyword">new</span> String(realName.getBytes(<span class="string">"utf-8"</span>),<span class="string">"iso-8859-1"</span>); <span class="comment">//服务器发送给客户端，Get 编码方式反过来</span></span><br><span class="line">			&#125;</span><br><span class="line">			resp.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span>+realName2);</span><br><span class="line">			OutputStream out = resp.getOutputStream();</span><br><span class="line">			<span class="comment">//3.2 将输入流复制到输出流中</span></span><br><span class="line">			IOUtils.copy(is, out);</span><br><span class="line">			<span class="comment">//3.3 关闭流</span></span><br><span class="line">			is.close();</span><br><span class="line">			out.close();</span><br><span class="line">			</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="10-版本管理与SVN-入门"><a href="#10-版本管理与SVN-入门" class="headerlink" title="10 版本管理与SVN 入门"></a>10 版本管理与SVN 入门</h1><h2 id="10-1-版本管理的概念"><a href="#10-1-版本管理的概念" class="headerlink" title="10.1 版本管理的概念"></a>10.1 版本管理的概念</h2><blockquote>
<p>解决：代码合并、历史版本中的迭代、重复</p>
</blockquote>
<h3 id="10-1-2-版本控制软件"><a href="#10-1-2-版本控制软件" class="headerlink" title="10.1.2  版本控制软件"></a>10.1.2  版本控制软件</h3><p>a) VSS：Microsoft 提供，Window 平台，小型开发团队所适合的工具。</p>
<p>b) CVS：开源工具，跨平台。绝大多数 CVS 服务已改用 SVN。CVS 已停止维护</p>
<p>c) SVN（Subversion）：开源，跨平台，在 CVS 的基础上开发。使用企业众多， 稳定安全，操作简单。集中式版本控制系统。</p>
<p>d) GIT：开源的分布式版本控制系统，用以有效高速的处理从很小到非常大的项</p>
<p>目版本管理。（GITHUB 是一个用 GIT 做版本控制的项目托管平台，B/S 架构。放到 GITHUB 上的代码需要开源，并且是互联网开发）</p>
<p><img src="http://www.zwer.xyz/picGo/20190506083256.png" alt></p>
<h2 id="10-2-SVN入门"><a href="#10-2-SVN入门" class="headerlink" title="10.2 SVN入门"></a>10.2 SVN入门</h2><h3 id="10-2-1-安装软件"><a href="#10-2-1-安装软件" class="headerlink" title="10.2.1 安装软件"></a>10.2.1 安装软件</h3><p>a) 指定软件安装位置和版本库位置</p>
<p>b) 默认端口 443</p>
<p>c) 使用 SVN authentication</p>
<h3 id="10-2-2-创建版本库"><a href="#10-2-2-创建版本库" class="headerlink" title="10.2.2  创建版本库"></a>10.2.2  创建版本库</h3><p>a) 创建默认结构 use default struction</p>
<p>b) 默认结构的含义</p>
<p>i. trunk：主干    开发时代码存储的位置，永远是最新的代码</p>
<p>ii. brank：分支    在不影响Trunk 其它用户情况下进行一些关于新功能的探索性或实验性的开发，待新功能完善后它也可以合并到 Trunk 中</p>
<p>iii. tags：标签 历史版本 阶段性里程碑版本 比如 1.0 2.0 3.0</p>
<h3 id="10-2-3-创建用户"><a href="#10-2-3-创建用户" class="headerlink" title="10.2.3 创建用户"></a>10.2.3 创建用户</h3><h3 id="10-2-4-创建组"><a href="#10-2-4-创建组" class="headerlink" title="10.2.4 创建组"></a>10.2.4 创建组</h3><h3 id="1-0-2-5-为组指定用户"><a href="#1-0-2-5-为组指定用户" class="headerlink" title="1 0.2.5 为组指定用户"></a>1 0.2.5 为组指定用户</h3><h3 id="10-2-6-为组指定对版本库的操作权限"><a href="#10-2-6-为组指定对版本库的操作权限" class="headerlink" title="10.2.6  为组指定对版本库的操作权限"></a>10.2.6  为组指定对版本库的操作权限</h3><p>​    a) 默认 everyone 具有 read/write 权限，无法删除，要修改为 no access</p>
<h3 id="10-2-7-通过浏览器访问服务器端"><a href="#10-2-7-通过浏览器访问服务器端" class="headerlink" title="10.2.7  通过浏览器访问服务器端"></a>10.2.7  通过浏览器访问服务器端</h3><h3 id="10-3-客户端-subclipse"><a href="#10-3-客户端-subclipse" class="headerlink" title="10.3 客户端 subclipse"></a>10.3 客户端 subclipse</h3><blockquote>
<p>一款 eclipse 中的 SNV 客户端插件。</p>
</blockquote>
<h3 id="10-3-1-安装"><a href="#10-3-1-安装" class="headerlink" title="10.3.1 安装"></a>10.3.1 安装</h3><p>a) 解压后将其中的 features 和 plugin 文件夹放入MyEclipse 的 dropins 目录下</p>
<p>b) 重新启动MyEclipse，即可自动发现并安装</p>
<p>c) 安装后在 window——preferrences——team 中可以看到 SVN</p>
<h3 id="10-3-2-提交项目到服务器端"><a href="#10-3-2-提交项目到服务器端" class="headerlink" title="10.3.2  提交项目到服务器端"></a>10.3.2  提交项目到服务器端</h3><p>a) 选中项目右键——–team—-share project    选择 SVN</p>
<p>b) 提交版本位置、用户名、密码都会由相关服务器管理人员提供。</p>
<p><img src="http://www.zwer.xyz/picGo/20190506083833.png" alt></p>
<p>a) 可以选择记住密码，避免多次的重复输入。</p>
<p>b) 提交后会跳到 team synchronizing view，还需要真正同步代码到服务器，同步之前可以选择哪些代码不需要使用 svn 进行管理</p>
<p>c) 提交成功后可以观察版本库容量的变化</p>
<p>d) 提交成功后客户端项目会显示专门的标记，并且增加了相应的.svn 项目，来存储操作记录</p>
<p><img src="http://www.zwer.xyz/picGo/20190506083935.png" alt></p>
<p><img src="http://www.zwer.xyz/picGo/20190506083951.png" alt></p>
<h3 id="10-3-4-断开和服务器连接"><a href="#10-3-4-断开和服务器连接" class="headerlink" title="10.3.4 断开和服务器连接"></a>10.3.4 断开和服务器连接</h3><p>a) team—断开连接    从项目中删除 SVN 元信息</p>
<h3 id="10-3-5-客户端从-SVN-检出项目"><a href="#10-3-5-客户端从-SVN-检出项目" class="headerlink" title="10.3.5 客户端从 SVN 检出项目"></a>10.3.5 客户端从 SVN 检出项目</h3><p>a) new— Project…——–SVN    从 SVN 检出项目</p>
<h3 id="10-3-6-更新和提交操作"><a href="#10-3-6-更新和提交操作" class="headerlink" title="10.3.6 更新和提交操作"></a>10.3.6 更新和提交操作</h3><p>a) 更新将服务器最新代码更新到本地；提交是将本地最新代码提交到服务器</p>
<p>b) <strong>提交之前要先更新</strong>，因为可能其他程序员期间以及提交了最新代码到服务器</p>
<p>c) <strong>提交一定要给出注释</strong>，对提交内容进行说明，作为以后辨别版本的主要依据。</p>
<h3 id="10-3-7-解决冲突"><a href="#10-3-7-解决冲突" class="headerlink" title="10.3.7 解决冲突"></a>10.3.7 解决冲突</h3><p>a) 模拟两个用户对一个类进行修改，分别修改相同的方法和增加一个新方法</p>
<p>b) 更新后出现冲突，和冲突方沟通后，对冲突文件给出最终解决方案</p>
<p>c) 还需要 team    标记为解决，相应冲突文件为自动删除，当前文件由冲突状态</p>
<p>转换为已修改状态，待提交</p>
<h4 id="10-3-8-还原没有提交的提交的代码"><a href="#10-3-8-还原没有提交的提交的代码" class="headerlink" title="10.3.8 还原没有提交的提交的代码"></a>10.3.8 还原没有提交的提交的代码</h4><p>a) team    还原</p>
<h4 id="10-3-9-还原已经提交的代码"><a href="#10-3-9-还原已经提交的代码" class="headerlink" title="10.3.9 还原已经提交的代码"></a>10.3.9 还原已经提交的代码</h4><p>a) 如果最新的代码出现问题，可以直接修改，也可以回滚到之前的某个历史版本，直接使用或者进行修改</p>
<p>b) 查看资源历史记录</p>
<p>c) 根据注释确定要还原的版本，无法确定可以查看或者比较代码</p>
<p>d) 确定版本后，右键选择”从修订班x 回复更改”</p>
<p>e) 可能出现冲突，解决后提交代码到服务器</p>
<h1 id="Bug-与-技巧"><a href="#Bug-与-技巧" class="headerlink" title="Bug 与 技巧"></a>Bug 与 技巧</h1><ol>
<li>使用 try catch 提高程序健壮性。列如在 servlet 中接受数字类型参数，需要格式转换，这时可以使用 trycatch语句，防止传入的参数有 null 和 空字符串或者其他的字符等等。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取请求参数</span></span><br><span class="line"><span class="comment">// 1.1 获取每页的记录数</span></span><br><span class="line">String sSize = req.getParameter(<span class="string">"size"</span>);</span><br><span class="line"><span class="keyword">int</span> size = <span class="number">5</span>; <span class="comment">//每页记录数</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    size = Integer.valueOf(sSize);</span><br><span class="line">&#125;<span class="keyword">catch</span>(NumberFormatException e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1.2 获取页码索引</span></span><br><span class="line">String sIndex = req.getParameter(<span class="string">"index"</span>);</span><br><span class="line"><span class="keyword">int</span> index = <span class="number">1</span>;<span class="comment">//页码索引 </span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    index = Integer.valueOf(sIndex);  <span class="comment">//null ," "				</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;	</span><br><span class="line"><span class="comment">// 1.3 获取当前成绩</span></span><br><span class="line">String sScore = req.getParameter(<span class="string">"score"</span>);</span><br><span class="line">Double score = <span class="number">0.0</span>;		 		</span><br><span class="line"><span class="keyword">if</span>(sScore == <span class="keyword">null</span> || sScore.equals(<span class="string">""</span>))&#123;</span><br><span class="line">    sScore = <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    score = Double.parseDouble(sScore);</span><br><span class="line">&#125;<span class="keyword">catch</span>(NumberFormatException e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1.4 获取学生姓名</span></span><br><span class="line">String name = req.getParameter(<span class="string">"name"</span>);</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/OA系统/" rel="tag"># OA系统</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/04/03/20190403 过滤器和监听器/" rel="next" title="20190403 过滤器和监听器">
                  <i class="fa fa-chevron-left"></i> 20190403 过滤器和监听器
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/05/06/20190506 Spring 框架/" rel="prev" title="20190506 Spring 框架">
                  20190506 Spring 框架 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-项目概况"><span class="nav-number">1.</span> <span class="nav-text">1 项目概况</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-搭建项目框架"><span class="nav-number">2.</span> <span class="nav-text">2 搭建项目框架</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-部门模块"><span class="nav-number">3.</span> <span class="nav-text">3 部门模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-Junit-测试"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 Junit 测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-重定向和请求转发"><span class="nav-number">3.2.</span> <span class="nav-text">3.2  重定向和请求转发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-断点调试"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 断点调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-时序图"><span class="nav-number">3.4.</span> <span class="nav-text">3.3 时序图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-添加部门信息"><span class="nav-number">3.4.1.</span> <span class="nav-text">3.3.1 添加部门信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-部门信息更新操作"><span class="nav-number">3.4.2.</span> <span class="nav-text">3.3.2 部门信息更新操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-属性关联"><span class="nav-number">3.5.</span> <span class="nav-text">3.4  属性关联</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-日历插件"><span class="nav-number">3.6.</span> <span class="nav-text">3.5  日历插件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-6-富文本编辑器"><span class="nav-number">3.7.</span> <span class="nav-text">3.6 富文本编辑器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-8-一对多查询"><span class="nav-number">3.8.</span> <span class="nav-text">3.8  一对多查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-9-动态-SQL语句"><span class="nav-number">3.9.</span> <span class="nav-text">3.9  动态 SQL语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-10-servlet-接受表单数据预处理"><span class="nav-number">3.10.</span> <span class="nav-text">3.10 servlet 接受表单数据预处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-11-获取同名列的问题"><span class="nav-number">3.11.</span> <span class="nav-text">3.11 获取同名列的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-12-form表单提交问题"><span class="nav-number">3.12.</span> <span class="nav-text">3.12 form表单提交问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-13-删除员工"><span class="nav-number">3.13.</span> <span class="nav-text">3.13 删除员工</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-14-更新员工信息"><span class="nav-number">3.14.</span> <span class="nav-text">3.14 更新员工信息</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-考勤模块"><span class="nav-number">4.</span> <span class="nav-text">4 考勤模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-登录模块"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 登录模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-1-菜单分栏"><span class="nav-number">4.1.1.</span> <span class="nav-text">4.1.1 菜单分栏</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-2-验证码"><span class="nav-number">4.1.2.</span> <span class="nav-text">4.1.2 验证码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-查看考勤信息模块"><span class="nav-number">4.2.</span> <span class="nav-text">4.5 查看考勤信息模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-1-动态-SQL"><span class="nav-number">4.2.1.</span> <span class="nav-text">4.5.1  动态 SQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-2-PIO"><span class="nav-number">4.2.2.</span> <span class="nav-text">4.5.2 PIO</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-报销模块"><span class="nav-number">5.</span> <span class="nav-text">5 报销模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-自定义异常"><span class="nav-number">5.1.</span> <span class="nav-text">5.1 自定义异常</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-1-自定义异常类"><span class="nav-number">5.1.1.</span> <span class="nav-text">5.5.1 自定义异常类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-2-DBUtil-使用自定义异常类"><span class="nav-number">5.1.2.</span> <span class="nav-text">5.1.2 DBUtil 使用自定义异常类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-servlet-中调用业务层发生错误的处理办法"><span class="nav-number">5.2.</span> <span class="nav-text">5.2 servlet 中调用业务层发生错误的处理办法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-service-层事务处理"><span class="nav-number">5.3.</span> <span class="nav-text">5.3 service 层事务处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-使用浏览器地址栏上的信息"><span class="nav-number">5.4.</span> <span class="nav-text">5.4 使用浏览器地址栏上的信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-关闭子窗口，刷新父窗口"><span class="nav-number">5.5.</span> <span class="nav-text">5.5 关闭子窗口，刷新父窗口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-6-画业务流程图"><span class="nav-number">5.6.</span> <span class="nav-text">5.6  画业务流程图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-1-第一步"><span class="nav-number">5.6.1.</span> <span class="nav-text">5.6.1 第一步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-2-第二步"><span class="nav-number">5.6.2.</span> <span class="nav-text">5.6.2 第二步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-3-第三步优化"><span class="nav-number">5.6.3.</span> <span class="nav-text">5.6.3 第三步优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-7-使用常量类"><span class="nav-number">5.7.</span> <span class="nav-text">5.7 使用常量类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-8-bug之数据库连接关闭"><span class="nav-number">5.8.</span> <span class="nav-text">5.8  bug之数据库连接关闭</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-收支管理"><span class="nav-number">6.</span> <span class="nav-text">6 收支管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-echart-（Enterprise-charts-商业产品图标库）入门"><span class="nav-number">6.1.</span> <span class="nav-text">6.1  echart （Enterprise charts 商业产品图标库）入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-1-特性"><span class="nav-number">6.1.1.</span> <span class="nav-text">6.1.1  特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-2-使用"><span class="nav-number">6.1.2.</span> <span class="nav-text">6.1.2 使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-3-效果"><span class="nav-number">6.1.3.</span> <span class="nav-text">6.1.3 效果</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-项目总结"><span class="nav-number">7.</span> <span class="nav-text">7 项目总结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-项目核心知识点"><span class="nav-number">7.1.</span> <span class="nav-text">7.1 项目核心知识点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-分层功能分配"><span class="nav-number">7.2.</span> <span class="nav-text">7.2 分层功能分配</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-分页功能"><span class="nav-number">8.</span> <span class="nav-text">8 分页功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-分页的意义"><span class="nav-number">8.1.</span> <span class="nav-text">8.1 分页的意义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-PageBean-分页工具类"><span class="nav-number">8.2.</span> <span class="nav-text">8.2  PageBean 分页工具类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-数据库分页"><span class="nav-number">8.2.1.</span> <span class="nav-text">8.3 数据库分页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-1-Oracle-分页"><span class="nav-number">8.2.2.</span> <span class="nav-text">8.3.1 Oracle 分页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-2-MySql-分页"><span class="nav-number">8.2.3.</span> <span class="nav-text">8.3.2 MySql 分页</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4-通过函数提交表单"><span class="nav-number">8.3.</span> <span class="nav-text">8.4  通过函数提交表单</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-文件上传与下载"><span class="nav-number">9.</span> <span class="nav-text">9 文件上传与下载</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-导入-jar-包"><span class="nav-number">9.1.</span> <span class="nav-text">9.1 导入 jar 包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-文件上传"><span class="nav-number">9.2.</span> <span class="nav-text">9.2 文件上传</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-1-获取动态上下文地址"><span class="nav-number">9.2.1.</span> <span class="nav-text">9.2.1 获取动态上下文地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-2-上传文件的中文乱码问题"><span class="nav-number">9.2.2.</span> <span class="nav-text">9.2.2 上传文件的中文乱码问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-3-限制文件上传的类型"><span class="nav-number">9.2.3.</span> <span class="nav-text">9.2.3  限制文件上传的类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-4-限制文件上传的大小"><span class="nav-number">9.2.4.</span> <span class="nav-text">9.2.4 限制文件上传的大小</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-5-使用UUID"><span class="nav-number">9.2.5.</span> <span class="nav-text">9.2.5 使用UUID</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-6-栗子"><span class="nav-number">9.2.6.</span> <span class="nav-text">9.2.6 栗子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-3-文件下载"><span class="nav-number">9.3.</span> <span class="nav-text">9.3 文件下载</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-1-下载中文名乱码问题"><span class="nav-number">9.3.1.</span> <span class="nav-text">9.3.1 下载中文名乱码问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-2-栗子"><span class="nav-number">9.3.2.</span> <span class="nav-text">9.3.2 栗子</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-版本管理与SVN-入门"><span class="nav-number">10.</span> <span class="nav-text">10 版本管理与SVN 入门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#10-1-版本管理的概念"><span class="nav-number">10.1.</span> <span class="nav-text">10.1 版本管理的概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-2-版本控制软件"><span class="nav-number">10.1.1.</span> <span class="nav-text">10.1.2  版本控制软件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-2-SVN入门"><span class="nav-number">10.2.</span> <span class="nav-text">10.2 SVN入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-1-安装软件"><span class="nav-number">10.2.1.</span> <span class="nav-text">10.2.1 安装软件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-2-创建版本库"><span class="nav-number">10.2.2.</span> <span class="nav-text">10.2.2  创建版本库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-3-创建用户"><span class="nav-number">10.2.3.</span> <span class="nav-text">10.2.3 创建用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-4-创建组"><span class="nav-number">10.2.4.</span> <span class="nav-text">10.2.4 创建组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-0-2-5-为组指定用户"><span class="nav-number">10.2.5.</span> <span class="nav-text">1 0.2.5 为组指定用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-6-为组指定对版本库的操作权限"><span class="nav-number">10.2.6.</span> <span class="nav-text">10.2.6  为组指定对版本库的操作权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-7-通过浏览器访问服务器端"><span class="nav-number">10.2.7.</span> <span class="nav-text">10.2.7  通过浏览器访问服务器端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-客户端-subclipse"><span class="nav-number">10.2.8.</span> <span class="nav-text">10.3 客户端 subclipse</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-1-安装"><span class="nav-number">10.2.9.</span> <span class="nav-text">10.3.1 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-2-提交项目到服务器端"><span class="nav-number">10.2.10.</span> <span class="nav-text">10.3.2  提交项目到服务器端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-4-断开和服务器连接"><span class="nav-number">10.2.11.</span> <span class="nav-text">10.3.4 断开和服务器连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-5-客户端从-SVN-检出项目"><span class="nav-number">10.2.12.</span> <span class="nav-text">10.3.5 客户端从 SVN 检出项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-6-更新和提交操作"><span class="nav-number">10.2.13.</span> <span class="nav-text">10.3.6 更新和提交操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-7-解决冲突"><span class="nav-number">10.2.14.</span> <span class="nav-text">10.3.7 解决冲突</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-8-还原没有提交的提交的代码"><span class="nav-number">10.2.14.1.</span> <span class="nav-text">10.3.8 还原没有提交的提交的代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-9-还原已经提交的代码"><span class="nav-number">10.2.14.2.</span> <span class="nav-text">10.3.9 还原已经提交的代码</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Bug-与-技巧"><span class="nav-number">11.</span> <span class="nav-text">Bug 与 技巧</span></a></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zwer</p>
  <div class="site-description" itemprop="description">记录学习的日常</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">77</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span>
        
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
        <span class="site-state-item-count">52</span>
        <span class="site-state-item-name">tags</span>
        
      </div>
    
  </nav>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zwer</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.4.0</div>

        












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/muse.js?v=7.4.0"></script>
<script src="/js/next-boot.js?v=7.4.0"></script>



  





















  

  

  

</body>
</html>
