<!DOCTYPE html>





<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="1 线程知识回顾1.1 程序、进程、线程程序： 计算机指令中的集合 进程： 运行中的程序 线程： 是进程中一个“单一的连续控制流程” (a singlesThread,equentialflow of control)/执行路径线程又被称为轻量级进程(lightweight process)。 1.2 在 Java 中创建线程的两种方式1) 继承 Thread2) 实现 Runnable 接口 1">
<meta name="keywords" content="多线程,并发">
<meta property="og:type" content="article">
<meta property="og:title" content="20181118 多线程并发技术">
<meta property="og:url" content="http://zwer.xyz/2018/11/18/Java/20181118 多线程并发技术/index.html">
<meta property="og:site_name" content="zwer 的博客空间">
<meta property="og:description" content="1 线程知识回顾1.1 程序、进程、线程程序： 计算机指令中的集合 进程： 运行中的程序 线程： 是进程中一个“单一的连续控制流程” (a singlesThread,equentialflow of control)/执行路径线程又被称为轻量级进程(lightweight process)。 1.2 在 Java 中创建线程的两种方式1) 继承 Thread2) 实现 Runnable 接口 1">
<meta property="og:locale" content="en">
<meta property="og:image" content="c:%5CUsers%5CLenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1542542458554.png">
<meta property="og:image" content="c:%5CUsers%5CLenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1542544545063.png">
<meta property="og:image" content="c:%5CUsers%5CLenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1542633774883.png">
<meta property="og:image" content="c:%5CUsers%5CLenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1542633869679.png">
<meta property="og:image" content="c:%5CUsers%5CLenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1542629233167.png">
<meta property="og:image" content="c:%5CUsers%5CLenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1542632141376.png">
<meta property="og:updated_time" content="2019-02-27T14:13:45.239Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="20181118 多线程并发技术">
<meta name="twitter:description" content="1 线程知识回顾1.1 程序、进程、线程程序： 计算机指令中的集合 进程： 运行中的程序 线程： 是进程中一个“单一的连续控制流程” (a singlesThread,equentialflow of control)/执行路径线程又被称为轻量级进程(lightweight process)。 1.2 在 Java 中创建线程的两种方式1) 继承 Thread2) 实现 Runnable 接口 1">
<meta name="twitter:image" content="c:%5CUsers%5CLenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1542542458554.png">
  <link rel="canonical" href="http://zwer.xyz/2018/11/18/Java/20181118 多线程并发技术/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>20181118 多线程并发技术 | zwer 的博客空间</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zwer 的博客空间</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">上善若水 自强不息</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2018/11/18/Java/20181118 多线程并发技术/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">20181118 多线程并发技术

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2018-11-18 19:30:00" itemprop="dateCreated datePublished" datetime="2018-11-18T19:30:00+08:00">2018-11-18</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-02-27 22:13:45" itemprop="dateModified" datetime="2019-02-27T22:13:45+08:00">2019-02-27</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="1-线程知识回顾"><a href="#1-线程知识回顾" class="headerlink" title="1 线程知识回顾"></a>1 线程知识回顾</h3><h4 id="1-1-程序、进程、线程"><a href="#1-1-程序、进程、线程" class="headerlink" title="1.1 程序、进程、线程"></a>1.1 程序、进程、线程</h4><p>程序： 计算机指令中的集合</p>
<p>进程： 运行中的程序</p>
<p>线程： 是进程中一个“单一的连续控制流程” (<code>a singlesThread,equential</code>flow of control)/执行路径<br>线程又被称为轻量级进程(lightweight process)。</p>
<h4 id="1-2-在-Java-中创建线程的两种方式"><a href="#1-2-在-Java-中创建线程的两种方式" class="headerlink" title="1.2 在 Java 中创建线程的两种方式"></a>1.2 在 Java 中创建线程的两种方式</h4><p>1) 继承 Thread<br>2) 实现 Runnable 接口</p>
<h4 id="1-3-线程的生命周期"><a href="#1-3-线程的生命周期" class="headerlink" title="1.3 线程的生命周期"></a>1.3 线程的生命周期</h4><p><img src="C:%5CUsers%5CLenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1542542458554.png" alt="1542542458554"></p>
<h4 id="1-4-同步与死锁"><a href="#1-4-同步与死锁" class="headerlink" title="1.4 同步与死锁"></a>1.4 同步与死锁</h4><p>1) 同步方法 同步监视器为当前对象 this</p>
<p>2) 同步代码块(同步监视器/共享资源的对象){}过多的同步就会导致死锁</p>
<h4 id="1-5-线程间的通信"><a href="#1-5-线程间的通信" class="headerlink" title="1.5 线程间的通信"></a>1.5 线程间的通信</h4><p>1) wait()</p>
<p>2) notify()</p>
<p>3) <code>notifyAll()</code></p>
<h4 id="1-6-案例"><a href="#1-6-案例" class="headerlink" title="1.6 案例"></a>1.6 案例</h4><p>编写两个线程,一个线程打印 1-52 的整数，另一个线程打印字母 A-Z。打印顺序为 12A34B56C….5152Z。即按照整数和字母的顺序从小到大打印，并且每打印两个整数后，打印一个字母，交替循环打印，直到打印到整数 52 和字母 Z 结束。</p>
<p>要求：1) 编写打印类 Printer，声明私有属性 index，初始值为 1，用来表示是第几次打印。</p>
<p>2) 在打印类 Printer 中编写打印数字的方法 <code>print(int i)</code>，3 的倍数就使用 wait()方法等待，否则就输出 <code>i</code>，使用 <code>notifyAll()</code>进行唤醒其它线程。</p>
<p>3) 在打印类 Printer 中编写打印字母的方法 print(char c)，不是 3 的倍数就等待，否则就打印输出字母 c，使用 <code>notifyAll()</code>进行唤醒其它线程。</p>
<p>4) 编写打印数字的线程 <code>NumberPrinter</code>继承 Thread 类，声私有属性 private Printer p;在构造方法中进行赋值，实现父类的 run 方法，调用 Printer 类中的输出数字的方法。</p>
<p>5) 编写打印字母的线程<code>LetterPrinter</code> 继承 Thread 类，声明私有属性 private Printer p;在构造方法中进行赋值，实现父类的run 方法，调用 Printer 类中的输出字母的方法。</p>
<p>6) 编写测试类 Test，创建打印类对象，创建两个线程类对象，启动线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.reviewThread;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打印数字和字母</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Printer</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> index=<span class="number">1</span>;<span class="comment">//打印的位置</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">PrintNum</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(index%<span class="number">3</span>==<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="keyword">this</span>.wait();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				<span class="comment">// TODO 自动生成的 catch 块</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.print(num);</span><br><span class="line">		index++;</span><br><span class="line">		<span class="keyword">super</span>.notify();</span><br><span class="line">	&#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">PrinChar</span><span class="params">(<span class="keyword">char</span> c)</span></span>&#123;</span><br><span class="line">	   <span class="keyword">if</span>(index%<span class="number">3</span>!=<span class="number">0</span>)&#123;</span><br><span class="line">		   <span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">this</span>.wait();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			<span class="comment">// TODO 自动生成的 catch 块</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	   &#125;</span><br><span class="line">	   System.out.print(c);</span><br><span class="line">	   index++;</span><br><span class="line">	   <span class="keyword">super</span>.notify();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.reviewThread;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打印数字</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintNumber</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Printer printer;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PrintNumber</span><span class="params">(Printer p)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO 自动生成的构造函数存根</span></span><br><span class="line">		<span class="keyword">this</span>.printer = p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO 自动生成的方法存根</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">52</span>;i++)</span><br><span class="line">		printer.PrintNum(i);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.reviewThread;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打印字母</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintChar</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Printer printer;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PrintChar</span><span class="params">(Printer p)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.printer = p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO 自动生成的方法存根</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">char</span> c=<span class="string">'A'</span>;c&lt;=<span class="string">'Z'</span>;c++)&#123;</span><br><span class="line">			printer.PrinChar(c);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">package</span> cn.szxy.reviewThread;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 利用多线程打印</span></span><br><span class="line"><span class="comment"> * 12A34B56C78D910E1112F1314G1516H1718I1920J2122K2324L2526M2728N2930O3132P3334Q3536R3738S3940T4142U4344V4546W4748X4950Y5152Z</span></span><br><span class="line"><span class="comment"> * 这个序列</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Printer printer = <span class="keyword">new</span> Printer();<span class="comment">//共享资源</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建线程</span></span><br><span class="line">		Thread num = <span class="keyword">new</span> Thread(<span class="keyword">new</span> PrintNumber(printer));</span><br><span class="line">		Thread ch = <span class="keyword">new</span> Thread(<span class="keyword">new</span> PrintChar(printer));</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//启动线程</span></span><br><span class="line">		num.start();</span><br><span class="line">		ch.start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-执行多线程的第三种方式"><a href="#2-执行多线程的第三种方式" class="headerlink" title="2 执行多线程的第三种方式"></a>2 执行多线程的第三种方式</h3><h4 id="2-1-实现线程前两种方式的缺点"><a href="#2-1-实现线程前两种方式的缺点" class="headerlink" title="2.1 实现线程前两种方式的缺点"></a>2.1 实现线程前两种方式的缺点</h4><p>1) 没有返回值</p>
<p>2) 不支持泛型</p>
<p>3) 异常必须处理</p>
<h4 id="2-2-实现多线程的第三种方式"><a href="#2-2-实现多线程的第三种方式" class="headerlink" title="2.2 实现多线程的第三种方式"></a>2.2 实现多线程的第三种方式</h4><p>实现 Callable 接口，重写 call 方法Callable 功能更加强大</p>
<p>1) Future 接 口 位 于<code>java.util.concurrent</code>包 中 ,可 以 对 具 体Runnable、Callable 任务的执行结果进行取消(cancel 方法，尝试取消执行此任务)、查询是否完成(i<code>sDone</code>方法)、获取结果(get 方法,等待完成，然后检索其结果)等。</p>
<p>2) <code>FutrueTask</code>是<code>Futrue</code>接口的唯一的实现类</p>
<p>3)<code>FutureTask</code> 同时实现了 Runnable, Future 接口。它既可以作为 Runnable 被线程执行，又可以作为 Future 得到Callable 的返回值</p>
<p><img src="C:%5CUsers%5CLenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1542544545063.png" alt="1542544545063"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TestCallable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * String数组前面要加 包名，不然编译器不认识</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;String&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Fruit</span>&lt;<span class="title">String</span>&gt; <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		java.lang.String [] str= &#123;<span class="string">"apple"</span>,<span class="string">"banana"</span>,<span class="string">"orange"</span>,<span class="string">"pear"</span>,<span class="string">"grape"</span>&#125;;</span><br><span class="line">		<span class="keyword">int</span> index=(<span class="keyword">int</span>)(Math.random()*<span class="number">5</span>);</span><br><span class="line">		<span class="keyword">return</span> (String) str[index];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TestCallable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现多线程的第三种</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">		<span class="comment">//创建任务</span></span><br><span class="line">		Fruit fruit = <span class="keyword">new</span> Fruit();</span><br><span class="line">		<span class="comment">//（2）交能任务管理 </span></span><br><span class="line">		<span class="comment">/**任务管理器是一个实现类，实现了RunnableFutrue接口,</span></span><br><span class="line"><span class="comment">		 * RunnableFutrue是Futrue与Runnable接口的子接口*/</span></span><br><span class="line">		FutureTask&lt;String&gt; task=<span class="keyword">new</span> FutureTask&lt;&gt;(fruit); <span class="comment">//可以看成是Runnable接口的实现类</span></span><br><span class="line">		<span class="comment">//创建代理类并启动线程</span></span><br><span class="line">		Thread t=<span class="keyword">new</span> Thread(task);</span><br><span class="line">		t.start();</span><br><span class="line">		System.out.println(<span class="string">"获取结果:"</span>+task.get());</span><br><span class="line">		<span class="comment">//判断任务是否执行完成</span></span><br><span class="line">		System.out.println(<span class="string">"任务是否执行完成:"</span>+task.isDone());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-总结"><a href="#2-3-总结" class="headerlink" title="2.3 总结"></a>2.3 总结</h4><p>实现第三种多线程方法需要实现 Callable 接口 </p>
<p>在主方法 调用的时候，创建 Callable 接口的实现类的对象，创建  <code>FutureTask</code>  类对象，并添加 Callable 接口的实现类 ，最后使用代理，通过 Thread 类开启线程模式。</p>
<h3 id="3-线程同步-Lock-锁"><a href="#3-线程同步-Lock-锁" class="headerlink" title="3 线程同步 Lock 锁"></a>3 线程同步 Lock 锁</h3><h4 id="3-1-线程同步的第三种方法"><a href="#3-1-线程同步的第三种方法" class="headerlink" title="3.1 线程同步的第三种方法"></a>3.1 线程同步的第三种方法</h4><p>Lock 锁:对需要上锁的地方上锁</p>
<p>1) JDK1.5 后新增的功能</p>
<p>2) 与 Synchronized 相比，Lock 可提供多种锁方案，更灵活</p>
<p>3) <code>Java.util.concurrent.locks</code>中的 Lock 是一个接口，它的实现类是一个 Java 类，而不是作为语言的特性（关键字）来实现注意：如果同步代码有异常，要将 <code>unLock()</code>放到 finally 中</p>
<h4 id="3-2-步骤"><a href="#3-2-步骤" class="headerlink" title="3.2 步骤"></a>3.2 步骤</h4><p>1) 创建 Lock 对象</p>
<p>2) 调用 lock()方法上锁</p>
<p>3) 调用 unlock()方法解锁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TestLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLock</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> index =<span class="number">0</span>;</span><br><span class="line">	Lock lock = <span class="keyword">new</span> ReentrantLock();<span class="comment">//创建锁对象</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">		<span class="comment">// TODO 自动生成的方法存根</span></span><br><span class="line">		<span class="comment">//synchronized (this) &#123;</span></span><br><span class="line">		lock.lock();</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					index++;</span><br><span class="line">					Thread.sleep(<span class="number">300</span>);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">					<span class="comment">// TODO 自动生成的 catch 块</span></span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">				System.out.println(Thread.currentThread().getName()+<span class="string">"执行第"</span>+index+<span class="string">"次"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		lock.unlock();</span><br><span class="line">		<span class="comment">//&#125;</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TestLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		TestLock tl = <span class="keyword">new</span> TestLock();</span><br><span class="line">		<span class="comment">//使用代理</span></span><br><span class="line">		<span class="keyword">new</span> Thread(tl,<span class="string">"A"</span>).start();</span><br><span class="line">		<span class="keyword">new</span> Thread(tl,<span class="string">"B"</span>).start();</span><br><span class="line">		<span class="keyword">new</span> Thread(tl,<span class="string">"C"</span>).start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3Lock-与-synchronized-的区别"><a href="#3-3Lock-与-synchronized-的区别" class="headerlink" title="3.3Lock 与 synchronized 的区别"></a>3.3Lock 与 synchronized 的区别</h4><p>1) Lock 是 显 示 锁 (手 动 开 启 和 关 闭 锁 ,别 忘 关 闭锁),synchronized 是隐式锁</p>
<p>2) Lock 只有代码块锁，synchronized 有代码块锁和方法锁</p>
<p>3) 使用 Lock 锁，JVM 将花费较少的时间来调度线程，性能更好，并且具有更好的扩展性（提供更多的子类）</p>
<p>4) Lock 确保当一个线程位于代码的<strong>临界区</strong>时，另一个线不进入临界区。如果其他线程试图进入锁定的代码，则它将一直等待(即被阻止)，直到该对象被释放。lock()方法会对 Lock 实例对象进行加锁，因此所有对该对象调用 lock()方法的线程都会被阻塞，直到该 Lock 对象的 unlock()法被</p>
<h4 id="3-4-总结"><a href="#3-4-总结" class="headerlink" title="3.4  总结"></a>3.4  总结</h4><p>   创建锁对象 <code>Lock lock = new ReentrantLock();</code>//创建锁对象   父类接口指向子类实现</p>
<h3 id="4-线程池"><a href="#4-线程池" class="headerlink" title="4 线程池"></a>4 线程池</h3><h4 id="4-1-什么是线程池"><a href="#4-1-什么是线程池" class="headerlink" title="4.1 什么是线程池"></a>4.1 什么是线程池</h4><p>存放线程的池子</p>
<p>创建和销毁对象是非常耗费时间的</p>
<p>创建对象：需要分配内存等资源销毁对象：虽然不需要程序员操心，但是垃圾回收器会在后台一直跟踪并销毁对于经常创建和销毁、使用量特别大的资源，比如并发情况下的线程，对性能影响很大。</p>
<p>思路：</p>
<p>创建好多个线程，放入线程池中，使用时直接获取引用，不使用时放回池中。可以避免频繁创建销毁、实现重复利用</p>
<p>生活案例：在尚学堂借用和归还电脑、共享单车</p>
<p>技术案例：线程池、数据库连接池</p>
<p>JDK1.5 起，提供了内置线程池</p>
<h4 id="4-2-线程池的好处"><a href="#4-2-线程池的好处" class="headerlink" title="4.2 线程池的好处"></a>4.2 线程池的好处</h4><p>1) 提高响应速度（减少了创建新线程的时间）<br>2) 降低资源消耗（重复利用线程池中线程，不需要每次都创建）</p>
<p>3) 提高线程的可管理性：避免线程无限制创建、从而销毁系统资源，降低系统稳定性，甚至内存溢出或者 CPU 耗尽 </p>
<h4 id="4-3-线程池的应用场合"><a href="#4-3-线程池的应用场合" class="headerlink" title="4.3 线程池的应用场合"></a>4.3 线程池的应用场合</h4><p>1) 需要大量线程，并且完成任务的时间短</p>
<p>2) 对性能要求苛刻</p>
<p>3) 接受突发性的大量请求</p>
<h4 id="4-4-使用线程池执行大量的-Runnable-命令"><a href="#4-4-使用线程池执行大量的-Runnable-命令" class="headerlink" title="4.4 使用线程池执行大量的 Runnable 命令"></a>4.4 使用线程池执行大量的 Runnable 命令</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.ThreadPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunableThread</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//如何创建一个线程池</span></span><br><span class="line">		<span class="comment">//(1)创建一个线程池，线程池中只有一个线程对象</span></span><br><span class="line">		<span class="comment">//ExecutorService pool1=Executors.newSingleThreadExecutor();</span></span><br><span class="line">		<span class="comment">//(2)创建一个线程池，线程池中有线程的数量固定</span></span><br><span class="line">		<span class="comment">//ExecutorService pool1=Executors.newFixedThreadPool(10);</span></span><br><span class="line">		<span class="comment">//(3)创建一个线程池，线程池中的线程的数量可以动态的改变</span></span><br><span class="line">		ExecutorService pool1=Executors.newCachedThreadPool();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">20</span>;i++)&#123;</span><br><span class="line">			 <span class="keyword">final</span> <span class="keyword">int</span> n = i;</span><br><span class="line">			 Runnable command = <span class="keyword">new</span> Runnable() &#123;<span class="comment">//匿名内部类</span></span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">					<span class="comment">// TODO 自动生成的方法存根</span></span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">						<span class="comment">// TODO 自动生成的 catch 块</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">					System.out.println(n);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;;</span><br><span class="line">			pool1.execute(command);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		pool1.shutdown();</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-5-使用线程池执行大量的-Callable"><a href="#4-5-使用线程池执行大量的-Callable" class="headerlink" title="4.5 使用线程池执行大量的 Callable"></a>4.5 使用线程池执行大量的 Callable</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.ThreadPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallableThread</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">		<span class="comment">//1  创建单个线程池</span></span><br><span class="line">		<span class="comment">//ExecutorService pool1 = Executors.newSingleThreadExecutor();</span></span><br><span class="line">		<span class="comment">//2 创建10个线程池</span></span><br><span class="line">		<span class="comment">//ExecutorService pool1 = Executors.newFixedThreadPool(10);</span></span><br><span class="line">		<span class="comment">//3 动态线程池</span></span><br><span class="line">		ExecutorService pool1 = Executors.newCachedThreadPool();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建一个集合</span></span><br><span class="line">		List&lt;Future&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</span><br><span class="line">			<span class="comment">// 创建任务</span></span><br><span class="line">			Callable&lt;Integer&gt; task = <span class="keyword">new</span> Callable&lt;Integer&gt;()&#123;</span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">					Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">					<span class="keyword">return</span> ((<span class="keyword">int</span>)(Math.random()*<span class="number">10</span>));</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">			&#125;;</span><br><span class="line">			<span class="comment">//提交任务</span></span><br><span class="line">		   Future f  = pool1.submit(task);</span><br><span class="line">		   list.add(f);</span><br><span class="line">		   <span class="comment">//System.out.println(f.get());</span></span><br><span class="line">		&#125;</span><br><span class="line">			System.out.println(<span class="string">"ok?"</span>);</span><br><span class="line">			<span class="keyword">for</span>(Future f:list)&#123;</span><br><span class="line">				System.out.println(f.get());</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(<span class="string">"ok!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-6-总结"><a href="#4-6-总结" class="headerlink" title="4.6 总结"></a>4.6 总结</h4><p>1 创建线程池所使用的类有 <code>ExecutorService</code>   Executors</p>
<p>2 创建线程池有 3 中 模式 ,创建单个线程池 Single，创建指定数目的线程池 Fixed，创建动态的线程池 Cached</p>
<p>3  在使用线程池执行 Callable 时，需要先创建一个 List 集合</p>
<p>将得到的结果添加到集合中，然后用 get 方法打印输出</p>
<h3 id="5-任务调度-Timer-Task"><a href="#5-任务调度-Timer-Task" class="headerlink" title="5 任务调度 Timer Task"></a>5 任务调度 Timer Task</h3><h4 id="5-1-调度"><a href="#5-1-调度" class="headerlink" title="5.1 调度"></a>5.1 调度</h4><p>任务：就是事情</p>
<p>调度：在不同的时间点或者在指定的时间点或者间隔多长时间我去运行这个任务。</p>
<p>就是生活中的闹钟</p>
<h4 id="5-2-相关的类Timer-类-位于-java-util包中"><a href="#5-2-相关的类Timer-类-位于-java-util包中" class="headerlink" title="5.2 相关的类Timer 类:位于 java.util包中"></a>5.2 相关的类Timer 类:位于 <code>java.util</code>包中</h4><h4 id="5-3-案例实现时间的动态刷新"><a href="#5-3-案例实现时间的动态刷新" class="headerlink" title="5.3 案例实现时间的动态刷新"></a>5.3 案例实现时间的动态刷新</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TimerTask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.TimerTask;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 任务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="keyword">extends</span> <span class="title">TimerTask</span></span>&#123;</span><br><span class="line">	<span class="keyword">long</span> time =<span class="number">1000</span>;</span><br><span class="line">	<span class="meta">@Override</span>	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;<span class="comment">//要执行的任务</span></span><br><span class="line">		Date d = <span class="keyword">new</span> Date(time);</span><br><span class="line">		System.out.println(d.toLocaleString());</span><br><span class="line">		time+=<span class="number">1000</span>;	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TimerTask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Timer;</span><br><span class="line"><span class="keyword">import</span> java.util.TimerTask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTimerTask</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建时间</span></span><br><span class="line">		Timer t = <span class="keyword">new</span> Timer();</span><br><span class="line">		<span class="comment">//创建任务</span></span><br><span class="line">		TimerTask task = <span class="keyword">new</span> Clock();</span><br><span class="line">		<span class="comment">//调用        执行任务         任务的开始时间	        每隔多久执行	 </span></span><br><span class="line">		t.schedule(task,<span class="keyword">new</span> Date(System.currentTimeMillis()+<span class="number">1000</span>), <span class="number">1000</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-ThreadLocal"><a href="#6-ThreadLocal" class="headerlink" title="6  ThreadLocal"></a>6  <code>ThreadLocal</code></h3><h4 id="6-1ThreadLocal"><a href="#6-1ThreadLocal" class="headerlink" title="6.1ThreadLocal"></a>6.1ThreadLocal</h4><p><code>ThreadLocal</code>直译为“本地线程”，其实它就是一容器，用于存放线程的局部变量</p>
<p>作用：为解决多线程程序的并发问题</p>
<ul>
<li><p>这个类提供线程局部变量。  这些变量与其正常的对应方式不同，因为访问一个的每个线程（通过其<code>get</code>或<code>set</code>方法）都有自己独立初始化<strong>的变量副本</strong>。 </p>
</li>
<li><p><code>ThreadLocal</code>实例通常是希望将状态与线程关联的类中的私有静态字段（例如，用户ID或事务ID）。 </p>
</li>
</ul>
<h4 id="6-2-案例实现一个序列号的生成器程序"><a href="#6-2-案例实现一个序列号的生成器程序" class="headerlink" title="6.2 案例实现一个序列号的生成器程序"></a>6.2 案例实现一个序列号的生成器程序</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TestThreadLocal;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumber</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TestThreadLocal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceImpl</span> <span class="keyword">implements</span> <span class="title">Sequence</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.number++;</span><br><span class="line">		<span class="keyword">return</span> number;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">package</span> cn.szxy.TestThreadLocal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceImpl2</span> <span class="keyword">implements</span> <span class="title">Sequence</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;Integer&gt; numberContainer = <span class="keyword">new</span> ThreadLocal&lt;Integer&gt;()&#123;</span><br><span class="line">		<span class="function"><span class="keyword">protected</span> Integer <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		numberContainer.set(numberContainer.get()+<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> numberContainer.get();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TestThreadLocal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Sequence seq;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyTread</span><span class="params">(Sequence seq)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO 自动生成的构造函数存根</span></span><br><span class="line">		<span class="keyword">this</span>.seq = seq;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO 自动生成的方法存根</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">3</span>;i++)&#123;</span><br><span class="line">			System.out.println(Thread.currentThread().getName()+<span class="string">"---&gt;number= "</span>+seq.getNumber());</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TestThreadLocal;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建共享资源</span></span><br><span class="line">		<span class="comment">//Sequence seq = new SequenceImpl();</span></span><br><span class="line">		Sequence seq = <span class="keyword">new</span> SequenceImpl2();</span><br><span class="line">		<span class="comment">//创建线程</span></span><br><span class="line">		MyTread t = <span class="keyword">new</span> MyTread(seq);</span><br><span class="line">		<span class="comment">//开启线程</span></span><br><span class="line">		<span class="keyword">new</span> Thread(t,<span class="string">"A"</span>).start();</span><br><span class="line">		<span class="keyword">new</span> Thread(t,<span class="string">"B"</span>).start();</span><br><span class="line">		<span class="keyword">new</span> Thread(t,<span class="string">"C"</span>).start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*每次运行结果的次序都是不一样的</span></span><br><span class="line"><span class="comment">    B---&gt;number= 1</span></span><br><span class="line"><span class="comment">    C---&gt;number= 1</span></span><br><span class="line"><span class="comment">    A---&gt;number= 1</span></span><br><span class="line"><span class="comment">    C---&gt;number= 2</span></span><br><span class="line"><span class="comment">    B---&gt;number= 2</span></span><br><span class="line"><span class="comment">    C---&gt;number= 3</span></span><br><span class="line"><span class="comment">    A---&gt;number= 2</span></span><br><span class="line"><span class="comment">    B---&gt;number= 3</span></span><br><span class="line"><span class="comment">    A---&gt;number= 3</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h4 id="6-3-ThreadLocakJDK-源码分析"><a href="#6-3-ThreadLocakJDK-源码分析" class="headerlink" title="6.3 ThreadLocakJDK 源码分析"></a>6.3 <code>ThreadLocak</code>JDK 源码分析</h4><p>通过集合的方式，添加线程对象到 map集合中</p>
<p><img src="C:%5CUsers%5CLenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1542633774883.png" alt="1542633774883"></p>
<p><img src="C:%5CUsers%5CLenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1542633869679.png" alt="1542633869679"></p>
<h4 id="6-4-ThreadLocal-的-API"><a href="#6-4-ThreadLocal-的-API" class="headerlink" title="6.4 ThreadLocal 的 API"></a>6.4 <code>ThreadLocal</code> 的 API</h4><p><img src="C:%5CUsers%5CLenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1542629233167.png" alt="1542629233167"></p>
<p>#### </p>
<h3 id="7-ThreadLocal-的应用"><a href="#7-ThreadLocal-的应用" class="headerlink" title="7 ThreadLocal 的应用"></a>7 <code>ThreadLocal</code> 的应用</h3><p><code>ThreadLocal</code> 的使用场景为:用来解决数据库连接、Session管理等</p>
<h4 id="7-1ThreadLocal在数据库连接上的应用"><a href="#7-1ThreadLocal在数据库连接上的应用" class="headerlink" title="7.1ThreadLocal在数据库连接上的应用"></a>7.1ThreadLocal在数据库连接上的应用</h4><p>当你在一个类中使用 static 成员变量时，一定要问自己这个 static 成员变量</p>
<p>需要考虑“线程安全吗？”（也就是说多个线程需要自己独立的 static 成员变量吗？）</p>
<p>如果需要那就需要使用<code>ThreadLocal</code></p>
<p><img src="C:%5CUsers%5CLenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1542632141376.png" alt="1542632141376"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TestThreadLocal2.DBUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数据库连接</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBUtil</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DRIVER=<span class="string">"com.mysql.jdbc.Driver"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String	USER=<span class="string">"root"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PWD=<span class="string">"root"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String URL=<span class="string">"jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf8"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//定义一个数据库连接</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Connection conn=<span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">//获取连接</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span>   <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class.forName(DRIVER);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(conn==<span class="keyword">null</span>)&#123;</span><br><span class="line">				</span><br><span class="line">				conn=DriverManager.getConnection(URL, USER, PWD);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">return</span> conn;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//关闭连接的方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span>   <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">colseConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (conn!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				conn.close();</span><br><span class="line">			</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		System.out.println(getConnection());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TestThreadLocal2.DBUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数据库连接</span></span><br><span class="line"><span class="comment"> * 去掉类中的 static 关键字</span></span><br><span class="line"><span class="comment"> * 即去掉 Connection 对象共享</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBUtil2</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DRIVER=<span class="string">"com.mysql.jdbc.Driver"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String	USER=<span class="string">"root"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PWD=<span class="string">"root"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String URL=<span class="string">"jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf8"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//定义一个数据库连接    static 共享本类的资源  不需要</span></span><br><span class="line">	<span class="keyword">private</span> Connection conn=<span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">//获取连接</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span>  Connection <span class="title">getConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class.forName(DRIVER);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(conn==<span class="keyword">null</span>)&#123;</span><br><span class="line">				</span><br><span class="line">				conn=DriverManager.getConnection(URL, USER, PWD);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">return</span> conn;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//关闭连接的方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">colseConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (conn!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				conn.close();</span><br><span class="line">			</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//System.out.println(getConnection());</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TestThreadLocal2.DBUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用 Threadlocal </span></span><br><span class="line"><span class="comment"> * 让每个用户即每个线程都自己一个连接的副本</span></span><br><span class="line"><span class="comment"> * 根据这个连接的副本，每个线程可以进行增删改查</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBUtil3</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DRIVER=<span class="string">"com.mysql.jdbc.Driver"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String	USER=<span class="string">"root"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PWD=<span class="string">"root"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String URL=<span class="string">"jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf8"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Connection&gt; connectionContainer = <span class="keyword">new</span> ThreadLocal&lt;Connection&gt;()&#123;</span><br><span class="line">		<span class="function"><span class="keyword">protected</span> Connection <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Class.forName(DRIVER);</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(conn==<span class="keyword">null</span>)&#123;</span><br><span class="line">					</span><br><span class="line">					conn=DriverManager.getConnection(URL, USER, PWD);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">			&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; </span><br><span class="line">			<span class="keyword">return</span> conn;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> Connection <span class="title">getConnectionContainer</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="keyword">return</span> connectionContainer.get();<span class="comment">//获得连接的副本</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//定义一个数据库连接</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Connection conn=<span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">//获取连接</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span>   <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> connectionContainer.get();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//关闭连接的方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span>   <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">colseConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (conn!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				conn.close();</span><br><span class="line">			</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		System.out.println(getConnection());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TestThreadLocal2.DBUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mysql.jdbc.Connection;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 调用 数据连接</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dao</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//连接数据</span></span><br><span class="line">		<span class="comment">//System.out.println(Thread.currentThread().getName()+" insert() "+DBUtil.getConnection());</span></span><br><span class="line">		<span class="comment">/*Connection con = (Connection) new DBUtil2().getConnection();</span></span><br><span class="line"><span class="comment">		System.out.println(Thread.currentThread().getName()+" issert() "+con);*/</span></span><br><span class="line">		Connection con = (Connection) <span class="keyword">new</span> DBUtil3().getConnection();</span><br><span class="line">		System.out.println(Thread.currentThread().getName()+<span class="string">" issert() "</span>+con);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//连接数据</span></span><br><span class="line">		<span class="comment">//System.out.println(Thread.currentThread().getName()+" delete() "+DBUtil.getConnection());</span></span><br><span class="line">		<span class="comment">/*Connection con = (Connection) new DBUtil2().getConnection();</span></span><br><span class="line"><span class="comment">		System.out.println(Thread.currentThread().getName()+" delete() "+con);*/</span></span><br><span class="line">		Connection con = (Connection) <span class="keyword">new</span> DBUtil3().getConnection();</span><br><span class="line">		System.out.println(Thread.currentThread().getName()+<span class="string">" delete() "</span>+con);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO 自动生成的方法存根</span></span><br><span class="line">		<span class="comment">//连接数据</span></span><br><span class="line">		<span class="comment">//System.out.println(Thread.currentThread().getName()+" update() "+DBUtil.getConnection());</span></span><br><span class="line">		<span class="comment">/*Connection con = (Connection) new DBUtil2().getConnection();</span></span><br><span class="line"><span class="comment">		System.out.println(Thread.currentThread().getName()+" update() "+con);*/</span></span><br><span class="line">		Connection con = (Connection) <span class="keyword">new</span> DBUtil3().getConnection();</span><br><span class="line">		System.out.println(Thread.currentThread().getName()+<span class="string">" update() "</span>+con);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//连接数据</span></span><br><span class="line">		<span class="comment">//System.out.println(Thread.currentThread().getName()+" select() "+DBUtil.getConnection());</span></span><br><span class="line">		<span class="comment">/*Connection con = (Connection) new DBUtil2().getConnection();</span></span><br><span class="line"><span class="comment">		System.out.println(Thread.currentThread().getName()+" select() "+con);*/</span></span><br><span class="line">		Connection con = (Connection) <span class="keyword">new</span> DBUtil3().getConnection();</span><br><span class="line">		System.out.println(Thread.currentThread().getName()+<span class="string">" select() "</span>+con);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.TestThreadLocal2.DBUtil;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		MyThread  t = <span class="keyword">new</span> MyThread();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> Thread(t,<span class="string">"A"</span>).start();</span><br><span class="line">		<span class="keyword">new</span> Thread(t,<span class="string">"B"</span>).start();</span><br><span class="line">		<span class="keyword">new</span> Thread(t,<span class="string">"C"</span>).start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">	Dao d = <span class="keyword">new</span> Dao();<span class="comment">//数据连接操作</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO 自动生成的方法存根</span></span><br><span class="line">			d.insert();</span><br><span class="line">			d.delete();</span><br><span class="line">			d.update();</span><br><span class="line">			d.select();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*  为每个用户也就每个线程只分配一个数据库连接对象供增删改查的方法</span></span><br><span class="line"><span class="comment">	A issert() com.mysql.jdbc.JDBC4Connection@1b84a4d5</span></span><br><span class="line"><span class="comment">    A delete() com.mysql.jdbc.JDBC4Connection@1b84a4d5</span></span><br><span class="line"><span class="comment">    A update() com.mysql.jdbc.JDBC4Connection@1b84a4d5</span></span><br><span class="line"><span class="comment">    A select() com.mysql.jdbc.JDBC4Connection@1b84a4d5</span></span><br><span class="line"><span class="comment">    C issert() com.mysql.jdbc.JDBC4Connection@1b84a4d5</span></span><br><span class="line"><span class="comment">    C delete() com.mysql.jdbc.JDBC4Connection@1b84a4d5</span></span><br><span class="line"><span class="comment">    C update() com.mysql.jdbc.JDBC4Connection@1b84a4d5</span></span><br><span class="line"><span class="comment">    C select() com.mysql.jdbc.JDBC4Connection@1b84a4d5</span></span><br><span class="line"><span class="comment">    B issert() com.mysql.jdbc.JDBC4Connection@781b849a</span></span><br><span class="line"><span class="comment">    B delete() com.mysql.jdbc.JDBC4Connection@781b849a</span></span><br><span class="line"><span class="comment">    B update() com.mysql.jdbc.JDBC4Connection@781b849a</span></span><br><span class="line"><span class="comment">    B select() com.mysql.jdbc.JDBC4Connection@781b849a</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h4 id="7-2-总结"><a href="#7-2-总结" class="headerlink" title="7.2 总结"></a>7.2 总结</h4><p>通过 <code>ThreadLocal</code> 可以实现数据库，为每个用户也就每个线程</p>
<p>只分配一个数据库连接对象 供增删改查的方法</p>

    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/多线程/" rel="tag"># 多线程</a>
            
              <a href="/tags/并发/" rel="tag"># 并发</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2018/11/16/Java/20181116 XML 技术/" rel="next" title="20181116 XML 技术">
                  <i class="fa fa-chevron-left"></i> 20181116 XML 技术
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2018/11/19/Java/20181119 服务器项目/" rel="prev" title="20181119 服务器项目">
                  20181119 服务器项目 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-线程知识回顾"><span class="nav-number">1.</span> <span class="nav-text">1 线程知识回顾</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-程序、进程、线程"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 程序、进程、线程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-在-Java-中创建线程的两种方式"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 在 Java 中创建线程的两种方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-线程的生命周期"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 线程的生命周期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-同步与死锁"><span class="nav-number">1.4.</span> <span class="nav-text">1.4 同步与死锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-线程间的通信"><span class="nav-number">1.5.</span> <span class="nav-text">1.5 线程间的通信</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-案例"><span class="nav-number">1.6.</span> <span class="nav-text">1.6 案例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-执行多线程的第三种方式"><span class="nav-number">2.</span> <span class="nav-text">2 执行多线程的第三种方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-实现线程前两种方式的缺点"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 实现线程前两种方式的缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-实现多线程的第三种方式"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 实现多线程的第三种方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-总结"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-线程同步-Lock-锁"><span class="nav-number">3.</span> <span class="nav-text">3 线程同步 Lock 锁</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-线程同步的第三种方法"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 线程同步的第三种方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-步骤"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3Lock-与-synchronized-的区别"><span class="nav-number">3.3.</span> <span class="nav-text">3.3Lock 与 synchronized 的区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-总结"><span class="nav-number">3.4.</span> <span class="nav-text">3.4  总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-线程池"><span class="nav-number">4.</span> <span class="nav-text">4 线程池</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-什么是线程池"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 什么是线程池</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-线程池的好处"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 线程池的好处</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-线程池的应用场合"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 线程池的应用场合</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-使用线程池执行大量的-Runnable-命令"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 使用线程池执行大量的 Runnable 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-使用线程池执行大量的-Callable"><span class="nav-number">4.5.</span> <span class="nav-text">4.5 使用线程池执行大量的 Callable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-6-总结"><span class="nav-number">4.6.</span> <span class="nav-text">4.6 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-任务调度-Timer-Task"><span class="nav-number">5.</span> <span class="nav-text">5 任务调度 Timer Task</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-调度"><span class="nav-number">5.1.</span> <span class="nav-text">5.1 调度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-相关的类Timer-类-位于-java-util包中"><span class="nav-number">5.2.</span> <span class="nav-text">5.2 相关的类Timer 类:位于 java.util包中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-案例实现时间的动态刷新"><span class="nav-number">5.3.</span> <span class="nav-text">5.3 案例实现时间的动态刷新</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-ThreadLocal"><span class="nav-number">6.</span> <span class="nav-text">6  ThreadLocal</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1ThreadLocal"><span class="nav-number">6.1.</span> <span class="nav-text">6.1ThreadLocal</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-案例实现一个序列号的生成器程序"><span class="nav-number">6.2.</span> <span class="nav-text">6.2 案例实现一个序列号的生成器程序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-ThreadLocakJDK-源码分析"><span class="nav-number">6.3.</span> <span class="nav-text">6.3 ThreadLocakJDK 源码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-4-ThreadLocal-的-API"><span class="nav-number">6.4.</span> <span class="nav-text">6.4 ThreadLocal 的 API</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-ThreadLocal-的应用"><span class="nav-number">7.</span> <span class="nav-text">7 ThreadLocal 的应用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1ThreadLocal在数据库连接上的应用"><span class="nav-number">7.1.</span> <span class="nav-text">7.1ThreadLocal在数据库连接上的应用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-总结"><span class="nav-number">7.2.</span> <span class="nav-text">7.2 总结</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zwer</p>
  <div class="site-description" itemprop="description">记录学习的日常</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">68</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span>
        
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">tags</span>
        
      </div>
    
  </nav>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zwer</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.4.0</div>

        












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/muse.js?v=7.4.0"></script>
<script src="/js/next-boot.js?v=7.4.0"></script>



  





















  

  

  

</body>
</html>
