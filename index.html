<!DOCTYPE html>





<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="记录学习的日常">
<meta name="keywords" content="zwer">
<meta property="og:type" content="website">
<meta property="og:title" content="zwer 的博客空间">
<meta property="og:url" content="http://zwer.xyz/index.html">
<meta property="og:site_name" content="zwer 的博客空间">
<meta property="og:description" content="记录学习的日常">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zwer 的博客空间">
<meta name="twitter:description" content="记录学习的日常">
  <link rel="canonical" href="http://zwer.xyz/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>zwer 的博客空间</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zwer 的博客空间</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">上善若水 自强不息</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <div id="posts" class="posts-expand">
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/10/09/20191009 Hadoop之MapReduce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/10/09/20191009 Hadoop之MapReduce/" class="post-title-link" itemprop="url">20191009 Hadoop-MapReduce</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-10-09 00:00:00 / Modified: 21:31:04" itemprop="dateCreated datePublished" datetime="2019-10-09T00:00:00+08:00">2019-10-09</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h1><blockquote>
<p>MapTask &amp; ReduceTask</p>
</blockquote>
<p>一个切片对应一个 Map，也就是说切片的数量决定了 Map 的数量</p>
<p>split 切片指逻辑上概念，用于指定 Map 处理数据的大小</p>
<p>切片用于将 HDFS中的块与 Map 之间解耦</p>
<p>Reduce 的数量由人来决定，根据前面的组的推导</p>
<p><img src="http://img.zwer.xyz/blog/20191009101915.png" alt></p>
<h3 id="MR-原语"><a href="#MR-原语" class="headerlink" title="MR  原语"></a><font color="green">MR  原语</font></h3><p>输入(格式化k,v)数据集 -&gt; map映射成一个中间数据集(k,v)  -&gt; reduce<br><font color="red">“相同”的 key 为一组，调用一次 reduce 方法，方法内迭代这一组数据进行计算</font></p>
<table>
<thead>
<tr>
<th>关系/对应比例</th>
<th>block &gt; split</th>
<th>split &gt; map</th>
<th>map &gt; reduce</th>
<th>group(key)&gt;partition</th>
<th>partition &gt; outputfile</th>
</tr>
</thead>
<tbody><tr>
<td>1:1</td>
<td>*</td>
<td>*</td>
<td>*</td>
<td>*</td>
<td></td>
</tr>
<tr>
<td>1:N</td>
<td>*</td>
<td></td>
<td>*</td>
<td><font color="red">违背了原语</font></td>
<td></td>
</tr>
<tr>
<td>N:1</td>
<td>*</td>
<td></td>
<td>*</td>
<td>*</td>
<td></td>
</tr>
<tr>
<td>N:M</td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
<td></td>
</tr>
</tbody></table>
<h3 id="Shuffler-lt-洗牌-gt"><a href="#Shuffler-lt-洗牌-gt" class="headerlink" title="Shuffler&lt;洗牌&gt;"></a>Shuffler&lt;洗牌&gt;</h3><blockquote>
<p>框架内部实现机制<br>分布式计算节点数据流转：连接 MapTask 与 ReduceTask</p>
</blockquote>
<p><img src="http://img.zwer.xyz/blog/20191009110701.png" alt></p>
<h3 id="计算框架"><a href="#计算框架" class="headerlink" title="计算框架"></a>计算框架</h3><p><img src="http://img.zwer.xyz/blog/20191009111332.png" alt></p>
<table>
<thead>
<tr>
<th></th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>Map</td>
<td>读懂数据<br>映射为KV模型<br>并行分布式<br><font color="red">计算向数据移动</font></td>
</tr>
<tr>
<td>Reduce</td>
<td>数据全量/分量加工<br>Reduce中可以包含不同的key<br>相同的Key汇聚到一个Reduce中<br>相同的Key调用一次reduce方法<br>排序实现key的汇聚<br></td>
</tr>
<tr>
<td>K,V使用自定义数据类型<br></td>
<td>作为参数传发成本，提高程序自由度<br>- Writable 序列化<br> - Comparable 比较器<br>实现具体排序（字典序，数值序等）</td>
</tr>
</tbody></table>
<h3 id="MapReduce-1-x"><a href="#MapReduce-1-x" class="headerlink" title="MapReduce 1.x"></a>MapReduce 1.x</h3><blockquote>
<p>计算向数据移动</p>
</blockquote>
<p><img src="http://img.zwer.xyz/blog/20191009113152.png" alt></p>
<h4 id="计算框架-Mapper"><a href="#计算框架-Mapper" class="headerlink" title="计算框架 Mapper"></a>计算框架 Mapper</h4><p><img src="http://img.zwer.xyz/blog/20191009113223.png" alt></p>
<h4 id="计算框架-Reducer"><a href="#计算框架-Reducer" class="headerlink" title="计算框架 Reducer"></a>计算框架 Reducer</h4><p><img src="http://img.zwer.xyz/blog/20191009113300.png" alt></p>
<table>
<thead>
<tr>
<th>MRv1角色：</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>JobTracker</td>
<td>核心，<font color="red">主</font>，单点<br>调度所有的作业<br>监控整个集群的资源负载</td>
</tr>
<tr>
<td>TaskTracker</td>
<td><font color="red">从</font>，自身节点资源管理<br>和 JobTracker 心跳，汇报资源，获取Task</td>
</tr>
<tr>
<td>Client</td>
<td>作业为单位<br>规划作业计算分布<br>提交作业资源到HDFS<br>最终提交作业到 JobTracker</td>
</tr>
<tr>
<td>弊端：</td>
<td>JobTracker：负载过重，单点故障<br>资源管理与计算调度强耦合，其他计算框架需要重复实现资源管理<br>不同框架对资源不能全局管理</td>
</tr>
</tbody></table>
<h3 id="MRV2-之-YARN"><a href="#MRV2-之-YARN" class="headerlink" title="MRV2 之 YARN"></a>MRV2 之 YARN</h3><blockquote>
<p> YARN：解耦资源与计算</p>
</blockquote>
<p><img src="http://img.zwer.xyz/blog/20191009140653.png" alt></p>
<table>
<thead>
<tr>
<th></th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>ResourceManager</td>
<td>主，核心<br>集群节点资源管理</td>
</tr>
<tr>
<td>NodeManager</td>
<td>与RM汇报资源<br>管理Container生命周期<br>计算框架中的角色都以Container表示</td>
</tr>
<tr>
<td>Container</td>
<td>【节点NM，CPU,MEM,I/O大小，启动命令】<br>默认NodeManager启动线程监控Container大小，超出申请资源额度，kill<br>支持Linux内核的Cgroup</td>
</tr>
<tr>
<td>MR</td>
<td>- MR-ApplicationMaster-Container<br>x作业为单位，避免单点故障，负载到不同的节点<br>创建Task需要和RM申请资源（Container）<br>- Task-Container</td>
</tr>
<tr>
<td>Client</td>
<td>RM-Client：请求资源创建AM<br>AM-Client：与AM交互</td>
</tr>
</tbody></table>
<h2 id="搭建-yarn"><a href="#搭建-yarn" class="headerlink" title="搭建 yarn"></a>搭建 yarn</h2><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><table>
<thead>
<tr>
<th></th>
<th>NN-1</th>
<th>NN-2</th>
<th>DN</th>
<th>ZK</th>
<th>ZKFC</th>
<th>JNN</th>
<th>RM</th>
<th>NM</th>
</tr>
</thead>
<tbody><tr>
<td>node01</td>
<td>*</td>
<td></td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
<td></td>
<td></td>
</tr>
<tr>
<td>node02</td>
<td></td>
<td>*</td>
<td>*</td>
<td>*</td>
<td>*</td>
<td>*</td>
<td></td>
<td>*</td>
</tr>
<tr>
<td>node03</td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
<td></td>
<td>*</td>
<td>*</td>
<td>*</td>
</tr>
<tr>
<td>node04</td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
</tr>
</tbody></table>
<p>说明： </p>
<pre><code>1. HA 高可用 HDFS 
 2. RM 资源管理器采用主从架构，使用 Zookeeper 做分布式协调
 3. NM 的数量与 DN 的数量相同</code></pre><h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><ul>
<li>mapred-site.xml </li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>yarn-site.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.cluster-id<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>cluster1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.rm-ids<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>rm1,rm2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>node03<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>node04<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.zk-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>node02:2181,node03:2181,node04:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>分发</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 将 node01 修改的配置文件分发给 node02、node03、node04</span><br><span class="line">scp mapred-site.xml yarn-site.xml root@node02:`pwd`</span><br><span class="line">scp mapred-site.xml yarn-site.xml root@node03:`pwd`</span><br><span class="line">scp mapred-site.xml yarn-site.xml root@node04:`pwd`</span><br></pre></td></tr></table></figure>

<h3 id="部署-yarn"><a href="#部署-yarn" class="headerlink" title="部署 yarn"></a>部署 yarn</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 在 node01。 </span><br><span class="line"><span class="meta">#</span> node01 可以免秘钥直接访问其他三个节点 node02、node03、node04</span><br><span class="line"><span class="meta">#</span> 这样 node01 上 hadoop 管理脚本可以直接操纵其他其他机器上的 hadoop</span><br><span class="line">start-yarn.sh </span><br><span class="line"><span class="meta">#</span> 在 node03、node04</span><br><span class="line">yarn-daemon.sh start resourcemanager</span><br></pre></td></tr></table></figure>

<h3 id="访问-yarn-web-界面"><a href="#访问-yarn-web-界面" class="headerlink" title="访问 yarn web 界面"></a>访问 yarn web 界面</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://node03:8088</span></span><br></pre></td></tr></table></figure>

<p><img src="http://img.zwer.xyz/blog/20191009153119.png" alt></p>
<p>直接访问 <a href="http://node04:8088" target="_blank" rel="noopener">http://node04:8088</a> ,会自动重定向到  <a href="http://node03:8088" target="_blank" rel="noopener">http://node03:8088</a></p>
<p><img src="http://img.zwer.xyz/blog/20191009153209.png" alt></p>
<h3 id="测试-运行-wordCount-程序"><a href="#测试-运行-wordCount-程序" class="headerlink" title="测试-运行 wordCount 程序"></a>测试-运行 wordCount 程序</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 进入 hadoop-2.6.5/share/hadoop/mapreduce 目录下</span><br><span class="line">hadoop jar hadoop-mapreduce-examples-2.6.5.jar wordcount /user/root/test.txt /data/wc/output</span><br></pre></td></tr></table></figure>

<h2 id="手写-wordcount-程序"><a href="#手写-wordcount-程序" class="headerlink" title="手写 wordcount 程序"></a>手写 wordcount 程序</h2><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration(<span class="keyword">true</span>);</span><br><span class="line">		Job job = Job.getInstance(conf);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Create a new Job</span></span><br><span class="line">		<span class="comment">// Job job = Job.getInstance();</span></span><br><span class="line">		job.setJarByClass(MainClient.class);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Specify various job-specific parameters</span></span><br><span class="line">		job.setJobName(<span class="string">"myjob"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// job.setInputPath(new Path("in"));</span></span><br><span class="line">		<span class="comment">// job.setOutputPath(new Path("out"));</span></span><br><span class="line">		<span class="comment">// import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span></span><br><span class="line">		Path path = <span class="keyword">new</span> Path(<span class="string">"/user/root/test.txt"</span>);</span><br><span class="line">		FileInputFormat.addInputPath(job, path);</span><br><span class="line">		</span><br><span class="line">		Path output = <span class="keyword">new</span> Path(<span class="string">"/data/wc/output"</span>);</span><br><span class="line">		<span class="keyword">if</span>(output.getFileSystem(conf).exists(output))&#123;</span><br><span class="line">			output.getFileSystem(conf).delete(output, <span class="keyword">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		FileOutputFormat.setOutputPath(job, output );</span><br><span class="line">		</span><br><span class="line">		job.setMapperClass(MyMapper.class);</span><br><span class="line">		job.setMapOutputKeyClass(Text.class);</span><br><span class="line">		job.setMapOutputValueClass(IntWritable.class);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		job.setReducerClass(MyReducer.class);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Submit the job, then poll for progress until the job is complete</span></span><br><span class="line">		job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义 Mapper</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zwer Hadoop 对基本数据类型进行了包装</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Object</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> IntWritable one = <span class="keyword">new</span> IntWritable(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">private</span> Text word = <span class="keyword">new</span> Text();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Object key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">		<span class="comment">// StringTokenizer 对单词数字进行分割</span></span><br><span class="line">		StringTokenizer itr = <span class="keyword">new</span> StringTokenizer(value.toString());</span><br><span class="line">		<span class="keyword">while</span> (itr.hasMoreTokens()) &#123;</span><br><span class="line">			word.set(itr.nextToken());</span><br><span class="line">			context.write(word, one);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReducer</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> IntWritable result = <span class="keyword">new</span> IntWritable();</span><br><span class="line">	<span class="comment">//相同的 key 为一组，调用一次 reduce 方法，方法内迭代这一组数据进行计算 (sum count max min)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (IntWritable val : values) &#123;</span><br><span class="line">			sum += val.get();</span><br><span class="line">		&#125;</span><br><span class="line">		result.set(sum);</span><br><span class="line">		context.write(key, result);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意： 导出 jar 的 JDK 版本与 Linux 上 JDK 版本（大版本号）一致</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/10/01/README/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/10/01/README/" class="post-title-link" itemprop="url">流年</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-10-01 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-01T00:00:00+08:00">2019-10-01</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-09 21:53:10" itemprop="dateModified" datetime="2019-10-09T21:53:10+08:00">2019-10-09</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>我只想拉住流年</li>
<li>好好地说声再见</li>
<li>遗憾感谢 都回不去昨天</li>
<li>我只想铭记这瞬间</li>
<li>我们一去走过的流年</li>
</ul>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/09/28/201909028 Hadoop之分布式系统 HDFS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/28/201909028 Hadoop之分布式系统 HDFS/" class="post-title-link" itemprop="url">20190928 Hadoop</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-09-28 00:00:00" itemprop="dateCreated datePublished" datetime="2019-09-28T00:00:00+08:00">2019-09-28</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-09 21:31:09" itemprop="dateModified" datetime="2019-10-09T21:31:09+08:00">2019-10-09</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>是什么</p>
<p>为什么</p>
<p>如何去使用</p>
<h2 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h2><blockquote>
<p>Hadoop简介：<a href="http://hadoop.apache.org" target="_blank" rel="noopener">http://hadoop.apache.org</a></p>
<p>The Apache™ Hadoop® project develops open-source software for reliable, scalable, distributed computing.The Apache Hadoop software library is a framework that allows for the distributed processing of large data sets across clusters of computers using simple programming models. It is designed to scale up from single servers to thousands of machines, each offering local computation and storage. Rather than rely on hardware to deliver high-availability, the library itself is designed to detect and handle failures at the application layer, so delivering a highly-available service on top of a cluster of computers, each of which may be prone to failures.</p>
</blockquote>
<table>
<thead>
<tr>
<th>模块</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>分布式存储系统HDFS （Hadoop Distributed File System ）POSIX</td>
<td>提供了 高可靠性、高扩展性和高吞吐率的数据存储服务</td>
</tr>
<tr>
<td>分布式计算框架MapReduce分布式计算框架（计算向数据移动）</td>
<td>具有 易于编程、高容错性和高扩展性等优点。</td>
</tr>
<tr>
<td>分布式资源管理框架YARN（Yet Another Resource Management）</td>
<td>负责集群资源的管理和调度</td>
</tr>
</tbody></table>
<h2 id="HDFS"><a href="#HDFS" class="headerlink" title="HDFS"></a>HDFS</h2><h3 id="存储模型：字节"><a href="#存储模型：字节" class="headerlink" title="存储模型：字节*"></a>存储模型：字节*</h3><blockquote>
<p>文件线性切割成块（Block）:<font color="red">偏移量 offset （byte）</font></p>
<ul>
<li>Block 分散存储在集群节点中单一文件Block<font color="red">大小一致，文件与文件可以不一致</font></li>
<li>Block可以设置<font color="red">副本数</font>，副本分散在不同节点中副本数不要超过节点数量</li>
<li>文件上传可以设置Block大小和副本数</li>
<li>已上传的文件Block副本数可以调整</li>
<li><strong>大小不变</strong>只支持一次写入多次读取，同一时刻只有一个写入者可以 append 追加数据</li>
</ul>
</blockquote>
<p>在一个文件中 Block 的大小保持一致，在不同文件中 Block 的大小可以不一致。</p>
<p>注意：同一个机器不能存储两个相同的副本，副本应该存在不同的机器上的。</p>
<p><img src="http://img.zwer.xyz/blog/20190928193642.png" alt></p>
<h3 id="架构模型"><a href="#架构模型" class="headerlink" title="架构模型"></a>架构模型</h3><blockquote>
<p>文件元数据 MetaData，文件数据<br>元数据:数据本身<br>NameNode(主)节点保存文件元数据：单节点   posix<br>DataNode(从)节点保存文件Block数据：<font color="red">多节点</font><br>DataNode与 NameNode <font color="red">保持心跳</font>，提交Block列表<br>HdfsClient 与 NameNode 交互元数据信息<br>HdfsClient 与 DataNode 交互文件Block数据</p>
</blockquote>
<p><img src="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/images/hdfsarchitecture.png" alt></p>
<h3 id="NameNode-NN"><a href="#NameNode-NN" class="headerlink" title="NameNode(NN)"></a>NameNode(NN)</h3><table>
<thead>
<tr>
<th>定义</th>
<th>主要功能</th>
</tr>
</thead>
<tbody><tr>
<td>基于内存存储 ：不会和磁盘发生交换<br>- 只存在内存中<br>- 持久化（fsimage、edits）</td>
<td>接受客户端的读写服务<br>收集 DataNode 汇报的 Block 列表信息<br>NameNode 保存 metadata 信息包括<br>文件 owership 和 permissions <br>文件大小，时间<br>（Block列表：Block偏移量），<font color="red">位置信息</font><br>Block每副本位置（由DataNode上报）</td>
</tr>
</tbody></table>
<p><strong>注意： NameNode 记录快照时是不包括 DataNode 的位置信息的。</strong></p>
<h4 id="NameNode-持久化"><a href="#NameNode-持久化" class="headerlink" title="NameNode 持久化"></a>NameNode 持久化</h4><ul>
<li>NameNode 的 metadate 信息在启动后会加载到内存</li>
<li>metadata 存储到磁盘文件名为”fsimage”</li>
<li><strong>Block 的位置信息不会保存到 fsimage</strong></li>
<li>edits记录对 metadata 的操作日志</li>
</ul>
<p>若 NameNode  发生故障，首先会从磁盘 fsimage 文件中恢复到上一次记录快照的状态，然后在根据 edits 记录执行从上一次记录快照的时刻到 NameNode 宕机前的操作。</p>
<h3 id="DataNode（DN）"><a href="#DataNode（DN）" class="headerlink" title="DataNode（DN）"></a>DataNode（DN）</h3><blockquote>
<p>本地磁盘目录存储数据（Block），文件形式</p>
<p>同时存储Block的元数据信息文件</p>
<p>启动 DN 时会向 NN 汇报 block 信息</p>
<p>通过向 NN 发送心跳保持与其联系（3秒一次），</p>
<p>如果 NN 10分钟没有收到 DN 的心跳，则认为其已经 lost，并 copy <strong>其上</strong>的 block 到其它 DN</p>
<p>注意：若一台 DN 宕机了，NN 10 分钟才会认为该 DN 已经丢失。这时 NN 会根据之前该 DN 上传的 block 信息，去其他 DN 上寻找这些 block 的副本。</p>
</blockquote>
<h3 id="HDFS-优缺点"><a href="#HDFS-优缺点" class="headerlink" title="HDFS 优缺点"></a>HDFS 优缺点</h3><table>
<thead>
<tr>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td><strong>1. 高容错性</strong><br>  数据自动保存多个副本  副本丢失后，自动恢复 <br><strong>2. 适合批处理</strong> <br>  移动计算而非数据 数据位置暴露给计算框架（Block偏移量） <br><strong>3. 适合大数据处理</strong><br> GB 、TB 、甚至PB 级数据 百万规模以上的文件数量 10K+ 节点 <br><strong>4. 可构建在廉价机器上</strong> <br>通过多副本提高可靠性 提供了容错和恢复 机制</td>
<td>低延迟数据访问<br>比如毫秒级<br>低延迟与高吞吐率<br>小文件存取<br>占用NameNode 大量内存<br>寻道时间超过读取时间<br>并发写入、文件随机修改<br>一个文件只能有一个写者<br>仅支持append</td>
</tr>
</tbody></table>
<h3 id="SecondaryNameNode（SNN）"><a href="#SecondaryNameNode（SNN）" class="headerlink" title="SecondaryNameNode（SNN）"></a>SecondaryNameNode（SNN）</h3><blockquote>
<p>它不是NN的备份（但可以做备份），它的主要工作是帮助NN合并edits log，减少NN启动时间。<br>SNN执行合并时机<br>根据配置文件设置的时间间隔 fs.checkpoint.period  默认3600秒<br>根据配置文件设置edits log大小 fs.checkpoint.size 规定edits文件的最大值默认是64MB    </p>
</blockquote>
<h4 id="SNN合并流程"><a href="#SNN合并流程" class="headerlink" title="SNN合并流程"></a>SNN合并流程</h4><ol>
<li>在 PN 合并之前，会将 edits 和 fsimage 文件发送给 SN，然后 PN 创建一个新的 edits.new 文件继续记录 PN 的操作。</li>
<li>PN 将之前的 edits 和 fsimage 发送给 SN 后，SN 会将 fsimage 加载到内存，edits 也加载到内存</li>
<li>根据 edits 中操作记录执行相应的指令，当 edits 的所有操作记录对应的指令执行完毕，会生成一个新的 fsimage.ckpt 快照。</li>
<li>将新生成的 fsimage.ckpt 再发送给 PN ，这时 PN 就拥有 edits.new 创建之前的快照记录</li>
<li>若 PN 发生了宕机，可以根据 fsimage 和 edits.new 恢复到宕机前的状态</li>
</ol>
<p><img src="http://img.zwer.xyz/blog/20190929192321.png" alt></p>
<h3 id="副本放置策略"><a href="#副本放置策略" class="headerlink" title="副本放置策略"></a>副本放置策略</h3><blockquote>
<p>第一个副本：放置在上传文件的 DN；如果是集群外提交，则随机挑选一台磁盘不太满，CPU不太忙的节点。</p>
<p>第二个副本：放置在于第一个副本不同的 机架的节点上。</p>
<p>第三个副本：与第二个副本相同机架的节点。</p>
<p>更多副本：随机节点</p>
</blockquote>
<p><strong>注意：第一个副本与第二个副本不在同一台机架上</strong></p>
<p>服务器的种类： 1.塔式（就像家里的台式机主机箱那样）2. 机箱（像 DVD机那样）3. 刀片（像厨房放刀的刀架）</p>
<p><img src="http://img.zwer.xyz/blog/20190929203934.png" alt></p>
<h3 id="HDFS-写流程"><a href="#HDFS-写流程" class="headerlink" title="HDFS 写流程*"></a>HDFS 写流程*</h3><blockquote>
<p>Client：</p>
<ul>
<li><p>切分文件 Block</p>
</li>
<li><p>按 Block 线性和 NN 获取 DN 列表（副本数）</p>
</li>
<li><p>验证DN列表后以<strong>更小的单位</strong>流式传输数据</p>
</li>
<li><p>各节点，两两通信确定可用</p>
</li>
<li><p>Block传输结束后：</p>
<ul>
<li><p>DN 向 NN汇报Block信息</p>
</li>
<li><p>DN 向 Client汇报完成</p>
</li>
<li><p>Clien t向 NN 汇报完成</p>
</li>
</ul>
</li>
<li><p>获取下一个 Block 存放的 DN 列表<br>循环往复之前的操作 …</p>
</li>
<li><p>最终Client汇报完成</p>
</li>
<li><p>NN会在写流程更新文件状态</p>
</li>
</ul>
</blockquote>
<p>注意：</p>
<ol>
<li>client 向 DataNode 写数据，分为许多小数据包，一次次的传递，直到所有数据包都发送完毕</li>
</ol>
<p><img src="http://img.zwer.xyz/blog/20190929204035.png" alt></p>
<h3 id="HDFS-读流程"><a href="#HDFS-读流程" class="headerlink" title="HDFS 读流程*"></a>HDFS 读流程*</h3><blockquote>
<p>Client：</p>
<ul>
<li>和 NN 获取一部分 Block 副本位置列表</li>
<li>线性和 DN 获取 Block，最终合并为一个文件</li>
<li>在Block副本列表中<strong>按距离择优选取</strong></li>
</ul>
</blockquote>
<p><img src="http://img.zwer.xyz/blog/20190929204234.png" alt></p>
<ol>
<li>HDFS 发送请求到 DistributedFileSystem，DistributedFileSystem 会向 NameNode 索要指定文件所有块信息，并返回所有块副本信息（按副本顺序按距离排序）</li>
<li>通过 HDFS，可以读取文件任意块的位置</li>
</ol>
<p><strong>记： 分布式文件系统很好的支持计算层的本地化读取</strong></p>
<h3 id="HDFS文件权限-POSIX"><a href="#HDFS文件权限-POSIX" class="headerlink" title="HDFS文件权限  POSIX"></a>HDFS文件权限  POSIX</h3><p>与Linux文件权限类似</p>
<p>r: read; w:write; x:execute</p>
<p>权限x对于文件忽略，对于文件夹表示是否允许访问其内容</p>
<p>如果Linux系统用户zhangsan使用hadoop命令创建一个文件，那么这个文件在HDFS中owner就是zhangsan。</p>
<p>HDFS的权限目的：阻止好人错错事，而不是阻止坏人做坏事。HDFS相信，你告诉我你是谁，我就认为你是谁。</p>
<h3 id="安全模式"><a href="#安全模式" class="headerlink" title="安全模式"></a>安全模式</h3><p>namenode启动的时候，首先将映像文件(fsimage)载入内存，并执行编辑日志(edits)中的各项操作。</p>
<p>一旦在内存中成功建立文件系统元数据的映射，则创建一个新的fsimage文件(这个操作不需要</p>
<p>SecondaryNameNode)和一个空的编辑日志。</p>
<p>此刻namenode运行在安全模式。即namenode的文件系统对于客户端来说是只读的。(显示目录，显示文件内容</p>
<p>等。写、删除、重命名都会失败)。<br>在此阶段Namenode收集各个datanode的报告，当数据块达到最小副本数以上时，会被认为是“安全”的， 在一定</p>
<p>比例（可设置）的数据块被确定为“安全”后，再过若干时间，安全模式结束</p>
<p>当检测到副本数不足的数据块时，该块会被复制直到达到最小副本数，系统中数据块的位置并不是由namenode</p>
<p>维护的，而是以块列表形式存储在datanode中。</p>
<h3 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h3><table>
<thead>
<tr>
<th>角色（进程）</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>NameNode</td>
<td>数据元数据<br>内存存储，不会有磁盘交换<br>持久化（fsimage，eidts log）<br>不会持久化block的位置信息</td>
</tr>
<tr>
<td>block</td>
<td>偏移量，因为block不可以调整大小，hdfs，不支持修改文件<br>偏移量不会改变<br>datanode<br>block块</td>
</tr>
<tr>
<td>磁盘</td>
<td>面向文件，大小一样，不能调整<br>副本数，调整，（备份，高可用，容错/可以调整很多个，为了计算向数据移动）</td>
</tr>
<tr>
<td>SN</td>
<td></td>
</tr>
<tr>
<td>NN &amp; DN</td>
<td>心跳机制<br>DN 向 NN 汇报block信息<br>安全模式</td>
</tr>
<tr>
<td>client</td>
<td></td>
</tr>
</tbody></table>
<h2 id="搭建-Hadoop-伪分布式"><a href="#搭建-Hadoop-伪分布式" class="headerlink" title="搭建 Hadoop 伪分布式"></a>搭建 Hadoop 伪分布式</h2><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><h4 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type ntpdate</span><br><span class="line"><span class="meta">#</span> 安装 ntpdate</span><br><span class="line">yum install -y ntpdate</span><br><span class="line"><span class="meta">#</span> 同步网络时</span><br><span class="line">ntpdate -u ntp.api.bz</span><br></pre></td></tr></table></figure>

<h4 id="操作系统环境设置"><a href="#操作系统环境设置" class="headerlink" title="操作系统环境设置"></a>操作系统环境设置</h4><ul>
<li>确认主机名一致</li>
</ul>
<p><img src="http://img.zwer.xyz/blog/20190930112247.png" alt></p>
<ul>
<li>ssh 免密钥</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 在另外一台机器上远程执行 192.168.170.101 机器上的命令(验证)</span><br><span class="line">ssh root@192.168.170.101 'ls ~' </span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa  # 生成密钥</span><br><span class="line"><span class="meta">$</span> cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys  # 对自己免密钥</span><br></pre></td></tr></table></figure>

<ul>
<li>安装 Java 并配置环境变量</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh jdk-7u67-linux-x64.rpm</span><br><span class="line"><span class="meta">#</span> 修改 /etc/profile</span><br><span class="line">export JAVA_HOME=/usr/java/jdk1.7.0_67</span><br><span class="line">export PATH=$PATH:$JAVA_HOME</span><br></pre></td></tr></table></figure>

<h4 id="Hadoop-配置"><a href="#Hadoop-配置" class="headerlink" title="Hadoop 配置"></a>Hadoop 配置</h4><ul>
<li>安装 Hadoop 并配置环境变量</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">tar xf hadoop-2.6.5.tar.gz </span><br><span class="line">mkdir /opt/sxt</span><br><span class="line">mv hadoop-2.6.5 /opt/sxt/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>  配置 hadoop 环境变量</span><br><span class="line">export HADOOP_HOME=/opt/sxt/hadoop-2.6.5</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> cd /opt/sxt/hadoop-2.6.5/</span><br><span class="line"><span class="meta">#</span> 进入 etc 目录中</span><br><span class="line"><span class="meta">#</span> 修改 Java 环境路径，export JAVA_HOME=/usr/java/jdk1.7.0_67</span><br><span class="line"><span class="meta">#</span> 目的是 hadoop 管理脚本操作机器不能读取 /etc/profile 文件，所以需要改 Java 的绝对路径</span><br><span class="line">vi hadoop-env.sh</span><br><span class="line">vi mapred-env.sh</span><br><span class="line">vi yarn-env.sh</span><br></pre></td></tr></table></figure>

<ul>
<li>修改  slaves</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">将 localhsot 改为 node01</span><br><span class="line">node01</span><br></pre></td></tr></table></figure>

<ul>
<li>修改 core-site.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://node01:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/var/sxt/hadoop/local<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>修改 hdfs-site.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>node01:50090<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>配置文件</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>etc/hadoop/core-site.xml</td>
<td>决定 NameNode 的启动</td>
</tr>
<tr>
<td>etc/hadoop/slaves</td>
<td>决定 DataNode 的启动</td>
</tr>
<tr>
<td>etc/hadoop/hdfs-site.xml</td>
<td>决定 SecondaryNode 的启动</td>
</tr>
</tbody></table>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 格式化</span><br><span class="line"><span class="meta">$</span>hdfs namenode -format</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span>ls /var/sxt/hodoop/local/dfs/name/current/</span><br><span class="line">fsimage_0000000000000000000  fsimage_0000000000000000000.md5  seen_txid  VERSION</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 启动  NN、DN、SN</span><br><span class="line"><span class="meta">$</span>start-dfs.sh</span><br><span class="line"><span class="meta">#</span> jps 查看 Java 进程，是否有 NN、DN、SN</span><br><span class="line"><span class="meta">$</span>jps</span><br><span class="line">3385 DataNode</span><br><span class="line">3543 SecondaryNameNode</span><br><span class="line">3674 Jps</span><br><span class="line">3306 NameNode</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>访问 http://192.168.170.101:50070</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -mkdir /user</span><br><span class="line">hdfs dfs -ls /user</span><br><span class="line">hdfs dfs -mkdir /user/root</span><br><span class="line">hdfs dfs -D dfs.blocksize=1048576 -put hadoop-2.6.5.tar.gz </span><br><span class="line"><span class="meta">#</span> 展示当前目录，并显示文件大小 </span><br><span class="line">ll -h</span><br></pre></td></tr></table></figure>

<h2 id="搭建-Hadoop-全分布式"><a href="#搭建-Hadoop-全分布式" class="headerlink" title="搭建 Hadoop 全分布式"></a>搭建 Hadoop 全分布式</h2><h3 id="准备-1"><a href="#准备-1" class="headerlink" title="准备"></a>准备</h3><table>
<thead>
<tr>
<th></th>
<th>NN</th>
<th>SNN</th>
<th>DN</th>
</tr>
</thead>
<tbody><tr>
<td>node01</td>
<td>*</td>
<td></td>
<td></td>
</tr>
<tr>
<td>node02</td>
<td></td>
<td>*</td>
<td>*</td>
</tr>
<tr>
<td>node03</td>
<td></td>
<td></td>
<td>*</td>
</tr>
<tr>
<td>node04</td>
<td></td>
<td></td>
<td>*</td>
</tr>
</tbody></table>
<h3 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 关闭 Hadoop 伪分布式</span><br><span class="line">stop-dfs.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 配置节点 node02、node03、node04 的 java 环境 和 ssh</span><br><span class="line">cat ~/node01.pub  &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line">cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 以下操作针对 node01 ---------------------------------------------</span><br><span class="line"><span class="meta">#</span> 修改 Hadoop 配置文件</span><br><span class="line"><span class="meta">#</span> 编辑 etc/core-site.xml 文件</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;hdfs://node01:9000&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;/var/sxt/hadoop/full&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"><span class="meta">#</span> 编辑 etc/hdfs-site.xml 文件</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">     &lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;2&lt;/value&gt;</span><br><span class="line">     &lt;/property&gt;</span><br><span class="line">     &lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;node02:50090&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"><span class="meta">#</span> 编辑 etc/slaves 文件</span><br><span class="line">node02</span><br><span class="line">node03</span><br><span class="line">node04</span><br><span class="line"><span class="meta">#</span> ------------------------------------------------------------------</span><br><span class="line"><span class="meta">#</span> 在 node02、node03、node04 下创建文件夹</span><br><span class="line">mkdir /opt/sxt</span><br><span class="line"><span class="meta">#</span> 在 node01 节点的 /opt/sxt 目录下执行</span><br><span class="line">scp -r ./hadoop-2.6.5/ node02:`pwd`</span><br><span class="line">scp -r ./hadoop-2.6.5/ node03:`pwd`</span><br><span class="line">scp -r ./hadoop-2.6.5/ node04:`pwd`</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 在 node01 节点上执行  ---------------------------</span><br><span class="line">hdfs namenode -format</span><br><span class="line">start-dfd.sh</span><br></pre></td></tr></table></figure>

<p>在 node01 节点上执行 格式化</p>
<p><img src="http://img.zwer.xyz/blog/20190930163010.png" alt="启动 hdfsnamenode -format 截图"></p>
<p>在 node01 节点启动 hadoop </p>
<p><img src="http://img.zwer.xyz/blog/20190930163212.png" alt></p>
<h2 id="Hadoop-2-x"><a href="#Hadoop-2-x" class="headerlink" title="Hadoop 2.x"></a>Hadoop 2.x</h2><p><img src="http://img.zwer.xyz/blog/20191008194300.png" alt></p>
<ul>
<li>主备 NameNode<br>解决单点故障（属性，位置）<br>主NameNode对外提供服务，备NameNode同步主NameNode元数据，以待切换<br>所有DataNode同时向两个NameNode汇报数据块信息（位置）</li>
<li>JNN:集群（属性）</li>
<li>standby：备，完成了 edits.log 文件的合并产生新的image，推送回 ANN<br>两种切换选择<br>手动切换：通过命令实现主备之间的切换，可以用HDFS升级等场合<br>自动切换：基于Zookeeper实现<br>基于Zookeeper自动切换方案</li>
<li>ZooKeeper Failover Controller：监控NameNode健康状态，并向Zookeeper注册NameNode<br>NameNode挂掉后，ZKFC为NameNode竞争锁，获得ZKFC 锁的NameNode变为active</li>
</ul>
<h3 id="Hadoop-2-x-联邦"><a href="#Hadoop-2-x-联邦" class="headerlink" title="Hadoop 2.x 联邦"></a>Hadoop 2.x 联邦</h3><blockquote>
<p>联邦：不同应用间是相互隔离</p>
</blockquote>
<ol>
<li>通过多个namenode/namespace把元数据的存储和管理分散到多个节点中，使到namenode/namespace可以通过增加机器来进行水平扩展。</li>
<li>能把单个 namenode 的负载分散到多个节点中，在 HDFS 数据规模较大的时候不会也降低 HDFS 的性能。可以通过多个 namespace 来隔离不同类型的应用，把不同类型应用的HDFS元数据的存储和管理分派到不同的namenode中。</li>
</ol>
<p><img src="http://img.zwer.xyz/blog/20191008194818.png" alt></p>
<h2 id="HA-高可用"><a href="#HA-高可用" class="headerlink" title="HA 高可用"></a>HA 高可用</h2><h3 id="准备-2"><a href="#准备-2" class="headerlink" title="准备"></a>准备</h3><table>
<thead>
<tr>
<th></th>
<th>NN-1</th>
<th>NN-2</th>
<th>DN</th>
<th>ZK</th>
<th>ZKFC</th>
<th>JNN</th>
</tr>
</thead>
<tbody><tr>
<td>node01</td>
<td>*</td>
<td></td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
</tr>
<tr>
<td>node02</td>
<td></td>
<td>*</td>
<td>*</td>
<td>*</td>
<td>*</td>
<td>*</td>
</tr>
<tr>
<td>node03</td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
<td></td>
<td>*</td>
</tr>
<tr>
<td>node04</td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="搭建-Zookeeper-集群"><a href="#搭建-Zookeeper-集群" class="headerlink" title="搭建 Zookeeper 集群"></a>搭建 Zookeeper 集群</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 解压 Zookeeper 压缩包，并移动到 /opt/sxt 目录下</span><br><span class="line"><span class="meta">#</span> 配置 Zookeeper 环境变量</span><br><span class="line"><span class="meta">#</span> 到 zookeeper 目录下，进入 conf 目录下</span><br><span class="line"><span class="meta">#</span> 复制 zoo_simple.cfg 到 zoo.cfg</span><br><span class="line"><span class="meta">#</span> 修改 zoo.cfg 配置文件</span><br><span class="line">dataDir=/var/sxt/hadoop/zk</span><br><span class="line">clientPort=2181</span><br><span class="line"><span class="meta">#</span> 配置 zk 集群，第一次启动按 serverid 区分 leader 和  fellower</span><br><span class="line">server.1=192.168.170.102:2888:3888</span><br><span class="line">server.2=192.168.170.103:2888:3888</span><br><span class="line">server.3=192.168.170.104:2888:3888</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>创建  /var/sxt/hadoop/zk 目录，将当前机器 zk 的 id 写入 myid 文件中</span><br><span class="line">mkdir /var/sxt/hadoop/zk -p</span><br><span class="line">echo "1"&gt;/var/sxt/hadoop/zk/myid</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span> 分发 zookeeper 目录到其他机器上(node03、node04)</span><br><span class="line">scp -r ./zookeeper-3.4.6/ root@node03:`pwd`</span><br><span class="line">scp -r ./zookeeper-3.4.6/ root@node04:`pwd`</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 在 node03、node04 机器上</span><br><span class="line"><span class="meta">#</span> 1. 配置 zookeeper 的环境变量 </span><br><span class="line"><span class="meta">#</span> 2. 增加 myid 文件，将当前机器 zk 的 serverid 写入</span><br></pre></td></tr></table></figure>

<h3 id="HA-搭建"><a href="#HA-搭建" class="headerlink" title="HA 搭建"></a>HA 搭建</h3><blockquote>
<ol>
<li>逻辑到物理的映射</li>
<li>JNode 位置信息相关配置</li>
<li>出现故障的处理方式及 SSH 免密钥配置</li>
</ol>
</blockquote>
<h4 id="hdfs-site-xml"><a href="#hdfs-site-xml" class="headerlink" title="hdfs-site.xml"></a>hdfs-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.nameservices<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>mycluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.namenodes.mycluster<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>nn1,nn2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.mycluster.nn1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>node01:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.mycluster.nn2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>node02:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.mycluster.nn1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>node01:50070<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.mycluster.nn2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>node02:50070<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.shared.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>qjournal://node01:8485;node02:8485;node03:8485/mycluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.journalnode.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>/var/sxt/hadoop/ha/jn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.client.failover.proxy.provider.mycluster<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">      org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider</span><br><span class="line">    <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.methods<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>sshfence<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.ssh.private-key-files<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>/root/.ssh/id_dsa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.automatic-failover.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="core-site-xml"><a href="#core-site-xml" class="headerlink" title="core-site.xml"></a>core-site.xml</h3><blockquote>
<p>注意：hadoop.tmp.dir的配置要变更：/var/sxt/hadoop-2.6/ha ###</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://mycluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>ha.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>node02:2181,node03:2181,node04:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="HA-部署"><a href="#HA-部署" class="headerlink" title="HA 部署"></a>HA 部署</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 第一次部署</span><br><span class="line"><span class="meta">#</span> 1.启动 node01、node02、node03 的 journalnode</span><br><span class="line">hadoop-daemon.sh start journalnode</span><br><span class="line"><span class="meta">#</span> 2.格式化 node01 dfs</span><br><span class="line">hdfs namenode –format</span><br><span class="line"><span class="meta">#</span> 3.启动 node01 的 NN ，启动 node02 的 standyNN</span><br><span class="line">hadoop-daemon.sh start namenode   # 在 node01</span><br><span class="line">hdfs namenode -bootstrapStandby   # 在 node02</span><br><span class="line"><span class="meta">#</span> 4.格式化 zk </span><br><span class="line">hdfs zkfc -formatZK</span><br><span class="line"><span class="meta">#</span> 5.启动 hdfs</span><br><span class="line">start-dfs.sh </span><br><span class="line"><span class="meta">#</span>测试 </span><br><span class="line">kill -9 进程号    强制清除</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 第二次启动 </span><br><span class="line">1，启动zk</span><br><span class="line">2，start-dfs.sh</span><br></pre></td></tr></table></figure>

<h3 id="SSH-免密钥的应用场景"><a href="#SSH-免密钥的应用场景" class="headerlink" title="SSH 免密钥的应用场景"></a>SSH 免密钥的应用场景</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 管理脚本管理服务的开启与关闭</span><br><span class="line">2. 搭建 HA 时，ZKFC 需要控制自己及对方</span><br><span class="line"></span><br><span class="line">ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa  # 生成密钥</span><br><span class="line">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys  # 对自己免密钥</span><br></pre></td></tr></table></figure>

<h2 id="Windows-下开发大数据"><a href="#Windows-下开发大数据" class="headerlink" title="Windows 下开发大数据"></a>Windows 下开发大数据</h2><h3 id="添加-Hadoop-环境变量和指定用户"><a href="#添加-Hadoop-环境变量和指定用户" class="headerlink" title="添加 Hadoop 环境变量和指定用户"></a>添加 Hadoop 环境变量和指定用户</h3><ul>
<li>新建系统环境变量 </li>
</ul>
<p><img src="http://img.zwer.xyz/blog/20191008211933.png" alt></p>
<ul>
<li>修改系统环境变量 path</li>
</ul>
<p><img src="http://img.zwer.xyz/blog/20191008212035.png" alt></p>
<h3 id="Eclipse-中自定义用户库"><a href="#Eclipse-中自定义用户库" class="headerlink" title="Eclipse 中自定义用户库"></a>Eclipse 中自定义用户库</h3><ol>
<li><p>打开 Eclipse 的首选项:点击菜单栏下 window &gt; Perferences </p>
</li>
<li><p>搜索 user ，即可找到 User Libraries 的位置并点击</p>
</li>
<li><p>点击 New 按钮，新建一个用户库，自定义库的名称</p>
</li>
<li><p>选择刚创建自定义用户库，点击 Add Exteral JARs …点击，选择需要添加 jar 包，最后确定即可</p>
</li>
</ol>
<p><img src="http://img.zwer.xyz/blog/20191008211524.png" alt></p>
<h3 id="HDFS-api"><a href="#HDFS-api" class="headerlink" title="HDFS-api"></a>HDFS-api</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">TestHDFS</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	Configuration conf = <span class="keyword">null</span>;</span><br><span class="line">	FileSystem fs = <span class="keyword">null</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		conf = <span class="keyword">new</span> Configuration(<span class="keyword">true</span>);</span><br><span class="line">		fs = FileSystem.get(conf);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@After</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		fs.close(); <span class="comment">//关闭资源</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 创建目录</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mkdir</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="comment">// 给定一个目录，若该目录存在，则直接删除再创建</span></span><br><span class="line">		<span class="comment">// 若该目录不存在，直接创建</span></span><br><span class="line">		Path f = <span class="keyword">new</span> Path(<span class="string">"/hello"</span>);</span><br><span class="line">		<span class="keyword">if</span>(fs.exists(f))&#123;</span><br><span class="line">			fs.delete(f, <span class="keyword">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		fs.mkdirs(f);	</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 上传文件</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">upload</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		</span><br><span class="line">		InputStream is = </span><br><span class="line">				<span class="keyword">new</span> BufferedInputStream(</span><br><span class="line">            <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">"D:\\hello.txt"</span>)));</span><br><span class="line"></span><br><span class="line">		Path p = <span class="keyword">new</span> Path(<span class="string">"/user/root/test-h.txt"</span>);</span><br><span class="line">		FSDataOutputStream out = fs.create(p);</span><br><span class="line">		</span><br><span class="line">		IOUtils.copyBytes(is, out, conf, <span class="keyword">true</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 下载文件</span></span><br><span class="line">	<span class="meta">@Test</span> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">download</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		Path path = <span class="keyword">new</span> Path(<span class="string">"/user/root/test.txt"</span>);</span><br><span class="line">		InputStream in = fs.open(path);</span><br><span class="line">		<span class="comment">// 输入流</span></span><br><span class="line">		FSDataInputStream fsin = <span class="keyword">new</span> FSDataInputStream(in);</span><br><span class="line">		<span class="comment">// 输出流</span></span><br><span class="line">		OutputStream ops = </span><br><span class="line">			<span class="keyword">new</span> BufferedOutputStream(</span><br><span class="line">            	<span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">"D:\\hadoop.txt"</span>)));</span><br><span class="line">		<span class="comment">// 流对接</span></span><br><span class="line">		IOUtils.copyBytes(fsin, ops, conf);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 块</span></span><br><span class="line">	<span class="meta">@Test</span> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBlockLocation</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		Path path = <span class="keyword">new</span> Path(<span class="string">"/user/root/test.txt"</span>);</span><br><span class="line">		FileStatus fStatus = fs.getFileStatus(path);</span><br><span class="line">		BlockLocation[] bkls = </span><br><span class="line">            fs.getFileBlockLocations(fStatus , <span class="number">0</span>, fStatus.getLen());</span><br><span class="line">		<span class="keyword">for</span> (BlockLocation bkl : bkls) &#123;</span><br><span class="line">			System.out.println(bkl);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		FSDataInputStream in = fs.open(path);</span><br><span class="line">	</span><br><span class="line">		in.seek(<span class="number">1048576</span>);</span><br><span class="line">		System.out.println((<span class="keyword">char</span>)in.readByte());</span><br><span class="line">		System.out.println((<span class="keyword">char</span>)in.readByte());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/09/24/20190924  TCP、keepalived、Nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/24/20190924  TCP、keepalived、Nginx/" class="post-title-link" itemprop="url">20190924 高并发</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-09-24 00:00:00" itemprop="dateCreated datePublished" datetime="2019-09-24T00:00:00+08:00">2019-09-24</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-09 21:30:52" itemprop="dateModified" datetime="2019-10-09T21:30:52+08:00">2019-10-09</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="大数据"><a href="#大数据" class="headerlink" title="大数据"></a>大数据</h2><p>高并发 -&gt; 日志* -&gt; 分析行为 -&gt;画像 -&gt;推荐 -&gt; 服务*</p>
<h2 id="TCP-IP-网络模型"><a href="#TCP-IP-网络模型" class="headerlink" title="TCP/IP 网络模型"></a>TCP/IP 网络模型</h2><p>三次握手：确认客户端和服务端的收发正常（IO 正常），可以进行连接</p>
<ul>
<li><p>C -&gt; S : 发送 sync 包给服务端，表示客户端想与服务端建立连接</p>
</li>
<li><p>S -&gt; C：服务端接收到客户端的 sync 包，并将 sync +ack  包，发送给客户端</p>
<p>表示服务端接收到客户端的请求，并回复客户端可以与服务端建立连接</p>
</li>
<li><p>C -&gt; S: 客户端接收到服务端的 ack 包，将 ack 包发送给服务端，表示客户端马上与服务端建立连接，让服务端做好准备</p>
</li>
</ul>
<p>四次离手：TCP 是稳定的连接，对于连接断开需要经过 Client 与 Server 双方都确认后，才可关闭</p>
<ul>
<li>C - &gt;S: 发送 fin 包给服务端，表示客户端想与服务端断开连接</li>
<li>S -&gt; C: 发送 ack包给客户端，表示接收到服务端的断开请求</li>
<li>S -&gt; C: 发送 fin 包给客户端，表示服务端想与客户端断开连接</li>
<li></li>
<li>C -&gt; S: 发送 ack 包给服务端，服务端接收到后，表示与客户端断开连接。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">TCP/IP协议  OSI 7L参考模型</span><br><span class="line">GET / www.baidu.com/</span><br><span class="line">7:应用层www.baidu.com  IP:80  1212</span><br><span class="line">http，smtp，ssh</span><br><span class="line">4:传输层控制：【三次握手&gt;&gt;（传输数据）&gt;&gt;四次分手】</span><br><span class="line">tcp，udp</span><br><span class="line">SOCKET：IP:PORT-IP:PORT</span><br><span class="line">netstat -natp</span><br><span class="line">3:网络层： 192.168.9.11</span><br><span class="line">ip，icmp</span><br><span class="line">ROUTE：下一跳</span><br><span class="line">route -n</span><br><span class="line">2:链路层</span><br><span class="line">以太网：Ethernet：MAC</span><br><span class="line">ARP：全F，两点通信，交换机学习</span><br><span class="line">arp -a</span><br></pre></td></tr></table></figure>

<p><img src="http://img.zwer.xyz/blog/20190924154314.png" alt></p>
<p>注意： 三次握手和四次离手中间不可拆分，一定针对于两台特定  IP:Port - IP:Port</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">netstat antp</span><br><span class="line"></span><br><span class="line">route -n # -n 查看 IP 地址</span><br><span class="line"></span><br><span class="line">arp -a  </span><br><span class="line">0.0.0.0 默认网关</span><br></pre></td></tr></table></figure>

<h3 id="功能分层"><a href="#功能分层" class="headerlink" title="功能分层"></a>功能分层</h3><p>层与层依赖<br>1，能够申请到端口号<br>2，路由表有下一跳条目<br>3，ARP能请求到下一跳MAC<br>4，三次握手<br>5，传输数据<br>6，四次分手</p>
<p><img src="http://img.zwer.xyz/blog/20190924202409.png" alt></p>
<h3 id="下一跳"><a href="#下一跳" class="headerlink" title="下一跳"></a>下一跳</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">整个互联网建立在下一跳的模式下</span><br><span class="line">IP是逻辑上的两个端点</span><br><span class="line">MAC是物理上连接的两个节点</span><br><span class="line">端点间TCP传输过程中</span><br><span class="line">确认机制</span><br><span class="line">状态机制</span><br><span class="line">不可分割</span><br><span class="line">解析数据包需要成本</span><br><span class="line">交换机：二层，只关心MAC地址</span><br><span class="line">学习机制：</span><br><span class="line">路由器：三层，只关心IP和路由表</span><br><span class="line">LVS服务器：四层，只关心PORT，状态</span><br><span class="line">nginx：七层，关心socket对应关系</span><br><span class="line"></span><br><span class="line">## 负载均衡 ##</span><br></pre></td></tr></table></figure>

<h2 id="LVS"><a href="#LVS" class="headerlink" title="LVS"></a>LVS</h2><blockquote>
<p>LVS技术要达到的目标是：通过LVS提供的负载均衡技术和Linux操作系统实现一个高性能、高可用的服务器群集，它具有良好可靠性、可扩展性和可操作性。从而以低廉的成本实现最优的服务性能。</p>
<p>LVS自从1998年开始，发展到现在已经是一个比较成熟的技术项目了。可以利用LVS技术实现高可伸缩的、高可用的网络服务，例如WWW服务、Cache服务、DNS服务、FTP服务、MAIL服务、视频/音频点播服务等等，有许多比较著名网站和组织都在使用LVS架设的集群系统，例如：Linux的门户网站（<a href="http://www.linux.com/" target="_blank" rel="noopener">www.linux.com</a>）、向RealPlayer提供音频视频服务而闻名的Real公司（<a href="http://www.real.com/" target="_blank" rel="noopener">www.real.com</a>）、全球最大的开源网站（sourceforge.net）等</p>
</blockquote>
<p><strong>LVS 参考</strong> <a href="https://superproxy.github.io/docs/lvs/index.html" target="_blank" rel="noopener">https://superproxy.github.io/docs/lvs/index.html</a></p>
<h3 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">昂贵，性能优越</span><br><span class="line">F5 BIG-IP </span><br><span class="line">Citrix NetScaler</span><br><span class="line">A10</span><br></pre></td></tr></table></figure>

<h3 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h3><blockquote>
<p>便宜，灵活度（开源）</p>
</blockquote>
<table>
<thead>
<tr>
<th></th>
<th>四层</th>
<th>七层</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>tcp 之上的第四层协议</td>
<td>LVS 只能操作IP,端口 ，在操作系统内核中。</td>
</tr>
<tr>
<td></td>
<td></td>
<td>nginx<br>haproxy<br>httpd  “apache”webserver</td>
</tr>
</tbody></table>
<h3 id="LVS-DR"><a href="#LVS-DR" class="headerlink" title="LVS -DR"></a>LVS -DR</h3><blockquote>
<p>Director 接收用户的请求，然后根据负载均衡算法选取一台 realserver，将包转发过去，最后由realserver直接回复给用户。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">DR：Director</span><br><span class="line">客户端发送对VIP的请求</span><br><span class="line">lvs负载到后端某一台server</span><br><span class="line">后端server处理后，直接封包回送客户端</span><br><span class="line">源IP地址一定是lvs上面陪的那个公网服务地址</span><br><span class="line">也就后端server要配置这个ip</span><br><span class="line">后端server收到的数据包是lvs没有变动过的（IP：vip）</span><br><span class="line">目标ip一定是自己持有的</span><br><span class="line">so：多个server，接入互联网的server持有相同的IP，是不对的</span><br><span class="line">必须将后端server中的vip隐藏起来（对外隐藏）</span><br><span class="line"></span><br><span class="line">VIP: 虚拟服务器地址</span><br><span class="line">DIP: 转发的网络地址</span><br><span class="line">1，和RIP通信：ARP协议，获取Real Server的RIP：MAC地址</span><br><span class="line">2，转发Client的数据包到RIP上（隐藏的VIP）</span><br><span class="line">RIP: 后端真实主机(后端服务器)</span><br><span class="line"></span><br><span class="line">CIP: 客户端IP地址</span><br></pre></td></tr></table></figure>

<p><img src="http://img.zwer.xyz/blog/20190927160750.png" alt></p>
<h3 id="LVS-配置实验"><a href="#LVS-配置实验" class="headerlink" title="LVS 配置实验"></a>LVS 配置实验</h3><h4 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h4><table>
<thead>
<tr>
<th>主机名</th>
<th>node01</th>
<th>node02</th>
<th>node03</th>
</tr>
</thead>
<tbody><tr>
<td>IP 类型</td>
<td>DIP</td>
<td>RIP</td>
<td>RIP</td>
</tr>
<tr>
<td>IP</td>
<td>192.168.170.101</td>
<td>192.168.170.102</td>
<td>192.168.170.103</td>
</tr>
</tbody></table>
<h4 id="实验图"><a href="#实验图" class="headerlink" title="实验图"></a>实验图</h4><p><img src="http://img.zwer.xyz/blog/20190928094014.png" alt></p>
<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>配置 LVS 服务器的虚拟IP 和开启 IPv4 转发</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 ~]# ifconfig eth0:0 192.168.170.100/24  # 临时生效</span><br><span class="line">echo “1” &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改 RP 服务器的文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo 1 &gt; /proc/sys/net/ipv4/conf/eth0/arp_ignore </span><br><span class="line">echo 2 &gt; /proc/sys/net/ipv4/conf/eth0/arp_announce </span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore </span><br><span class="line">echo 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置 RP 服务器的本地环回地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig lo:0 192.168.170.100 netmask 255.255.255.255</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 RP 服务器上安装 httpd 服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y httpd</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置 主页</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /var/www/html</span><br><span class="line">vi index.html</span><br><span class="line">内容： from 192.168.170.102</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动 httpd 服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service httpd start</span><br></pre></td></tr></table></figure>
</li>
<li><p>LVS 配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> yum install ipvsadm -y</span><br><span class="line">ipvsadm -A -t 192.168.170.100:80 -s rr </span><br><span class="line">ipvsadm -a -t 192.168.170.100:80 -r 192.168.170.102 -g</span><br><span class="line">ipvsadm -a -t 192.168.170.100:80 -r 192.168.170.103 -g</span><br><span class="line"></span><br><span class="line">ipvsadm -ln</span><br><span class="line">浏览器刷新: 访问vip</span><br><span class="line">ipvsadm –lnc</span><br><span class="line">netstat -natp</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="keepalived"><a href="#keepalived" class="headerlink" title="keepalived"></a>keepalived</h2><blockquote>
<p>集群管理中保证集群高可用的服务软件</p>
<p>用于做健康检查和主备切换，这里用在 LVS 服务器，使用 LVS 服务器达到高可用 HA(High Availability)</p>
<p>高可用 High Available</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、需要心跳机制探测后端RS是否提供服务。</span><br><span class="line">	a) 探测down，需要从lvs中删除该RS</span><br><span class="line">	b) 探测发送从down到up，需要从lvs中再次添加RS。</span><br><span class="line">2、Lvs DR，需要主备（HA）</span><br></pre></td></tr></table></figure>

<h3 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h3><h4 id="环境-1"><a href="#环境-1" class="headerlink" title="环境"></a>环境</h4><table>
<thead>
<tr>
<th>主机名</th>
<th>node01</th>
<th>node02</th>
<th>node03</th>
<th>node04</th>
</tr>
</thead>
<tbody><tr>
<td>类型</td>
<td>LVS(MASTER)</td>
<td>RIP1</td>
<td>RIP2</td>
<td>LVS(BACKUP)</td>
</tr>
<tr>
<td>IP</td>
<td>192.168.170.101</td>
<td>192.168.170.102</td>
<td>192.168.170.103</td>
<td>192.168.170.104</td>
</tr>
</tbody></table>
<h5 id="实验图-1"><a href="#实验图-1" class="headerlink" title="实验图"></a>实验图</h5><p><img src="http://img.zwer.xyz/blog/20190928100941.png" alt></p>
<h4 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤"></a>步骤</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>  node01 上LVS 服务器上关闭之前的 ipvsadm 设置</span><br><span class="line">ipvsadm -C  #              Clear the virtual server table.</span><br><span class="line">ifconfig eth0:0 down  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 在 node01、node04上安装 keepalived </span><br><span class="line">yum install -y keepalived </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 安装完成后， 进入 cd /etc/keepalived 目录下,备份 keepalived.conf 文件</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     acassen@firewall.loc</span><br><span class="line">     failover@firewall.loc</span><br><span class="line">     sysadmin@firewall.loc</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">   smtp_server 192.168.200.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER   # 主节点</span><br><span class="line">    interface eth0  # 操作的网卡</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100  # 优先级</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;  # VIP  虚拟IP配置</span><br><span class="line">	192.168.170.100/24 dev eth0 label eth0:3 </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 192.168.170.100 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR   # 指定 LVS DR模式</span><br><span class="line">    nat_mask 255.255.255.0</span><br><span class="line">    persistence_timeout 0 # 同一个IP地址在50秒内lvs转发给同一个后端服务器</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 192.168.170.102 80 &#123; #设置真实服务器的心跳机制 RID PORT</span><br><span class="line">        weight 1</span><br><span class="line">        HTTP_GET &#123;  #心跳检测的方式</span><br><span class="line">            url &#123;</span><br><span class="line">              path /   # 心跳检查的地址</span><br><span class="line">	    	  status_code 200      #心跳检查返回的状态</span><br><span class="line">            &#125;</span><br><span class="line">            connect_timeout 3</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 192.168.170.103 80 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        HTTP_GET &#123;</span><br><span class="line">            url &#123;</span><br><span class="line">              path /</span><br><span class="line">	      status_code 200</span><br><span class="line">            &#125;</span><br><span class="line">            connect_timeout 3</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span> 配置完成 keepalived.conf ，将文件拷贝到 node04 上，并修改</span><br><span class="line">scp ./keepalived.conf root@192.168.170.104:/`pwd`</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> keepalived.conf 修改 node04 部分内容</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP   # 从节点</span><br><span class="line">    interface eth0  # 操作的网卡</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 50  # 优先级，从节点的优先级应低于主节点的优先级</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;  # VIP  虚拟IP配置</span><br><span class="line">	192.168.170.100/24 dev eth0 label eth0:3 </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> -------------------------------------------------------------------</span><br><span class="line"><span class="meta">#</span> 在 node01、node04 上启动 keepalived 服务</span><br><span class="line">service keepalived start</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 在 ifconfig 命令查看</span><br><span class="line">ifocnifg</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 查看路由</span><br><span class="line">ipvsadm -ln</span><br></pre></td></tr></table></figure>

<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><blockquote>
<p>Nginx (“engine x”) 是一个高性能的 HTTP 和 反向代理 服务器，也是一个 IMAP/POP3/SMTP 代理服务器。</p>
</blockquote>
<h3 id="Apache-与-Nginx-的比较"><a href="#Apache-与-Nginx-的比较" class="headerlink" title="Apache 与 Nginx 的比较"></a>Apache 与 Nginx 的比较</h3><table>
<thead>
<tr>
<th></th>
<th>Apache</th>
<th>Nginx</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>一个客户端连接开辟一个进程处理</td>
<td>仅有一个进程</td>
</tr>
<tr>
<td></td>
<td>同步阻塞</td>
<td>异步非阻塞</td>
</tr>
</tbody></table>
<h3 id="nginx-conf"><a href="#nginx-conf" class="headerlink" title="nginx.conf"></a>nginx.conf</h3><h4 id="events"><a href="#events" class="headerlink" title="events"></a>events</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#工作模式与连接数上限</span><br><span class="line">events</span><br><span class="line">&#123;</span><br><span class="line">    #参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ];</span><br><span class="line">    epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型，如果跑在FreeBSD上面，就用kqueue模型。</span><br><span class="line">    use epoll;</span><br><span class="line">    #单个进程最大连接数（最大连接数=连接数*进程数）</span><br><span class="line">    worker_connections 65535;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">event下的一些配置及其意义</span><br><span class="line">#单个后台worker process进程的最大并发链接数    </span><br><span class="line">worker_connections  1024;</span><br><span class="line"># 并发总数是 worker_processes 和 worker_connections 的乘积</span><br><span class="line"># 即 max_clients = worker_processes * worker_connections</span><br><span class="line"># 在设置了反向代理的情况下，max_clients = worker_processes * worker_connections / 4  为什么</span><br><span class="line"># 为什么上面反向代理要除以4，应该说是一个经验值</span><br><span class="line"># 根据以上条件，正常情况下的Nginx Server可以应付的最大连接数为：4 * 8000 = 32000</span><br><span class="line"># worker_connections 值的设置跟物理内存大小有关</span><br><span class="line"># 因为并发受IO约束，max_clients的值须小于系统可以打开的最大文件数</span><br><span class="line">    </span><br><span class="line">event下的一些配置及其意义</span><br><span class="line"># 而系统可以打开的最大文件数和内存大小成正比，一般1GB内存的机器上可以打开的文件数大约是10万左右</span><br><span class="line"># 我们来看看360M内存的VPS可以打开的文件句柄数是多少：</span><br><span class="line"># $ cat /proc/sys/fs/file-max</span><br><span class="line"># 输出 34336</span><br><span class="line"># 32000 &lt; 34336，即并发连接总数小于系统可以打开的文件句柄总数，这样就在操作系统可以承受的范围之内</span><br><span class="line"># 所以，worker_connections 的值需根据 worker_processes 进程数目和系统可以打开的最大文件总数进行适当地进行设置</span><br><span class="line"># 使得并发总数小于操作系统可以打开的最大文件数目</span><br><span class="line"># 其实质也就是根据主机的物理CPU和内存进行配置</span><br><span class="line"># 当然，理论上的并发总数可能会和实际有所偏差，因为主机还有其他的工作进程需要消耗系统资源。</span><br><span class="line"># ulimit -SHn 65535</span><br><span class="line"></span><br><span class="line">#定义Nginx运行的用户和用户组</span><br><span class="line">user www www;</span><br><span class="line"></span><br><span class="line">#nginx进程数，建议设置为等于CPU总核心数。</span><br><span class="line">worker_processes 8;</span><br><span class="line"></span><br><span class="line">#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</span><br><span class="line">error_log /var/log/nginx/error.log info;</span><br><span class="line"></span><br><span class="line">#进程文件</span><br><span class="line">pid /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line">#一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。</span><br><span class="line">worker_rlimit_nofile 65535;</span><br></pre></td></tr></table></figure>

<h4 id="httpd"><a href="#httpd" class="headerlink" title="httpd"></a>httpd</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#设定http服务器</span><br><span class="line">http</span><br><span class="line">&#123;</span><br><span class="line">include mime.types; #文件扩展名与文件类型映射表</span><br><span class="line">default_type application/octet-stream; #默认文件类型</span><br><span class="line">#charset utf-8; #默认编码</span><br><span class="line">server_names_hash_bucket_size 128; #服务器名字的hash表大小</span><br><span class="line">client_header_buffer_size 32k; #上传文件大小限制</span><br><span class="line">large_client_header_buffers 4 64k; #设定请求缓</span><br><span class="line">client_max_body_size 8m; #设定请求缓</span><br><span class="line">sendfile on; #开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。</span><br><span class="line">autoindex on; #开启目录列表访问，合适下载服务器，默认关闭。</span><br><span class="line">tcp_nopush on; #防止网络阻塞</span><br><span class="line">tcp_nodelay on; #防止网络阻塞</span><br><span class="line">keepalive_timeout 120; #长连接超时时间，单位是秒</span><br></pre></td></tr></table></figure>

<h4 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gzip的一些配置及其意义</span><br><span class="line">#gzip模块设置gzip on;</span><br><span class="line">#开启gzip压缩输出 gzip_min_length 1k; </span><br><span class="line">#最小压缩文件大小 gzip_buffers 4 16k;</span><br><span class="line">#压缩缓冲区 gzip_http_version 1.0; </span><br><span class="line">#压缩版本（默认1.1，前端如果是squid2.5请使用1.0）</span><br><span class="line">gzip_comp_level 2; </span><br><span class="line">#压缩等级</span><br><span class="line">gzip_types text/plain application/x-javascript text/css application/xml;</span><br><span class="line">#压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，</span><br><span class="line">但是会有一个warn。</span><br><span class="line">gzip_vary on;</span><br><span class="line">#limit_zone crawler $binary_remote_addr 10m; #开启限制IP连接数的时候需要使用</span><br></pre></td></tr></table></figure>

<h4 id="虚拟主机"><a href="#虚拟主机" class="headerlink" title="虚拟主机"></a>虚拟主机</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">虚拟主机一些配置及其意义</span><br><span class="line">#虚拟主机的配置</span><br><span class="line">server&#123;</span><br><span class="line">    #监听端口 listen 80;</span><br><span class="line">    #域名可以有多个，用空格隔开</span><br><span class="line">    server_name www.ha97.com ha97.com;</span><br><span class="line">    index index.html index.htm index.jsp;</span><br><span class="line">    root /data/www/ha97;</span><br><span class="line">    location ~ .*\.(php|php5)?$&#123;</span><br><span class="line">        fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        fastcgi_index index.jsp;</span><br><span class="line">        include fastcgi.conf;</span><br><span class="line">&#125;</span><br><span class="line">通过nginx可以实现虚拟主机的配置，nginx支持三种类型的虚拟主机配置，</span><br><span class="line">1、基于ip的虚拟主机， （一块主机绑定多个ip地址）</span><br><span class="line">2、基于域名的虚拟主机（servername）</span><br><span class="line">3、基于端口的虚拟主机（listen如果不写ip端口模式）</span><br><span class="line">示例基于虚拟机ip的配置，这里需要配置多个ip</span><br><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">    listen 192.168.20.20:80;</span><br><span class="line">    server_name www.linuxidc.com;</span><br><span class="line">    root /data/www;</span><br><span class="line">&#125;</span><br><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">    listen 192.168.20.21:80;</span><br><span class="line">    server_name www.linuxidc.com;</span><br><span class="line">    root /data/www;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="location"><a href="#location" class="headerlink" title="location"></a>location</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">location 映射（ngx_http_core_module）</span><br><span class="line">location [ = | ~ | ~* | ^~ ] uri &#123; ... &#125;</span><br><span class="line">location URI &#123;&#125;:</span><br><span class="line">对当前路径及子路径下的所有对象都生效；</span><br><span class="line">location = URI &#123;&#125;: 注意URL最好为具体路径。</span><br><span class="line">精确匹配指定的路径，不包括子路径，因此，只对当前资源生效；</span><br><span class="line">location ~ URI &#123;&#125;:</span><br><span class="line">location ~* URI &#123;&#125;:</span><br><span class="line">模式匹配URI，此处的URI可使用正则表达式，~区分字符大小写，~*不区分字符大小写；</span><br><span class="line">location ^~ URI &#123;&#125;:</span><br><span class="line">不使用正则表达式</span><br><span class="line">优先级：= &gt; ^~ &gt; ~|~* &gt;  /|/dir/</span><br><span class="line"></span><br><span class="line">/loghaha.html</span><br><span class="line">/logheihei.html</span><br><span class="line">^/log.*html$</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span># location 配置规则</span><br><span class="line">=前缀的指令严格匹配这个查询。如果找到，停止搜索。</span><br><span class="line">所有剩下的常规字符串，最长的匹配。如果这个匹配使用^〜前缀，搜索停止。</span><br><span class="line">正则表达式，在配置文件中定义的顺序。</span><br><span class="line">如果第3条规则产生匹配的话，结果被使用。否则，如同从第2条规则被使用</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span># location配置规则</span><br><span class="line">location 的执行逻辑跟 location 的编辑顺序无关。</span><br><span class="line">矫正：这句话不全对，“普通 location ”的匹配规则是“最大前缀”，</span><br><span class="line">因此“普通 location ”的确与 location 编辑顺序无关；</span><br><span class="line"></span><br><span class="line">但是“正则 location ”的匹配规则是“顺序匹配，且只要匹配到第一个就停止后面的匹配”；</span><br><span class="line">“普通location ”与“正则 location ”之间的匹配顺序是？</span><br><span class="line">先匹配普通 location ，再“考虑”匹配正则 location 。</span><br><span class="line">注意这里的“考虑”是“可能”的意思，也就是说匹配完“普通 location ”后，有的时候需要继续匹配“正则 location ”，有的时候则不需要继续匹配“正则 location ”。两种情况下，不需要继续匹配正则 location ：</span><br><span class="line">（ 1 ）当普通 location 前面指定了“ ^~ ”，特别告诉 Nginx 本条普通 location 一旦匹配上，则不需要继续正则匹配；</span><br><span class="line">（ 2 ）当普通location 恰好严格匹配上，不是最大前缀匹配，则不再继续匹配正则</span><br><span class="line"></span><br><span class="line">loghaha.html</span><br><span class="line">l:  logha</span><br><span class="line">l:  ^~ loghah</span><br><span class="line">l:  loghaha.html</span><br><span class="line">l:  =loghaha.html</span><br><span class="line">l:   ^logh.*html$</span><br><span class="line">l:   ^logha.*html$</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 总结</span><br><span class="line">nginx  收到请求头：判定ip，port，hosts决定server</span><br><span class="line">nginx location匹配：用客户端的uri匹配location的uri</span><br><span class="line">先普通</span><br><span class="line">顺序无关</span><br><span class="line">最大前缀</span><br><span class="line">匹配规则简单</span><br><span class="line">打断：</span><br><span class="line">^~</span><br><span class="line">完全匹配</span><br><span class="line">再正则</span><br><span class="line">不完全匹配</span><br><span class="line">正则特殊性：一条URI可以和多条location匹配上</span><br><span class="line">有顺序的</span><br><span class="line">先匹配，先应用，即时退出匹配</span><br></pre></td></tr></table></figure>

<h4 id="请求头"><a href="#请求头" class="headerlink" title="请求头"></a>请求头</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">请求头</span><br><span class="line">host：决策server负责处理</span><br><span class="line">uri：决策location</span><br><span class="line">反向代理：proxy_pass  ip:port[uri];</span><br></pre></td></tr></table></figure>

<h4 id="IP-访问控制"><a href="#IP-访问控制" class="headerlink" title="IP 访问控制"></a>IP 访问控制</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">IP访问控制</span><br><span class="line">location  &#123;</span><br><span class="line">	   deny  IP /IP段</span><br><span class="line">	   deny  192.168.1.109;</span><br><span class="line">	   allow 192.168.1.0/24;192.168.0.0/16;192.0.0.0/8</span><br><span class="line">	&#125;</span><br><span class="line">规则：按照顺序依次检测，直到匹配到第一条规则</span><br></pre></td></tr></table></figure>

<h3 id="Nginx-的-session-一致性问题"><a href="#Nginx-的-session-一致性问题" class="headerlink" title="Nginx 的 session 一致性问题"></a>Nginx 的 session 一致性问题</h3><p>​        http协议是无状态的，即你连续访问某个网页100次和访问1次对服务器来说是没有区别对待的，因为它记不住你。那么，在一些场合，确实需要服务器记住当前用户怎么办？比如用户登录邮箱后，接下来要收邮件、写邮件，总不能每次操作都让用户输入用户名和密码吧，为了解决这个问题，session的方案就被提了出来，事实上它并不是什么新技术，而且也不能脱离http协议以及任何现有的web技术</p>
<p>​        session的常见实现形式是会话cookie（session cookie），即未设置过期时间的cookie，这个cookie的默认生命周期为浏览器会话期间，只要关闭浏览器窗口，cookie就消失了。实现机制是当用户发起一个请求的时候，服务器会检查该请求中是否包含sessionid，如果未包含，则系统会创造一个名为JSESSIONID的输出 cookie返回给浏览器(只放入内存，并不存在硬盘中)，并将其以HashTable的形式写到服务器的内存里面；当已经包含sessionid是，服务端会检查找到与该session相匹配的信息，如果存在则直接使用该sessionid，若不存在则重新生成新的 session。这里需要注意的是session始终是有服务端创建的，并非浏览器自己生成的。　但是浏览器的cookie被禁止后session就需要用get方法的URL重写的机制或使用POST方法提交隐藏表单的形式来实现</p>
<h4 id="Session共享"><a href="#Session共享" class="headerlink" title="Session共享"></a>Session共享</h4><p>​        首先我们应该明白，为什么要实现共享，如果你的网站是存放在一个机器上，那么是不存在这个问题的，因为会话数据就在这台机器，但是如果你使用了负载均衡把请求分发到不同的机器呢？这个时候会话id在客户端是没有问题的，但是如果用户的两次请求到了两台不同的机器，而它的session数据可能存在其中一台机器，这个时候就会出现取不到session数据的情况，于是session的共享就成了一个问题</p>
<h4 id="Session一致性解决方案"><a href="#Session一致性解决方案" class="headerlink" title="Session一致性解决方案"></a>Session一致性解决方案</h4><p>​    1、session复制<br>​        tomcat 本身带有复制session的功能。（不讲）<br>​    2、共享session<br>​        需要专门管理session的软件，<br>​        memcached 缓存服务，可以和tomcat整合，帮助tomcat共享管理session。</p>
<ul>
<li><strong>安装 memecache 缓存服务</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">安装memcached</span><br><span class="line">1、安装libevent</span><br><span class="line">2、安装memcached</span><br><span class="line">3、启动memcached</span><br><span class="line">	memcached -d -m 128m -p 11211 -l 192.168.170.101 -u root -P /tmp/</span><br><span class="line">	-d:后台启动服务</span><br><span class="line">	-m:缓存大小</span><br><span class="line">	-p：端口</span><br><span class="line">	-l:IP</span><br><span class="line">	-P:服务器启动后的系统进程ID，存储的文件</span><br><span class="line">	-u:服务器启动是以哪个用户名作为管理用户</span><br><span class="line">如果源配置了也可以用</span><br><span class="line">	yum –y install memcached</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>tomcat 配置 session共享</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">配置session共享如下：</span><br><span class="line">3、拷贝jar到tomcat的lib下，jar包见附件</span><br><span class="line">4、配置tomcat，每个tomcat里面的context.xml中加入</span><br><span class="line"><span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">"de.javakaffee.web.msm.MemcachedBackupSessionManager"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">memcachedNodes</span>=<span class="string">"n1:192.168.170.101:11211"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">sticky</span>=<span class="string">"false"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">lockingMode</span>=<span class="string">"auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">sessionBackupAsync</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">requestUriIgnorePattern</span>=<span class="string">".*\.(ico|png|gif|jpg|css|js)$"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">sessionBackupTimeout</span>=<span class="string">"1000"</span> <span class="attr">transcoderFactoryClass</span>=<span class="string">"de.javakaffee.web.msm.serializer.kryo.KryoTranscoderFactory"</span> </span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意： tomcat 集群一定要保持时间一致性</strong></p>
<p><img src="http://img.zwer.xyz/blog/20190928155702.png" alt></p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/09/21/20190921 Linux 基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/21/20190921 Linux 基础/" class="post-title-link" itemprop="url">20190921 Linux 基础</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-09-21 00:00:00" itemprop="dateCreated datePublished" datetime="2019-09-21T00:00:00+08:00">2019-09-21</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-08 11:30:44" itemprop="dateModified" datetime="2019-10-08T11:30:44+08:00">2019-10-08</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Linux-基础"><a href="#Linux-基础" class="headerlink" title="Linux  基础"></a>Linux  基础</h1><h2 id="Linux-开始"><a href="#Linux-开始" class="headerlink" title="Linux 开始"></a>Linux 开始</h2><h3 id="虚拟机-Linux-准备工作"><a href="#虚拟机-Linux-准备工作" class="headerlink" title="虚拟机 Linux 准备工作"></a>虚拟机 Linux 准备工作</h3><h4 id="Linux-安装步骤"><a href="#Linux-安装步骤" class="headerlink" title="Linux 安装步骤"></a>Linux 安装步骤</h4><ul>
<li>选择稍后安装</li>
</ul>
<p><img src="http://img.zwer.xyz/blog/20190921110238.png" alt></p>
<ul>
<li>网络类型选择 NAT</li>
</ul>
<p><img src="http://img.zwer.xyz/blog/20190921110512.png" alt></p>
<ul>
<li>修改最大磁盘大小（这里最大磁盘大小指给虚拟机分配的，但不真正使用不是这么多）</li>
</ul>
<p><img src="http://img.zwer.xyz/blog/20190921110550.png" alt></p>
<p>注意： Linux 版本根据自己的Linux 版本选择。列如：我这用的是 CentOS-6.5-x86_64-minimal.iso，</p>
<p>所以选择 Linux 版本时选择时 Centos 64位</p>
<ul>
<li>添加 ISO 镜像文件，之后开启虚拟机即可<ol>
<li>选择编辑虚拟机设置</li>
</ol>
</li>
</ul>
<p><img src="http://img.zwer.xyz/blog/20190921110728.png" alt></p>
<p>​    2. 挂载 iso 镜像文件</p>
<p><img src="http://img.zwer.xyz/blog/20190921110819.png" alt></p>
<ul>
<li><p>虚拟机安装配置（若特殊说明，则选择默认即可）</p>
<ul>
<li><p>跳过磁盘检查，否则磁盘检查时间会很长</p>
<p><img src="http://img.zwer.xyz/blog/20190921111022.png" alt></p>
<ul>
<li><p>语言、键盘都选择英文即可。</p>
</li>
<li><p>选择第一个</p>
<p><img src="http://img.zwer.xyz/blog/20190921111435.png" alt></p>
</li>
<li><p>选择 yes，discard any data</p>
<p><img src="http://img.zwer.xyz/blog/20190921111512.png" alt></p>
</li>
<li><p>自定义 Linux 虚拟机名称</p>
<p><img src="http://img.zwer.xyz/blog/20190921111635.png" alt></p>
</li>
<li><p>选择时区</p>
<p><img src="http://img.zwer.xyz/blog/20190921111735.png" alt></p>
</li>
<li><p>密码设置要简单、透明（大家都知道的，不属于个人重要密码）</p>
<p><img src="http://img.zwer.xyz/blog/20190921111806.png" alt></p>
</li>
<li><p><strong>自定义磁盘分区</strong></p>
<p><img src="http://img.zwer.xyz/blog/20190921111959.png" alt></p>
</li>
</ul>
</li>
<li><p><img src="http://img.zwer.xyz/blog/20190921112133.png" alt></p>
</li>
<li><p><img src="http://img.zwer.xyz/blog/20190921112737.png" alt></p>
</li>
<li><p><img src="http://img.zwer.xyz/blog/20190921112755.png" alt></p>
</li>
<li><p><img src="http://img.zwer.xyz/blog/20190921112814.png" alt></p>
</li>
</ul>
</li>
</ul>
<p>注意事项：</p>
<ol>
<li>VM 安装选择自定义安装，便于之后的自定义硬件配置（如：磁盘大小等）</li>
<li>语言、键盘都选择英文</li>
<li>时区选择亚洲/上海</li>
<li>密码设置要简单透明</li>
<li>磁盘需要手动分区  boot（200MB） swap(2G) /(剩余所有)</li>
</ol>
<h4 id="Linux-静态-IP-设置"><a href="#Linux-静态-IP-设置" class="headerlink" title="Linux 静态 IP 设置"></a>Linux 静态 IP 设置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 设置静态 IP </span><br><span class="line"><span class="meta">#</span> 编辑   vi   /etc/sysconfig/network-scripts/ifcfg-eth0 </span><br><span class="line">[root@node01 network-scripts]# cd /etc/sysconfig/network-scripts/</span><br><span class="line">[root@node01 network-scripts]# vi ifcfg-eth0 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ifcfg-eth0 网卡配置，使用打开后编辑，</span><br><span class="line"><span class="meta">#</span> ONBOOT=on 开机自启 </span><br><span class="line"><span class="meta">#</span> BOOTPROTO=static 表示 IP 使用静态IP</span><br><span class="line">DEVICE=eth0</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">ONBOOT=yes</span><br><span class="line">NM_CONTROLLED=yes</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.170.101</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.170.2</span><br><span class="line">DNS1=144.144.144.144</span><br><span class="line">DNS2=8.8.8.8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 删除 rm -f 70-persistent-net.rules </span><br><span class="line"><span class="meta">#</span> 70-persistent-net.rules  该文件的作用是将 IP 地址与 MAC 地址绑定</span><br><span class="line">[root@node01 etc]# cd /etc/udev/rules.d/</span><br><span class="line">[root@node01 rules.d]# ll</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r--. 1 root root 316 Nov 22  2013 60-raw.rules</span><br><span class="line">-rw-r--r--. 1 root root 789 Sep 21 19:33 70-persistent-cd.rules</span><br><span class="line">-rw-r--r--. 1 root root 420 Sep 21 19:28 70-persistent-net.rules</span><br><span class="line">-rw-r--r--. 1 root root  54 Dec  8  2011 99-fuse.rules</span><br><span class="line">[root@node01 rules.d]# rm -f 70-persistent-net.rules </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 关机 </span><br><span class="line">poweroff </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 修改主机名</span><br><span class="line">[root@node01 ~]# vi /etc/sysconfig/network</span><br><span class="line"><span class="meta">#</span> 编辑 network 文件</span><br><span class="line">NETWORKING=yes</span><br><span class="line">HOSTNAME=node01</span><br></pre></td></tr></table></figure>

<h5 id="Linux-网络配置文件位置"><a href="#Linux-网络配置文件位置" class="headerlink" title="Linux 网络配置文件位置"></a>Linux 网络配置文件位置</h5><table>
<thead>
<tr>
<th>文件位置</th>
<th>文件作用说明</th>
</tr>
</thead>
<tbody><tr>
<td>/etc/sysconfig/network-scripts/ifcfg-eth0</td>
<td>配置静态 IP 地址</td>
</tr>
<tr>
<td>/etc/udev/rules.d/70-persistent-net.rules</td>
<td>将 IP 地址与 MAC 地址绑定</td>
</tr>
<tr>
<td>/etc/sysconfig/network</td>
<td>配置主机名</td>
</tr>
</tbody></table>
<h4 id="使用-VM-软件-记录快照"><a href="#使用-VM-软件-记录快照" class="headerlink" title="使用 VM 软件 记录快照"></a>使用 VM 软件 记录快照</h4><p><img src="http://img.zwer.xyz/blog/20190921140910.png" alt></p>
<h4 id="Linux-关机和重启命令"><a href="#Linux-关机和重启命令" class="headerlink" title="Linux 关机和重启命令"></a>Linux 关机和重启命令</h4><table>
<thead>
<tr>
<th>关机</th>
<th>重启</th>
</tr>
</thead>
<tbody><tr>
<td>poweroff</td>
<td>reboot</td>
</tr>
<tr>
<td>init 0</td>
<td>init 6</td>
</tr>
</tbody></table>
<h3 id="Linux-常用命令"><a href="#Linux-常用命令" class="headerlink" title="Linux 常用命令"></a>Linux 常用命令</h3><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>ls</td>
<td>显示目录内容  ll –i</td>
</tr>
<tr>
<td>pwd</td>
<td>显示当前目录的绝对路径</td>
</tr>
<tr>
<td>cd</td>
<td>切换目录</td>
</tr>
<tr>
<td>mkdir</td>
<td>文件夹 -p    {}</td>
</tr>
<tr>
<td>cp</td>
<td>复制  -r</td>
</tr>
<tr>
<td>mv</td>
<td>移动</td>
</tr>
<tr>
<td>touch</td>
<td>创建文件夹、文件</td>
</tr>
<tr>
<td>type 命令名</td>
<td>查看指定命令的文件的存放位置 外部命令 &amp; 内部命令</td>
</tr>
<tr>
<td>cat</td>
<td>查看文件内容</td>
</tr>
<tr>
<td>file</td>
<td>查看文件详细信息 (ELF 表示二进制文件)</td>
</tr>
<tr>
<td>echo</td>
<td>回声，打印标椎输出 <br><code>echo $PATH 查看环境变量路径</code><br><code>echo $$  当前shell的PID</code></td>
</tr>
<tr>
<td>help</td>
<td>查看内部命令</td>
</tr>
<tr>
<td>man</td>
<td>查看外部命令命令</td>
</tr>
<tr>
<td>whereis</td>
<td>定位命令位置</td>
</tr>
<tr>
<td>hash</td>
<td>查看 hash 表</td>
</tr>
<tr>
<td>ps -ef</td>
<td>查看当前进程信息</td>
</tr>
<tr>
<td>df -h</td>
<td>显示文件系统使用情况[甩锅]</td>
</tr>
<tr>
<td>du -h</td>
<td>查看某种文件使用状况[甩锅]</td>
</tr>
<tr>
<td>mount/unmout</td>
<td>挂载/卸载磁盘文件</td>
</tr>
<tr>
<td>#### ls 命令 ####</td>
<td></td>
</tr>
</tbody></table>
<p>文件类型：<br>    -：普通文件 (f)<br>    d: 目录文件</p>
<p>​    b: 块设备文件 (block)<br>​    c: 字符设备文件 (character)</p>
<p>​    l: 符号链接文件(symbolic link file)</p>
<p>​    p: 命令管道文件(pipe)<br>​    s: 套接字文件(socket)<br>文件权限：9位，每3位一组，3组 权限（U,G,O）每一组：rwx(读，写，执行), r–<br>文件硬链接的次数<br>文件的属主(owner)<br>文件的属组(group)<br>文件大小(size)，单位是字节<br>时间戳(timestamp)：最近一次被修改的时间<br>​    访问:access<br>​    修改:modify，文件内容发生了改变<br>​    改变:change，metadata，元数据</p>
<p><strong>使用  ls 同时展示多个目录</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 god]# ls ~  /usr/local</span><br><span class="line">/root:</span><br><span class="line">anaconda-ks.cfg  install.log  install.log.syslog</span><br><span class="line"></span><br><span class="line">/usr/local:</span><br><span class="line">bin  etc  games  include  lib  lib64  libexec  sbin  share  src</span><br></pre></td></tr></table></figure>

<p><strong>使用 mkdir 命令同时创建多个文件夹</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 c]# mkdir Hello/&#123;a,b,c&#125;A -p</span><br><span class="line">[root@node01 c]# ll</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x. 5 root root 4096 Sep 22 00:45 Hello</span><br><span class="line">[root@node01 c]# cd Hello</span><br><span class="line">[root@node01 Hello]# ll</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Sep 22 00:45 aA</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Sep 22 00:45 bA</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Sep 22 00:45 cA</span><br></pre></td></tr></table></figure>

<p><strong>查看文件系统和文件使用情况</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 /]# du -h /etc/udev</span><br><span class="line">4.0K	/etc/udev/makedev.d</span><br><span class="line">20K	/etc/udev/rules.d</span><br><span class="line">32K	/etc/udev</span><br><span class="line">[root@node01 /]# df -h </span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3        97G  842M   91G   1% /</span><br><span class="line">tmpfs           491M     0  491M   0% /dev/shm</span><br><span class="line">/dev/sda1       194M   28M  157M  15% /boot</span><br><span class="line">/dev/sr0        398M  398M     0 100% /mnt</span><br></pre></td></tr></table></figure>

<p><strong>使用硬链接和软链接</strong></p>
<ul>
<li>硬链接类似于拷贝，即使原文件被删除了，硬链接生成文件仍可使用</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln --l  原文件名 硬链接文件名</span><br></pre></td></tr></table></figure>

<ul>
<li>软链接，原文件删除了，软链接生成文件不可使用</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s 原文件名 软链接文件名</span><br></pre></td></tr></table></figure>

<p>  <strong>安装 man 命令</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install man man-pages</span><br></pre></td></tr></table></figure>

<h4 id="Linux命令执行流程"><a href="#Linux命令执行流程" class="headerlink" title="Linux命令执行流程"></a>Linux命令执行流程</h4><p>​        用户通过客户端命令行输入命令以及命令参数， bash 解释器会根据空白符切割，得到的第一个元素，作为命令 command。通过判断该 command 命令是外部命令还是内部命令，若内部命令，则由 bash 执行器直接执行。若是外部命令，则 根据 $PATH 中给定的目录中从左向右寻找该命令文件的可执行程序文件，然后由 bash 执行器执行。</p>
<p><img src="http://img.zwer.xyz/blog/20190921145435.png" alt></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 ~]# type ls</span><br><span class="line">ls is aliased to `ls --color=auto'</span><br><span class="line">[root@node01 ~]# type -a ls</span><br><span class="line">ls is aliased to `ls --color=auto'</span><br><span class="line">ls is /bin/ls</span><br><span class="line">[root@node01 ~]# type ifconfig</span><br><span class="line">ifconfig is /sbin/ifconfig</span><br><span class="line">[root@node01 ~]# file /sbin/ifconfig</span><br><span class="line">/sbin/ifconfig: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.18, stripped</span><br><span class="line">[root@node01 ~]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">[root@node01 ~]# type yum</span><br><span class="line">yum is hashed (/usr/bin/yum)</span><br><span class="line">[root@node01 ~]# file /usr/bin/yum</span><br><span class="line">/usr/bin/yum: a /usr/bin/python script text executable</span><br></pre></td></tr></table></figure>

<p>小技巧：使用 xshell 登录 Linux  ssh root:<a href="mailto:123456@192.168.170.101" target="_blank" rel="noopener">123456@192.168.170.101</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh 用户名:密码@IP地址</span><br></pre></td></tr></table></figure>

<h3 id="Linux-文件系统"><a href="#Linux-文件系统" class="headerlink" title="Linux 文件系统"></a>Linux 文件系统</h3><h4 id="boot-目录的挂载与卸载"><a href="#boot-目录的挂载与卸载" class="headerlink" title="boot 目录的挂载与卸载"></a>boot 目录的挂载与卸载</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 /]# umount /boot</span><br><span class="line">[root@node01 /]# df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3        97G  842M   91G   1% /</span><br><span class="line">tmpfs           491M     0  491M   0% /dev/shm</span><br><span class="line">[root@node01 /]# mount /dev/sda1 /boot</span><br><span class="line">[root@node01 /]# df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3        97G  842M   91G   1% /</span><br><span class="line">tmpfs           491M     0  491M   0% /dev/shm</span><br><span class="line">/dev/sda1       194M   28M  157M  15% /boot</span><br></pre></td></tr></table></figure>

<h4 id="File-System-Hierarchy-Standard"><a href="#File-System-Hierarchy-Standard" class="headerlink" title="File System Hierarchy Standard"></a>File System Hierarchy Standard</h4><blockquote>
<p> 文件系统层次化标准</p>
</blockquote>
<table>
<thead>
<tr>
<th>目录</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>/boot</td>
<td>系统启动相关的文件，如内核、initrd，以及grub(bootloader)</td>
</tr>
<tr>
<td>/dev</td>
<td>设备文件</td>
</tr>
<tr>
<td>/etc</td>
<td>配置文件</td>
</tr>
<tr>
<td>/home</td>
<td>用户的家目录，每一个用户的家目录通常默认为/home/USERNAME</td>
</tr>
<tr>
<td>/root</td>
<td>管理员的家目录</td>
</tr>
<tr>
<td>/lib</td>
<td>库文件</td>
</tr>
<tr>
<td>/media</td>
<td>挂载点目录，移动设备</td>
</tr>
<tr>
<td>/mnt</td>
<td>挂载点目录，额外的临时文件系统</td>
</tr>
<tr>
<td>/opt</td>
<td>可选目录，第三方程序的安装目录</td>
</tr>
<tr>
<td>/proc</td>
<td>伪文件系统，跟硬件设备相关的属性映射文件</td>
</tr>
<tr>
<td>/sys</td>
<td>临时文件， /var/tmp</td>
</tr>
<tr>
<td>/tmp</td>
<td>可变化的文件</td>
</tr>
<tr>
<td>/bin</td>
<td>可执行文件， 用户命令</td>
</tr>
<tr>
<td>/sbin</td>
<td>管理命令</td>
</tr>
</tbody></table>
<p><strong>系统启动必须：</strong></p>
<ul>
<li><p><strong>/boot：</strong>存放的启动Linux 时使用的内核文件，包括连接文件以及镜像文件。</p>
</li>
<li><p><strong>/etc：</strong>存放<strong>所有</strong>的系统需要的<strong>配置文件</strong>和<strong>子目录列表，</strong>更改目录下的文件可能会导致系统不能启动。</p>
</li>
<li><p><strong>/lib</strong>：存放基本代码库（比如c++库），其作用类似于Windows里的DLL文件。几乎所有的应用程序都需要用到这些共享库。</p>
</li>
<li><p><strong>/sys</strong>： 这是linux2.6内核的一个很大的变化。该目录下安装了2.6内核中新出现的一个文件系统 sysfs 。sysfs文件系统集成了下面3种文件系统的信息：针对进程信息的proc文件系统、针对设备的devfs文件系统以及针对伪终端的devpts文件系统。该文件系统是内核设备树的一个直观反映。当一个内核对象被创建的时候，对应的文件和目录也在内核对象子系统中</p>
</li>
</ul>
<p><strong>指令集合：</strong></p>
<ul>
<li><p><strong>/bin：</strong>存放着最常用的程序和指令</p>
</li>
<li><p><strong>/sbin：</strong>只有系统管理员能使用的程序和指令。</p>
</li>
</ul>
<p><strong>外部文件管理：</strong></p>
<ul>
<li><p><strong>/dev ：</strong>Device(设备)的缩写, 存放的是Linux的外部设备。<strong>注意：</strong>在Linux中访问设备和访问文件的方式是相同的。</p>
</li>
<li><p><strong>/media</strong>：类windows的<strong>其他设备，</strong>例如U盘、光驱等等，识别后linux会把设备放到这个目录下。</p>
</li>
<li><p><strong>/mnt</strong>：临时挂载别的文件系统的，我们可以将光驱挂载在/mnt/上，然后进入该目录就可以查看光驱里的内容了。</p>
</li>
</ul>
<p><strong>临时文件：</strong></p>
<ul>
<li><p><strong>/run</strong>：是一个临时文件系统，存储系统启动以来的信息。当系统重启时，这个目录下的文件应该被删掉或清除。如果你的系统上有 /var/run 目录，应该让它指向 run。</p>
</li>
<li><p><strong>/lost+found</strong>：一般情况下为空的，系统非法关机后，这里就存放一些文件。</p>
</li>
<li><p><strong>/tmp</strong>：这个目录是用来存放一些临时文件的。</p>
</li>
</ul>
<p><strong>账户：</strong></p>
<ul>
<li><p><strong>/root</strong>：系统管理员的用户主目录。</p>
</li>
<li><p><strong>/home</strong>：用户的主目录，以用户的账号命名的。</p>
</li>
<li><p><strong>/usr</strong>：用户的很多应用程序和文件都放在这个目录下，类似于windows下的program files目录。</p>
</li>
<li><p><strong>/usr/bin：</strong>系统用户使用的应用程序与指令。</p>
</li>
<li><p><strong>/usr/sbin：</strong>超级用户使用的比较高级的管理程序和系统守护程序。</p>
</li>
<li><p><strong>/usr/src：</strong>内核源代码默认的放置目录。</p>
</li>
</ul>
<p><strong>运行过程中要用：</strong></p>
<ul>
<li><p><strong>/var</strong>：存放经常修改的数据，比如程序运行的日志文件（/var/log 目录下）。</p>
</li>
<li><p><strong>/proc</strong>：管理<strong>内存空间！</strong>虚拟的目录，是系统内存的映射，我们可以直接访问这个目录来，获取系统信息。这个目录的内容不在硬盘上而是在内存里，我们也可以直接修改里面的某些文件来做修改。</p>
</li>
</ul>
<p><strong>扩展用的：</strong></p>
<ul>
<li><p><strong>/opt</strong>：默认是空的，我们安装额外软件可以放在这个里面。</p>
</li>
<li><p><strong>/srv</strong>：存放服务启动后需要提取的数据<strong>（不用服务器就是空）</strong> </p>
</li>
</ul>
<p><strong>挂载 cdrom 到 /mnt 目录下</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/cdrom  /mnt</span><br></pre></td></tr></table></figure>

<h3 id="文本操作命令"><a href="#文本操作命令" class="headerlink" title="文本操作命令"></a>文本操作命令</h3><table>
<thead>
<tr>
<th>command</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>cat</td>
<td>显示全部文本文件内容</td>
</tr>
<tr>
<td>more</td>
<td>逐页显示文本文件内容</td>
</tr>
<tr>
<td>less</td>
<td>一次性读取全部文件内容，相比more，可以往回看</td>
</tr>
<tr>
<td>head</td>
<td>显示前 n 行的内容</td>
</tr>
<tr>
<td>tail</td>
<td>显示后 n 行的内容</td>
</tr>
<tr>
<td>|</td>
<td>管道</td>
</tr>
<tr>
<td>xargs</td>
<td></td>
</tr>
</tbody></table>
<p><strong>使用 head 和 tail 命令遍历每行</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 god]# cat profile | head -3 | tail -1</span><br><span class="line"># System wide environment and startup programs, for login setup</span><br></pre></td></tr></table></figure>

<p><strong>xargs 用法</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 god]# echo "/"  |xargs ls -l</span><br><span class="line">total 90</span><br><span class="line">dr-xr-xr-x.  2 root root  4096 Sep 21 19:29 bin</span><br><span class="line">dr-xr-xr-x.  5 root root  1024 Sep 21 19:29 boot</span><br><span class="line">drwxr-xr-x. 18 root root  3680 Sep 21 22:21 dev</span><br><span class="line"><span class="meta">#</span> ....</span><br></pre></td></tr></table></figure>

<h3 id="vi-全屏文本编辑器"><a href="#vi-全屏文本编辑器" class="headerlink" title="vi 全屏文本编辑器"></a>vi 全屏文本编辑器</h3><h4 id="打开方式"><a href="#打开方式" class="headerlink" title="打开方式"></a>打开方式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /path/to/somefile</span><br><span class="line">vim +# :打开文件，并定位于第#行 </span><br><span class="line">vim +：打开文件，定位至最后一行</span><br><span class="line">vim +/PATTERN : 打开文件，定位至第一次被PATTERN匹配到的行的行首</span><br></pre></td></tr></table></figure>

<h4 id="关闭文件"><a href="#关闭文件" class="headerlink" title="关闭文件"></a>关闭文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">末行模式：</span><br><span class="line">:q  退出  没有动过文件 </span><br><span class="line">:wq 保存并退出   动过了，不后悔</span><br><span class="line">:q! 不保存并退出  动过了，后悔了</span><br><span class="line">:w 保存</span><br><span class="line">:w! 强行保存</span><br><span class="line">:wq --&gt; :x</span><br><span class="line"></span><br><span class="line">ZZ: 保存并退出   不需要冒号，编辑模式   # 重点*</span><br></pre></td></tr></table></figure>

<h4 id="三种模式"><a href="#三种模式" class="headerlink" title="三种模式"></a>三种模式</h4><p>按键具有编辑文本功能：默认打开进入编辑模式<br>输入模式：按键本身意义<br>末行模式：接受用户命令输入</p>
<ul>
<li><p><strong>编辑模式</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>编辑--&gt;输入：</span><br><span class="line">	i: 在当前光标所在字符的前面，转为输入模式；*</span><br><span class="line">	a: 在当前光标所在字符的后面，转为输入模式；*</span><br><span class="line"></span><br><span class="line">	o: 在当前光标所在行的下方，新建一行，并转为输入模式；</span><br><span class="line">	O：在当前光标所在行的上方，新建一行，并转为输入模式；	</span><br><span class="line">	I：在当前光标所在行的行首，转换为输入模式</span><br><span class="line">	A：在当前光标所在行的行尾，转换为输入模式</span><br><span class="line">	输入--&gt;编辑：</span><br><span class="line">ESC</span><br><span class="line"><span class="meta">#</span>编辑--&gt;末行：</span><br><span class="line">：</span><br><span class="line"><span class="meta">#</span>末行--&gt;编辑：</span><br><span class="line">ESC, ESC</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>移动光标</span><br><span class="line">字符</span><br><span class="line">h: 左；j: 下；k: 上；l: 右</span><br><span class="line"><span class="meta">#</span> 单词</span><br><span class="line">w: 移至下一个单词的词首*</span><br><span class="line">e: 跳至当前或下一个单词的词尾</span><br><span class="line">b: 跳至当前或前一个单词的词首</span><br><span class="line"><span class="meta">#</span> 行内</span><br><span class="line">0: 绝对行首</span><br><span class="line">^: 行首的第一个非空白字符*</span><br><span class="line"><span class="meta">$</span>: 绝对行尾*</span><br><span class="line"><span class="meta">#</span> 行间</span><br><span class="line">G:文章末尾</span><br><span class="line">3G:第3行</span><br><span class="line">gg:文章开头</span><br><span class="line"><span class="meta">#</span> 翻屏</span><br><span class="line">ctrl：f，b</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 删除&amp;替换单个字符</span><br><span class="line">x:删除光标位置字符</span><br><span class="line">3x:删除光标开始3个字符</span><br><span class="line">r:替换光标位置字符</span><br><span class="line"><span class="meta">#</span> 删除命令 ： d </span><br><span class="line">dw，dd</span><br><span class="line"><span class="meta">#</span> 复制粘贴&amp;剪切	</span><br><span class="line">yw(复制一个词)，yy（复制一行）</span><br><span class="line">p（向下粘贴）</span><br><span class="line">P(向上粘贴)</span><br><span class="line"><span class="meta">#</span> 撤销&amp;重做</span><br><span class="line">u   撤销*</span><br><span class="line">ctrl+r  重做 撤销的操作*</span><br><span class="line"></span><br><span class="line">.  重复上一步的操作</span><br></pre></td></tr></table></figure>
</li>
<li><p>末行模式 （进入末行模式 shirt+: ）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">set：设置</span><br><span class="line">set nu  number</span><br><span class="line">set nonu nonumber</span><br><span class="line">set readonly</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/：查找</span><br><span class="line">/after</span><br><span class="line">n(向下查找)，N（向上查找）</span><br><span class="line">？向上查找</span><br><span class="line">！：执行命令</span><br><span class="line">:!ls -l /</span><br><span class="line"></span><br><span class="line">s查找并替换</span><br><span class="line">s/str1/str2/gi</span><br><span class="line">/：临近s命令的第一个字符为边界字符：/，@，#</span><br><span class="line">g：一行内全部替换（若没有选择，则替换当前行的第一个替换）</span><br><span class="line">i：忽略大小写</span><br><span class="line">范围</span><br><span class="line">n：行号</span><br><span class="line">.：当前光标行</span><br><span class="line">+n：偏移n行</span><br><span class="line"><span class="meta">$</span>：末尾行，$-3</span><br><span class="line"><span class="meta">%</span>：全文</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 替换查找从当前光标处，到文件末尾处</span><br><span class="line">eg: .,$s/str1/str2/gi</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="末行模式小技巧"><a href="#末行模式小技巧" class="headerlink" title="末行模式小技巧"></a>末行模式小技巧</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">编辑模式下 ：</span><br><span class="line">:Gd  清空内容</span><br><span class="line">:.,$d 删除从当前光标到末尾所有行</span><br><span class="line">:n,md 删除从第 n 行到 m 行的所有内容</span><br><span class="line">:n,my 复制从第 n 行到 m 行的所有内容</span><br></pre></td></tr></table></figure>

<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">grep：显示匹配行</span><br><span class="line">- v：反显示</span><br><span class="line">- e：使用扩展正则表达式</span><br><span class="line"></span><br><span class="line">匹配操作符</span><br><span class="line">\                  转义字符</span><br><span class="line">. 	                 匹配任意单个字符</span><br><span class="line">[1249a]，[^12],[a-k]  字符序列单字符占位</span><br><span class="line">^                 行首</span><br><span class="line">$                  行尾</span><br><span class="line">\&lt;,\&gt;：\&lt;abc           单词首尾边界*</span><br><span class="line">|                   连接操作符</span><br><span class="line">(,)              选择操作符</span><br><span class="line">\n    	     反向引用</span><br><span class="line"></span><br><span class="line">重复操作符：</span><br><span class="line">?      	匹配0到1次。</span><br><span class="line">*      	匹配0到多次。</span><br><span class="line">+     	匹配1到多次。</span><br><span class="line">&#123;n&#125;   	匹配n次。</span><br><span class="line">&#123;n,&#125;  	匹配n到多次。</span><br><span class="line">&#123;n,m&#125;      匹配n到m次。</span><br><span class="line">与扩展正则表达式的区别:grep basic</span><br><span class="line">\?, \+, \&#123;, \|, \(, and \)</span><br><span class="line">匹配任意字符</span><br><span class="line">.*</span><br></pre></td></tr></table></figure>

<p><strong>注意：在未扩展正则表达式时，若匹配规则中含有 ？,+,{,},|,(,) ,都需要通过 \ 转义，否则匹配不到</strong></p>
<p><strong>查询文章中包括4位整数的行</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -E  &quot;([^0-9][0-9]|^[0-9])([0-9]&#123;2&#125;)([0-9][^0-9]|[0-9]$)&quot;  grep.txt</span><br></pre></td></tr></table></figure>

<p><strong>查看指定单词</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep “\&lt;单词名\&gt;”  file</span><br></pre></td></tr></table></figure>

<p><strong>反向引用</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 god]# grep  -E ".*(god).*(good).*\2.*\1" test</span><br><span class="line">asgodssgoodsssagoodssgod</span><br><span class="line">[root@node01 god]# grep  -E ".*(god).*(good).*\1.*\2" test</span><br><span class="line">asgodssgoodsssagodssgood</span><br></pre></td></tr></table></figure>

<h2 id="文本处理"><a href="#文本处理" class="headerlink" title="文本处理"></a>文本处理</h2><h4 id="cut-命令"><a href="#cut-命令" class="headerlink" title="cut 命令"></a>cut 命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cut：显示切割的行数据</span><br><span class="line">f：选择显示的列</span><br><span class="line">s：不显示没有分隔符的行</span><br><span class="line">d：自定义分隔符</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 god]# cut -d' ' -s  -f1-3 grep.txt </span><br><span class="line">ooxx 12121212</span><br><span class="line">oox 12121212</span><br><span class="line">1212 ooxx 1212</span><br><span class="line">[root@node01 god]# cut -d' ' -f1,2,3 grep.txt </span><br><span class="line">ooxx12121212ooxx</span><br><span class="line">ooxx 12121212</span><br><span class="line">oox 12121212</span><br><span class="line">1212 ooxx 1212</span><br><span class="line">oo3xx</span><br><span class="line">oo4xx</span><br><span class="line">ooWxx</span><br><span class="line">oomxx</span><br><span class="line"><span class="meta">$</span>ooxx</span><br><span class="line">oo1234xx</span><br><span class="line">ooxyzxx</span><br></pre></td></tr></table></figure>

<h4 id="sort命令"><a href="#sort命令" class="headerlink" title="sort命令"></a>sort命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sort：排序文件的行</span><br><span class="line">n：按数值排序</span><br><span class="line">r：倒序</span><br><span class="line">t：自定义分隔符</span><br><span class="line">k：选择排序列</span><br><span class="line">u：合并相同行</span><br><span class="line">f：忽略大小写</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 god]# sort  -k2 -n -r  fruits.txt </span><br><span class="line">orange--27</span><br><span class="line">banana--15</span><br><span class="line">apple--20</span><br><span class="line">apple--20</span><br><span class="line">[root@node01 god]# sort  -k2 -n -r fruits.txt</span><br></pre></td></tr></table></figure>

<h4 id="wc-命令"><a href="#wc-命令" class="headerlink" title="wc 命令"></a>wc 命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc 打印每个文件的换行数、单词数和字节数</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 god]# wc fruits.txt </span><br><span class="line"> 4  4 42 fruits.txt</span><br><span class="line">[root@node01 god]# cat fruits.txt | wc</span><br><span class="line">      4       4      42</span><br><span class="line">[root@node01 god]# cat fruits.txt | wc -l</span><br><span class="line">4</span><br></pre></td></tr></table></figure>

<p><strong>统计当前目录中文件的个数</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls ./ | wc</span><br></pre></td></tr></table></figure>

<h3 id="行编辑器"><a href="#行编辑器" class="headerlink" title="行编辑器"></a>行编辑器</h3><h4 id="sed-命令"><a href="#sed-命令" class="headerlink" title="sed 命令"></a>sed 命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">sed [options] 'AddressCommand' file ...</span><br><span class="line">	-n: 静默模式，不再默认显示模式空间中的内容</span><br><span class="line">	-i: 直接修改原文件*</span><br><span class="line">	-e SCRIPT -e SCRIPT:可以同时执行多个脚本</span><br><span class="line">	-f /PATH/TO/SED_SCRIPT</span><br><span class="line">	-r: 表示使用扩展正则表达式*</span><br><span class="line">	</span><br><span class="line">d: 删除符合条件的行；</span><br><span class="line">p: 显示符合条件的行；</span><br><span class="line">a \string: 在指定的行后面追加新行，内容为string*</span><br><span class="line">\n：可以用于换行</span><br><span class="line">i \string: 在指定的行前面添加新行，内容为string*</span><br><span class="line">r FILE: 将指定的文件的内容添加至符合条件的行处</span><br><span class="line">w FILE: 将地址指定的范围内的行另存至指定的文件中; </span><br><span class="line">s/pattern/string/修饰符: 查找并替换，默认只替换每行中第一次被模式匹配到的字符串*</span><br><span class="line">g: 行内全局替换</span><br><span class="line">i: 忽略字符大小写</span><br><span class="line">s///: s###, s@@@	</span><br><span class="line">	\(\), \1, \2   *</span><br><span class="line"></span><br><span class="line">sed：行编辑器Address</span><br><span class="line">可以没有 </span><br><span class="line">给定范围</span><br><span class="line">查找指定行/str/</span><br></pre></td></tr></table></figure>

<p><strong>模糊匹配指定行，并替换</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> id:9:initdefault:</span><br><span class="line"></span><br><span class="line">sed "s/\(id:\)[0-9]\(:initdefault:\)/\19\2/" inittab</span><br></pre></td></tr></table></figure>

<p><strong>模糊匹配 IP 地址，并替换最后的主机号</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">"s/\(IPADDR=\(\([0-9]\|[1-9][0-9]\|1[0-9][0-9]\|2[0-4][0-9]\|25[0-5]\)\.\)\&#123;3\&#125;\).*/\1144/"</span> ifcfg-eth0</span><br><span class="line"></span><br><span class="line">[root@node01 god]<span class="comment"># num=100</span></span><br><span class="line">[root@node01 god]<span class="comment"># sed "s/\(IPADDR=\(\([0-9]\|[1-9][0-9]\|1[0-9][0-9]\|2[0-4][0-4]\|25[0-5]\)\.\)\&#123;3\&#125;\).*/\1$num/"  -i ifcfg-eth0</span></span><br></pre></td></tr></table></figure>

<p>注意： <code>\.</code> 表示真实的点，不作为正则匹配中任意字符</p>
<h4 id="awk-命令"><a href="#awk-命令" class="headerlink" title="awk 命令"></a>awk 命令</h4><blockquote>
<p>awk是一个强大的文本分析工具。<br>相对于grep的查找，sed的编辑，awk在其对数据分析并生成报告时，显得尤为强大。<br>简单来说awk就是把文件逐行的读入，（空格，制表符）为默认分隔符将每行切片，切开的部分再进行各种分析处理。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">awk -F '&#123;pattern + action&#125;' &#123;filenames&#125;</span><br><span class="line">支持自定义分隔符</span><br><span class="line">支持正则表达式匹配</span><br><span class="line">支持自定义变量，数组  a[1]  a[tom]  map(key)</span><br><span class="line">支持内置变量</span><br><span class="line">ARGC               命令行参数个数</span><br><span class="line">ARGV               命令行参数排列</span><br><span class="line">ENVIRON            支持队列中系统环境变量的使用</span><br><span class="line">FILENAME           awk浏览的文件名</span><br><span class="line">FNR                浏览文件的记录数</span><br><span class="line">FS                 设置输入域分隔符，等价于命令行 -F选项</span><br><span class="line">NF                 浏览记录的域的个数*</span><br><span class="line">NR                 已读的记录数*</span><br><span class="line">OFS                输出域分隔符</span><br><span class="line">ORS                输出记录分隔符</span><br><span class="line">RS                 控制记录分隔符</span><br><span class="line">支持函数</span><br><span class="line">print、split、substr、sub、gsub</span><br><span class="line">支持流程控制语句，类C语言</span><br><span class="line">if、while、do/while、for、break、continue</span><br><span class="line"><span class="meta">#</span>--------------------------------------------------------------------------------#</span><br><span class="line">只是显示/etc/passwd的账户:CUT</span><br><span class="line">awk -F':' '&#123;print $1&#125;' passwd</span><br><span class="line">只是显示/etc/passwd的账户和账户对应的shell,而账户与shell之间以逗号分割,而且在所有行开始前添加列名name,shell,在最后一行添加"blue,/bin/nosh"（cut，sed）</span><br><span class="line">awk -F':' 'BEGIN&#123;print "name,shell"&#125; &#123;print $1 "," $7&#125; END&#123;print "blue,/bin/nosh"&#125;' passwd</span><br><span class="line">搜索/etc/passwd有root关键字的所有行</span><br><span class="line">awk  '/root/ &#123; print $0&#125;'   passwd</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li><p><code>$0 表示一整行内容</code></p>
</li>
<li><p>代码块{} 外加单引号，不能是双引号，即 <code>&#39;{}&#39;</code></p>
</li>
<li><p>awk 默认以空白、TAB作为分隔符 delimiter，即若以空白、TAB为分隔号，不需要指定 <code>-F</code>参数</p>
</li>
</ol>
<p><strong>统计/etc/passwd文件中，每行的行号，每行的列数，对应的完整行内容</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">awk -F":" 'BEGIN&#123; print "NR\tNF\tContent" &#125; &#123;print NR "\t" NF "\t" $0 &#125;' passwd </span><br><span class="line"><span class="meta">#</span> 结果</span><br><span class="line">NR	NF	Content</span><br><span class="line">1	7	root:x:0:0:root:/root:/bin/bash</span><br><span class="line">2	7	bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">3	7	daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"><span class="meta">#</span> ....</span><br></pre></td></tr></table></figure>

<p><strong>打印报表功能</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> awk.txt</span><br><span class="line">Tom	     0   2012-12-11      car     3000</span><br><span class="line">John	 1   2013-01-13      bike    1000</span><br><span class="line">vivi	 1   2013-01-18      car     2800</span><br><span class="line">Tom	     0   2013-01-20      car     2500</span><br><span class="line">John	 1   2013-01-28      bike    3500</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> awk.sh</span><br><span class="line">&#123;</span><br><span class="line">        split($3,date,"-")</span><br><span class="line">        if(date[2] == "01")&#123;</span><br><span class="line">                name[$1] += $5  #把名字作为数组下标，对应的value为工资</span><br><span class="line">        &#125;</span><br><span class="line">        if($2 == "0")&#123;</span><br><span class="line">                role[$1] = "manager"</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">                role[$1] = "worker"</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">END&#123;</span><br><span class="line">        for (i in name)&#123;</span><br><span class="line">                print i "\t" role[i] "\t" name[i]</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>  使用</span><br><span class="line">[root@node01 god]# awk -f awk.sh awk.txt </span><br><span class="line">vivi	worker	2800</span><br><span class="line">Tom	manager	2500</span><br><span class="line">John	worker	4500</span><br></pre></td></tr></table></figure>

<h2 id="Linux-用户管理"><a href="#Linux-用户管理" class="headerlink" title="Linux 用户管理"></a>Linux 用户管理</h2><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>打印输出有效用户的自身的ID 和 所在组的 ID</td>
</tr>
<tr>
<td>useradd</td>
<td>添加用户</td>
</tr>
<tr>
<td>userdel</td>
<td>删除用户</td>
</tr>
<tr>
<td>groupadd</td>
<td>添加组</td>
</tr>
<tr>
<td>groupdel</td>
<td>删除组</td>
</tr>
<tr>
<td>passwd</td>
<td>设置或修改密码</td>
</tr>
<tr>
<td>sudo *</td>
<td>提升权限</td>
</tr>
<tr>
<td>su</td>
<td>切换用户</td>
</tr>
</tbody></table>
<p><strong>删除用户</strong></p>
<p>若要删除用户，再创建同名用户，需要在创建前删除原 /home 目录和 /var/mail 目录下的内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 /]# userdel god</span><br><span class="line">[root@node01 /]# useradd god</span><br><span class="line">useradd: warning: the home directory already exists.</span><br><span class="line">Not copying any file from skel directory into it.</span><br><span class="line">Creating mailbox file: File exists</span><br><span class="line">[root@node01 /]# rm -rf /home/god/</span><br><span class="line">[root@node01 /]# useradd god</span><br><span class="line">useradd: user 'god' already exists</span><br><span class="line">[root@node01 /]# rm -fr /var/</span><br><span class="line">cache/    empty/    lib/      lock/     mail/     opt/      run/      tmp/      </span><br><span class="line">db/       games/    local/    log/      nis/      preserve/ spool/    yp/       </span><br><span class="line">[root@node01 /]# rm -fr /var/mail/god </span><br><span class="line">[root@node01 /]# useradd god</span><br></pre></td></tr></table></figure>

<h4 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>读权限 r=4</td>
</tr>
<tr>
<td>w</td>
<td>写权限 w=2</td>
</tr>
<tr>
<td>x</td>
<td>可执行权限 x=1</td>
</tr>
<tr>
<td>usermod</td>
<td>修改用户权限</td>
</tr>
<tr>
<td>chown</td>
<td>修改文件的属主和属组</td>
</tr>
<tr>
<td>chmod</td>
<td>修改文件操作权限 (RWX)  augo</td>
</tr>
</tbody></table>
<p>注意： </p>
<ol>
<li><p>一个文件只能有一个属主和一个属组</p>
</li>
<li><p><strong>文件夹的执行权限 x ，表示用户是否可以进入到该文件夹下</strong></p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">useradd sxt01</span><br><span class="line">passwd sxt01</span><br><span class="line">useradd sxt02</span><br><span class="line">passwd sxt02</span><br><span class="line"></span><br><span class="line">mkdir /var/swapdata</span><br><span class="line">1,权限修正：</span><br><span class="line">chmod  770  swapdata   |  chmod  o-rwx g+rwx   swapdata</span><br><span class="line">2,修正属组</span><br><span class="line">groupadd sxtswap</span><br><span class="line">usermod -a -G sxtswap sxt01</span><br><span class="line">usermod -a -G sxtswap sxt02</span><br><span class="line">chown  root:sxtswap swapdata</span><br><span class="line">chown :sxtswap   ooxx.file</span><br><span class="line">chmod  770 ooxx.file</span><br><span class="line">id  username</span><br></pre></td></tr></table></figure>

<h2 id="Linux-编译安装"><a href="#Linux-编译安装" class="headerlink" title="Linux  编译安装"></a>Linux  编译安装</h2><table>
<thead>
<tr>
<th>执行顺</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>./configure</td>
<td>生成编译依赖关系</td>
</tr>
<tr>
<td>make</td>
<td>编译</td>
</tr>
<tr>
<td>make install</td>
<td>新建文件夹、拷贝文件</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1，下载源码包</span><br><span class="line">2，解压缩：tar xf filename</span><br><span class="line">3，cd：vi README</span><br><span class="line">4，./configure</span><br><span class="line">检查操作系统</span><br><span class="line">检查编译环境</span><br><span class="line">yum install gcc</span><br><span class="line">pcre 依赖库</span><br><span class="line">yum search pcre</span><br><span class="line">yum install pcre-devel</span><br><span class="line">openssl</span><br><span class="line">yum install opssl-devel</span><br><span class="line">./configure --help</span><br><span class="line">./configure --prefix=/opt/sxt/nginx   #配置安装路径</span><br><span class="line">5，Makefile</span><br><span class="line">6，make</span><br><span class="line">7，make install</span><br><span class="line">8，cd /opt/sxt/nginx/sbin     ./nginx</span><br><span class="line">9，浏览器访问测试</span><br><span class="line">10，祝君好运~！</span><br></pre></td></tr></table></figure>

<h2 id="Linux-RPM-安装"><a href="#Linux-RPM-安装" class="headerlink" title="Linux RPM 安装"></a>Linux RPM 安装</h2><blockquote>
<p>Redhat提供了rpm管理体系<br>已经编译的软件包：针对不同的平台系统编译目标软件包<br>操作系统维护安装信息<br>软件包包含依赖检查，但还需人为解决</p>
</blockquote>
<p><strong>安装 rpm 软件</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh  xxxx.rpm</span><br></pre></td></tr></table></figure>

<p><strong>rpm 命令使用</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">rpm安装：</span><br><span class="line">-ivh  filename</span><br><span class="line">--prefix</span><br><span class="line">rpm升级：</span><br><span class="line">-Uvh</span><br><span class="line">-Fvh</span><br><span class="line">rpm卸载：</span><br><span class="line">-e PACKAGE_NAME</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> rpm查询</span><br><span class="line">rpm -qa : 查询已经安装的所有包</span><br><span class="line">rpm -q  PACKAGE_NAME: 查询指定的包是否已经安装</span><br><span class="line">rpm -qi PACKAGE_NAME: 查询指定包的说明信息</span><br><span class="line">rpm -ql PACKAGE_NAME: 查询指定包安装后生成的文件列表</span><br><span class="line">rpm -qc PACEAGE_NEME：查询指定包安装的配置文件</span><br><span class="line">rpm -qd PACKAGE_NAME: 查询指定包安装的帮助文件</span><br><span class="line">rpm -q --scripts PACKAGE_NAME: 查询指定包中包含的脚本	</span><br><span class="line">rpm -qf /path/to/somefile: 查询文件是由哪个rpm包安装生成的	</span><br><span class="line">如果某rpm包尚未安装，需查询其说明信息、安装以后会生成的文件</span><br><span class="line">rpm -qpi /PATH/TO/PACKAGE_FILE</span><br><span class="line">rpm -qpl</span><br></pre></td></tr></table></figure>

<h2 id="Linux-YUM-安装"><a href="#Linux-YUM-安装" class="headerlink" title="Linux YUM 安装"></a>Linux YUM 安装</h2><h3 id="yum-命令"><a href="#yum-命令" class="headerlink" title="yum 命令"></a>yum 命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">yum命令：</span><br><span class="line">yum repolist</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum update</span><br><span class="line">查询：</span><br><span class="line">yum list</span><br><span class="line">yum search</span><br><span class="line">yum info</span><br><span class="line">安装&amp;卸载：</span><br><span class="line">yum install </span><br><span class="line">remove|erase</span><br><span class="line"></span><br><span class="line">yum命令：分组</span><br><span class="line">yum grouplist</span><br><span class="line">yum groupinfo</span><br><span class="line">yum groupinstall</span><br><span class="line">yum groupremove</span><br><span class="line">yum groupupdate</span><br></pre></td></tr></table></figure>

<h4 id="更换安装为阿里源"><a href="#更换安装为阿里源" class="headerlink" title="更换安装为阿里源"></a>更换安装为阿里源</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 备份</span><br><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 下载阿里 yum 源</span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 更新缓存</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<h4 id="本地-yum-源"><a href="#本地-yum-源" class="headerlink" title="本地 yum 源"></a>本地 yum 源</h4><ol>
<li>为当前虚拟机挂载镜像文件</li>
</ol>
<p><img src="http://img.zwer.xyz/blog/20190923144107.png" alt></p>
<ol start="2">
<li>操作</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 挂载 cdrom </span><br><span class="line">mount /dev/cdrom /mnt</span><br><span class="line"></span><br><span class="line">repo：</span><br><span class="line">/etc/yum.repos.d/</span><br><span class="line">[repoID]</span><br><span class="line">baseurl=</span><br><span class="line">http://</span><br><span class="line">file://</span><br><span class="line">ftp://</span><br><span class="line"><span class="meta">#</span>gpgchkeck= 有1和0两个选择，分别代表是否是否进行gpg校验，如果没有这一项，默认是检查的。 </span><br><span class="line">gpgcheck=1/0</span><br><span class="line"><span class="meta">#</span>当某个软件仓库被配置成 enabled=0 时，yum 在安装或升级软件包时不会将该仓库做为软件包提供源。使用这个选项，可以启用或禁用软件仓库。  </span><br><span class="line">enable=0/1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>[base]</span><br><span class="line">name=local</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=file:///mnt</span><br><span class="line">gpgcheck=1</span><br><span class="line">enable=1</span><br></pre></td></tr></table></figure>

<p>注意： <strong>若包名中间包括空格，一定使用双引号括起来</strong></p>
<h4 id="中文显示，查看中文文档"><a href="#中文显示，查看中文文档" class="headerlink" title="中文显示，查看中文文档"></a>中文显示，查看中文文档</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> yum 的 repo 变成aliyun  || 本地DVD</span><br><span class="line">yum grouplist</span><br><span class="line">yum groupinstall "Chinese Support"</span><br><span class="line">echo $LANG</span><br><span class="line">en_US.UTF-8</span><br><span class="line">LANG=zh_CN.UTF-8</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>增加epel的repo：</span><br><span class="line">http://mirrors.aliyun.com</span><br><span class="line"><span class="meta">epel&gt;</span>&gt;&gt;&gt;&gt;help</span><br><span class="line">wget centos6.......</span><br><span class="line"></span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum search man-pages</span><br><span class="line">yum install man man-pages man-pages-zh-CN</span><br><span class="line">【【【【 man bash 】】】】</span><br></pre></td></tr></table></figure>

<h2 id="文本流"><a href="#文本流" class="headerlink" title="文本流"></a>文本流</h2><blockquote>
<p>变量<br>引用&amp;命令替换<br>退出状态&amp;逻辑判断<br>表达式<br>流程控制</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">重定向：不是命令</span><br><span class="line">程序自身都有I/O</span><br><span class="line">0：标准输入</span><br><span class="line">1：标准输出</span><br><span class="line">2：错误输出</span><br><span class="line">控制程序I/O位置</span><br><span class="line">一切皆文件</span><br><span class="line">/proc/$$/fd</span><br><span class="line">程序是否处理I/O？</span><br><span class="line">绑定顺序：从左到右</span><br></pre></td></tr></table></figure>

<h4 id="输出重定向"><a href="#输出重定向" class="headerlink" title="输出重定向"></a>输出重定向</h4><table>
<thead>
<tr>
<th>输出重定向</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>1&gt;xxx</code></td>
<td>标准输出覆盖重定向</td>
</tr>
<tr>
<td><code>1&gt;&gt;xxx</code></td>
<td>标准输出追加重定向</td>
</tr>
<tr>
<td><code>2&gt;xxx</code></td>
<td>错误覆盖重定向</td>
</tr>
<tr>
<td><code>2&gt;&gt;xxx</code></td>
<td>错误追加重定向</td>
</tr>
<tr>
<td><code>&gt;&amp;</code>或者<code>&amp;&gt;</code>   xxx</td>
<td>向 xxx 文件添加错误和标准输出信息</td>
</tr>
</tbody></table>
<p>注意： 重定向符号左边都不能包括空格</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 god]# ls /yy 2&gt;error</span><br><span class="line">[root@node01 god]# ll</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r--. 1 root root 140 Sep 22 22:39 a</span><br><span class="line">-rw-r--r--. 1 root root  49 Sep 22 22:40 error</span><br><span class="line">[root@node01 god]# cat error </span><br><span class="line">ls: cannot access /yy: No such file or directory</span><br><span class="line">[root@node01 god]# ls /123 2&gt;&gt;error</span><br><span class="line">[root@node01 god]# cat error</span><br><span class="line">ls: cannot access /yy: No such file or directory</span><br><span class="line">ls: cannot access /123: No such file or directory</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node01 god]# ls / /suibian 1&gt;ls02.out 2&gt;&amp;1</span><br><span class="line">[root@node01 god]# cat ls02.out</span><br><span class="line">ls: cannot access /suibian: No such file or directory</span><br><span class="line">/:</span><br><span class="line">abc</span><br><span class="line">bin</span><br><span class="line"><span class="meta">#</span> ... 省略</span><br><span class="line">[root@node01 god]# ls / /suibian &gt;&amp; ls01.out</span><br><span class="line">[root@node01 god]# cat ls01.out </span><br><span class="line">ls: cannot access /suibian: No such file or directory</span><br><span class="line">/:</span><br><span class="line">abc</span><br><span class="line">bin</span><br><span class="line">boot</span><br><span class="line"><span class="meta">#</span> ... 省略</span><br></pre></td></tr></table></figure>

<p> 注意： 若一条命令中既包括错误输出，也包括正确输出，则先输出错误输出     </p>
<h4 id="输入重定向"><a href="#输入重定向" class="headerlink" title="输入重定向"></a>输入重定向</h4><table>
<thead>
<tr>
<th>输入重定向</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;&lt;&lt;</code></td>
<td>从字符串中读取输入</td>
</tr>
<tr>
<td><code>&lt;&lt;E</code></td>
<td>从键盘中读取输入,E表示结束符</td>
</tr>
<tr>
<td><code>&lt;</code></td>
<td>从文件中读取输入</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 god]# read aaa &lt;&lt;&lt;"HelloWord"</span><br><span class="line">[root@node01 god]# echo $aaa</span><br><span class="line">HelloWord</span><br><span class="line">[root@node01 god]# read aaa&lt;&lt;GG</span><br><span class="line"><span class="meta">&gt;</span> ljasf</span><br><span class="line"><span class="meta">&gt;</span> ajlsdfj;la</span><br><span class="line"><span class="meta">&gt;</span> ;ajdfkl</span><br><span class="line"><span class="meta">&gt;</span> GG  #跟 GG 一样，表示输入退出</span><br><span class="line">[root@node01 god]# echo $aaa</span><br><span class="line">ljasf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> input.sh 脚本</span><br><span class="line">cat &lt;&lt;AABB</span><br><span class="line">print error info</span><br><span class="line">AABB</span><br><span class="line">echo "you know me .."</span><br><span class="line"><span class="meta">#</span> 执行</span><br><span class="line">source input.sh</span><br><span class="line"></span><br><span class="line">[root@node01 god]# cat 0&lt; /etc/in</span><br><span class="line">init/    init.d/  inittab  inputrc  </span><br><span class="line">[root@node01 god]# cat 0&lt; /etc/inittab </span><br><span class="line"><span class="meta">#</span> inittab is only used by upstart for the default runlevel.</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span> ADDING OTHER CONFIGURATION HERE WILL HAVE NO EFFECT ON YOUR SYSTEM.</span><br></pre></td></tr></table></figure>

<h4 id="全重定向"><a href="#全重定向" class="headerlink" title="全重定向"></a>全重定向</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exec 8&lt;&gt; /dev/tcp/www.baidu.com/80</span><br><span class="line">echo -e "GET / HTTP/1.0\n" &gt;&amp; 8</span><br><span class="line">cat &lt;&amp; 8</span><br></pre></td></tr></table></figure>

<h2 id="Shell-编程"><a href="#Shell-编程" class="headerlink" title="Shell 编程"></a>Shell 编程</h2><h3 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">shell  bash</span><br><span class="line">解释器，启动器</span><br><span class="line">解释器：</span><br><span class="line">用户交互输入</span><br><span class="line">文本文件输入*</span><br><span class="line">脚本本质：</span><br><span class="line"><span class="meta">#</span>! /bin/bash</span><br><span class="line"><span class="meta">#</span>! /usr/bin/python</span><br><span class="line">读取方式：</span><br><span class="line">当前shell：source/.</span><br><span class="line">新建子shell：/bin/bash  file   /   ./file.sh  《chmod +x file.sh》</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>执行方式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>source  xxx.sh</td>
<td>在当前 bash 中执行脚本</td>
</tr>
<tr>
<td>./xxx.sh</td>
<td>开启一个子 bash 执行脚本</td>
</tr>
</tbody></table>
<p>注意：在不同 bash 中执行的结果有可能不相同，即要理清父子 bash 之间的关系</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 sh]# echo $$</span><br><span class="line">1132</span><br><span class="line">[root@node01 sh]# source sh01.sh </span><br><span class="line">abc  boot  etc   lib    lost+found  mnt  proc  sbin     share  sys  usr</span><br><span class="line">bin  dev   home  lib64  media       opt  root  selinux  srv    tmp  var</span><br><span class="line">Hello World</span><br><span class="line">1132</span><br><span class="line">init─┬─auditd───&#123;auditd&#125;</span><br><span class="line">     ├─crond</span><br><span class="line">     ├─dbus-daemon───&#123;dbus-daemon&#125;</span><br><span class="line">     ├─master─┬─pickup</span><br><span class="line">     │        └─qmgr</span><br><span class="line">     ├─6*[mingetty]</span><br><span class="line">     ├─rsyslogd───3*[&#123;rsyslogd&#125;]</span><br><span class="line">     ├─sshd───sshd───bash───pstree</span><br><span class="line">     └─udevd───2*[udevd]</span><br><span class="line">[root@node01 sh]# ./sh01.sh </span><br><span class="line">abc  boot  etc	 lib	lost+found  mnt  proc  sbin	share  sys  usr</span><br><span class="line">bin  dev   home  lib64	media	    opt  root  selinux	srv    tmp  var</span><br><span class="line">Hello World</span><br><span class="line">1296</span><br><span class="line">init─┬─auditd───&#123;auditd&#125;</span><br><span class="line">     ├─crond</span><br><span class="line">     ├─dbus-daemon───&#123;dbus-daemon&#125;</span><br><span class="line">     ├─master─┬─pickup</span><br><span class="line">     │        └─qmgr</span><br><span class="line">     ├─6*[mingetty]</span><br><span class="line">     ├─rsyslogd───3*[&#123;rsyslogd&#125;]</span><br><span class="line">     ├─sshd───sshd───bash───bash───pstree</span><br><span class="line">     └─udevd───2*[udevd]</span><br></pre></td></tr></table></figure>

<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><table>
<thead>
<tr>
<th>类型</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>本地变量</td>
<td>作用于当前 bash 中</td>
</tr>
<tr>
<td>局部变量</td>
<td>local，只作用于当前代码块</td>
</tr>
<tr>
<td>位置变量</td>
<td><code>$1</code>,<code>$2，</code>，从脚本文件后，读取参数</td>
</tr>
<tr>
<td>特殊变量</td>
<td><code>$#</code>: 位置参数个数<br><code>$*</code>: 参数列表，双引号引用为一个字符串<br><code>$@</code>: 参数列表，双引号引用为单独的字符串<br><code>$$</code>:当前 shell 的 PID：接收者<br><code>$BASHPID</code>:真实<br>管道 *<br>$?:上一个命令退出状态<br>    - 0 成功<br>    -other: 失败</td>
</tr>
<tr>
<td>环境变量</td>
<td>- export 定义变量<br>- 导出到子 shell<br>- fork()  Copy On Write  时间复杂度 O(1)<br>适用用于函数<br>unset: 取消变量<br>set: 查看shell 的变量</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 sh]# num=1</span><br><span class="line">[root@node01 sh]# myfunc()&#123;</span><br><span class="line"><span class="meta">&gt;</span> echo $num</span><br><span class="line"><span class="meta">&gt;</span> echo HelloWorld</span><br><span class="line"><span class="meta">&gt;</span> &#125;</span><br><span class="line">[root@node01 sh]# myfunc</span><br><span class="line">1</span><br><span class="line">HelloWorld</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 本地变量 local</span><br><span class="line">[root@node01 sh]# myfunc()&#123;</span><br><span class="line"><span class="meta">&gt;</span> local fun=1</span><br><span class="line"><span class="meta">&gt;</span> echo $fun</span><br><span class="line"><span class="meta">&gt;</span> echo ok</span><br><span class="line"><span class="meta">&gt;</span> &#125;</span><br><span class="line">[root@node01 sh]# myfunc</span><br><span class="line">1</span><br><span class="line">ok</span><br><span class="line">[root@node01 sh]# echo $fun</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> -------------------------------</span><br><span class="line"><span class="meta">#</span> 位置参数</span><br><span class="line">[root@node01 sh]# cat sh02.sh</span><br><span class="line">echo $1</span><br><span class="line">echo $2</span><br><span class="line">[root@node01 sh]# vi sh02.sh</span><br><span class="line">[root@node01 sh]# source sh02.sh 1 2 </span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 特殊参数</span><br><span class="line">[root@node01 sh]# cat sh02.sh </span><br><span class="line">echo $1</span><br><span class="line">echo $2</span><br><span class="line">echo $&#123;11&#125;</span><br><span class="line">echo "---------"</span><br><span class="line">echo &#123;'position parameters:'&#125;$#</span><br><span class="line">echo $@</span><br><span class="line">[root@node01 sh]# source sh02.sh a b c d e f j h k m n o</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">n</span><br><span class="line">---------</span><br><span class="line">&#123;position parameters:&#125;12</span><br><span class="line">a b c d e f j h k m n o</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>查看上一个命令的执行状态</span><br><span class="line">[root@node01 sh]# ls /</span><br><span class="line">abc  bin  boot  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  sbin  selinux  share  srv  sys  tmp  usr  var</span><br><span class="line">[root@node01 sh]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@node01 sh]# ls /asf</span><br><span class="line">ls: cannot access /asf: No such file or directory</span><br><span class="line">[root@node01 sh]# echo $?</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 数组使用</span><br><span class="line">[root@node01 sh]# arr=(1 2 3)</span><br><span class="line">[root@node01 sh]# echo $arr[1]</span><br><span class="line">1[1]</span><br><span class="line">[root@node01 sh]# echo $&#123;arr[1]&#125;</span><br><span class="line">2</span><br><span class="line">[root@node01 sh]# echo $&#123;arr[0]&#125;</span><br><span class="line">1</span><br><span class="line">[root@node01 sh]# echo $&#123;arr[2]&#125;</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 变量与其他字符串的拼接，需要使用花括号 &#123;&#125;，标识为变量</span><br><span class="line">[root@node01 sh]# num=1</span><br><span class="line">[root@node01 sh]# echo $num1231</span><br><span class="line"></span><br><span class="line">[root@node01 sh]# echo $&#123;num&#125;111</span><br><span class="line">1111</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 管道--管道两边分为在两个子 bash 中，  子 bash 可以使用父 bash 中的引用</span><br><span class="line">[root@node01 sh]# dd=1</span><br><span class="line">[root@node01 sh]# dd=10 | echo $dd</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> export 导入不共享</span><br><span class="line">[root@node01 sh]# cat sh04.sh </span><br><span class="line">echo $k</span><br><span class="line">echo "-------------"</span><br><span class="line">sleep 10</span><br><span class="line">echo $k</span><br><span class="line">[root@node01 sh]# export k=5</span><br><span class="line">[root@node01 sh]# ./sh04.sh &amp;  # $ 表示在后台运行</span><br><span class="line">[1] 1729</span><br><span class="line">[root@node01 sh]# 5</span><br><span class="line">-------------</span><br><span class="line">^C</span><br><span class="line">[root@node01 sh]# k=8</span><br><span class="line">[root@node01 sh]# 5</span><br><span class="line">^C</span><br><span class="line">[1]+  Done                    ./sh04.sh</span><br></pre></td></tr></table></figure>

<p>注意： </p>
<ol>
<li>数组元素之间通过空格分隔，使用逗号分号，bash 会把数组整体当做字符串使用</li>
<li>export 导出非共享<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><blockquote>
<p>双引号：弱引用，参数扩展<br>单引号：强引用，不可嵌套<br>花括号扩展不能被引用<br>命令执行前删除引用</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 sh]# kk=12</span><br><span class="line">[root@node01 sh]# echo "$kk"</span><br><span class="line">12</span><br><span class="line">[root@node01 sh]# echo '$kk'</span><br><span class="line"><span class="meta">$</span>kk</span><br><span class="line"><span class="meta">#</span> 花括号扩展不能被引用</span><br><span class="line">[root@node01 b]# cp  "/etc/&#123;passwd,inittab&#125;" ./</span><br><span class="line">cp: cannot stat `/etc/&#123;passwd,inittab&#125;': No such file or directory</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="命令替换"><a href="#命令替换" class="headerlink" title="命令替换"></a>命令替换</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">反引号：`ls -l /`</span><br><span class="line"><span class="meta">$</span>(ls -l /)</span><br><span class="line">可以嵌套</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 sh]# echo "`echo 123`"</span><br><span class="line">123</span><br><span class="line"></span><br><span class="line">[root@node01 sh]# abc=$(echo $(echo "sxt"))</span><br><span class="line">[root@node01 sh]# echo $abc</span><br><span class="line">sxt</span><br><span class="line"></span><br><span class="line">[root@node01 sh]# abc=$(ls -l /)</span><br><span class="line">[root@node01 sh]# echo $abc</span><br><span class="line">total 98 drwxrw-r-x. 3 root root 4096 Sep 22 13:53 abc dr-xr-xr-x. 2 root root 4096 Sep 22 21:34 bin dr-xr-xr-x. 5 root root 1024 Sep 21 19:29 boot drwxr-xr-x. 18 root root 3680 Sep 22 21:45 dev drwxr-xr-x. 76 root root 4096 Sep 22 21:45 etc drwxr-xr-x. 4 root root 4096 Sep 22 13:04 home dr-xr-xr-x. 8 root root 4096 Sep 22 14:16 lib dr-xr-xr-x. 10 root root 12288 Sep 22 21:34 lib64 drwx------. 2 root root 16384 Sep 21 19:28 lost+found drwxr-xr-x. 2 root root 4096 Sep 23 2011 media drwxr-xr-x. 2 root root 4096 Sep 23 2011 mnt drwxr-xr-x. 2 root root 4096 Sep 23 2011 opt dr-xr-xr-x. 87 root root 0 Sep 22 21:45 proc dr-xr-x---. 5 root root 4096 Sep 23 03:26 root dr-xr-xr-x. 2 root root 12288 Sep 22 17:58 sbin drwxr-xr-x. 7 root root 0 Sep 22 21:45 selinux drwxrwx---. 2 root share 4096 Sep 22 13:51 share drwxr-xr-x. 2 root root 4096 Sep 23 2011 srv drwxr-xr-x. 13 root root 0 Sep 22 21:45 sys drwxrwxrwt. 3 root root 4096 Sep 23 02:02 tmp drwxr-xr-x. 14 root root 4096 Sep 22 17:50 usr drwxr-xr-x. 17 root root 4096 Sep 21 19:28 var</span><br></pre></td></tr></table></figure>

<h3 id="逻辑判断"><a href="#逻辑判断" class="headerlink" title="逻辑判断*"></a>逻辑判断*</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">退出状态</span><br><span class="line">echo $?</span><br><span class="line">逻辑判断</span><br><span class="line">command1 &amp;&amp; command2</span><br><span class="line">command1 || command2</span><br></pre></td></tr></table></figure>

<h3 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h3><h4 id="算术表达式"><a href="#算术表达式" class="headerlink" title="算术表达式"></a>算术表达式</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let  算术运算表达式</span><br><span class="line">let  C=$A+$B</span><br><span class="line"><span class="meta">$</span>[算术表达式]</span><br><span class="line">C =$[$A+$B]</span><br><span class="line"><span class="meta">$</span>((算术表达式))</span><br><span class="line">C=$(($A+$B))</span><br><span class="line">expr  算术表达式  </span><br><span class="line">注意：表达式中各操作数及运算符之间要有空格。而且要使用命令引用</span><br><span class="line">C=`expr $A + $B`</span><br><span class="line">help let</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 sh]# a=1</span><br><span class="line">[root@node01 sh]# b=2</span><br><span class="line">[root@node01 sh]# let c=$a+$b</span><br><span class="line">[root@node01 sh]# echo $c</span><br><span class="line">3</span><br><span class="line">[root@node01 sh]# c=3</span><br><span class="line">[root@node01 sh]# d=4</span><br><span class="line">[root@node01 sh]# e=$(($c+$d))</span><br><span class="line">[root@node01 sh]# echo $e</span><br><span class="line">7</span><br><span class="line">[root@node01 sh]# j=1</span><br><span class="line">[root@node01 sh]# k=2</span><br><span class="line">[root@node01 sh]# c=$((j+k))</span><br><span class="line">[root@node01 sh]# echo $c</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">[root@node01 sh]# echo $a</span><br><span class="line">2</span><br><span class="line">[root@node01 sh]# ((a++))</span><br><span class="line">[root@node01 sh]# echo $a</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<h4 id="条件表达式"><a href="#条件表达式" class="headerlink" title="条件表达式"></a>条件表达式</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[  expression  ]</span><br><span class="line">test expression</span><br><span class="line">[[ expression ]]</span><br><span class="line">help test</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 sh]# test -a /etc/adf</span><br><span class="line">[root@node01 sh]# echo $?</span><br><span class="line">1</span><br><span class="line">[root@node01 sh]# test -a /etc/password</span><br><span class="line">[root@node01 sh]# echo $?</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@node01 sh]# [ $a -gt $b ]</span><br><span class="line">[root@node01 sh]# echo $?</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@node01 sh]# [3 -gt 2]</span><br><span class="line">-bash: [3: command not found</span><br><span class="line">[root@node01 sh]# [ 3 -gt 2 ]</span><br><span class="line">[root@node01 sh]# echo $?</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p><em>注意： 靠近 [] ，需要有空格间隔</em></p>
<h4 id="添加用户脚本"><a href="#添加用户脚本" class="headerlink" title="添加用户脚本"></a>添加用户脚本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>添加用户</span><br><span class="line"><span class="meta">#</span>用户密码同用户名</span><br><span class="line"><span class="meta">#</span>静默运行脚本</span><br><span class="line"><span class="meta">#</span>避免捕获用户接口</span><br><span class="line"><span class="meta">#</span>程序自定义输出</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>! /bin/bash</span><br><span class="line">[ ! $# -eq 1 ] &amp;&amp; echo "args error ! " &amp;&amp; exit 3</span><br><span class="line">id $1 &gt;&amp;/dev/null &amp;&amp; echo "user exits" &amp;&amp; exit 4</span><br><span class="line">useradd $1 &gt;&amp; /dev/null &amp;&amp; echo $1 | passwd --stdin $1 &gt;&amp; /dev/null &amp;&amp; echo "useradd user success!" &amp;&amp; exit 0</span><br><span class="line">echo "don't know, user add error!"</span><br></pre></td></tr></table></figure>

<h3 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h3><h4 id="if"><a href="#if" class="headerlink" title="if"></a>if</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[test06@node01 sh]$ if [ 3 -gt 1 ]; then echo ok; fi</span><br><span class="line">ok</span><br><span class="line">[test06@node01 sh]$ a=1</span><br><span class="line">[test06@node01 sh]$ b=2</span><br><span class="line">[test06@node01 sh]$ if [ $b -lt $a ];then echo ok;elif [ $b -gt $a ];then echo ojbk;fi</span><br><span class="line">ojbk</span><br><span class="line">[test06@node01 sh]$ if [ $b -lt $a ];then echo lt;else echo gt;fi</span><br><span class="line">gt</span><br></pre></td></tr></table></figure>

<h4 id="while"><a href="#while" class="headerlink" title="while"></a>while</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[test06@node01 sh]$ while ls /;do echo ok;break;done</span><br><span class="line">abc  boot  etc   lib    lost+found  mnt  proc  sbin     share  sys  usr</span><br><span class="line">bin  dev   home  lib64  media       opt  root  selinux  srv    tmp  var</span><br><span class="line">ok</span><br><span class="line">[test06@node01 sh]$ a=1</span><br><span class="line">[test06@node01 sh]$ while [ $a -le 5 ];do echo $a;((a++));done</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<h4 id="for"><a href="#for" class="headerlink" title="for"></a>for</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[test06@node01 sh]$ for ((ab=1;ab&lt;5;ab++));do echo ab=$ab;done</span><br><span class="line">ab=1</span><br><span class="line">ab=2</span><br><span class="line">ab=3</span><br><span class="line">ab=4</span><br><span class="line">[test06@node01 sh]$ for i in 1 2 3 4 5;do echo $i;done</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 用户给定路径</span><br><span class="line"><span class="meta">#</span> 输出文件大小最大的文件</span><br><span class="line"><span class="meta">#</span> 递归子目录</span><br><span class="line"><span class="meta">#</span>! /bin/bash</span><br><span class="line">oldIFS=$IFS</span><br><span class="line">IFS=$'\n'</span><br><span class="line">for i in `du -a $1 | sort -nr`;do</span><br><span class="line">        filename=`echo $i | awk '&#123;print $2&#125;'`</span><br><span class="line">        if [ -f $filename ];then</span><br><span class="line">                echo $filename</span><br><span class="line">                break;</span><br><span class="line">        fi</span><br><span class="line">done</span><br><span class="line">IFS=$oldIFS</span><br></pre></td></tr></table></figure>

<p>注意: 变量的赋值等于号前面两边不能有空格，bash 对空格敏感</p>
<h4 id="循环遍历文件输出"><a href="#循环遍历文件输出" class="headerlink" title="循环遍历文件输出"></a>循环遍历文件输出</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>! /bin/bash</span><br><span class="line">oldIFS=$IFS</span><br><span class="line">IFS=$'\n'</span><br><span class="line">num=0</span><br><span class="line">for i in `cat file.txt`;do</span><br><span class="line">        echo $i</span><br><span class="line">        ((num++));</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span>! /bin/bash</span><br><span class="line">oldIFS=$IFS</span><br><span class="line">IFS=$'\n'</span><br><span class="line">num=0</span><br><span class="line">for i in `cat file.txt`;do</span><br><span class="line">        echo $i</span><br><span class="line">        ((num++));</span><br><span class="line">done</span><br><span class="line">echo "num:$num"</span><br><span class="line">IFS=$oldIFS</span><br><span class="line">echo "---------------"</span><br><span class="line">lines=`cat file.txt | wc -l`</span><br><span class="line">for ((i=1;i&lt;=lines;i++));do</span><br><span class="line">        echo `head -$i file.txt | tail -1`</span><br><span class="line">        ((line++))</span><br><span class="line">done</span><br><span class="line">echo "line:$line"</span><br><span class="line">echo "---------------"</span><br><span class="line">num=0</span><br><span class="line">while  read line ;do</span><br><span class="line">        echo $line</span><br><span class="line">        ((num++ ))</span><br><span class="line">done &lt; file.txt</span><br><span class="line">echo "num:$num"</span><br><span class="line">echo "-----------------"</span><br><span class="line">num=0</span><br><span class="line">cat file.txt | while  read line;do</span><br><span class="line">        echo $line</span><br><span class="line">        ((num++))</span><br><span class="line">done</span><br><span class="line">echo "num:$num"</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/09/02/20190902大数据入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/09/02/20190902大数据入门/" class="post-title-link" itemprop="url">大数据入门</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-09-02 00:00:00" itemprop="dateCreated datePublished" datetime="2019-09-02T00:00:00+08:00">2019-09-02</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-09 21:30:15" itemprop="dateModified" datetime="2019-10-09T21:30:15+08:00">2019-10-09</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="人工智能真来了吗？"><a href="#人工智能真来了吗？" class="headerlink" title="人工智能真来了吗？"></a>人工智能真来了吗？</h2><blockquote>
<p>来了，真滴来了。</p>
</blockquote>
<p>Example：</p>
<ul>
<li>谷歌、百度的无人汽车</li>
<li>高铁站出入检票站</li>
<li>杭州主要干道由阿里巴巴的人工智能（ET）管理</li>
</ul>
<h3 id="人工智能三要素"><a href="#人工智能三要素" class="headerlink" title="人工智能三要素"></a>人工智能三要素</h3><ul>
<li>硬件（计算机硬件的计算速度提升和计算成本下降）</li>
<li>算法（机械学习算法、深度学习算法）</li>
<li>数据（特指大数据）</li>
</ul>
<h3 id="人工智能的发展阶段"><a href="#人工智能的发展阶段" class="headerlink" title="人工智能的发展阶段"></a>人工智能的发展阶段</h3><p><img src="http://img.zwer.xyz/blog/20190902192559.png" alt></p>
<h3 id="人工智能的概念"><a href="#人工智能的概念" class="headerlink" title="人工智能的概念"></a>人工智能的概念</h3><p>李开复：大数据+深度学习=人工智能</p>
<h2 id="机器学习"><a href="#机器学习" class="headerlink" title="机器学习"></a>机器学习</h2>
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
  </div>

  


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zwer</p>
  <div class="site-description" itemprop="description">记录学习的日常</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
  </nav>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zwer</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.4.0</div>

        












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/muse.js?v=7.4.0"></script>
<script src="/js/next-boot.js?v=7.4.0"></script>



  





















  

  

  

</body>
</html>
