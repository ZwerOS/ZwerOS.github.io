<!DOCTYPE html>





<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="记录学习的日常">
<meta name="keywords" content="zwer">
<meta property="og:type" content="website">
<meta property="og:title" content="zwer 的博客空间">
<meta property="og:url" content="http://zwer.xyz/page/5/index.html">
<meta property="og:site_name" content="zwer 的博客空间">
<meta property="og:description" content="记录学习的日常">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zwer 的博客空间">
<meta name="twitter:description" content="记录学习的日常">
  <link rel="canonical" href="http://zwer.xyz/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>zwer 的博客空间</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zwer 的博客空间</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">上善若水 自强不息</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <div id="posts" class="posts-expand">
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/10/20190510 SSM框架整合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/10/20190510 SSM框架整合/" class="post-title-link" itemprop="url">20190510 SSM 框架整合</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-10 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-10T00:00:00+08:00">2019-05-10</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-11 14:50:39" itemprop="dateModified" datetime="2019-05-11T14:50:39+08:00">2019-05-11</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-框架环境搭建"><a href="#1-框架环境搭建" class="headerlink" title="1  框架环境搭建"></a>1  框架环境搭建</h1><p>需求 ：完成基金开户及购买功能</p>
<h2 id="1-1-配置-xml-文件"><a href="#1-1-配置-xml-文件" class="headerlink" title="1.1  配置 xml 文件"></a>1.1  配置 xml 文件</h2><blockquote>
<p>JdbcTemplate spring  框架中提供的模板类，简化 jdbc 的操作。</p>
</blockquote>
<h3 id="中文乱码问题"><a href="#中文乱码问题" class="headerlink" title="中文乱码问题"></a>中文乱码问题</h3><p>在 web.xml 添加过滤器 filter </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置编码过滤器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 必须设置为 true， 否则设置 utf-8 编码无效 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="注册-Spring-监听器"><a href="#注册-Spring-监听器" class="headerlink" title="注册 Spring 监听器"></a>注册 Spring 监听器</h3><p>spring 配置文件及路径 ContextLoaderListener</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置 spring 监听器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置 spring 配置文件的名称及位置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="注册-springmvc-中央调度器"><a href="#注册-springmvc-中央调度器" class="headerlink" title="注册 springmvc 中央调度器"></a>注册 springmvc 中央调度器</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- springmvc 配置 中央调度器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 指定 springmvc 配置文件名称及位置 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-2-完整-web-xml-配置"><a href="#1-2-完整-web-xml-配置" class="headerlink" title="1.2 完整 web.xml 配置"></a>1.2 完整 web.xml 配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>ssm-01-jdbc<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置 spring 监听器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置 spring 配置文件的名称及位置 --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置编码过滤器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="comment">&lt;!-- 必须设置为 true， 否则设置 utf-8 编码无效 --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- springmvc 配置 中央调度器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 指定 springmvc 配置文件名称及位置 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-3-spring-xml-配置"><a href="#1-3-spring-xml-配置" class="headerlink" title="1.3 spring.xml 配置"></a>1.3 spring.xml 配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 注册组件扫描器 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.service"</span>/&gt;</span></span><br><span class="line">     </span><br><span class="line">     <span class="comment">&lt;!-- 加载 jdbc 数据库配置文件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 加载 c3p0 数据源 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span>	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 注册 AccountDaoImpl  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.AccountDaoImpl"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 注册 FundDaoImpl  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"FundDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.FundDaoImpl"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-4-springmvc-xml-配置"><a href="#1-4-springmvc-xml-配置" class="headerlink" title="1.4  springmvc.xml 配置"></a>1.4  springmvc.xml 配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 放行静态资源 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/images/"</span> <span class="attr">mapping</span>=<span class="string">"/images/*"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/js/"</span> <span class="attr">mapping</span>=<span class="string">"/js/*"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 注册组件扫描器 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.handle"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 开启自动注解 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span>    </span><br><span class="line">    <span class="comment">&lt;!-- 开启视图解析器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span> &gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/jsp/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="2-SSM-整合"><a href="#2-SSM-整合" class="headerlink" title="2 SSM 整合"></a>2 SSM 整合</h1><h2 id="2-1-搭建环境"><a href="#2-1-搭建环境" class="headerlink" title="2.1  搭建环境"></a>2.1  搭建环境</h2><h4 id="导入-jar-包"><a href="#导入-jar-包" class="headerlink" title="导入 jar 包"></a>导入 jar 包</h4><p>asm-3.3.1.jar<br>cglib-2.2.2.jar<br>com.springsource.com.mchange.v2.c3p0-0.9.1.2.jar<br>com.springsource.org.aopalliance-1.0.0.jar<br>com.springsource.org.apache.commons.logging-1.1.1.jar<br>com.springsource.org.apache.log4j-1.2.15.jar<br>com.springsource.org.aspectj.weaver-1.6.8.RELEASE.jar<br>commons-logging-1.1.1.jar<br>jackson-annotations-2.5.0.jar<br>jackson-core-2.5.0.jar<br>jackson-databind-2.5.0.jar<br>javassist-3.17.1-GA.jar<br>junit-4.9.jar<br>log4j-1.2.17.jar<br>log4j-api-2.0-rc1.jar<br>log4j-core-2.0-rc1.jar<br>mybatis-3.2.7.jar<br>mybatis-spring-1.2.3.jar<br>mysql-connector-java-5.1.30.jar<br>slf4j-api-1.7.5.jar<br>slf4j-log4j12-1.7.5.jar<br>spring-aop-4.1.6.RELEASE.jar<br>spring-aspects-4.1.6.RELEASE.jar<br>spring-beans-4.1.6.RELEASE.jar<br>spring-context-4.1.6.RELEASE.jar<br>spring-context-support-4.1.6.RELEASE.jar<br>spring-core-4.1.6.RELEASE.jar<br>spring-expression-4.1.6.RELEASE.jar<br>spring-jdbc-4.1.6.RELEASE.jar<br>spring-orm-4.1.6.RELEASE.jar<br>spring-tx-4.1.6.RELEASE.jar<br>spring-web-4.1.6.RELEASE.jar<br>spring-webmvc-4.1.6.RELEASE.jar</p>
<h4 id="修改-spring-xml-配置文件"><a href="#修改-spring-xml-配置文件" class="headerlink" title="修改 spring.xml 配置文件"></a>修改 spring.xml 配置文件</h4><ul>
<li><p>采用 spring 默认数据源 </p>
<p>DriverManagerDataSource</p>
</li>
<li><p>注册 SqlSessionFactoryBean         </p>
<p>sqlsesison 工厂，依赖于数据源</p>
</li>
<li><p>注册 MapperScannerConfigurer  </p>
<p> 获取mapper 代理对象，依赖于sqlSessionFactory  指定basepackage</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 注册组件扫描器 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.service"</span>/&gt;</span></span><br><span class="line">     </span><br><span class="line">     <span class="comment">&lt;!-- 加载 jdbc 数据库配置文件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 加载 c3p0 数据源 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	&lt;bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"&gt;</span></span><br><span class="line"><span class="comment">		&lt;property name="driverClass" value="$&#123;jdbc.driver&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     	&lt;property name="jdbcUrl" value="$&#123;jdbc.url&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     	&lt;property name="user" value="$&#123;jdbc.username&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     	&lt;property name="password" value="$&#123;jdbc.password&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	&lt;/bean&gt;	</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- spring 默认数据源 --&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">	 		</span><br><span class="line">	 		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	 				Property 'driverClassName' threw exception; nested exception is java.lang.IllegalStateException: Could not load JDBC driver class [$&#123;jdbc.driver&#125;]</span></span><br><span class="line"><span class="comment">	 		 --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///test"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	 		&lt;property name="driverClassName" value="$&#123;jdbc.driver&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	 		&lt;property name="url" value="$&#123;jdbc.url&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	 		&lt;property name="username" value="$&#123;jdbc.username&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	 		&lt;property name="password" value="$&#123;jdbc.password&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	 		 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- 注册 Mybatis 中 SqlSessionFactory  --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span>  <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- 指定数据源 --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- 指定 mybatis 配置文件的位置 --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- 获取Mapper 代理对象 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.szxy.mapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="添加-MyBatis-xml-配置文件"><a href="#添加-MyBatis-xml-配置文件" class="headerlink" title="添加 MyBatis.xml  配置文件"></a>添加 MyBatis.xml  配置文件</h4><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">  PUBLIC <span class="string">"-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line">  <span class="string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 设置 M<span class="function"><span class="title">ybatis</span> 对 Log4J 的支持  --&gt;</span></span><br><span class="line">	&lt;settings&gt;</span><br><span class="line">		&lt;setting <span class="keyword">name</span>=<span class="string">"logImpl"</span> value=<span class="string">"LOG4J"</span>/&gt;</span><br><span class="line">	&lt;/settings&gt;</span><br><span class="line">	&lt;!--  设置 <span class="function"><span class="title">pojo</span>类的别名   减少 mapper.xml文件的书写量，不用写包名+类名，直接写类名 --&gt;</span></span><br><span class="line">	&lt;typeAliases&gt;</span><br><span class="line">		&lt;package <span class="keyword">name</span>=<span class="string">"com.szxy.pojo"</span>/&gt;</span><br><span class="line">	&lt;/typeAliases&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 扫描配置文件  --&gt;</span><br><span class="line">	&lt;mappers&gt;</span><br><span class="line">		&lt;package <span class="keyword">name</span>=<span class="string">"com.szxy.mapper"</span>/&gt;</span><br><span class="line">		&lt;!-- &lt;<span class="function"><span class="title">mapper</span> resource="cn/szxy/mapper/StudentMapper.xml"/&gt; --&gt;</span></span><br><span class="line">	&lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h4 id="添加-Mapper-xml-配置文件"><a href="#添加-Mapper-xml-配置文件" class="headerlink" title="添加 **Mapper.xml 配置文件"></a>添加 **Mapper.xml 配置文件</h4><ul>
<li>AccountMappe.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.szxy.mapper.AccountMapper"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	 <span class="comment">&lt;!-- 添加账户信息 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertAccount"</span>&gt;</span></span><br><span class="line">	 		insert into account(acount,money) values(#&#123;aname&#125;,#&#123;balance&#125;)</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateAccount"</span>&gt;</span></span><br><span class="line">	 		update account set money = money - #&#123;balance&#125; where acount = #&#123;aname&#125;</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>FundMapper.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.szxy.mapper.FundMapper"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	&lt;resultMap type="clazz" id="cmap"&gt;</span></span><br><span class="line"><span class="comment">		&lt;id column="cid" property="cid"/&gt;</span></span><br><span class="line"><span class="comment">		&lt;result column="cname" property="cname"/&gt;</span></span><br><span class="line"><span class="comment">		&lt;result column="croom" property="croom"/&gt;</span></span><br><span class="line"><span class="comment">	 	&lt;collection property="students" select="cn.szxy.mapper.StudentMapper.selByCId" column="cid" /&gt;</span></span><br><span class="line"><span class="comment">	&lt;/resultMap&gt;</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	&lt;select id="selAll"&gt;</span></span><br><span class="line"><span class="comment">		select</span></span><br><span class="line"><span class="comment">		c.id cid,c.name cname,c.room croom </span></span><br><span class="line"><span class="comment">	   from t_class c  </span></span><br><span class="line"><span class="comment">	&lt;/select&gt;</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- 添加账户信息 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertFund"</span>&gt;</span></span><br><span class="line">	 		insert into fund(fname,count) values(#&#123;fname&#125;,#&#123;count&#125;)</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateFund"</span>&gt;</span></span><br><span class="line">	 		update fund set count = count + #&#123;count&#125; where fname = #&#123;fname&#125;</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-修改-mybatis-xml-部分文件"><a href="#2-2-修改-mybatis-xml-部分文件" class="headerlink" title="2.2 修改 mybatis.xml 部分文件"></a>2.2 修改 mybatis.xml 部分文件</h2><ul>
<li>mybatis.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 设置 Mybatis 对 Log4J 的支持  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"logImpl"</span> <span class="attr">value</span>=<span class="string">"LOG4J"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--  设置 pojo类的别名   减少 mapper.xml文件的书写量，不用写包名+类名，直接写类名 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	&lt;typeAliases&gt;</span></span><br><span class="line"><span class="comment">		&lt;package name="com.szxy.pojo"/&gt;</span></span><br><span class="line"><span class="comment">	&lt;/typeAliases&gt;</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 扫描配置文件  --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	&lt;mappers&gt;</span></span><br><span class="line"><span class="comment">		&lt;package name="com.szxy.mapper"/&gt;</span></span><br><span class="line"><span class="comment">		&lt;mapper resource="cn/szxy/mapper/StudentMapper.xml"/&gt;</span></span><br><span class="line"><span class="comment">	&lt;/mappers&gt;</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>spring.xml 增加部分</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册 Mybatis 中 SqlSessionFactory  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span>  <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 mybatis 配置文件的位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 替换 mybatis.xml 下的 typeAliases 标签 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliasesPackage"</span> <span class="attr">value</span>=<span class="string">"com.szxy.pojo"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 获取Mapper 代理对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 替换 mybatis.xml 下的 mappers 标签，作用是扫描配置文件  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.szxy.mapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="3-源码分析"><a href="#3-源码分析" class="headerlink" title="3  源码分析"></a>3  源码分析</h1><blockquote>
<p>Eclipse 小技巧：</p>
<p>通过<code>Ctrl+O</code>查看当前类或者 接口的方法</p>
<p> 通过 Ctrl + T 查看当前类或者 接口 继承实现关系</p>
</blockquote>
<h2 id="3-1-ContextLoadListener-类"><a href="#3-1-ContextLoadListener-类" class="headerlink" title="3.1 ContextLoadListener 类"></a>3.1 ContextLoadListener 类</h2><ul>
<li>web.xml </li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	配置 spring 监听器，监听 ServletContext，</span></span><br><span class="line"><span class="comment">	当其初始化时，创建 spring 容器对象，</span></span><br><span class="line"><span class="comment">		并且将 spring</span></span><br><span class="line"><span class="comment"> 	容器对象放入 ServletContext 作用域中</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span></span><br><span class="line">        	org.springframework.web.context.ContextLoaderListener</span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ContextLoader.class 中部分源码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> WebApplicationContext <span class="title">initWebApplicationContext</span><span class="params">(ServletContext servletContext)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (servletContext.getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE) != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">					<span class="string">"Cannot initialize context because there is already a root application context present - "</span> +</span><br><span class="line">					<span class="string">"check whether you have multiple ContextLoader* definitions in your web.xml!"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Log logger = LogFactory.getLog(ContextLoader.class);</span><br><span class="line">		servletContext.log(<span class="string">"Initializing Spring root WebApplicationContext"</span>);</span><br><span class="line">		<span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">			logger.info(<span class="string">"Root WebApplicationContext: initialization started"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// Store context in local instance variable, to guarantee that</span></span><br><span class="line">			<span class="comment">// it is available on ServletContext shutdown.</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>.context == <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">this</span>.context = createWebApplicationContext(servletContext);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>.context <span class="keyword">instanceof</span> ConfigurableWebApplicationContext) &#123;</span><br><span class="line">				ConfigurableWebApplicationContext cwac = (ConfigurableWebApplicationContext) <span class="keyword">this</span>.context;</span><br><span class="line">				<span class="keyword">if</span> (!cwac.isActive()) &#123;</span><br><span class="line">					<span class="comment">// The context has not yet been refreshed -&gt; provide services such as</span></span><br><span class="line">					<span class="comment">// setting the parent context, setting the application context id, etc</span></span><br><span class="line">					<span class="keyword">if</span> (cwac.getParent() == <span class="keyword">null</span>) &#123;</span><br><span class="line">						<span class="comment">// The context instance was injected without an explicit parent -&gt;</span></span><br><span class="line">						<span class="comment">// determine parent for root web application context, if any.</span></span><br><span class="line">						ApplicationContext parent = loadParentContext(servletContext);</span><br><span class="line">						cwac.setParent(parent);</span><br><span class="line">					&#125;</span><br><span class="line">					configureAndRefreshWebApplicationContext(cwac, servletContext);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, <span class="keyword">this</span>.context);</span><br></pre></td></tr></table></figure>

<p>ContextLoadListener  类继承了 ContextLoader 类并且实现了 ServletContextListener 接口。</p>
<p>当 ServletContext 应用 application 上下文创建时，监听 ServletContext初始化</p>
<p>调用 public void contextInitialized(ServletContextEvent event) 方法</p>
<p>再在该 contextInitialized 方法 调用父类 ContextLoader 中</p>
<p> initWebApplicationContext(ServletContext servletContext)  方法</p>
<p>为spring 容器初始化，然后放入 Servletcontext 中。</p>
<h2 id="3-2-DriverManagerDataSource-类"><a href="#3-2-DriverManagerDataSource-类" class="headerlink" title="3.2 DriverManagerDataSource 类"></a>3.2 DriverManagerDataSource 类</h2><ul>
<li>spring.xml 部分 </li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">      Property 'driverClassName' threw exception; nested exception is java.lang.IllegalStateException: Could not load JDBC driver class [$&#123;jdbc.driver&#125;]</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///test"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    &lt;property name="driverClassName" value="$&#123;jdbc.driver&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">    &lt;property name="url" value="$&#123;jdbc.url&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">    &lt;property name="username" value="$&#123;jdbc.username&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">    &lt;property name="password" value="$&#123;jdbc.password&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>DriverManagerDataSource  类继承了 AbstractDriverBasedDataSource  父类</p>
<p>在 DriverManagerDataSource  类中可以找到 </p>
<p>public void setDriverClassName(String driverClassName) 方法，</p>
<p>用于 spring 通过设值注入到 属性 driverClassName 。 </p>
<p>在它父类 AbstractDriverBasedDataSource    类中，有 属性 url、username、password</p>
<p>并提供了 setter 方法。</p>
<h2 id="3-3-SqlSessionFactoryBean-与-MapperScannerConfigurer"><a href="#3-3-SqlSessionFactoryBean-与-MapperScannerConfigurer" class="headerlink" title="3.3  SqlSessionFactoryBean 与  MapperScannerConfigurer"></a>3.3  SqlSessionFactoryBean 与  MapperScannerConfigurer</h2><blockquote>
<p>配置属性通过到源码中找到对应  setter 方法即可。</p>
</blockquote>
<ul>
<li>spring.xml 配置文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册 Mybatis 中 SqlSessionFactory  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span>  <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 mybatis 配置文件的位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 获取Mapper 代理对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.szxy.mapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="BUG"><a href="#BUG" class="headerlink" title="BUG"></a>BUG</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">      Property 'driverClassName' threw exception; nested exception is java.lang.IllegalStateException: Could not load JDBC driver class [$&#123;jdbc.driver&#125;]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">       上述出错的原因是 ： 		</span></span><br><span class="line"><span class="comment">       之前的用过这个 sqlSessionFactory ，报错</span></span><br><span class="line"><span class="comment">       &lt;property name="sqlSessionFactory" ref="sqlSessionFactory"&gt;&lt;/property&gt; </span></span><br><span class="line"><span class="comment">        改用 sqlSessionFactoryBeanName 就可以使用配置文件 db.properties </span></span><br><span class="line"><span class="comment">       &lt;property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">    &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">    &lt;property name="url" value="jdbc:mysql:///test"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">    &lt;property name="username" value="root"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">    &lt;property name="password" value="root"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/08/20190508 SpringMVC 框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/08/20190508 SpringMVC 框架/" class="post-title-link" itemprop="url">20190508 SpringMVC 框架</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-08 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-08T00:00:00+08:00">2019-05-08</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-10 11:59:48" itemprop="dateModified" datetime="2019-05-10T11:59:48+08:00">2019-05-10</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Spring-MVC-概念"><a href="#1-Spring-MVC-概念" class="headerlink" title="1 Spring MVC 概念"></a>1 Spring MVC 概念</h1><blockquote>
<p>SpringMVC 是 Spring 框架中一部分（子框架），是实现对 Servlet 技术进行封装。</p>
</blockquote>
<h2 id="1-1-MVC-介绍"><a href="#1-1-MVC-介绍" class="headerlink" title="1.1 MVC 介绍"></a>1.1 MVC 介绍</h2><p>MVC 全名是 Model View Controller  ，是模型 视图 控制的缩写，是一种软件设计典范，是一种软件架构设计分层模式</p>
<p>Model 模型 是应用程序中用于<strong>处理数据</strong>逻辑部分‘</p>
<p>View 视图 是应用程序<strong>处理数据</strong>显示的部分’</p>
<p>Controller 控制器 是应用程序处理<strong>用户交互</strong>的部分‘</p>
<p>例子： JSP + Servlet + Bean   分层开发</p>
<h2 id="1-2-SpringMVC-运行原理"><a href="#1-2-SpringMVC-运行原理" class="headerlink" title="1.2 SpringMVC 运行原理"></a>1.2 SpringMVC 运行原理</h2><p>Dispatherservlet  中央控制器</p>
<h2 id="1-3-第一个SpringMVC-项目"><a href="#1-3-第一个SpringMVC-项目" class="headerlink" title="1.3 第一个SpringMVC 项目"></a>1.3 第一个SpringMVC 项目</h2><ol>
<li><p>新建JavaWeb 工程 ，导入 jar包 </p>
<p>com.springsource.com.mchange.v2.c3p0-0.9.1.2.jar<br>com.springsource.org.aopalliance-1.0.0.jar<br>com.springsource.org.apache.commons.logging-1.1.1.jar<br>com.springsource.org.apache.log4j-1.2.15.jar<br>com.springsource.org.aspectj.weaver-1.6.8.RELEASE.jar<br>junit-4.9.jar<br>mysql-connector-java-5.1.30.jar<br>spring-aop-4.1.6.RELEASE.jar<br>spring-aspects-4.1.6.RELEASE.jar<br>spring-beans-4.1.6.RELEASE.jar<br>spring-context-4.1.6.RELEASE.jar<br>spring-context-support-4.1.6.RELEASE.jar<br>spring-core-4.1.6.RELEASE.jar<br>spring-expression-4.1.6.RELEASE.jar<br>spring-jdbc-4.1.6.RELEASE.jar<br>spring-tx-4.1.6.RELEASE.jar<br>spring-web-4.1.6.RELEASE.jar<br>spring-webmvc-4.1.6.RELEASE.jar</p>
</li>
</ol>
<ol start="2">
<li><p>编写 web.xml ，配置中央调度器</p>
<p>注意：配置中央调度器中 springmvc.xml 文件的配置</p>
</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;web-app xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> xmlns=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> xsi:schemaLocation=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> id=<span class="string">"WebApp_ID"</span> version=<span class="string">"3.0"</span>&gt;</span><br><span class="line"></span><br><span class="line">	  &lt;!-- 配置 SpringMVC 中央控制器 --&gt;</span><br><span class="line">	  &lt;servlet&gt;</span><br><span class="line">	  		&lt;servlet-name&gt;SpringMVC&lt;/servlet-name&gt;</span><br><span class="line">	  	 	&lt;servlet-<span class="class"><span class="keyword">class</span>&gt;<span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">servlet</span>.<span class="title">DispatcherServlet</span>&lt;/<span class="title">servlet</span>-<span class="title">class</span>&gt;</span></span><br><span class="line"><span class="class">	  	 	&lt;!-- 配置<span class="title">SpringMVC</span>.<span class="title">xml</span> 的位置及名称 --&gt;</span></span><br><span class="line"><span class="class">	  	 	&lt;<span class="title">init</span>-<span class="title">param</span>&gt;</span></span><br><span class="line"><span class="class">	  	 		&lt;<span class="title">param</span>-<span class="title">name</span>&gt;<span class="title">contextConfigLocation</span>&lt;/<span class="title">param</span>-<span class="title">name</span>&gt;</span></span><br><span class="line">	  	 		&lt;param-value&gt;classpath:SpringMVC.xml&lt;/param-value&gt;</span><br><span class="line">	  	 	&lt;/init-param&gt;</span><br><span class="line">	  &lt;/servlet&gt;</span><br><span class="line">	  &lt;servlet-mapping&gt;</span><br><span class="line">	  		&lt;servlet-name&gt;SpringMVC&lt;/servlet-name&gt;</span><br><span class="line">	  		&lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">	  &lt;/servlet-mapping&gt;</span><br><span class="line">	  </span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>编写 后台控制器</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.Controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> <span class="keyword">implements</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleRequest</span><span class="params">(HttpServletRequest req,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse resp)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">			<span class="comment">//创建 ModelAndView 对象</span></span><br><span class="line">			ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">			<span class="comment">//添加响应信息</span></span><br><span class="line">			mv.addObject(<span class="string">"msg"</span>, <span class="string">"HelloWorld"</span>);</span><br><span class="line">			<span class="comment">//设置逻辑视图</span></span><br><span class="line">			mv.setViewName(<span class="string">"/jsp/index.jsp"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>编写  springmvc.xml 中注册 bean</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 注册 MyController --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"/*.do"</span> <span class="attr">class</span>=<span class="string">"com.szxy.controller.MyController"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>编写 jsp </li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>My JSP 'index.jsp' starting page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"pragma"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"cache-control"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"expires"</span> <span class="attr">content</span>=<span class="string">"0"</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"keywords"</span> <span class="attr">content</span>=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">"This is my page"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	&lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    	$&#123;msg&#125;  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-4-web-xml-中urlpathern-问题"><a href="#1-4-web-xml-中urlpathern-问题" class="headerlink" title="1.4  web.xml 中urlpathern 问题"></a>1.4  web.xml 中urlpathern 问题</h2><ul>
<li><p>配置 / 与 配置 /* 的区别</p>
<p>/ 拦截某个路径下的所有资源</p>
<p>/* 拦截所有资源包括静态资源</p>
</li>
<li><p>静态资源无法访问的问题</p>
</li>
</ul>
<ol>
<li>第一种解决方案</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	  <span class="comment">&lt;!-- 第一种解决方案 --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.png<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>		</span><br><span class="line">	  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.js<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>		</span><br><span class="line">	  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.css<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>		</span><br><span class="line">		</span><br><span class="line">	  <span class="comment">&lt;!-- 配置 SpringMVC 中央控制器 --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	  	 	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">	  	 	<span class="comment">&lt;!-- 配置SpringMVC.xml 的位置及名称 --&gt;</span></span><br><span class="line">	  	 	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">	  	 		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">	  	 		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:SpringMVC.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	  	 	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	  </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>第二种解决方案</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	第二种 解决方案 </span></span><br><span class="line"><span class="comment">	在 springmvc.xml 文件中添加下面的标签 	</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>第三种解决方案</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第三种 解决方案 </span></span><br><span class="line"><span class="comment">	 在springmvc.xml 文件指定静态的位置及映射</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/images/"</span> <span class="attr">mapping</span>=<span class="string">"/images/**"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="2-SpringMVC-注解开发"><a href="#2-SpringMVC-注解开发" class="headerlink" title="2  SpringMVC 注解开发"></a>2  SpringMVC 注解开发</h1><h2 id="2-1-搭建环境"><a href="#2-1-搭建环境" class="headerlink" title="2.1 搭建环境"></a>2.1 搭建环境</h2><p>后台控制器不需要实现 Ctroller 接口，添加相应的注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//访问路径  http://localhost:8080/mvc/springmvc/hander</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  使用注解后台控制器</span></span><br><span class="line"><span class="comment"> *	不需要实现 Contrller 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span>  	<span class="comment">//将该后台控制器交给 spring 容器管理</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/springmvc"</span>)   <span class="comment">//指定命令空间</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/hander"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleRequest</span><span class="params">(HttpServletRequest req,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse resp)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">			<span class="comment">//创建 ModelAndView 对象</span></span><br><span class="line">			ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">			<span class="comment">//添加响应信息</span></span><br><span class="line">			mv.addObject(<span class="string">"msg"</span>, <span class="string">"HelloWorld"</span>);</span><br><span class="line">			<span class="comment">//设置逻辑视图</span></span><br><span class="line">			mv.setViewName(<span class="string">"/jsp/index.jsp"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 配置 springmvc.xml 文档</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 开启组件扫描器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 开启注解驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-视图解析器"><a href="#2-2-视图解析器" class="headerlink" title="2.2   视图解析器"></a>2.2   视图解析器</h2><ul>
<li>springmvc.xml 配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 开启组件扫描器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 开启注解驱动 </span></span><br><span class="line"><span class="comment">    	 自动注册 适配器、处理器</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span>  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 注册视图解析器</span></span><br><span class="line"><span class="comment">    	 由 springmvc 调用，故不需要 设置 id 属性</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> 	<span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/jsp/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>后台控制器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  使用注解后台控制器</span></span><br><span class="line"><span class="comment"> *	不需要实现 Contrller 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span>  	<span class="comment">//将该后台控制器交给 spring 容器管理</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/springmvc"</span>)   <span class="comment">//指定命令空间</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/hander"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-处理器方法常用的方法参数"><a href="#2-3-处理器方法常用的方法参数" class="headerlink" title="2.3 处理器方法常用的方法参数"></a>2.3 处理器方法常用的方法参数</h2><ul>
<li>HttpServletRequest</li>
<li>HttpServletResponse</li>
<li>HttpSession</li>
<li>用于承载数据的Model 、Map、ModelMap</li>
<li>请求中携带的参数</li>
</ul>
<h2 id="2-4-接受请求参数"><a href="#2-4-接受请求参数" class="headerlink" title="2.4 接受请求参数"></a>2.4 接受请求参数</h2><ul>
<li><h4 id="逐个接受请求参数"><a href="#逐个接受请求参数" class="headerlink" title="逐个接受请求参数"></a>逐个接受请求参数</h4><p>@RequestParam  在方法名前使用</p>
<p>应用场景：表示当表单属性名与方法参数名不一致的和接受集合方式的数据</p>
</li>
<li><h4 id="使用对象整体接受"><a href="#使用对象整体接受" class="headerlink" title="使用对象整体接受"></a>使用对象整体接受</h4><p>注意：对象属性名与表单属性名一致。</p>
</li>
<li><h4 id="以域属性接受（也就是属性对象）"><a href="#以域属性接受（也就是属性对象）" class="headerlink" title="以域属性接受（也就是属性对象）"></a>以域属性接受（也就是属性对象）</h4><p>注意：表单中域属性的属性名填写方式 对象名.属性名 pattern.name</p>
</li>
<li><h4 id="数组或集合的接受-PathVaiable"><a href="#数组或集合的接受-PathVaiable" class="headerlink" title="数组或集合的接受 @PathVaiable"></a>数组或集合的接受 @PathVaiable</h4><p>注意：以集合形式接受数据 (@RequestParam List<string>  arr)</string></p>
</li>
<li><h4 id="restful-风格传参-PathVaiable"><a href="#restful-风格传参-PathVaiable" class="headerlink" title="restful 风格传参  @PathVaiable"></a>restful 风格传参  @PathVaiable</h4><p>(地址栏路径上带有参数 /hello/zhangsan/3）</p>
<p>RequestMapping(“/hello/{name}/{age}”)</p>
<p>注意: 在控制器方法名参数名前加上 @PathVaiable</p>
</li>
<li><h4 id="接受-json-格式字符串-RequestBody"><a href="#接受-json-格式字符串-RequestBody" class="headerlink" title="接受 json 格式字符串 @RequestBody"></a>接受 json 格式字符串 @RequestBody</h4><p>pathContext.request.contextPath</p>
<p>contentType: application/json</p>
<p>JSON.stringify()   //将 json对象转为 json字符串</p>
<p>注意：要导入 json jar 包</p>
<p>jackson-annotations-2.5.0.jar<br>jackson-core-2.5.0.jar<br>jackson-databind-2.5.0.jar</p>
</li>
<li><h4 id="获取请求头的参数-RequestHeader"><a href="#获取请求头的参数-RequestHeader" class="headerlink" title="获取请求头的参数 @RequestHeader"></a>获取请求头的参数 @RequestHeader</h4></li>
</ul>
<ul>
<li>测试类-控制器</li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestHeader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.Star;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *	接受请求数据</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/mvc"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReceviceDataFormRequest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//逐个接受请求参数</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata0"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">getFormData0</span><span class="params">(String uname,<span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建 ModelAndView 对象</span></span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//添加响应信息</span></span><br><span class="line">		mv.addObject(<span class="string">"uname"</span>, uname);</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,age);</span><br><span class="line">		mv.setViewName(<span class="string">"showData"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//逐个接受请求参数2</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata1"</span>)    <span class="comment">//更正接受参数名称</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">getFormData1</span><span class="params">(@RequestParam(<span class="string">"uname"</span>)</span>String username,<span class="keyword">int</span> age)</span>&#123;</span><br><span class="line">		<span class="comment">//创建 ModelAndView 对象</span></span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//添加响应信息</span></span><br><span class="line">		mv.addObject(<span class="string">"uname"</span>, username);</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,age);</span><br><span class="line">		mv.setViewName(<span class="string">"showData"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//通过对象整体接受</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata2"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">getFormData2</span><span class="params">(Star star)</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建 ModelAndView 对象</span></span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//添加响应信息</span></span><br><span class="line">		mv.addObject(<span class="string">"uname"</span>, star.getUname());</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,star.getAge());</span><br><span class="line">		mv.setViewName(<span class="string">"showData"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//接受域属性数据</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata3"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">getFormData3</span><span class="params">(Star star)</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建 ModelAndView 对象</span></span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//添加响应信息</span></span><br><span class="line">		mv.addObject(<span class="string">"uname"</span>, star.getUname());</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,star.getAge());</span><br><span class="line">		mv.addObject(<span class="string">"pattern"</span>,star.getPattern().getName());</span><br><span class="line">		mv.setViewName(<span class="string">"showData"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//接受数组数据</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata4"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFormData4</span><span class="params">(String[] hobbys)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (String str : hobbys) &#123;</span><br><span class="line">			System.out.println(str);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//以集合方式接受多条数据</span></span><br><span class="line">	<span class="comment">//注意：使用集合</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata5"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFormData5</span><span class="params">(@RequestParam List&lt;String&gt; hobbys)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (String str : hobbys) &#123;</span><br><span class="line">			System.out.println(str);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//接受 restful 风格的数据  </span></span><br><span class="line">	<span class="comment">// /getFormData6/zhangsan/12</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata6/&#123;uname&#125;/&#123;age&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFormData6</span><span class="params">(@PathVariable String uname,@PathVariable <span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(uname+<span class="string">"\t"</span>+age);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//接受 json 格式字符串数据</span></span><br><span class="line">	<span class="comment">//注意：要导入 json jar包，不然包 415 服务器不能处理该类型的请求</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata7"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFormData7</span><span class="params">(@RequestBody Star star)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(star.getUname()+<span class="string">"\t"</span>+star.getAge());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 获取请求头信息</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata8"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFormData8</span><span class="params">(@RequestHeader String host,@RequestHeader  String cookie)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(host+<span class="string">"\t"</span>+cookie);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>发送 ajax 请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery-1.7.2.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#btn"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="comment">// json 对象</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> varJson = &#123;</span></span><br><span class="line"><span class="javascript">						uname:<span class="string">"zhangsan"</span>,</span></span><br><span class="line">						age:31</span><br><span class="line">				&#125;;</span><br><span class="line">				</span><br><span class="line"><span class="javascript">				$.ajax(&#123;</span></span><br><span class="line"><span class="javascript">					url:<span class="string">"mvc/formdata7"</span>,</span></span><br><span class="line"><span class="javascript">					type:<span class="string">"POST"</span>,</span></span><br><span class="line"><span class="javascript">					contentType:<span class="string">"application/json"</span>, <span class="comment">//以 json格式发送请求</span></span></span><br><span class="line"><span class="javascript">					data:<span class="built_in">JSON</span>.stringify(varJson)  <span class="comment">//将 json 对象转为 json格式的字符串</span></span></span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h2 id="2-5-处理器方法返回值"><a href="#2-5-处理器方法返回值" class="headerlink" title="2.5 处理器方法返回值"></a>2.5 处理器方法返回值</h2><ul>
<li>ModelAndView  承载数据和跳转视图资源</li>
<li>String 返回值类型  </li>
<li>void 无返回值类型</li>
<li>Object  Object 返回值类型</li>
</ul>
<h4 id="String-类型返回值"><a href="#String-类型返回值" class="headerlink" title="String 类型返回值"></a>String 类型返回值</h4><ul>
<li>使用 Model 、 Map 、ModelMap 承载数据</li>
<li>直接返回 json 字符串，添加注解@ReponseBody</li>
</ul>
<h4 id="Obejct-类型返回值"><a href="#Obejct-类型返回值" class="headerlink" title="Obejct 类型返回值"></a>Obejct 类型返回值</h4><ul>
<li>注解@ResponseBody</li>
<li>注册 springmvc 驱动 </li>
<li>导入 jackson 包</li>
</ul>
<h4 id="解决中文乱码问题"><a href="#解决中文乱码问题" class="headerlink" title="解决中文乱码问题"></a>解决中文乱码问题</h4><p>​    在 @RequestMapping 注解中添加 produces = “text/html;charset=utf-8”</p>
<p>​    同时在方法前添加注解@ResponseBody</p>
<h4 id="ResponseBody-注解作用"><a href="#ResponseBody-注解作用" class="headerlink" title="@ResponseBody 注解作用"></a>@ResponseBody 注解作用</h4><ul>
<li><p>将当前方法的返回值放到响应体中，并转成 json 格式</p>
</li>
<li><p>接受 json 格式的字符串，将该注解放在方法名参数前</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.ModelMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/return"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReturningToView</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//使用 Model 、 Map 、 ModelMap 承载数据</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/sendData1"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String  <span class="title">sendData</span><span class="params">(String username,<span class="keyword">int</span> age,Model model,Map&lt;String,Integer&gt; map,ModelMap modelMap)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">			<span class="comment">//承载数据 </span></span><br><span class="line">			model.addAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">			map.put(<span class="string">"age"</span>, age);</span><br><span class="line">			modelMap.addAttribute(<span class="string">"age1"</span>, age);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"showData"</span>;  <span class="comment">//只写视图即可，前缀和后缀由视图解析器完成</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//返回 json格式字符串</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/sendData2"</span>,produces=<span class="string">"text/html;charset=utf-8"</span>) <span class="comment">//解决响应中文乱码问题</span></span><br><span class="line">	<span class="meta">@ResponseBody</span>      <span class="comment">//作用：将当前方法的返回值放到响应体中，并转成 json 格式</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String  <span class="title">sendData2</span><span class="params">()</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"&#123;china:中国&#125;"</span>; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// void 返回类型    </span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/sendData3"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendData3</span><span class="params">(HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		resp.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		String json = <span class="string">"&#123;\"name\":\"张三\",\"age\":32&#125;"</span>;</span><br><span class="line">		resp.getWriter().print(json);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/sendData4"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span>   <span class="comment">//作用：将当前方法的返回值放到响应体中，并转成 json 格式</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">sendData4</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"aaa"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-6-请求转发与重定向"><a href="#2-6-请求转发与重定向" class="headerlink" title="2.6 请求转发与重定向"></a>2.6 请求转发与重定向</h2><h4 id="请求转发（服务内部跳转）"><a href="#请求转发（服务内部跳转）" class="headerlink" title="请求转发（服务内部跳转）"></a>请求转发（服务内部跳转）</h4><p>springmvc 默认使用请求转发</p>
<ul>
<li>请求转发到视图</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setViewName(<span class="string">"逻辑视图名"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>请求转发给处理器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">"forward:***.do"</span>;</span><br></pre></td></tr></table></figure>

<h4 id="重定向（服务器外部跳转）"><a href="#重定向（服务器外部跳转）" class="headerlink" title="重定向（服务器外部跳转）"></a>重定向（服务器外部跳转）</h4><ul>
<li>重定向到视图</li>
</ul>
<p>springmvc 使用重定向，会将默认会将数据通过地址栏的方式传递物理视图</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setViewName(<span class="string">"redirct:逻辑视图名"</span>)</span><br><span class="line"><span class="comment">//http://localhost:8080/mvc/jsp/showData.jsp?username=张三&amp;age=123</span></span><br><span class="line"><span class="comment">//获取地址栏中的数据  </span></span><br><span class="line"><span class="comment">//$&#123;param.username&#125;---$&#123;param.age&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>重定向到处理器</li>
</ul>
<p>注意：<strong>前面不需要加斜杠</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setViewName(<span class="string">"redirct:处理器方法请求路径"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/redirect"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedirctController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//请求转发到视图页面中</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/helloWord"</span>,produces=<span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testDispather</span><span class="params">(String username,<span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//承载数据</span></span><br><span class="line">		mv.addObject(<span class="string">"username"</span>, username);</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,age);</span><br><span class="line">		<span class="comment">//采用默认的请求转发</span></span><br><span class="line">		mv.setViewName(<span class="string">"showData"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/helloWord4"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testDispather2</span><span class="params">(String username,<span class="keyword">int</span> age,Map&lt;String,Object&gt; map)</span></span>&#123;</span><br><span class="line">		map.put(<span class="string">"username"</span>, username);</span><br><span class="line">		map.put(<span class="string">"age"</span>, age);</span><br><span class="line">		System.out.println(map);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"forward:helloWorld5.do"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/helloWord5.do"</span>,produces=<span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDispather3</span><span class="params">(String username,<span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			System.out.println(username+<span class="string">"\t"</span>+age);</span><br><span class="line">			</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//重定向到视图页面</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/helloWord2"</span>,produces=<span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testRedirect</span><span class="params">(String username,<span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//承载数据</span></span><br><span class="line">		mv.addObject(<span class="string">"username"</span>, username);</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,age);</span><br><span class="line">		<span class="comment">//采用重定向</span></span><br><span class="line">		mv.setViewName(<span class="string">"redirect:/jsp/showData.jsp"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 重定向另一个处理器</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/helloWord3"</span>,produces=<span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testRedirect2</span><span class="params">(String username,<span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//承载数据</span></span><br><span class="line">		mv.addObject(<span class="string">"username"</span>, username);</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,age);</span><br><span class="line">		<span class="comment">//采用重定向，到另一个处理器中</span></span><br><span class="line">		mv.setViewName(<span class="string">"redirect:helloWord"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-7-文件上传"><a href="#2-7-文件上传" class="headerlink" title="2.7 文件上传"></a>2.7 文件上传</h2><p>要求：</p>
<ul>
<li><p>注册 mvc 注解驱动</p>
</li>
<li><p><strong>文件上传解析器</strong>-   </p>
<p>CommonsoMultipartRes</p>
</li>
<li><p>导入相关 jar 包</p>
<p>com.springsource.org.apache.commons.fileupload-1.2.0.jar<br>com.springsource.org.apache.commons.io-1.4.0.jar</p>
</li>
</ul>
<h4 id="form-表单修改上传类型"><a href="#form-表单修改上传类型" class="headerlink" title="form 表单修改上传类型"></a>form 表单修改上传类型</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"file/fileUpload"</span> <span class="attr">method</span>=<span class="string">"post"</span>  <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> &gt;</span></span><br><span class="line">    图片<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span>  <span class="attr">name</span>=<span class="string">"img"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>  <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="后台控制器-—上传文件"><a href="#后台控制器-—上传文件" class="headerlink" title="后台控制器 —上传文件"></a>后台控制器 —上传文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/file"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUploadController</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//单文件上传</span></span><br><span class="line">		<span class="meta">@RequestMapping</span>(value=<span class="string">"/fileUpload"</span>,method= RequestMethod.POST)</span><br><span class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">fileUploadOne</span><span class="params">(MultipartFile img,Model model)</span></span>&#123;</span><br><span class="line">			<span class="comment">//指定文件上传路径</span></span><br><span class="line">			String path = <span class="string">"E:/"</span>;  <span class="comment">//这里是服务器目录下</span></span><br><span class="line">			<span class="comment">//获取文件上传名,中文处理在 springmvc.xml 的文件上传解析器修改默认编码</span></span><br><span class="line">			String fileName = img.getOriginalFilename();</span><br><span class="line">			<span class="comment">//上传文件</span></span><br><span class="line">			File file = <span class="keyword">new</span> File(path,fileName);</span><br><span class="line">			<span class="comment">//上传文件到服务器中 </span></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				img.transferTo(file);</span><br><span class="line">				model.addAttribute(<span class="string">"fileName"</span>, fileName);</span><br><span class="line">				model.addAttribute(<span class="string">"flag"</span>, <span class="string">"上传成功"</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">				model.addAttribute(<span class="string">"flag"</span>, <span class="string">"上传失败"</span>);</span><br><span class="line">			&#125; </span><br><span class="line">			<span class="comment">//返回视图界面</span></span><br><span class="line">			<span class="keyword">return</span> <span class="string">"showData"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//多文件上传</span></span><br><span class="line">		<span class="comment">//多文件上传，需采用 @RequestParam 自动修正参数</span></span><br><span class="line">		<span class="meta">@RequestMapping</span>(value=<span class="string">"/fileUpload2"</span>,method= RequestMethod.POST)</span><br><span class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">fileUploadMany</span><span class="params">(@RequestParam MultipartFile imgs[],Model model,HttpSession session)</span></span>&#123;</span><br><span class="line">			<span class="comment">//获取服务器上下文，找到 images 目录</span></span><br><span class="line">			String path = session.getServletContext().getRealPath(<span class="string">"/images"</span>);</span><br><span class="line">			System.out.println(<span class="string">"path="</span>+path);</span><br><span class="line">			<span class="comment">//存储数据</span></span><br><span class="line">			Map&lt;String,String&gt;  map = <span class="keyword">new</span> HashMap&lt;String,String&gt;(); </span><br><span class="line">			<span class="comment">//遍历文件</span></span><br><span class="line">			<span class="keyword">for</span> (MultipartFile img : imgs) &#123;</span><br><span class="line">				<span class="comment">//获取文件上传名,中文处理在 springmvc.xml 的文件上传解析器修改默认编码</span></span><br><span class="line">				String fileName = img.getOriginalFilename();</span><br><span class="line">				<span class="comment">//上传文件</span></span><br><span class="line">				File file = <span class="keyword">new</span> File(path,fileName);</span><br><span class="line">				<span class="comment">//上传文件到服务器中 </span></span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					img.transferTo(file);</span><br><span class="line">					map.put(<span class="string">"flag"</span>, <span class="string">"成功"</span>);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">					map.put(<span class="string">"flag"</span>, <span class="string">"失败"</span>);</span><br><span class="line">				&#125; </span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//Map 添加到 model 中</span></span><br><span class="line">			model.addAllAttributes(map);</span><br><span class="line">			<span class="comment">//返回视图界面</span></span><br><span class="line">			<span class="keyword">return</span> <span class="string">"showData"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注册文件上传解析器"><a href="#注册文件上传解析器" class="headerlink" title="注册文件上传解析器"></a>注册文件上传解析器</h4><p>​    注意：文件上传解析器的 id 属性是由 DispatherServlet 中获取的。</p>
<p>​    因为文件上传解析器是由中央调度器 DispatherServlet 控制的  </p>
<p>​    记住：文件上传解析器的类名  CommonsMultipartResolver</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 注册文件上传解析器 --&gt;</span><br><span class="line"> &lt;bean id=<span class="string">"multipartResolver"</span>  </span><br><span class="line">    <span class="class"><span class="keyword">class</span></span>=<span class="string">" org.springframework.web.multipart.commons.CommonsMultipartResolver"</span> &gt;</span><br></pre></td></tr></table></figure>

<h4 id="解决上传文件中文名乱码"><a href="#解决上传文件中文名乱码" class="headerlink" title="解决上传文件中文名乱码"></a>解决上传文件中文名乱码</h4><p>​    在 springmvc.xml 中的文件上传解析器中，添加属性 defaultEncoding 为 utf-8</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册文件上传解析器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span>  </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">" org.springframework.web.multipart.commons.CommonsMultipartResolver"</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 处理中文乱码问题 --&gt;</span>	 </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"utf-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="上传文件路径问题"><a href="#上传文件路径问题" class="headerlink" title="上传文件路径问题"></a>上传文件路径问题</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取服务器上下文，找到 images 目录</span></span><br><span class="line">String path = session.getServletContext().getRealPath(<span class="string">"/images"</span>);</span><br></pre></td></tr></table></figure>

<h4 id="多文件上传参数问题"><a href="#多文件上传参数问题" class="headerlink" title="多文件上传参数问题"></a>多文件上传参数问题</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP Status 500 - Request processing failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [[Lorg.springframework.web.multipart.MultipartFile;]: No default constructor found; nested exception is java.lang.NoSuchMethodException: [Lorg.springframework.web.multipart.MultipartFile;.&lt;init&gt;()</span><br></pre></td></tr></table></figure>

<p>解决：</p>
<p>​    添加方法参数类型前添加注解 @RequestParam ，自动修正参数</p>
<p>​    <code>public String fileUploadMany(@RequestParam MultipartFile imgs[];</code></p>
<h2 id="2-8-文件下载"><a href="#2-8-文件下载" class="headerlink" title="2.8  文件下载"></a>2.8  文件下载</h2><ul>
<li>使用返回值类型 ReponseEntity&lt;byte[]&gt;</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.HttpStatusCodeException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/fileDownload"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileDownLoadController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/download"</span>)</span><br><span class="line">	<span class="keyword">public</span> ResponseEntity&lt;<span class="keyword">byte</span>[]&gt; downloadFile(HttpSession session) <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">		<span class="comment">//要下载文件路径</span></span><br><span class="line">		String path = session.getServletContext().getRealPath(<span class="string">"/images"</span>);</span><br><span class="line">		<span class="comment">/*	String path = "d:/ab小情歌.jpg";*/</span></span><br><span class="line">		<span class="comment">//要下载文件对象</span></span><br><span class="line">		File file = <span class="keyword">new</span> File(path,<span class="string">"ab.png"</span>);</span><br><span class="line">		<span class="comment">//获取文件输入流对象</span></span><br><span class="line">		InputStream is = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">		<span class="comment">//创建字节数组，数组大小根据  is 对象可用字节数指定</span></span><br><span class="line">		<span class="keyword">byte</span>[] body = <span class="keyword">new</span> <span class="keyword">byte</span>[is.available()];</span><br><span class="line">		<span class="comment">//将文件读字节数组</span></span><br><span class="line">		is.read(body);</span><br><span class="line">		<span class="comment">//添加响应信息</span></span><br><span class="line">		HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">		<span class="comment">//解决文件名文件乱码问题</span></span><br><span class="line">		String fileName = file.getName();</span><br><span class="line">		String fileDownloadName = <span class="keyword">new</span> String(fileName.getBytes(<span class="string">"utf-8"</span>),<span class="string">"iso-8859-1"</span>);</span><br><span class="line">		<span class="comment">//以附件的形式发送给浏览器，并指定下载名称</span></span><br><span class="line">		headers.add(<span class="string">"Content-Disposition"</span>, <span class="string">"attatchment;filename="</span>+fileDownloadName);</span><br><span class="line">		<span class="comment">//设置响应状态码</span></span><br><span class="line">		HttpStatus statusCode = HttpStatus.OK;  <span class="comment">//200  浏览器正常访问</span></span><br><span class="line">		</span><br><span class="line">		ResponseEntity&lt;<span class="keyword">byte</span>[]&gt; responseEntity = </span><br><span class="line">				<span class="keyword">new</span> ResponseEntity&lt;<span class="keyword">byte</span>[]&gt;(body, headers, statusCode);</span><br><span class="line">				</span><br><span class="line">		<span class="keyword">return</span> responseEntity;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-9-自定义拦截器"><a href="#2-9-自定义拦截器" class="headerlink" title="2.9 自定义拦截器"></a>2.9 自定义拦截器</h2><p>要求：</p>
<ul>
<li>实现 HandleInterceptor 接口 </li>
<li>注册拦截器  <code>&lt;mvc:interceptores&gt;</code></li>
</ul>
<p>拦截情况</p>
<ul>
<li>拦截所有请求</li>
<li>拦截特定请求路径</li>
<li>放行请求路径</li>
<li>使用多个拦截器拦截的顺序</li>
</ul>
<h4 id="后台拦截器"><a href="#后台拦截器" class="headerlink" title="后台拦截器"></a>后台拦截器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.intercetor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstInterceptor</span> <span class="keyword">implements</span>  <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//在服务器响应给浏览器数据之前拦截</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest arg0,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse arg1, Object arg2, Exception arg3)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">			System.out.println(<span class="string">"FirstInterceptor.afterCompletion() 执行！"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//在处理器方法执行之后拦截</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1,</span></span></span><br><span class="line"><span class="function"><span class="params">			Object arg2, ModelAndView arg3)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">			System.out.println(<span class="string">"FirstInterceptor.postHandle() 执行！"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//在处理器方法执行之前拦截</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1,</span></span></span><br><span class="line"><span class="function"><span class="params">			Object arg2)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"FirstInterceptor.preHandle() 执行！"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">// false 表示拦截对应请求，不交给对应 处理器处理   </span></span><br><span class="line">					 <span class="comment">//true 表示放行</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注册拦截器"><a href="#注册拦截器" class="headerlink" title="注册拦截器"></a>注册拦截器</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册自定义拦截器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 执行拦截器中拦截路径 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;mvc:mapping path="/**"/&gt; --&gt;</span><span class="comment">&lt;!-- 拦截所有 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 方式1 ：执行指定路径的处理器方法  --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;mvc:mapping path="/mvc/formdata0" /&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 方式2 ：执行指定路径的处理器方法  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span><span class="comment">&lt;!-- 拦截所有 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 排除在拦截器之外，直接放行 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/mvc/formdata1"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注册拦截器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.szxy.intercetor.HelloInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.szxy.intercetor.FirstInterceptor"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.szxy.intercetor.SecondInterceptora"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="使用多个拦截器拦截的顺序"><a href="#使用多个拦截器拦截的顺序" class="headerlink" title="使用多个拦截器拦截的顺序"></a>使用多个拦截器拦截的顺序</h4><ul>
<li>在处理器执行之前，拦截器的顺序由springmvc.xml 声明自定义拦截器的顺序执行</li>
<li>在处理执行完成后。拦截器的顺序是从后往前执行</li>
<li>在服务器响应数据给客户端之前，拦截器的顺序是从后往前执行（一般情况）</li>
</ul>
<h2 id="2-10-Spring-与-SpringMVC-父子容器关系"><a href="#2-10-Spring-与-SpringMVC-父子容器关系" class="headerlink" title="2.10  Spring 与 SpringMVC  父子容器关系"></a>2.10  Spring 与 SpringMVC  父子容器关系</h2><ul>
<li><p>在Spring 整体框架中，容器是核心思想，是用来管理 bean 的生命周期的。</p>
</li>
<li><p>Spring 是父容器，SpringMVC 是子容器。</p>
</li>
<li><p>SpringMVC 可以访问父容器中 注册的bean 对象，但是父容器不能访问子容器注册的 bean 对象。</p>
<p>例如：SpringMVC  容器可以访问 Spring 容器中 dao 层、 service 层 中 bean 对象。</p>
</li>
</ul>
<p>​    </p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/06/20190506 Spring 框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/06/20190506 Spring 框架/" class="post-title-link" itemprop="url">20190506 Spring 框架</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-06 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-06T00:00:00+08:00">2019-05-06</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-10 12:04:09" itemprop="dateModified" datetime="2019-05-10T12:04:09+08:00">2019-05-10</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Spring-简介"><a href="#1-Spring-简介" class="headerlink" title="1 Spring 简介"></a>1 Spring 简介</h1><blockquote>
<p> Spring 是一个轻量级控制反转（IOC）和面向切面（AOP）的容器框架</p>
<p>IOC：Inversion of  Control   控制反转  DI</p>
<p>AOP：Aspect of program      面向切面编程  Aspect</p>
</blockquote>
<h2 id="1-1-常用-jar-包"><a href="#1-1-常用-jar-包" class="headerlink" title="1.1 常用 jar 包"></a>1.1 常用 jar 包</h2><table>
<thead>
<tr>
<th align="center">Spring 常用jar包</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">spring-aop</td>
<td align="center">提供AOP（面向切面编程）实现</td>
</tr>
<tr>
<td align="center">spring-aspect</td>
<td align="center">spring提供对AspectJ 框架的整合</td>
</tr>
<tr>
<td align="center">spring-beans</td>
<td align="center">提供IoC（控制反转）的基础实现</td>
</tr>
<tr>
<td align="center">spring-context-support</td>
<td align="center">对Spring-context 的扩展支持</td>
</tr>
<tr>
<td align="center">spring-context</td>
<td align="center">Spring提供在IoC 基础功能上的扩展服务</td>
</tr>
<tr>
<td align="center">spring-core</td>
<td align="center">spring 的核心组件</td>
</tr>
<tr>
<td align="center">spring-expression</td>
<td align="center">spring 表达式语言</td>
</tr>
<tr>
<td align="center">spring-jdbc</td>
<td align="center">spring 提供的对 JDBC 支持包</td>
</tr>
<tr>
<td align="center">spring-orm</td>
<td align="center">整合第三方的ORM框架</td>
</tr>
<tr>
<td align="center">spring-test</td>
<td align="center">对单元测试和继承测试的简单封装</td>
</tr>
<tr>
<td align="center">spring-tx</td>
<td align="center">对事务管理的封装</td>
</tr>
<tr>
<td align="center">spring-web</td>
<td align="center">SpringMVC支持WEB端应用部署架构</td>
</tr>
<tr>
<td align="center">spring-webmvc</td>
<td align="center">REST Web 服务和Web 应用的视图控制器的实现</td>
</tr>
</tbody></table>
<h2 id="1-2-Spring-版本差异"><a href="#1-2-Spring-版本差异" class="headerlink" title="1.2 Spring 版本差异"></a>1.2 Spring 版本差异</h2><p>sprin 4  支持 JavaEE 7 </p>
<p>spring 5 支持 JavaEE 8，Junit 5</p>
<h1 id="2-Spring-之-IOC-控制反转"><a href="#2-Spring-之-IOC-控制反转" class="headerlink" title="2 Spring 之 IOC 控制反转"></a>2 Spring 之 IOC 控制反转</h1><blockquote>
<p>IOC 控制反转：将对象的控制权(对象的创建、初始化、销毁等操作)由原先的调用者交给 Spring 容器管理。</p>
<p>DI 依赖注入：  若一个对象需要调用另一个对象，无须在代码中创建被调用者，而是依赖于外部容器，由外部容器创建后传递给程序。</p>
<p>IoC 是一个概念，一种思想， DI 是其中实现之一。</p>
</blockquote>
<h2 id="2-1-第一个-spring-程序"><a href="#2-1-第一个-spring-程序" class="headerlink" title="2.1  第一个 spring 程序"></a>2.1  第一个 spring 程序</h2><h3 id="2-2-1-导入-jar-包"><a href="#2-2-1-导入-jar-包" class="headerlink" title="2.2.1 导入 jar 包"></a>2.2.1 导入 jar 包</h3><blockquote>
<p>导入 jar 包</p>
<p>com.springsource.junit-3.8.2.jar<br>com.springsource.org.apache.commons.logging-1.1.1.jar<br>com.springsource.org.apache.log4j-1.2.15.jar<br>spring-beans-4.1.6.RELEASE.jar<br>spring-context-4.1.6.RELEASE.jar<br>spring-context-support-4.1.6.RELEASE.jar<br>spring-core-4.1.6.RELEASE.jar<br>spring-expression-4.1.6.RELEASE.jar</p>
<p>查找 约束文档的位置 spring-framework-4.1.6.RELEASE-dist/spring-framework-4.1.6.RELEASE/docs/spring-framework-reference/html/xsd-config.html</p>
</blockquote>
<h3 id="2-2-2-创建-spring-配置文件"><a href="#2-2-2-创建-spring-配置文件" class="headerlink" title="2.2.2 创建 spring 配置文件"></a>2.2.2 创建 spring 配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">   </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-3-Bean-的定义与注册"><a href="#2-2-3-Bean-的定义与注册" class="headerlink" title="2.2.3 Bean 的定义与注册"></a>2.2.3 Bean 的定义与注册</h3><blockquote>
<p>在 beans 标签中添加下面的语句</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 定义 bean 对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"com.szxy.spring.TestSpring"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-4-从-spring-容器中获取-Bean"><a href="#2-2-4-从-spring-容器中获取-Bean" class="headerlink" title="2.2.4 从 spring 容器中获取 Bean"></a>2.2.4 从 spring 容器中获取 Bean</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.szxy.spring.TestSpring;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 测试类与 service 实现类 耦合</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">traditionalTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">		SomeServiceImpl service = <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line">		service.someMethod();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">///Spring 测试类与 service 实现类 解耦合</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ClassPathXmlApplicationContext context = </span><br><span class="line">				<span class="keyword">new</span>  ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		TestSpring t1 = (TestSpring)context.getBean(<span class="string">"bean1"</span>);</span><br><span class="line">		t1.testMethod();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-BeanFactory-与-ApplicationContext"><a href="#2-2-BeanFactory-与-ApplicationContext" class="headerlink" title="2.2 BeanFactory 与 ApplicationContext"></a>2.2 BeanFactory 与 ApplicationContext</h2><blockquote>
<p>ApplicationContext 在加载配置文件时，对容器中所有 bean 进行对象创建及初始化操作。</p>
<p>BeanFactory 在执行 getBean 时，对容器中指定的 bean 进行对象的创建及初始化操作。</p>
<p>另外： BeanFactory  父接口，ApplicationContext  是 BeanFactory   的子接口</p>
<p>​        </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ApplicationContext context = </span><br><span class="line">				<span class="keyword">new</span>  ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		<span class="comment">//TestSpring t1 = (TestSpring)context.getBean("bean1");</span></span><br><span class="line">		TestSpring t1 =  context.getBean(<span class="string">"bean1"</span>,TestSpring.class);</span><br><span class="line">		t1.testMethod();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//使用 断点调试，区别 BeanFactory 与  ApplicationContext 的区别</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		BeanFactory bf = <span class="keyword">new</span> XmlBeanFactory(<span class="keyword">new</span> ClassPathResource(<span class="string">"applicationContext.xml"</span>));</span><br><span class="line">		TestSpring t1 =  bf.getBean(<span class="string">"bean1"</span>,TestSpring.class);</span><br><span class="line">		t1.testMethod();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-bean-装配"><a href="#2-3-bean-装配" class="headerlink" title="2.3  bean 装配"></a>2.3  bean 装配</h2><blockquote>
<p>Bean 装配指对象的创建方式</p>
<ol>
<li>默认装配方式（构造方法）</li>
<li>动态/实例工厂模式</li>
<li>静态工厂模式</li>
</ol>
</blockquote>
<h3 id="2-3-1-dynamicFactory"><a href="#2-3-1-dynamicFactory" class="headerlink" title="2.3.1 dynamicFactory"></a>2.3.1 dynamicFactory</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 动态/实例工厂模式 </span></span><br><span class="line"><span class="comment">   相当于 	SomeDynamicFactory factory = new SomeDynamicFactory();</span></span><br><span class="line"><span class="comment">    SomeService service = factory.getSomeService();</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"someDynamicFactory"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dynamicFactory.SomeDynamicFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"somServiceByDyFactory"</span> <span class="attr">factory-bean</span>=<span class="string">"someDynamicFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getSomeService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-staticFactory"><a href="#2-3-2-staticFactory" class="headerlink" title="2.3.2  staticFactory"></a>2.3.2  staticFactory</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 静态工厂模式</span></span><br><span class="line"><span class="comment">    相当于 SomeService service = SomeStaticFactory.getSomeService();</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"someServiceByStaticFactory"</span>  <span class="attr">class</span>=<span class="string">"com.szxy.staticFactory.SomeStaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getSomeService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-4-bean-作用域"><a href="#2-4-bean-作用域" class="headerlink" title="2.4 bean 作用域"></a>2.4 bean 作用域</h2><blockquote>
<p>单列模式 singleton</p>
<p>默认采用单例模式，每次使用getBean 方法获取相同 ID 类对象只获取同一个对象</p>
<p>原型列 prototype 每次都获取一个新的对象</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 默认单列模式</span></span><br><span class="line"><span class="comment">  每次从容器获取同一个的对象</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"service1"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.SomeServiceImpl"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 原型列模式</span></span><br><span class="line"><span class="comment">  每次从容器获取一个新的对象</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"service2"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.SomeServiceImpl"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-5-基于XML-方式的-DI"><a href="#2-5-基于XML-方式的-DI" class="headerlink" title="2.5 基于XML 方式的 DI"></a>2.5 基于XML 方式的 DI</h2><blockquote>
<p>依赖注入：为对象的属性赋值,通过 setter 方法。</p>
</blockquote>
<h3 id="2-5-1-设值注入"><a href="#2-5-1-设值注入" class="headerlink" title="2.5.1 设值注入"></a>2.5.1 设值注入</h3><blockquote>
<ol>
<li><p>简单数据类型注入和引用数据类型注入通过 property 标签</p>
</li>
<li><p>集合 Collection 属性的注入 （array、set、list、map、property）</p>
</li>
<li><p>域属性自动注入（autoWire = “by Mame” 方式 、autWiire = “by Type ”；全局/局部）</p>
<p>注意：</p>
<ol>
<li><p>byName 方式 注入的对象的属性名必须与它的id 名称相同</p>
</li>
<li><p>byType 方式注入自动注入：spring 配置文件中查询与属性类型一致的的bean并进行注入.</p>
</li>
</ol>
</li>
<li><p>注入 null 或 空串</p>
</li>
</ol>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">default-autowire</span>=<span class="string">"byType"</span> &gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span> <span class="comment">&lt;!-- 全局配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>/&gt;</span>  <span class="comment">&lt;!--注入空串--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">null</span>/&gt;</span>  <span class="comment">&lt;!--  null --&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">    xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">"</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">         http://www.springframework.org/schema/beans/spring-beans.xsd"</span></span><br><span class="line">         <span class="keyword">default</span>-autowire=<span class="string">"byType"</span> &gt; &lt;!-- 全局自动注入 --&gt;</span><br><span class="line">         </span><br><span class="line">     &lt;!-- 定义 bean 对象 --&gt;</span><br><span class="line">     &lt;!-- <span class="number">1</span>. 简单类型注入和引用类型注入 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"student"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="张三"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="score" value="90"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 引用类型注入 --&gt;</span><br><span class="line">		&lt;property name="teacher" ref="teacher"&gt;&lt;/property&gt; </span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;bean id=<span class="string">"teacher"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Teacher"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="雷老师"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">&lt;!-- 	&lt;bean id=<span class="string">"teacher1"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Teacher"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="马老师"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"teacher2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Teacher"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="曹老师"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt; --&gt;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	&lt;!-- <span class="number">2</span>. 集合类型注入  --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"collect"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.CollectionDI"</span>&gt;</span><br><span class="line">		&lt;property name=<span class="string">"myArray"</span>&gt;</span><br><span class="line">			&lt;array &gt;</span><br><span class="line">					&lt;value&gt;蜡笔小新&lt;/value&gt;</span><br><span class="line">					&lt;value&gt;美少女战士&lt;/value&gt;</span><br><span class="line">					&lt;value&gt;路飞&lt;/value&gt;</span><br><span class="line">			&lt;/array&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;property name=<span class="string">"mySet"</span>&gt;</span><br><span class="line">			&lt;set&gt;</span><br><span class="line">				&lt;ref bean="teacher"&gt;&lt;/ref&gt; </span><br><span class="line">			&lt;!-- 	&lt;ref bean="teacher1"&gt;&lt;/ref&gt;</span><br><span class="line">				&lt;ref bean="teacher2"&gt;&lt;/ref&gt; --&gt;</span><br><span class="line">			&lt;/set&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;property name=<span class="string">"myList"</span>&gt;</span><br><span class="line">			&lt;list&gt;</span><br><span class="line">				&lt;ref bean=<span class="string">"student"</span>/&gt;</span><br><span class="line">			&lt;/list&gt;</span><br><span class="line">		&lt;/property&gt;		</span><br><span class="line">		&lt;property name=<span class="string">"myMap"</span>&gt;</span><br><span class="line">			&lt;map&gt;</span><br><span class="line">				&lt;entry key="一"  value="1"&gt;&lt;/entry&gt;</span><br><span class="line">				&lt;entry key="二"  value="2"&gt;&lt;/entry&gt;</span><br><span class="line">				&lt;entry key="三"  value="3"&gt;&lt;/entry&gt;</span><br><span class="line">			&lt;/map&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;property name=<span class="string">"myProp"</span>&gt;</span><br><span class="line">			&lt;props&gt;</span><br><span class="line">				&lt;prop key="1"&gt;一是一&lt;/prop&gt;</span><br><span class="line">				&lt;prop key="2"&gt;二是二&lt;/prop&gt;</span><br><span class="line">			&lt;/props&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">   </span><br><span class="line">   	&lt;!-- <span class="number">3</span>. 域类型自动注入 --&gt;</span><br><span class="line">   	&lt;!-- 域类型自动注入 byName  byType  --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"student1"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span> autowire=<span class="string">"byName"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="张三"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="score" value="90"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 引用类型注入 --&gt;</span><br><span class="line">		&lt;!-- &lt;property name="teacher" ref="teacher"&gt;&lt;/property&gt;  --&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;!-- </span><br><span class="line">		 域属性自动注入值 byType </span><br><span class="line">		No qualifying bean of type [com.szxy.bean.Teacher] is defined: </span><br><span class="line">		expected single matching bean but found <span class="number">3</span>: teacher,teacher1,teacher2</span><br><span class="line">		</span><br><span class="line">		即使用 byType 作为自动注入，不能注册 多个  bean 是同一个类的，这样会导致 spring 容器不知道选择哪一个，因为类型都相同。</span><br><span class="line"> </span><br><span class="line">	 --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"student2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span> autowire=<span class="string">"byType"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="张三2"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="score" value="60"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 全局自动注入 --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"student3"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="张三3"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="score" value="100"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	&lt;!-- <span class="number">4</span>. 空串或 <span class="keyword">null</span> 注入 --&gt;</span><br><span class="line">	 &lt;bean id=<span class="string">"student4"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span><br><span class="line">		&lt;property name="name"&gt;&lt;value/&gt;&lt;/property&gt;&lt;!-- 空串注入 --&gt;</span><br><span class="line">		&lt;property name="score" value="0"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	 &lt;bean id=<span class="string">"student5"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span><br><span class="line">		&lt;property name="name"&gt;&lt;null/&gt;&lt;/property&gt;&lt;!--  null注入  --&gt;</span><br><span class="line">		&lt;property name="score" value="0"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-2-构造注入"><a href="#2-5-2-构造注入" class="headerlink" title="2.5.2 构造注入"></a>2.5.2 构造注入</h3><p>要求：在 bean 对象中要有参构造方法，同时注意添加无参构造方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 构造注入 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1.1 构造注入 按照名称 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student6"</span> <span class="attr">class</span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"小方"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"score"</span> <span class="attr">value</span>=<span class="string">"90"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"teacher"</span> <span class="attr">ref</span>=<span class="string">"teacher"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1.2 构造注入 按照索引--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student7"</span> <span class="attr">class</span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"小方2"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"90"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"2"</span> <span class="attr">ref</span>=<span class="string">"teacher"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1.3 构造注入 按照默认位置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student8"</span> <span class="attr">class</span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">value</span>=<span class="string">"小方3 "</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">value</span>=<span class="string">"100"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">ref</span>=<span class="string">"teacher1"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-6-基于注解-annotation-方式DI"><a href="#2-6-基于注解-annotation-方式DI" class="headerlink" title="2.6 基于注解 annotation 方式DI"></a>2.6 基于注解 annotation 方式DI</h2><h3 id="2-6-1-环境搭建"><a href="#2-6-1-环境搭建" class="headerlink" title="2.6.1 环境搭建"></a>2.6.1 环境搭建</h3><blockquote>
<p>导入 aop 包，添加 context 约束头信息(组件扫描器)</p>
</blockquote>
<h2 id="2-6-2-常用注解"><a href="#2-6-2-常用注解" class="headerlink" title="2.6.2 常用注解"></a>2.6.2 常用注解</h2><blockquote>
<p> @Component  表名当前类交给Spring容器管理 </p>
<p> @Repository  该注解添加在Dao 中</p>
<p>@Service  该注解添加在 Service 中 </p>
<p>@Controller  该注解添加在 Controller </p>
<p>@Autowired   引用数据类型注入，默认byType</p>
<p>@Qualifier(“id”)   与@Autowired 联合使用 byName 方式注入</p>
<p>@Value  简单数据类型注入</p>
<p>@Resource  引用数据类型默认使用 byName 方式，</p>
<p>若找不到名称匹配的 bean ，才会采用 byType 方式</p>
<p>@Scope()  表明作用域</p>
</blockquote>
<ul>
<li>xml 文档约束</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 使用注解方式 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.bean"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>栗子</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Scope;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">//表明将当前类交给 Spring 容器管理</span></span><br><span class="line"><span class="meta">@Component</span>(<span class="string">"student"</span>)  </span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"小白2"</span>)</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"100"</span>)</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> score;</span><br><span class="line">	<span class="comment">/*	</span></span><br><span class="line"><span class="comment">	@Autowired  //默认以 byType 方式自动注入</span></span><br><span class="line"><span class="comment">	@Qualifier("teacher")  //与 @Autowired 联合使用，以byName 方式自动注入</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="meta">@Resource</span>    <span class="comment">//默认以 byName 方式，若找不到，则以byType 查找</span></span><br><span class="line">	<span class="keyword">private</span> Teacher teacher; <span class="comment">//引用对象</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, <span class="keyword">int</span> score, Teacher teacher)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.score = score;</span><br><span class="line">		<span class="keyword">this</span>.teacher = teacher;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, <span class="keyword">int</span> score)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.score = score;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getScore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> score;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScore</span><span class="params">(<span class="keyword">int</span> score)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.score = score;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Teacher <span class="title">getTeacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> teacher;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeacher</span><span class="params">(Teacher teacher)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.teacher = teacher;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Student [name="</span> + name + <span class="string">", score="</span> + score + <span class="string">", teacher="</span></span><br><span class="line">				+ teacher + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-AOP"><a href="#3-AOP" class="headerlink" title="3  AOP"></a>3  AOP</h1><blockquote>
<p>AOP 面向切面编程(编程思想)，是将交叉业务逻辑封装成切面，利用AOP的功能将切面织入主业务逻辑中。</p>
<p>交叉业务逻辑是值，通用的、与主业务无关的代码，如安全检查、事务、日志等。</p>
<p>切面：泛指交叉业务逻辑。</p>
<p>织入：将切面代码插入到目标对象的过程。</p>
<p>连接点：切面可以织入的位置。</p>
<p>切入点：切面具体织入的位置。注意：切入点的范围比连接点的范围小</p>
<p>通知（advice）： 切面的一种实现，是在目标方法执行前或后，切入。</p>
<p>顾问（advisor）： 不仅指定了切入时间点，还指定具体的    切入点</p>
</blockquote>
<h2 id="3-1-三种代理方式"><a href="#3-1-三种代理方式" class="headerlink" title="3.1 三种代理方式"></a>3.1 三种代理方式</h2><blockquote>
<p>应用场景:</p>
<ul>
<li>可以隐藏目标类的具体实现</li>
<li>在不修改目标类代码的情况下能够对其功能进行增强</li>
</ul>
</blockquote>
<h3 id="3-1-1-静态代理"><a href="#3-1-1-静态代理" class="headerlink" title="3.1.1 静态代理"></a>3.1.1 静态代理</h3><blockquote>
<p>测试静态代理，写一个接口，一个目标实现类，再写一个代理类也实现该接口，并将目标类对象传入代理类中，代理类调用目标类对象的方法。最后测试。</p>
<p>注意： 代理类与目标类实现相同的接口</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.staticProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.service.SomeService;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestStaticProxy</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 目标类</span></span><br><span class="line">		SomeService target= <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line">		<span class="comment">// 代理类</span></span><br><span class="line">		SomeProxy proxy = <span class="keyword">new</span> SomeProxy(target);</span><br><span class="line">		<span class="comment">//调用 代理类，获取返回值</span></span><br><span class="line">		String result = proxy.someMethod();</span><br><span class="line">		System.out.println(result);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-2-JDK动态代理"><a href="#3-1-2-JDK动态代理" class="headerlink" title="3.1.2  JDK动态代理"></a>3.1.2  JDK动态代理</h3><blockquote>
<p>动态代理不在程序中声明代理类代码，而是在运行中使用 Proxy 类 动态执行代理类的方法。</p>
<p>应用场景：目标类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.dynamicProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.service.SomeService;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * JDK 动态代理方式</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDynamicProxy</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//目标类</span></span><br><span class="line">		<span class="comment">//内部类调用外部类中的对象时，要求外部类中的对象必须由 final 关键字 修饰</span></span><br><span class="line">		<span class="keyword">final</span> SomeService target = <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line">		<span class="comment">//代理类</span></span><br><span class="line">		SomeService proxy = </span><br><span class="line">				(SomeService) Proxy.newProxyInstance(target.getClass().getClassLoader(), <span class="comment">//获取目标类类加载器</span></span><br><span class="line">							   target.getClass().getInterfaces(), <span class="comment">//获取目标类实现的接口类</span></span><br><span class="line">							   <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">								</span><br><span class="line">								<span class="comment">/**</span></span><br><span class="line"><span class="comment">								 *   proxy : 代理对象</span></span><br><span class="line"><span class="comment">								 *   method: 目标方法</span></span><br><span class="line"><span class="comment">								 *   args: 目标参数 </span></span><br><span class="line"><span class="comment">								 */</span></span><br><span class="line">								<span class="meta">@Override</span></span><br><span class="line">								<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span></span><br><span class="line"><span class="function">										<span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">									    <span class="comment">//执行目标类的方法</span></span><br><span class="line">										String  result = (String)method.invoke(target, args); </span><br><span class="line">										<span class="keyword">return</span>  result.toLowerCase();</span><br><span class="line">								&#125;</span><br><span class="line">							&#125;);</span><br><span class="line">		<span class="comment">//调用目标类的方法</span></span><br><span class="line">		String result = proxy.someMethod();</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-3-CGLIB-代理"><a href="#3-1-3-CGLIB-代理" class="headerlink" title="3.1.3 CGLIB 代理"></a>3.1.3 CGLIB 代理</h3><blockquote>
<p>应用场景： 实现目标类没有实现目标接口</p>
<p>注意： CGLIB 代理需要引入 cglib 架包</p>
</blockquote>
<ol>
<li><h4 id="CGLIB-代理类工厂"><a href="#CGLIB-代理类工厂" class="headerlink" title="CGLIB 代理类工厂"></a>CGLIB 代理类工厂</h4></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.cglibDynamicProxy.SomeService2;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.asm.Type;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.transform.impl.InterceptFieldFilter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  CGLIB 动态代理工厂</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> *  实现 MethodInterceptore 接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CGLIBProxyFactory</span>  <span class="keyword">implements</span> <span class="title">MethodInterceptor</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span>  SomeService2 target;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CGLIBProxyFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CGLIBProxyFactory</span><span class="params">(SomeService2 target)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.target = target;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> SomeService2 <span class="title">createProxy</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建增强类对象</span></span><br><span class="line">		Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">		<span class="comment">//指定父类对象，即目标类</span></span><br><span class="line">		enhancer.setSuperclass(SomeService2.class);</span><br><span class="line">		<span class="comment">//指定回调接口的对象</span></span><br><span class="line">		enhancer.setCallback(<span class="keyword">this</span>);</span><br><span class="line">		<span class="comment">//创建 cglib 代理类对象</span></span><br><span class="line">		<span class="keyword">return</span> (SomeService2) enhancer.create();</span><br><span class="line">	&#125;	</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *    ojb：     目标对象</span></span><br><span class="line"><span class="comment">	 *    method：  目标方法</span></span><br><span class="line"><span class="comment">	 */</span>	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object obj, Method method, Object[] args,</span></span></span><br><span class="line"><span class="function"><span class="params">			MethodProxy arg3)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">			</span><br><span class="line">			String result = (String)method.invoke(target, args);</span><br><span class="line">			<span class="keyword">return</span> result.toLowerCase();</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.cglibDynamicProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.factory.CGLIBProxyFactory;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCGLIBProxy</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建目标类对象</span></span><br><span class="line">		SomeService2 target = <span class="keyword">new</span> SomeService2();</span><br><span class="line">		<span class="comment">//创建CGLIB 工厂</span></span><br><span class="line">		SomeService2 proxy = <span class="keyword">new</span>  CGLIBProxyFactory(target).createProxy();</span><br><span class="line">		<span class="comment">//调用 代理类方法</span></span><br><span class="line">		String result = proxy.someMethod();</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-基于Schema-based方式之通知"><a href="#3-2-基于Schema-based方式之通知" class="headerlink" title="3.2 基于Schema-based方式之通知"></a>3.2 基于Schema-based方式之通知</h2><blockquote>
<p>导入 两个 jar 包（aop \ aopalliance）</p>
<p>MethodBeforeAdivce</p>
<p>AfterReturningAdvice</p>
<p>MethodInterceptor</p>
</blockquote>
<blockquote>
<p>Eclipse 小技巧： Ctrl+Shirt+I  根据类名查找类所在位置</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">    xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">"</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">         http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span><br><span class="line">        </span><br><span class="line">    &lt;!-- 注册 bean对象，默认通过无参构造方法初始化 bean 对象 </span><br><span class="line">    	 相当于 SomeService service = <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line">    --&gt;</span><br><span class="line">	&lt;bean id="someService" class="com.szxy.service.impl.SomeServiceImpl"&gt;&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 注册切面：前置通知 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"methodBeforeAdviceImpl2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.aspects.MethodBeforeAdviceImpl2"</span>/&gt;</span><br><span class="line">	&lt;!-- 注册切面：后置通知 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"myMethodBeforeAdivce"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.aspects.MyMethodBeforeAdivce"</span>/&gt;</span><br><span class="line">	&lt;!-- 注册切面：环绕通知 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"myMethodInterceptor"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.aspects.MyMethodInterceptor"</span>/&gt;</span><br><span class="line">	&lt;!-- 注册切面：异常通知 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"myThrowAdvice"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.aspects.MyThrowAdvice"</span>/&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 注册代理类对象 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"ProxyFactoryBean"</span>  <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;</span><br><span class="line">		&lt;!-- 指明目标类对象 --&gt;</span><br><span class="line">		&lt;property name="target" ref="someService"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 指明目标类所有接口 --&gt;</span><br><span class="line">		&lt;property name="interfaces" value="com.szxy.service.SomeService"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 指明切面 --&gt;</span><br><span class="line">		&lt;property name="interceptorNames"  value="myThrowAdvice"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-3-基于-AspectJ-方式之通知"><a href="#3-3-基于-AspectJ-方式之通知" class="headerlink" title="3.3  基于 AspectJ 方式之通知"></a>3.3  基于 AspectJ 方式之通知</h2><blockquote>
<p>支持注解式开发</p>
<p>最终通知：无论程序执行是否正常，该通知都会执行。</p>
</blockquote>
<h3 id="3-3-1-切入点表达式"><a href="#3-3-1-切入点表达式" class="headerlink" title="3.3.1 切入点表达式"></a>3.3.1 切入点表达式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">execution( </span><br><span class="line">	[modifiers-pattern]  访问权限类型</span><br><span class="line">	ret-type-pattern   返回值类型 </span><br><span class="line">	[deciaring-type-pattern]   全限定类名</span><br><span class="line">	name-pattern(param-pattern) 方法名（参数名）</span><br><span class="line">    [<span class="keyword">throws</span>-pattern]   抛出异常类型</span><br><span class="line">)</span><br><span class="line">   </span><br><span class="line">  * 表示 <span class="number">0</span>个或多个任意字符</span><br><span class="line">  </span><br><span class="line">  .. 用在方法参数前，表示任意多个参数</span><br><span class="line">     用在包名后，表示当前包及其子包路径</span><br><span class="line">     </span><br><span class="line">  +  用在类名后，表示当前类及其子类</span><br><span class="line">  	 用在接口后，表示当前接口及其实现类</span><br><span class="line">    </span><br><span class="line">execution(* *..service.*.*(..))</span><br><span class="line">指定所有包下的 service 子包下所有类(接口) 中的所有方法为切入点</span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-基于注解方式通知"><a href="#3-3-2-基于注解方式通知" class="headerlink" title="3.3.2 基于注解方式通知"></a>3.3.2 基于注解方式通知</h3><blockquote>
<p>@Aspect              表明当前类为切面</p>
<p>@Before              表明前置通知</p>
<p>@AfterReturning(value=””,returning=””)   表明后置通知</p>
<p>@Around               表明环绕通知</p>
<p>@AfterThrowing(value=””,throwing=””)      表明异常通知</p>
<p>@After  表明最终通知(不论程序是否正常运行，都执行该通知)</p>
</blockquote>
<ul>
<li>测试通知类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.aspects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//将当前作为切面</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspects</span> </span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	//前置通知</span></span><br><span class="line"><span class="comment">	@Before("execution(* *..service.*.someMethod(..))") </span></span><br><span class="line"><span class="comment">	public void methodBefore()&#123;</span></span><br><span class="line"><span class="comment">		System.out.println("前置通知...");</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	//后置通知  </span></span><br><span class="line"><span class="comment">	//注意：后置通知方法中的参数名与注解中的返回值参数名保持一致</span></span><br><span class="line"><span class="comment">	@AfterReturning(value="execution(* *..service.*.doOthers(..))",returning="result")</span></span><br><span class="line"><span class="comment">	public void afterMethod(Object result)&#123;</span></span><br><span class="line"><span class="comment">		</span></span><br><span class="line"><span class="comment">		System.out.println("后置通知... 目标方法的返回值:"+result);</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	//环绕通知</span></span><br><span class="line"><span class="comment">	@Around(value="execution(* *..service.*.doOthers(..))")</span></span><br><span class="line"><span class="comment">	public Object  aroundMethod(ProceedingJoinPoint joinPoint) throws Throwable&#123;</span></span><br><span class="line"><span class="comment">		System.out.println("环绕通知前 ..");</span></span><br><span class="line"><span class="comment">		//执行目标方法</span></span><br><span class="line"><span class="comment">		String result = (String)joinPoint.proceed();</span></span><br><span class="line"><span class="comment">		if(result != null)&#123;</span></span><br><span class="line"><span class="comment">			result = result.toUpperCase();//转换为大写</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">		System.out.println("环绕通知后 ..");</span></span><br><span class="line"><span class="comment">		return result;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="comment">//异常通知</span></span><br><span class="line">	<span class="meta">@AfterThrowing</span>(value=<span class="string">"execution(* *..service.*.someMethod(..))"</span>,throwing=<span class="string">"e"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testThrowing</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"异常通知..."</span>+e);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//最终通知</span></span><br><span class="line">	<span class="meta">@After</span>(<span class="string">"execution(* *..service.*.someMethod(..))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLastAdvice</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"最终通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>applicationContext.xml 文档配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">&lt;!-- 注册 bean对象，默认通过无参构造方法初始化 bean 对象 </span></span><br><span class="line"><span class="comment">    	 相当于 SomeService service = new SomeServiceImpl();</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"someService"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.SomeServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 注册切面 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspects"</span> <span class="attr">class</span>=<span class="string">"com.szxy.aspects.MyAspects"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--  aspectJ  自动代理 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-3-基于-XML-方式通知"><a href="#3-3-3-基于-XML-方式通知" class="headerlink" title="3.3.3 基于 XML 方式通知"></a>3.3.3 基于 XML 方式通知</h3><ul>
<li>applicationContext.xml 配置，注意配置前置带参数通知参数类型所导入的包</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">&lt;!-- 注册 bean对象，默认通过无参构造方法初始化 bean 对象 </span></span><br><span class="line"><span class="comment">    	 相当于 SomeService service = new SomeServiceImpl();</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"someService"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.SomeServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 注册切面 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspects"</span> <span class="attr">class</span>=<span class="string">"com.szxy.aspects.MyAspects"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- AOP 配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 目标方法 --&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* *..service.*.someMethod(..))"</span> <span class="attr">id</span>=<span class="string">"someMethodPC"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* *..service.*.doOthers(..))"</span> <span class="attr">id</span>=<span class="string">"doOthersPC"</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 定义切面 --&gt;</span></span><br><span class="line">	</span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspects"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 前置通知 --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- &lt;aop:before method="methodBefore" pointcut-ref="someMethodPC"/&gt; --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 带参数的前置通知 </span></span><br><span class="line"><span class="comment">				 方法名写参数的类型的全限定路径类名  org.aspectj.lang.JoinPoint		 </span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"methodBefore(org.aspectj.lang.JoinPoint)"</span> <span class="attr">pointcut-ref</span>=<span class="string">"someMethodPC"</span>/&gt;</span> </span><br><span class="line">			<span class="comment">&lt;!-- 后置通知 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"afterMethod(java.lang.Object)"</span>  <span class="attr">pointcut-ref</span>=<span class="string">"doOthersPC"</span> <span class="attr">returning</span>=<span class="string">"result"</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 环绕通知 </span></span><br><span class="line"><span class="comment">				 org.aspectj.lang.ProceedingJoinPoint  默认参数类型可以选择不加</span></span><br><span class="line"><span class="comment">			 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"aroundMethod(org.aspectj.lang.ProceedingJoinPoint)"</span> <span class="attr">pointcut-ref</span>=<span class="string">"doOthersPC"</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 异常通知 </span></span><br><span class="line"><span class="comment">				 带参数的异常通知  方法中写参数类型的全限定路径名 </span></span><br><span class="line"><span class="comment">				 throwing="e" 中的指定的参数 e 与 方法名中参数名一致</span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"testThrowing(java.lang.Exception)"</span> <span class="attr">pointcut-ref</span>=<span class="string">"someMethodPC"</span> <span class="attr">throwing</span>=<span class="string">"e"</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 最终通知 </span></span><br><span class="line"><span class="comment">				 不论程序是否发生问题，都要执行</span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"testLastAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"someMethodPC"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>切面测试类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.aspects;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;  <span class="comment">//导入这个包，别导错了 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  切入类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspects</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//前置通知</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">methodBefore</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"前置通知..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">methodBefore</span><span class="params">(JoinPoint jp)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"前置通知... jp:"</span>+jp);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//后置通知  </span></span><br><span class="line">	<span class="comment">//注意：后置通知方法中的参数名与注解中的返回值参数名保持一致</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterMethod</span><span class="params">(Object result)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"后置通知... 目标方法的返回值:"</span>+result);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//环绕通知</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object  <span class="title">aroundMethod</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"环绕通知前 .."</span>);</span><br><span class="line">		<span class="comment">//执行目标方法</span></span><br><span class="line">		String result = (String)joinPoint.proceed();</span><br><span class="line">		<span class="keyword">if</span>(result != <span class="keyword">null</span>)&#123;</span><br><span class="line">			result = result.toUpperCase();<span class="comment">//转换为大写</span></span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"环绕通知后 .."</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//异常通知</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testThrowing</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"异常通知..."</span>+e);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//最终通知</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLastAdvice</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"最终通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-Spring-事务管理"><a href="#4-Spring-事务管理" class="headerlink" title="4 Spring 事务管理"></a>4 Spring 事务管理</h1><blockquote>
<p>一般情况下，将事务从 dao 层提升到业务层，目的是运用事务的特性（ACID），便于管理具体的业务</p>
</blockquote>
<h2 id="4-1-Spring-事务管理API"><a href="#4-1-Spring-事务管理API" class="headerlink" title="4.1 Spring 事务管理API"></a>4.1 Spring 事务管理API</h2><p>PlatformTransctionManager 接口作为事务管理的对象。</p>
<p>其主要用于完成事务的提交、回滚、获取事务的状态信息</p>
<p>DataSourceTransactionManager 实现类  用于 jdbc 、mybatis </p>
<p>Spring 回滚方式：发生运行异常时回滚，发生受检查异常时提交。</p>
<p>事务定义接口 TransactionDefinition 中定义了事务描述相关变量：</p>
<ul>
<li>事务隔离级别</li>
<li>事务传播行为</li>
<li>事务默认超时时限</li>
<li>对上述事务的操作</li>
</ul>
<p>事务传播行为：处于不同事务中的方法在相互调用时，执行期间事务的维护情况。</p>
<p>REQUIRED: 指定方法必须在事务内执行</p>
<h2 id="4-2-使用-AspectJ-的AOP-配置管理事务"><a href="#4-2-使用-AspectJ-的AOP-配置管理事务" class="headerlink" title="4.2 使用 AspectJ 的AOP 配置管理事务"></a>4.2 使用 AspectJ 的AOP 配置管理事务</h2><blockquote>
<ol>
<li>注册事务管理器，依赖于数据源 dataSource</li>
<li>注册事务通知，设置连接的事务描述</li>
<li>AOP 配置</li>
</ol>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd "</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">     <span class="comment">&lt;!-- 加载数据库配置文件 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"db.properties"</span>/&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 加载数据源 ,使用 c3p0 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   	 </span><br><span class="line">   	 <span class="comment">&lt;!-- 账户  --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.AccountDaoImpl"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 基金 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fundDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.FundDaoImpl"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 基金业务层 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fundServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.FundServiceImpl"</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">ref</span>=<span class="string">"accountDaoImpl"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fundDaoImpl"</span> <span class="attr">ref</span>=<span class="string">"fundDaoImpl"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- 注册事务管理器 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">	 	 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- 注册事务通知 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- 连接点方法事务属性配置 --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"open*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	 			  注意：  rollback-for 的属性值是 异常类名</span></span><br><span class="line"><span class="comment">	 		 --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"buy*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"FundException"</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- AOP 配置 --&gt;</span>	</span><br><span class="line">	 <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!-- 切入点 --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* *..service.*.buyFund(..))"</span> <span class="attr">id</span>=<span class="string">"buyFundPC"</span>/&gt;</span>	</span><br><span class="line">	 		<span class="comment">&lt;!-- 通知 --&gt;</span>		</span><br><span class="line">		 	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"buyFundPC"</span>/&gt;</span> </span><br><span class="line">	 <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-3-AOP-事务注解方式"><a href="#4-3-AOP-事务注解方式" class="headerlink" title="4.3  AOP 事务注解方式"></a>4.3  AOP 事务注解方式</h2><ul>
<li>修改 代码，添加注释</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用 AOP 注解方式管理事务</span></span><br><span class="line"><span class="meta">@Transactional</span>(rollbackFor=FundException.class) </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buyFund</span><span class="params">(String aname, <span class="keyword">double</span> money, String fname, <span class="keyword">int</span> count)</span> <span class="keyword">throws</span> FundException </span>&#123;</span><br><span class="line">    accountDaoImpl.update(aname, money);</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span>==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FundException(<span class="string">"购买基金异常"</span>);			</span><br><span class="line">    &#125;</span><br><span class="line">    fundDaoImpl.update(fname, count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>applicationContext.xml  配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd "</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">     <span class="comment">&lt;!-- 加载数据库配置文件 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"db.properties"</span>/&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 加载数据源 ,使用 c3p0 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   	 </span><br><span class="line">   	 <span class="comment">&lt;!-- 账户  --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.AccountDaoImpl"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 基金 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fundDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.FundDaoImpl"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 基金业务层 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fundServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.FundServiceImpl"</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">ref</span>=<span class="string">"accountDaoImpl"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fundDaoImpl"</span> <span class="attr">ref</span>=<span class="string">"fundDaoImpl"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- 注册事务管理器 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">	 	 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- 注册事务通知 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- 连接点方法事务属性配置 --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"open*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	 			  注意：  rollback-for 的属性值是 异常类名</span></span><br><span class="line"><span class="comment">	 		 --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"buy*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"FundException"</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- AOP 配置 --&gt;</span>	</span><br><span class="line">	<span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">	 &lt;aop:config&gt;</span></span><br><span class="line"><span class="comment">	 		切入点</span></span><br><span class="line"><span class="comment">	 		&lt;aop:pointcut expression="execution(* *..service.*.buyFund(..))" id="buyFundPC"/&gt;	</span></span><br><span class="line"><span class="comment">	 		通知		</span></span><br><span class="line"><span class="comment">		 	&lt;aop:advisor advice-ref="txAdvice" pointcut-ref="buyFundPC"/&gt; </span></span><br><span class="line"><span class="comment">	 &lt;/aop:config&gt;</span></span><br><span class="line"><span class="comment">	  --&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!-- 使用 AOP 注解 --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>FundException 异常类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.exceptions;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  基金异常类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FundException</span> <span class="keyword">extends</span>  <span class="title">Exception</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">FundException</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	 </span><br><span class="line">	 <span class="function"><span class="keyword">public</span> <span class="title">FundException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">	        <span class="keyword">super</span>(message);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/04/04/20190404 OA管理系统开发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/04/04/20190404 OA管理系统开发/" class="post-title-link" itemprop="url">20190404 OA管理系统开发</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-04-04 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-04T00:00:00+08:00">2019-04-04</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-09 10:02:43" itemprop="dateModified" datetime="2019-05-09T10:02:43+08:00">2019-05-09</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-项目概况"><a href="#1-项目概况" class="headerlink" title="1 项目概况"></a>1 项目概况</h1><blockquote>
</blockquote>
<h1 id="2-搭建项目框架"><a href="#2-搭建项目框架" class="headerlink" title="2 搭建项目框架"></a>2 搭建项目框架</h1><p>1 设置工作空间的编码，设置 workspace 的编码为 utf-8</p>
<p>2  创建包和文件，注意可以不同文件夹创建相同的包，但是不能建相同类名的类</p>
<p>​    system 人事 、 duty 、 expense  、 inout 收支</p>
<p>3 导入 jar 包 和 工具类以及配置文件 </p>
<p>4 导入 SQL 脚本</p>
<h1 id="3-部门模块"><a href="#3-部门模块" class="headerlink" title="3 部门模块"></a>3 部门模块</h1><h2 id="3-1-Junit-测试"><a href="#3-1-Junit-测试" class="headerlink" title="3.1 Junit 测试"></a>3.1 Junit 测试</h2><blockquote>
<p>使用注解<code>@Test</code>进行测试</p>
<p>​                <code>@ignore</code>取消该方法的测试</p>
<p>建议测试方法名<code>testMethod()</code></p>
</blockquote>
<h2 id="3-2-重定向和请求转发"><a href="#3-2-重定向和请求转发" class="headerlink" title="3.2  重定向和请求转发"></a>3.2  重定向和请求转发</h2><blockquote>
<p>建议在提交表单后，使用重定向，防止表单重复提交，保护第一次请求数据。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.getContextPath()  <span class="comment">//动态获取上下文路径</span></span><br></pre></td></tr></table></figure>

<h2 id="3-3-断点调试"><a href="#3-3-断点调试" class="headerlink" title="3.3 断点调试"></a>3.3 断点调试</h2><blockquote>
<p>在 servlet 中，设置断点，然后在客户端执行相应的操作，查看代码的运行过程。</p>
</blockquote>
<ol>
<li>以 dubug 模式开启 server 服务器</li>
<li>设置断点</li>
<li>查看运行过程</li>
</ol>
<h2 id="3-3-时序图"><a href="#3-3-时序图" class="headerlink" title="3.3 时序图"></a>3.3 时序图</h2><h3 id="3-3-1-添加部门信息"><a href="#3-3-1-添加部门信息" class="headerlink" title="3.3.1 添加部门信息"></a>3.3.1 添加部门信息</h3><p><img src="http://www.zwer.xyz/picGo/20190404213006.png" alt></p>
<h3 id="3-3-2-部门信息更新操作"><a href="#3-3-2-部门信息更新操作" class="headerlink" title="3.3.2 部门信息更新操作"></a>3.3.2 部门信息更新操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">title: 更新操作</span><br><span class="line"></span><br><span class="line">participant deptList.jsp</span><br><span class="line">participant deptUpdate.jsp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DeparmentServlet -&gt; DepartmentService:调用 findDeptById(req,resp)方法</span><br><span class="line">DepartmentService -&gt; DepartmentDao:调用 findDeptById(int deptno)方法</span><br><span class="line">DepartmentDao -&gt; DBUtil:调用 findDeptById(int deptno)方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DBUtil - &gt; DepartmentDao: return dept</span><br><span class="line">DepartmentDao -&gt; DepartmentService: return dept </span><br><span class="line">DepartmentService-&gt; DeparmentServlet: return dept </span><br><span class="line">DeparmentServlet -&gt; deptUpdate.jsp:显示</span><br><span class="line"></span><br><span class="line">deptUpdate.jsp -&gt; DeparmentServlet: 发送请求update(Department dept)</span><br><span class="line">DeparmentServlet -&gt;DepartmentService: 调用update(Department dept)</span><br><span class="line">DepartmentService -&gt; DepartmentDao:调用 update(Department dept) </span><br><span class="line">DepartmentDao-&gt;DBUtil:调用 update(Department dept) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DBUtil - &gt; DepartmentDao: return dept</span><br><span class="line">DepartmentDao -&gt; DepartmentService: return dept </span><br><span class="line">DepartmentService-&gt; DeparmentServlet: return dept </span><br><span class="line">DeparmentServlet -&gt; deptList.jsp:显示</span><br></pre></td></tr></table></figure>

<h2 id="3-4-属性关联"><a href="#3-4-属性关联" class="headerlink" title="3.4  属性关联"></a>3.4  属性关联</h2><blockquote>
<p>用于实体类一对多关系</p>
<p>将表中的外键关系，在 java 语言用 类与类之间的关系表表示</p>
<p>new  java.sql.Date(().getTime);</p>
<p>如何表示员工所属一个部门、一个岗位、一个上级、甚至多个下级的信息？</p>
<p>在数据库中通过外键来实现： deptno、posid、mgrid</p>
<p>在 Java 类中通过属性关联来实现，即通过添加类有私有属性完成。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一对多的联系</span></span><br><span class="line"><span class="comment"> * 在 Java 类中通过属性关联的方式实现</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 	private Department dept;// 所在部门的信息</span></span><br><span class="line"><span class="comment">	private Position pos; //所在岗位的信息</span></span><br><span class="line"><span class="comment">	private Employee mgr; //上级领导</span></span><br><span class="line"><span class="comment">	private List&lt;Employee&gt; empList = new ArrayList&lt;&gt;(); //下级员工</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String empId;</span><br><span class="line">	<span class="keyword">private</span> String passWord;</span><br><span class="line">	<span class="keyword">private</span> String realName;</span><br><span class="line">	<span class="keyword">private</span> String sex;</span><br><span class="line">	<span class="keyword">private</span> Date birthDate; <span class="comment">//出生日期</span></span><br><span class="line">	<span class="keyword">private</span> Date hireDate;  <span class="comment">//入职日期</span></span><br><span class="line">	<span class="keyword">private</span> Date leaveDate; <span class="comment">//离职日期</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> onduty; <span class="comment">//   0-离职  1-在职         </span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> emptype;<span class="comment">//   1.普通员工  2.管理人员 含经理、总监、总裁等  3.管理员 	</span></span><br><span class="line">	<span class="keyword">private</span> String phone;</span><br><span class="line">	<span class="keyword">private</span> String qq;</span><br><span class="line">	<span class="keyword">private</span> String emerContactPerson;<span class="comment">//紧急联系人</span></span><br><span class="line">	<span class="keyword">private</span> String idCard; <span class="comment">// 身份证号</span></span><br><span class="line">	<span class="keyword">private</span> Department dept;<span class="comment">// 所在部门的信息</span></span><br><span class="line">	<span class="keyword">private</span> Position pos; <span class="comment">//所在岗位的信息</span></span><br><span class="line">	<span class="keyword">private</span> Employee mgr; <span class="comment">//上级领导</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Employee&gt; empList = <span class="keyword">new</span> ArrayList&lt;&gt;(); <span class="comment">//下级员工</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(String empId, String passWord, String realName, String sex,</span></span></span><br><span class="line"><span class="function"><span class="params">			Date birthDate, Date hireDate, Date leaveDate, <span class="keyword">int</span> onduty,</span></span></span><br><span class="line"><span class="function"><span class="params">			<span class="keyword">int</span> emptype, String phone, String qq, String emerContactPerson,</span></span></span><br><span class="line"><span class="function"><span class="params">			String idCard, Department dept, Position pos, Employee mgr,</span></span></span><br><span class="line"><span class="function"><span class="params">			List&lt;Employee&gt; empList)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.empId = empId;</span><br><span class="line">		<span class="keyword">this</span>.passWord = passWord;</span><br><span class="line">		<span class="keyword">this</span>.realName = realName;</span><br><span class="line">		<span class="keyword">this</span>.sex = sex;</span><br><span class="line">		<span class="keyword">this</span>.birthDate = birthDate;</span><br><span class="line">		<span class="keyword">this</span>.hireDate = hireDate;</span><br><span class="line">		<span class="keyword">this</span>.leaveDate = leaveDate;</span><br><span class="line">		<span class="keyword">this</span>.onduty = onduty;</span><br><span class="line">		<span class="keyword">this</span>.emptype = emptype;</span><br><span class="line">		<span class="keyword">this</span>.phone = phone;</span><br><span class="line">		<span class="keyword">this</span>.qq = qq;</span><br><span class="line">		<span class="keyword">this</span>.emerContactPerson = emerContactPerson;</span><br><span class="line">		<span class="keyword">this</span>.idCard = idCard;</span><br><span class="line">		<span class="keyword">this</span>.dept = dept;</span><br><span class="line">		<span class="keyword">this</span>.pos = pos;</span><br><span class="line">		<span class="keyword">this</span>.mgr = mgr;</span><br><span class="line">		<span class="keyword">this</span>.empList = empList;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(String empId, String passWord, String realName, String sex,</span></span></span><br><span class="line"><span class="function"><span class="params">			Date birthDate, Date hireDate, Date leaveDate, <span class="keyword">int</span> onduty,</span></span></span><br><span class="line"><span class="function"><span class="params">			<span class="keyword">int</span> emptype, String phone, String qq, String emerContactPerson,</span></span></span><br><span class="line"><span class="function"><span class="params">			String idCard, Department dept, Position pos, Employee mgr)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.empId = empId;</span><br><span class="line">		<span class="keyword">this</span>.passWord = passWord;</span><br><span class="line">		<span class="keyword">this</span>.realName = realName;</span><br><span class="line">		<span class="keyword">this</span>.sex = sex;</span><br><span class="line">		<span class="keyword">this</span>.birthDate = birthDate;</span><br><span class="line">		<span class="keyword">this</span>.hireDate = hireDate;</span><br><span class="line">		<span class="keyword">this</span>.leaveDate = leaveDate;</span><br><span class="line">		<span class="keyword">this</span>.onduty = onduty;</span><br><span class="line">		<span class="keyword">this</span>.emptype = emptype;</span><br><span class="line">		<span class="keyword">this</span>.phone = phone;</span><br><span class="line">		<span class="keyword">this</span>.qq = qq;</span><br><span class="line">		<span class="keyword">this</span>.emerContactPerson = emerContactPerson;</span><br><span class="line">		<span class="keyword">this</span>.idCard = idCard;</span><br><span class="line">		<span class="keyword">this</span>.dept = dept;</span><br><span class="line">		<span class="keyword">this</span>.pos = pos;</span><br><span class="line">		<span class="keyword">this</span>.mgr = mgr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmpId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> empId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmpId</span><span class="params">(String empId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.empId = empId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassWord</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> passWord;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassWord</span><span class="params">(String passWord)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.passWord = passWord;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getRealName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> realName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRealName</span><span class="params">(String realName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.realName = realName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sex = sex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getBirthDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> birthDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthDate</span><span class="params">(Date birthDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.birthDate = birthDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getHireDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> hireDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHireDate</span><span class="params">(Date hireDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.hireDate = hireDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getLeaveDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> leaveDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeaveDate</span><span class="params">(Date leaveDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.leaveDate = leaveDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOnduty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> onduty;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnduty</span><span class="params">(<span class="keyword">int</span> onduty)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.onduty = onduty;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getEmptype</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> emptype;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmptype</span><span class="params">(<span class="keyword">int</span> emptype)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.emptype = emptype;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPhone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> phone;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPhone</span><span class="params">(String phone)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.phone = phone;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getQq</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> qq;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQq</span><span class="params">(String qq)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.qq = qq;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmerContactPerson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> emerContactPerson;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmerContactPerson</span><span class="params">(String emerContactPerson)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.emerContactPerson = emerContactPerson;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getIdCard</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> idCard;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIdCard</span><span class="params">(String idCard)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.idCard = idCard;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Department <span class="title">getDept</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dept;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDept</span><span class="params">(Department dept)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.dept = dept;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Position <span class="title">getPos</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pos;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPos</span><span class="params">(Position pos)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pos = pos;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Employee <span class="title">getMgr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mgr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMgr</span><span class="params">(Employee mgr)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mgr = mgr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> empList;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmpList</span><span class="params">(List&lt;Employee&gt; empList)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.empList = empList;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="keyword">int</span> prime = <span class="number">31</span>;</span><br><span class="line">		<span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((birthDate == <span class="keyword">null</span>) ? <span class="number">0</span> : birthDate.hashCode());</span><br><span class="line">		result = prime * result + ((dept == <span class="keyword">null</span>) ? <span class="number">0</span> : dept.hashCode());</span><br><span class="line">		result = prime</span><br><span class="line">				* result</span><br><span class="line">				+ ((emerContactPerson == <span class="keyword">null</span>) ? <span class="number">0</span> : emerContactPerson</span><br><span class="line">						.hashCode());</span><br><span class="line">		result = prime * result + ((empId == <span class="keyword">null</span>) ? <span class="number">0</span> : empId.hashCode());</span><br><span class="line">		result = prime * result + ((empList == <span class="keyword">null</span>) ? <span class="number">0</span> : empList.hashCode());</span><br><span class="line">		result = prime * result + emptype;</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((hireDate == <span class="keyword">null</span>) ? <span class="number">0</span> : hireDate.hashCode());</span><br><span class="line">		result = prime * result + ((idCard == <span class="keyword">null</span>) ? <span class="number">0</span> : idCard.hashCode());</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((leaveDate == <span class="keyword">null</span>) ? <span class="number">0</span> : leaveDate.hashCode());</span><br><span class="line">		result = prime * result + ((mgr == <span class="keyword">null</span>) ? <span class="number">0</span> : mgr.hashCode());</span><br><span class="line">		result = prime * result + onduty;</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((passWord == <span class="keyword">null</span>) ? <span class="number">0</span> : passWord.hashCode());</span><br><span class="line">		result = prime * result + ((phone == <span class="keyword">null</span>) ? <span class="number">0</span> : phone.hashCode());</span><br><span class="line">		result = prime * result + ((pos == <span class="keyword">null</span>) ? <span class="number">0</span> : pos.hashCode());</span><br><span class="line">		result = prime * result + ((qq == <span class="keyword">null</span>) ? <span class="number">0</span> : qq.hashCode());</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((realName == <span class="keyword">null</span>) ? <span class="number">0</span> : realName.hashCode());</span><br><span class="line">		result = prime * result + ((sex == <span class="keyword">null</span>) ? <span class="number">0</span> : sex.hashCode());</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span> == obj)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		<span class="keyword">if</span> (obj == <span class="keyword">null</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (getClass() != obj.getClass())</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		Employee other = (Employee) obj;</span><br><span class="line">		<span class="keyword">if</span> (birthDate == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.birthDate != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!birthDate.equals(other.birthDate))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (dept == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.dept != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!dept.equals(other.dept))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (emerContactPerson == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.emerContactPerson != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!emerContactPerson.equals(other.emerContactPerson))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (empId == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.empId != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!empId.equals(other.empId))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (empList == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.empList != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!empList.equals(other.empList))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (emptype != other.emptype)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (hireDate == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.hireDate != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!hireDate.equals(other.hireDate))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (idCard == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.idCard != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!idCard.equals(other.idCard))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (leaveDate == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.leaveDate != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!leaveDate.equals(other.leaveDate))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (mgr == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.mgr != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!mgr.equals(other.mgr))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (onduty != other.onduty)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (passWord == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.passWord != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!passWord.equals(other.passWord))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (phone == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.phone != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!phone.equals(other.phone))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (pos == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.pos != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!pos.equals(other.pos))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (qq == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.qq != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!qq.equals(other.qq))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (realName == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.realName != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!realName.equals(other.realName))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (sex == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.sex != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!sex.equals(other.sex))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Employee [empId="</span> + empId + <span class="string">", passWord="</span> + passWord</span><br><span class="line">				+ <span class="string">", realName="</span> + realName + <span class="string">", sex="</span> + sex + <span class="string">", birthDate="</span></span><br><span class="line">				+ birthDate + <span class="string">", hireDate="</span> + hireDate + <span class="string">", leaveDate="</span></span><br><span class="line">				+ leaveDate + <span class="string">", onduty="</span> + onduty + <span class="string">", emptype="</span> + emptype</span><br><span class="line">				+ <span class="string">", phone="</span> + phone + <span class="string">", qq="</span> + qq + <span class="string">", emerContactPerson="</span></span><br><span class="line">				+ emerContactPerson + <span class="string">", idCard="</span> + idCard + <span class="string">", dept="</span> + dept</span><br><span class="line">				+ <span class="string">", pos="</span> + pos + <span class="string">", mgr="</span> + mgr + <span class="string">", empList="</span> + empList</span><br><span class="line">				+ <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-5-日历插件"><a href="#3-5-日历插件" class="headerlink" title="3.5  日历插件"></a>3.5  日历插件</h2><blockquote>
<p>使用日历插件的步骤</p>
<p>导入日历插件的Js文件，对 input 输入框添加焦点事件，使用 WdatePicker()函数，</p>
<p>配置使用参数 Json 格式 {属性名：属性值}</p>
</blockquote>
<ol>
<li>导入日历插件的 Js 文件</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入日历插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"My97DatePicker/WdatePicker.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>添加鼠标事件，使用日历插件</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>出生日期<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"dfinput"</span> 		       <span class="attr">onfocus</span>=<span class="string">"WdatePicker(&#123;lang:'en',skin:'whyGreen'&#125;)"</span>/&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">i</span>&gt;</span>也可以根据身份证号自动获取<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>调整日历插件的配置,使用 json 格式</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WdatePicker(&#123;lang:'en',skin:'whyGreen'&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="3-6-富文本编辑器"><a href="#3-6-富文本编辑器" class="headerlink" title="3.6 富文本编辑器"></a>3.6 富文本编辑器</h2><blockquote>
<p>使用富文本编辑器 KindEditor</p>
</blockquote>
<ol>
<li>导入富文本编辑器 JS 文件</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入富文本编辑器插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"editor/kindeditor.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>绑定 ID</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>紧急联系人信息<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">""</span>  <span class="attr">id</span>=<span class="string">"ecp"</span> <span class="attr">cols</span>=<span class="string">""</span> <span class="attr">rows</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"textinput"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改配置</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">		<span class="comment">// 注意：要选择 id 键，指明在哪里使用富文本编辑器</span></span></span><br><span class="line"><span class="javascript">		KE.show(&#123;<span class="attr">id</span>:<span class="string">"ecp"</span>,<span class="attr">width</span>:<span class="string">"500px"</span>,<span class="attr">height</span>:<span class="string">"300px;"</span>,<span class="attr">resizeType</span>:<span class="number">1</span>,<span class="attr">skinType</span>:<span class="string">"tinymce"</span>,</span></span><br><span class="line">			items:[</span><br><span class="line"><span class="javascript">		        <span class="string">'source'</span>, <span class="string">'|'</span>, <span class="string">'undo'</span>, <span class="string">'redo'</span>, <span class="string">'|'</span>, <span class="string">'preview'</span>, <span class="string">'print'</span>, <span class="string">'template'</span>, <span class="string">'code'</span>, <span class="string">'cut'</span>, <span class="string">'copy'</span>, <span class="string">'paste'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'plainpaste'</span>, <span class="string">'wordpaste'</span>, <span class="string">'|'</span>, <span class="string">'justifyleft'</span>, <span class="string">'justifycenter'</span>, <span class="string">'justifyright'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'justifyfull'</span>, <span class="string">'insertorderedlist'</span>, <span class="string">'insertunorderedlist'</span>, <span class="string">'indent'</span>, <span class="string">'outdent'</span>, <span class="string">'subscript'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'superscript'</span>, <span class="string">'clearhtml'</span>, <span class="string">'quickformat'</span>, <span class="string">'selectall'</span>, <span class="string">'|'</span>, <span class="string">'fullscreen'</span>, <span class="string">'/'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'formatblock'</span>, <span class="string">'fontname'</span>, <span class="string">'fontsize'</span>, <span class="string">'|'</span>, <span class="string">'forecolor'</span>, <span class="string">'hilitecolor'</span>, <span class="string">'bold'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'italic'</span>, <span class="string">'underline'</span>, <span class="string">'strikethrough'</span>, <span class="string">'lineheight'</span>, <span class="string">'removeformat'</span>, <span class="string">'|'</span>, <span class="string">'image'</span>, <span class="string">'multiimage'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'flash'</span>, <span class="string">'media'</span>, <span class="string">'insertfile'</span>, <span class="string">'table'</span>, <span class="string">'hr'</span>, <span class="string">'emoticons'</span>, <span class="string">'baidumap'</span>, <span class="string">'pagebreak'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'anchor'</span>, <span class="string">'link'</span>, <span class="string">'unlink'</span>, <span class="string">'|'</span>, <span class="string">'about'</span></span></span><br><span class="line">		]</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-8-一对多查询"><a href="#3-8-一对多查询" class="headerlink" title="3.8  一对多查询"></a>3.8  一对多查询</h2><blockquote>
<p>SQL 语句采用多表连接的方式，按需求将所需数据查找出来。</p>
<p>不建议采用 调用其他 dao 层 对象查找所需数据，再组合起来，这样耦合性高，查询效率不理想。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">findAllEmpsInfoService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Connection conn = <span class="keyword">null</span>;</span><br><span class="line">		PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">		ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">		List&lt;Employee&gt; emps = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			conn = DBUtil.getConnection();</span><br><span class="line">			<span class="comment">/*String sql = "select * from employee";*/</span></span><br><span class="line">			String sql = <span class="string">"select  e.*,d.deptname,d.location,p.pname,mgr.empid,mgr.realname"</span>+</span><br><span class="line">						 <span class="string">"	from employee e"</span>+</span><br><span class="line">						 <span class="string">"	left join dept d"</span>+</span><br><span class="line">						 <span class="string">"	on e.deptno = d.deptno"</span>+</span><br><span class="line">						 <span class="string">"	left join position p"</span>+</span><br><span class="line">						 <span class="string">"	on e.posid = p.posid"</span>+</span><br><span class="line">						 <span class="string">"	left join employee mgr"</span>+</span><br><span class="line">						 <span class="string">"	on e.mgrid = mgr.empid"</span>;</span><br><span class="line">			ps = conn.prepareStatement(sql);</span><br><span class="line">			rs = ps.executeQuery();</span><br><span class="line">			emps = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">			<span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">				Employee emp = <span class="keyword">new</span> Employee();</span><br><span class="line">				emp.setEmpId(rs.getString(<span class="string">"empid"</span>));</span><br><span class="line">				emp.setRealName(rs.getString(<span class="string">"realname"</span>));</span><br><span class="line">				emp.setPassWord(rs.getString(<span class="string">"password"</span>));</span><br><span class="line">				emp.setSex(rs.getString(<span class="string">"sex"</span>));</span><br><span class="line">				emp.setHireDate(rs.getDate(<span class="string">"hiredate"</span>));</span><br><span class="line">				emp.setBirthDate(rs.getDate(<span class="string">"birthdate"</span>));</span><br><span class="line">				emp.setLeaveDate(rs.getDate(<span class="string">"leavedate"</span>));</span><br><span class="line">				emp.setPhone(rs.getString(<span class="string">"phone"</span>));</span><br><span class="line">				emp.setEmptype(rs.getInt(<span class="string">"emptype"</span>));</span><br><span class="line">				emp.setOnduty(rs.getInt(<span class="string">"onduty"</span>));</span><br><span class="line">				emp.setQq(rs.getString(<span class="string">"qq"</span>));</span><br><span class="line">				emp.setEmerContactPerson(rs.getString(<span class="string">"emercontactperson"</span>));</span><br><span class="line">				emp.setIdCard(rs.getString(<span class="string">"idcard"</span>));</span><br><span class="line">				</span><br><span class="line">				Department dept = <span class="keyword">new</span> Department();</span><br><span class="line">				dept.setDeptno(rs.getInt(<span class="string">"deptno"</span>));</span><br><span class="line">				dept.setDeptName(rs.getString(<span class="string">"deptName"</span>));</span><br><span class="line">				emp.setDept(dept);</span><br><span class="line">				</span><br><span class="line">				Position pos = <span class="keyword">new</span> Position();</span><br><span class="line">				pos.setPosid(rs.getInt(<span class="string">"posid"</span>));</span><br><span class="line">				pos.setPosName(rs.getString(<span class="string">"pname"</span>));</span><br><span class="line">				emp.setPos(pos);</span><br><span class="line">				</span><br><span class="line">				Employee mgr = <span class="keyword">new</span> Employee();</span><br><span class="line">				mgr.setEmpId(rs.getString(<span class="string">"empid"</span>));</span><br><span class="line">				mgr.setRealName(rs.getString(<span class="string">"realname"</span>));</span><br><span class="line">				emp.setMgr(mgr);</span><br><span class="line">				</span><br><span class="line">				<span class="comment">// 耦合性太高，而且查询速度慢</span></span><br><span class="line">			<span class="comment">/*	//调用 DepartmentDao</span></span><br><span class="line"><span class="comment">				DepartmentDao deptDao = new DepartmentDaoImpl();</span></span><br><span class="line"><span class="comment">				Department dept = deptDao.findDeptInfoByIdDao(rs.getInt("emptype")); </span></span><br><span class="line"><span class="comment">				emp.setDept(dept);</span></span><br><span class="line"><span class="comment">				//调用 PositionDao </span></span><br><span class="line"><span class="comment">				PositionDao posDao = new PositionDaoImpl();</span></span><br><span class="line"><span class="comment">				Position pos = posDao.findPosInfoById(rs.getString("posid"));</span></span><br><span class="line"><span class="comment">				emp.setPos(pos);</span></span><br><span class="line"><span class="comment">				//调用 this ,查找该员工的上级信息</span></span><br><span class="line"><span class="comment">				Employee mgr = this.findEmpInfoByIdDao(rs.getString("mgrid"));</span></span><br><span class="line"><span class="comment">				emp.setMgr(mgr);</span></span><br><span class="line"><span class="comment">				//调用 this ，查找该员工的所有下级信息</span></span><br><span class="line"><span class="comment">				List&lt;Employee&gt; empList = this.findEmpsInfoByMgrDao(rs.getString("mgrid"));</span></span><br><span class="line"><span class="comment">				emp.setEmpList(empList);*/</span></span><br><span class="line">						</span><br><span class="line">				emps.add(emp);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			DBUtil.closeAll(rs, ps, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> emps; </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-9-动态-SQL语句"><a href="#3-9-动态-SQL语句" class="headerlink" title="3.9  动态 SQL语句"></a>3.9  动态 SQL语句</h2><blockquote>
<p>使用 <code>StringBuilder</code> 类中 <code>append</code> 方法，j加上 if  条件动态控制 where 子句的查询条件的选择</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*String sql = "select * from employee";*/</span></span><br><span class="line">StringBuilder sql = <span class="keyword">new</span> StringBuilder(<span class="string">"select  e.*,d.deptname,d.location,p.pname,mgr.empid,mgr.realname mgrRealName"</span>+</span><br><span class="line">				<span class="string">" from employee e"</span>+</span><br><span class="line">				<span class="string">" left join dept d"</span>+</span><br><span class="line">				<span class="string">" on e.deptno = d.deptno"</span>+</span><br><span class="line">				<span class="string">" left join position p"</span>+</span><br><span class="line">				<span class="string">" on e.posid = p.posid"</span>+</span><br><span class="line">				<span class="string">" left join employee mgr"</span>+</span><br><span class="line">				<span class="string">" on e.mgrid = mgr.empid where 1=1"</span>);</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(empId !=<span class="keyword">null</span>&amp;&amp;!empId.equals(<span class="string">""</span>))&#123;</span><br><span class="line">					sql.append(<span class="string">" and e.empid like '%"</span>+empId+<span class="string">"%'"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(deptNO !=<span class="keyword">null</span> &amp;&amp; !deptNO.equals(<span class="string">"0"</span>))&#123;</span><br><span class="line">					sql.append(<span class="string">" and e.deptno ="</span>+deptNO);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(onDuty !=<span class="keyword">null</span> &amp;&amp; !empId.equals(<span class="string">""</span>))&#123;</span><br><span class="line">					sql.append(<span class="string">" and e.onDuty ="</span>+onDuty);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				</span><br><span class="line">				System.out.println(sql.toString());</span><br><span class="line">				ps = conn.prepareStatement(sql.toString());</span><br></pre></td></tr></table></figure>

<h2 id="3-10-servlet-接受表单数据预处理"><a href="#3-10-servlet-接受表单数据预处理" class="headerlink" title="3.10 servlet 接受表单数据预处理"></a>3.10 servlet 接受表单数据预处理</h2><blockquote>
<p>通过预先对传入的数据进行 null 值判断。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转换日期格式</span></span><br><span class="line">SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-mm-dd"</span>);</span><br><span class="line">Date birthDate = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    birthDate = sdf.parse(sBirthDay);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(hireDate !=<span class="keyword">null</span> &amp;&amp; !hireDate.equals(<span class="string">""</span>))&#123;</span><br><span class="line">    Date date = <span class="keyword">new</span> java.sql.Date(hireDate.getTime());</span><br><span class="line">    sql.append(<span class="string">" and to_char(e.hiredate,'yyyy-MM-dd') &gt;='"</span>+date+<span class="string">"'"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-11-获取同名列的问题"><a href="#3-11-获取同名列的问题" class="headerlink" title="3.11 获取同名列的问题"></a>3.11 获取同名列的问题</h2><blockquote>
<p>解决方法：为同名列起别名，区分不同同名列。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">StringBuilder sql = </span><br><span class="line"> 	<span class="keyword">new</span> StringBuilder(<span class="string">"select  e.*,d.deptname,d.location,p.pname,mgr.empid,mgr.realname mgrRealName"</span>+</span><br><span class="line">                      <span class="string">" from employee e"</span>+</span><br><span class="line">                      <span class="string">" left join dept d"</span>+</span><br><span class="line">                      <span class="string">" on e.deptno = d.deptno"</span>+</span><br><span class="line">                      <span class="string">" left join position p"</span>+</span><br><span class="line">                      <span class="string">" on e.posid = p.posid"</span>+</span><br><span class="line">                      <span class="string">" left join employee mgr"</span>+</span><br><span class="line">                      <span class="string">" on e.mgrid = mgr.empid where 1=1"</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-12-form表单提交问题"><a href="#3-12-form表单提交问题" class="headerlink" title="3.12 form表单提交问题"></a>3.12 form表单提交问题</h2><blockquote>
<p>注意：写明提交方式，否则 action 后面附带的参数不提交。</p>
</blockquote>
<h2 id="3-13-删除员工"><a href="#3-13-删除员工" class="headerlink" title="3.13 删除员工"></a>3.13 删除员工</h2><blockquote>
<p>不删除员工，将员工设为离职状态</p>
</blockquote>
<h2 id="3-14-更新员工信息"><a href="#3-14-更新员工信息" class="headerlink" title="3.14 更新员工信息"></a>3.14 更新员工信息</h2><blockquote>
<p>设置员工的用户名不可修改</p>
<p>寻找插件将输入的用户名中文转为收汉语拼音</p>
</blockquote>
<h1 id="4-考勤模块"><a href="#4-考勤模块" class="headerlink" title="4 考勤模块"></a>4 考勤模块</h1><h2 id="4-1-登录模块"><a href="#4-1-登录模块" class="headerlink" title="4.1 登录模块"></a>4.1 登录模块</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"pwd"</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"loginpwd"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">onclick</span>=<span class="string">"JavaScript:this.value=''"</span>/&gt;</span>  <span class="comment">&lt;!-- 单击清空输入框  -&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-1-1-菜单分栏"><a href="#4-1-1-菜单分栏" class="headerlink" title="4.1.1 菜单分栏"></a>4.1.1 菜单分栏</h3><blockquote>
<p>根据用户的类型，显示不同的菜单。</p>
</blockquote>
<h3 id="4-1-2-验证码"><a href="#4-1-2-验证码" class="headerlink" title="4.1.2 验证码"></a>4.1.2 验证码</h3><blockquote>
<p>登录验证码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.Font;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 在内存中创建图象</span></span><br><span class="line">		<span class="keyword">int</span> width = <span class="number">110</span>, height = <span class="number">30</span>;</span><br><span class="line">		BufferedImage image = <span class="keyword">new</span> BufferedImage(width, height,</span><br><span class="line">				BufferedImage.TYPE_INT_RGB);</span><br><span class="line">		<span class="comment">// 获取图形上下文</span></span><br><span class="line">		Graphics g = image.getGraphics();</span><br><span class="line">		<span class="comment">// 生成随机类</span></span><br><span class="line">		Random random = <span class="keyword">new</span> Random();</span><br><span class="line">		<span class="comment">// 设定背景色</span></span><br><span class="line">		g.setColor(getRandColor(<span class="number">200</span>, <span class="number">250</span>));</span><br><span class="line">		g.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">		<span class="comment">// 设定字体</span></span><br><span class="line">		g.setFont(<span class="keyword">new</span> Font(<span class="string">"Times New Roman"</span>, Font.PLAIN, <span class="number">20</span>));</span><br><span class="line">		<span class="comment">// 随机产生155条干扰线，使图象中的认证码不易被其它程序探测到</span></span><br><span class="line">		g.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">155</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">int</span> x = random.nextInt(width);</span><br><span class="line">			<span class="keyword">int</span> y = random.nextInt(height);</span><br><span class="line">			<span class="keyword">int</span> xl = random.nextInt(<span class="number">12</span>);</span><br><span class="line">			<span class="keyword">int</span> yl = random.nextInt(<span class="number">12</span>);</span><br><span class="line">			g.drawLine(x, y, x + xl, y + yl);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 取随机产生的认证码(6位数字)</span></span><br><span class="line">		String sRand = <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">			String rand = String.valueOf(random.nextInt(<span class="number">10</span>));</span><br><span class="line">			sRand += rand;</span><br><span class="line">			<span class="comment">// 将认证码显示到图象中</span></span><br><span class="line">			g.setColor(<span class="keyword">new</span> Color(<span class="number">20</span> + random.nextInt(<span class="number">110</span>), <span class="number">20</span> + random</span><br><span class="line">					.nextInt(<span class="number">110</span>), <span class="number">20</span> + random.nextInt(<span class="number">110</span>)));</span><br><span class="line">			<span class="comment">// 调用函数出来的颜色相同，可能是因为种子太接近，所以只能直接生成</span></span><br><span class="line">			g.drawString(rand, <span class="number">13</span> * i + <span class="number">6</span>, <span class="number">16</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 图象生效</span></span><br><span class="line">		g.dispose();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			ImageIO.write(image, <span class="string">"JPEG"</span>, response.getOutputStream());</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			System.out.println(<span class="string">"验证码图片产生出现错误："</span> + e.toString());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//保存验证码到Session</span></span><br><span class="line">		request.getSession().setAttribute(<span class="string">"randStr"</span>, sRand);</span><br><span class="line">	<span class="comment">/*	System.out.println("randStr"+sRand);*/</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>.doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 给定范围获得随机颜色</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Color <span class="title">getRandColor</span><span class="params">(<span class="keyword">int</span> fc, <span class="keyword">int</span> bc)</span> </span>&#123;</span><br><span class="line">		Random random = <span class="keyword">new</span> Random();</span><br><span class="line">		<span class="keyword">if</span> (fc &gt; <span class="number">255</span>)</span><br><span class="line">			fc = <span class="number">255</span>;</span><br><span class="line">		<span class="keyword">if</span> (bc &gt; <span class="number">255</span>)</span><br><span class="line">			bc = <span class="number">255</span>;</span><br><span class="line">		<span class="keyword">int</span> r = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">int</span> g = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">int</span> b = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Color(r, g, b);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-5-查看考勤信息模块"><a href="#4-5-查看考勤信息模块" class="headerlink" title="4.5 查看考勤信息模块"></a>4.5 查看考勤信息模块</h2><h3 id="4-5-1-动态-SQL"><a href="#4-5-1-动态-SQL" class="headerlink" title="4.5.1  动态 SQL"></a>4.5.1  动态 SQL</h3><blockquote>
<p>注意：拼接 字符串SQL 时，注意两边需要加单引号</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">StringBuilder  sql = <span class="keyword">new</span> StringBuilder(<span class="string">"select dt.*,e.realname,d.deptno deptno,d.deptname"</span>+</span><br><span class="line">						<span class="string">" from duty  dt"</span>+</span><br><span class="line">						<span class="string">" join employee e"</span>+</span><br><span class="line">						<span class="string">" on dt.emprid = e.empid"</span>+</span><br><span class="line">						<span class="string">" join dept d"</span>+</span><br><span class="line">						<span class="string">" on e.deptno = d.deptno"</span>+</span><br><span class="line">						<span class="string">" where 1=1"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(empId!=<span class="keyword">null</span>&amp;&amp;!<span class="string">""</span>.equals(empId))&#123;</span><br><span class="line">				sql.append(<span class="string">"and dt.emprid = '"</span>+empId+<span class="string">"'"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(deptNo!=<span class="number">0</span>)&#123;</span><br><span class="line">				sql.append(<span class="string">"and d.deptno = "</span>+deptNo);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(dtDate!=<span class="keyword">null</span>&amp;!<span class="string">""</span>.equals(dtDate))&#123;</span><br><span class="line">				sql.append(<span class="string">"and to_char(dt.dtdate,'yyyy-MM-dd') &gt;='"</span>+dtDate+<span class="string">"'"</span>);</span><br><span class="line">			</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(sql.toString());</span><br></pre></td></tr></table></figure>

<h3 id="4-5-2-PIO"><a href="#4-5-2-PIO" class="headerlink" title="4.5.2 PIO"></a>4.5.2 PIO</h3><blockquote>
<p><a href="https://baike.baidu.com/item/Apache/6265" target="_blank" rel="noopener">Apache</a> POI 是用<a href="https://baike.baidu.com/item/Java/85979" target="_blank" rel="noopener">Java</a>编写的免费开源的跨平台的 Java API，Apache POI提供API给Java程式对[Microsoft Office](<a href="https://baike.baidu.com/item/Microsoft" target="_blank" rel="noopener">https://baike.baidu.com/item/Microsoft</a> Office)格式档案读和写的功能。POI为“Poor Obfuscation Implementation”的首字母缩写，意为“简洁版的模糊实现”。</p>
</blockquote>
<ul>
<li><p>栗子</p>
<p>将考勤信息导出为 xls 格式的文档，然后通过浏览器下载到本地保存</p>
<p>注意：将xls格式的文档通过流的方式发送给客户端，并且要设置响应数据的格式和响应头</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据条件查询考勤信息</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllDutyInfoByCondition</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException, ServletException</span>&#123;</span><br><span class="line">		<span class="comment">//获取请求处理参数</span></span><br><span class="line">		String empId = req.getParameter(<span class="string">"empId"</span>);</span><br><span class="line">		</span><br><span class="line">		String sdeptNo = req.getParameter(<span class="string">"deptNo"</span>);</span><br><span class="line">		<span class="keyword">int</span> deptNo = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			deptNo = Integer.valueOf(sdeptNo); <span class="comment">// null 、非法字符</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(NumberFormatException e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		String sdtDate = req.getParameter(<span class="string">"dtDate"</span>);</span><br><span class="line">		Date dtDate = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			DateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">			dtDate = sdf.parse(sdtDate);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//调用业务层对象</span></span><br><span class="line">		List&lt;Duty&gt; dutyList = dutyService.findAllDutyInfoByConditionService(empId,deptNo,dtDate);</span><br><span class="line">		<span class="comment">//响应处理结果</span></span><br><span class="line">		Gson gson = <span class="keyword">new</span> GsonBuilder().setDateFormat(<span class="string">"yyyy-MM-dd"</span>).create();<span class="comment">//日期格式化</span></span><br><span class="line">		resp.getWriter().print(gson.toJson(dutyList));<span class="comment">//使用 ajax ，直接响应</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 导出 考勤信息 xls 文档</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exportXls</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException, ServletException</span>&#123;</span><br><span class="line">		<span class="comment">//获取请求处理参数</span></span><br><span class="line">		String empId = req.getParameter(<span class="string">"empId"</span>);</span><br><span class="line">		</span><br><span class="line">		String sdeptNo = req.getParameter(<span class="string">"deptNo"</span>);</span><br><span class="line">		<span class="keyword">int</span> deptNo = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			deptNo = Integer.valueOf(sdeptNo); <span class="comment">// null 、非法字符</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(NumberFormatException e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		String sdtDate = req.getParameter(<span class="string">"dtDate"</span>);</span><br><span class="line">		Date dtDate = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			DateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">			dtDate = sdf.parse(sdtDate);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//调用业务层对象</span></span><br><span class="line">		List&lt;Duty&gt; dutyList = dutyService.findAllDutyInfoByConditionService(empId,deptNo,dtDate);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//响应处理结果</span></span><br><span class="line">		createExcel(dutyList,resp);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createExcel</span><span class="params">(List&lt;Duty&gt; list,HttpServletResponse resp)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建一个Excel文件</span></span><br><span class="line">        HSSFWorkbook workbook = <span class="keyword">new</span> HSSFWorkbook();</span><br><span class="line">        <span class="comment">// 创建一个工作表</span></span><br><span class="line">        HSSFSheet sheet = workbook.createSheet(<span class="string">"考勤表一"</span>);</span><br><span class="line">        </span><br><span class="line">        CellRangeAddress region = <span class="keyword">new</span> CellRangeAddress(<span class="number">0</span>, <span class="comment">// first row</span></span><br><span class="line">                <span class="number">0</span>, <span class="comment">// last row</span></span><br><span class="line">                <span class="number">0</span>, <span class="comment">// first column</span></span><br><span class="line">                <span class="number">2</span> <span class="comment">// last column</span></span><br><span class="line">        );</span><br><span class="line">        sheet.addMergedRegion(region);</span><br><span class="line">        </span><br><span class="line">        HSSFRow hssfRow = sheet.createRow(<span class="number">0</span>);</span><br><span class="line">        HSSFCell headCell = hssfRow.createCell(<span class="number">0</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"OA系统之考勤列表"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置单元格格式居中</span></span><br><span class="line">        HSSFCellStyle cellStyle = workbook.createCellStyle();</span><br><span class="line">    	cellStyle.setAlignment(HSSFCellStyle.ALIGN_CENTER);</span><br><span class="line">      </span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加表头行</span></span><br><span class="line">        hssfRow = sheet.createRow(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 添加表头内容</span></span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">0</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"用户名"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">1</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"真实姓名"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">2</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"所属部门"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line">        </span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">3</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"出勤日期"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line">        </span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">4</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"签到时间"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line">        </span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">5</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"签退时间"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加数据内容</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            hssfRow = sheet.createRow((<span class="keyword">int</span>) i + <span class="number">2</span>);</span><br><span class="line">            Duty duty = list.get(i);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建单元格，并设置值</span></span><br><span class="line">            HSSFCell cell = hssfRow.createCell(<span class="number">0</span>);</span><br><span class="line">            cell.setCellValue(duty.getEmpId());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">            cell = hssfRow.createCell(<span class="number">1</span>);</span><br><span class="line">            cell.setCellValue(duty.getEmp().getRealName());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">            cell = hssfRow.createCell(<span class="number">2</span>);</span><br><span class="line">            cell.setCellValue(duty.getEmp().getDept().getDeptName());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line">            </span><br><span class="line">            cell = hssfRow.createCell(<span class="number">3</span>);</span><br><span class="line">            cell.setCellValue(duty.getDtDate());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line">            </span><br><span class="line">            cell = hssfRow.createCell(<span class="number">4</span>);</span><br><span class="line">            cell.setCellValue(duty.getSignInTime());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line">            </span><br><span class="line">            cell = hssfRow.createCell(<span class="number">5</span>);</span><br><span class="line">            cell.setCellValue(duty.getSignOutTime());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存Excel文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">/* OutputStream outputStream = new FileOutputStream("D:/students.xls");*/</span> <span class="comment">//保存到本地（即服务器）</span></span><br><span class="line">        		<span class="comment">//设置响应数据格式</span></span><br><span class="line">        		resp.setContentType(<span class="string">"application/vnd.ms-excel"</span>);</span><br><span class="line">        		resp.setHeader(<span class="string">"Content-disposition"</span>, <span class="string">"attachment; fileName=duty.xls"</span>);</span><br><span class="line">        		OutputStream outputStream  = resp.getOutputStream();</span><br><span class="line">	            workbook.write(outputStream);</span><br><span class="line">	            outputStream.close();</span><br><span class="line">	        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	            e.printStackTrace();</span><br><span class="line">	        &#125;</span><br><span class="line">	    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="5-报销模块"><a href="#5-报销模块" class="headerlink" title="5 报销模块"></a>5 报销模块</h1><p>注意： Oracle 不能获取 char 类型的字符     </p>
<h2 id="5-1-自定义异常"><a href="#5-1-自定义异常" class="headerlink" title="5.1 自定义异常"></a>5.1 自定义异常</h2><blockquote>
<p>直接异常的结果抛给调用该类的上级处理</p>
</blockquote>
<h3 id="5-5-1-自定义异常类"><a href="#5-5-1-自定义异常类" class="headerlink" title="5.5.1 自定义异常类"></a>5.5.1 自定义异常类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.util;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义异常信息</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">super</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">super</span>(message);</span><br><span class="line">		&#125;</span><br><span class="line">	  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-1-2-DBUtil-使用自定义异常类"><a href="#5-1-2-DBUtil-使用自定义异常类" class="headerlink" title="5.1.2 DBUtil 使用自定义异常类"></a>5.1.2 DBUtil 使用自定义异常类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">executeDML</span><span class="params">(String sql,Object...objs)</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">				Connection conn = <span class="keyword">null</span>;</span><br><span class="line">				PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">				<span class="keyword">int</span> i = -<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">	</span><br><span class="line">					conn = DBUtil.getConnection();</span><br><span class="line"></span><br><span class="line">					conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">					ps = conn.prepareStatement(sql);</span><br><span class="line">					<span class="keyword">if</span>(objs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">						<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;objs.length;j++)&#123;</span><br><span class="line">							ps.setObject(j+<span class="number">1</span>,objs[j]);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				</span><br><span class="line">					i = ps.executeUpdate();</span><br><span class="line">					conn.commit();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						conn.rollback();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e1.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">					<span class="comment">//抛出给上级调用者</span></span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> MyException(e.toString());</span><br><span class="line">				&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">					DBUtil.closeAll(<span class="keyword">null</span>, ps, conn);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> i;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-servlet-中调用业务层发生错误的处理办法"><a href="#5-2-servlet-中调用业务层发生错误的处理办法" class="headerlink" title="5.2 servlet 中调用业务层发生错误的处理办法"></a>5.2 servlet 中调用业务层发生错误的处理办法</h2><blockquote>
<p>使用 try{}catch{}语句,若调业务层发生错误，则直接打印错误信息，并把错误信息返回给客户端</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">				expenseService.add(exp); <span class="comment">//不接受返回值	</span></span><br><span class="line">				<span class="comment">//响应处理结果</span></span><br><span class="line">				resp.sendRedirect(req.getContextPath()+<span class="string">"/expense/myExpense.jsp"</span>);</span><br><span class="line">			&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">				<span class="comment">//业务层发生错误，则重定向到添加报销单界面，并携带错误信息</span></span><br><span class="line">				req.setAttribute(<span class="string">"error"</span>, <span class="string">"添加报销单失败"</span>);</span><br><span class="line">				req.getRequestDispatcher(<span class="string">"/expense/expenseAdd.jsp"</span>).forward(req, resp);</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-3-service-层事务处理"><a href="#5-3-service-层事务处理" class="headerlink" title="5.3 service 层事务处理"></a>5.3 service 层事务处理</h2><blockquote>
<p>在 dao 层，一个DML操作就相当于一个事务。</p>
<p>但是当 service 层，调用两个不同 dao 层，就相当于执行不同两个事务。</p>
<p>问题：将 两个 dao 层的事务，在 service 层合并成一个事务操作？</p>
<p>解决：</p>
<p>在 service 层，先关闭事务的自动提交，并在DML 操作成功执行完毕后 commit 提交，否则 rollback 。    </p>
<p>​    1. 在 service 创建 Connection 连接对象，将该对象传入 DML 操作中。 缺点：过于麻烦</p>
<p>​    2.修改 DBUtil 工具类，改用 TreadLocal 类获取 Connection 连接对象。</p>
<p>注意：保证两个不同 dao 层的 DML 操作使用同一个 Connection 连接对象。 </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.ExpenseDao;</span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.ExpenseItemDao;</span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.impl.ExpenseDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.impl.ExpenseItemDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.Expense;</span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.ExpenseItem;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.ExpenseService;</span><br><span class="line"><span class="keyword">import</span> com.szxy.util.DBUtil;</span><br><span class="line"><span class="keyword">import</span> com.szxy.util.DBUtil2;</span><br><span class="line"><span class="keyword">import</span> com.szxy.util.MyException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 	报销单类</span></span><br><span class="line"><span class="comment"> * 	</span></span><br><span class="line"><span class="comment"> * 问题：怎么获取当前报销单编号？ </span></span><br><span class="line"><span class="comment"> * 解决：获取当前序列的值</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 在 dao 层，一个DML操作就相当于一个事务。</span></span><br><span class="line"><span class="comment"> * 但是当 service 层，调用两个不同 dao 层，就相当于执行不同两个事务。</span></span><br><span class="line"><span class="comment"> * 问题：将 两个 dao 层的事务，在 service 层合并成一个事务操作？</span></span><br><span class="line"><span class="comment"> * 解决：</span></span><br><span class="line"><span class="comment"> * 		在 service 层，先关闭事务的自动提交，并在DML 操作成功执行完毕后 commit 提交，否则 rollback 。	</span></span><br><span class="line"><span class="comment"> * 		1. 在 service 创建 Connection 连接对象，将该对象传入 DML 操作中。 缺点：过于麻烦</span></span><br><span class="line"><span class="comment"> * 		2. 修改 DBUtil 工具类，改用 TreadLocal 类获取 Connection 连接对象。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 注意：保证两个不同 dao 层的 DML 操作使用同一个 Connection 连接对象。 </span></span><br><span class="line"><span class="comment"> * 	</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExpenseServiceImpl</span> <span class="keyword">implements</span> <span class="title">ExpenseService</span></span>&#123;</span><br><span class="line">	ExpenseDao  expenseDao = <span class="keyword">new</span> ExpenseDaoImpl();</span><br><span class="line">	ExpenseItemDao itemDao = <span class="keyword">new</span> ExpenseItemDaoImpl();</span><br><span class="line">	<span class="comment">//添加报销单信息s</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Expense exp)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取当前序列的值</span></span><br><span class="line">		<span class="keyword">int</span> nextVal = expenseDao.getExpidNextval();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取 数据库连接 对象</span></span><br><span class="line">		Connection conn = DBUtil2.getConnection();</span><br><span class="line">		<span class="comment">//关闭事务自动提交</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">			<span class="comment">//保存报销单主表</span></span><br><span class="line">			java.sql.Date exptime = <span class="keyword">new</span> java.sql.Date(exp.getExptime().getTime());</span><br><span class="line">			Expense expense = </span><br><span class="line">			<span class="keyword">new</span> Expense(nextVal,exp.getEmpId(), exp.getTotalAmount(),exptime , exp.getExpdesc(), exp.getNextAuditor(), exp.getLastResult(), exp.getStatus());</span><br><span class="line">			expenseDao.save(expense);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//保存报销单明细</span></span><br><span class="line">			List&lt;ExpenseItem&gt; itemList = exp.getItemList();</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; itemList.size(); i++) &#123;</span><br><span class="line">				ExpenseItem item = </span><br><span class="line">				<span class="keyword">new</span> ExpenseItem(nextVal,itemList.get(i).getType(), itemList.get(i).getAmount(), itemList.get(i).getItemdesc());</span><br><span class="line">				itemDao.save(item);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//成功执行上面的 DML 操作后，提交事务</span></span><br><span class="line">			conn.commit(); </span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="comment">//抛出给上级调用者</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MyException(e.toString());</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="comment">//关闭数据库连接</span></span><br><span class="line">			DBUtil2.closeAll(<span class="keyword">null</span>, <span class="keyword">null</span>, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">			</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-4-使用浏览器地址栏上的信息"><a href="#5-4-使用浏览器地址栏上的信息" class="headerlink" title="5.4 使用浏览器地址栏上的信息"></a>5.4 使用浏览器地址栏上的信息</h2><blockquote>
<p>不通过 servlet 转发，采用 EL 表达式实现 </p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">$&#123;param.地址栏上带有的参数名&#125;</span> "/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 相当于 req.getParameter("参数名") --&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-5-关闭子窗口，刷新父窗口"><a href="#5-5-关闭子窗口，刷新父窗口" class="headerlink" title="5.5 关闭子窗口，刷新父窗口"></a>5.5 关闭子窗口，刷新父窗口</h2><blockquote>
<p> <code>window.close();</code>//关闭当前窗口<br><code>window.opener.location.reload();</code>    //刷新父窗口</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">$.ajax(&#123;</span></span><br><span class="line"><span class="javascript">    url:<span class="string">"expense"</span>,</span></span><br><span class="line"><span class="javascript">    data:&#123;<span class="attr">method</span>:<span class="string">"audit"</span>,<span class="attr">expId</span>:expId,<span class="attr">result</span>:result,<span class="attr">auditDesc</span>:auditDesc&#125;,</span></span><br><span class="line"><span class="javascript">    type:<span class="string">"POST"</span>,</span></span><br><span class="line"><span class="javascript">    success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(data == <span class="string">"success"</span>)&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">"审核成功"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.close(); <span class="comment">//关闭当前窗口</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.opener.location.reload();    <span class="comment">//刷新父窗口</span></span></span><br><span class="line"><span class="javascript">             <span class="comment">/* 	window.location.reload(); //刷新当前窗口 */</span></span></span><br><span class="line"><span class="javascript">        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">"审核失败"</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-6-画业务流程图"><a href="#5-6-画业务流程图" class="headerlink" title="5.6  画业务流程图"></a>5.6  画业务流程图</h2><p><img src="http://www.zwer.xyz/picGo/%E5%AE%A1%E6%A0%B8%E6%B5%81%E7%A8%8B%E5%9B%BE1.png" alt></p>
<h3 id="5-6-1-第一步"><a href="#5-6-1-第一步" class="headerlink" title="5.6.1 第一步"></a>5.6.1 第一步</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *   审核报销单</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">audit</span><span class="params">(Auditing audit)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//根据业务流程图，写出大概步骤</span></span><br><span class="line">		<span class="keyword">if</span>(是财务)&#123;<span class="comment">//是财务</span></span><br><span class="line">			<span class="comment">//添加财务支出信息</span></span><br><span class="line">			<span class="comment">//修改报销单状态</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;<span class="comment">//不是财务</span></span><br><span class="line">			<span class="keyword">if</span>(审核通过)&#123;<span class="comment">//审核通过</span></span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(&gt;<span class="number">2500</span>)&#123;</span><br><span class="line">					<span class="keyword">if</span>(总裁)&#123; <span class="comment">//是总裁</span></span><br><span class="line">						<span class="comment">//添加审核记录</span></span><br><span class="line">						<span class="comment">//修改报销单状态</span></span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">						<span class="comment">//添加审核记录</span></span><br><span class="line">						<span class="comment">//修改报销单状态</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;<span class="comment">//小于 2500</span></span><br><span class="line">					<span class="comment">//添加审核记录</span></span><br><span class="line">					<span class="comment">//修改报销单状态</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;<span class="comment">//审核没通过</span></span><br><span class="line">				<span class="comment">//添加审核记录</span></span><br><span class="line">				<span class="comment">//修改报销单状态</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-6-2-第二步"><a href="#5-6-2-第二步" class="headerlink" title="5.6.2 第二步"></a>5.6.2 第二步</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">audit</span><span class="params">(Auditing audit)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//获取当前数据库连接</span></span><br><span class="line">		Connection conn = DBUtil2.getConnection();</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			conn.setAutoCommit(<span class="keyword">false</span>); <span class="comment">//关闭自动提交</span></span><br><span class="line">			<span class="comment">//根据业务流程图，写出大概步骤</span></span><br><span class="line">			String empId = audit.getEmpId();<span class="comment">//审核人的ID </span></span><br><span class="line">			<span class="keyword">if</span>(empId.equals(Constants.POSITION_CFO))&#123;<span class="comment">//是财务</span></span><br><span class="line">				<span class="comment">//添加财务支出信息</span></span><br><span class="line">				<span class="comment">//修改报销单状态</span></span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;<span class="comment">//不是财务</span></span><br><span class="line">				String result = audit.getResult();</span><br><span class="line">				<span class="keyword">if</span>(result.equals(<span class="string">"通过"</span>))&#123;<span class="comment">//审核通过</span></span><br><span class="line">					Expense expense = expenseDao.findExpenseByExpId(audit.getExpId());</span><br><span class="line">					<span class="keyword">double</span> totalAmount = expense.getTotalAmount();</span><br><span class="line">					<span class="keyword">if</span>(totalAmount &gt; <span class="number">2500</span>)&#123;</span><br><span class="line">						<span class="keyword">if</span>(empId.equals(Constants.POSITION_CEO))&#123; <span class="comment">//是总裁</span></span><br><span class="line">							<span class="comment">//添加审核记录</span></span><br><span class="line">							auditDao.save(audit);</span><br><span class="line">							</span><br><span class="line">							Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">							exp.setExpId(audit.getExpId());</span><br><span class="line">							exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">							exp.setLastResult(<span class="string">"审核通过"</span>);</span><br><span class="line">							exp.setStatus(Constants.EXPENSE_STATUS_AUDITED); 						</span><br><span class="line">							<span class="comment">//修改报销单状态</span></span><br><span class="line">							expenseDao.update(exp);</span><br><span class="line">						&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">							<span class="comment">//添加审核记录</span></span><br><span class="line">							auditDao.save(audit);</span><br><span class="line">							</span><br><span class="line">							Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">							exp.setExpId(audit.getExpId());</span><br><span class="line">							exp.setNextAuditor(<span class="string">"gaoqi"</span>);   <span class="comment">//交给下一个审核人，简化难度</span></span><br><span class="line">							exp.setNextAuditor(audit.getExp().getNextAuditor());  </span><br><span class="line">							exp.setLastResult(Constants.EXPENSE_STATUS_AUDITING);</span><br><span class="line">							exp.setStatus(<span class="string">"1"</span>);</span><br><span class="line">							<span class="comment">//修改报销单状态</span></span><br><span class="line">							expenseDao.update(exp);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;<span class="comment">//小于 2500</span></span><br><span class="line">						<span class="comment">//添加审核记录</span></span><br><span class="line">						auditDao.save(audit);</span><br><span class="line">						Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">						exp.setExpId(audit.getExpId());</span><br><span class="line">						exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">						exp.setLastResult(<span class="string">"审核通过"</span>);</span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_AUDITED); 						</span><br><span class="line">						<span class="comment">//修改报销单状态</span></span><br><span class="line">						expenseDao.update(exp);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;<span class="comment">//审核没通过 ，一种是打回，一种是拒绝</span></span><br><span class="line">					</span><br><span class="line">					<span class="comment">//添加审核记录</span></span><br><span class="line">					auditDao.save(audit);</span><br><span class="line">					</span><br><span class="line">					Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">					exp.setExpId(audit.getExpId());</span><br><span class="line">					exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">					exp.setLastResult(<span class="string">"未通过"</span>);</span><br><span class="line">					<span class="keyword">if</span>(<span class="string">"打回"</span>.equals(audit.getResult()))&#123;</span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_BACK); 						</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;<span class="comment">//拒绝</span></span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_REJECT); 						</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="comment">//修改报销单状态</span></span><br><span class="line">					expenseDao.update(exp);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			conn.commit(); <span class="comment">//提交事务</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			<span class="comment">//回滚</span></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				conn.rollback();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">				e1.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MyException(e.toString());</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			DBUtil2.closeAll(<span class="keyword">null</span>, <span class="keyword">null</span>, conn);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;*/</span><br></pre></td></tr></table></figure>

<h3 id="5-6-3-第三步优化"><a href="#5-6-3-第三步优化" class="headerlink" title="5.6.3 第三步优化"></a>5.6.3 第三步优化</h3><blockquote>
<p>使用常量类，及合并多余代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">audit</span><span class="params">(Auditing audit)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//添加审核记录</span></span><br><span class="line">		auditDao.save(audit);</span><br><span class="line">		<span class="comment">//添加报销单信息</span></span><br><span class="line">		Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">		exp.setExpId(audit.getExpId());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取当前数据库连接</span></span><br><span class="line">		Connection conn = DBUtil2.getConnection();</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			conn.setAutoCommit(<span class="keyword">false</span>); <span class="comment">//关闭自动提交</span></span><br><span class="line">			<span class="comment">//根据业务流程图，写出大概步骤</span></span><br><span class="line">			String empId = audit.getEmpId();<span class="comment">//审核人的ID </span></span><br><span class="line">			<span class="keyword">if</span>(empId.equals(Constants.POSITION_CFO))&#123;<span class="comment">//是财务</span></span><br><span class="line">				<span class="comment">//添加财务支出信息</span></span><br><span class="line">				<span class="comment">//修改报销单状态</span></span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;<span class="comment">//不是财务</span></span><br><span class="line">				String result = audit.getResult();</span><br><span class="line">				<span class="keyword">if</span>(result.equals(<span class="string">"通过"</span>))&#123;<span class="comment">//审核通过</span></span><br><span class="line">					Expense expense = expenseDao.findExpenseByExpId(audit.getExpId());</span><br><span class="line">					<span class="keyword">double</span> totalAmount = expense.getTotalAmount();</span><br><span class="line">					<span class="keyword">if</span>(totalAmount &gt; <span class="number">2500</span>)&#123;</span><br><span class="line">						<span class="keyword">if</span>(empId.equals(Constants.POSITION_CEO))&#123; <span class="comment">//是总裁</span></span><br><span class="line">							<span class="comment">//添加审核记录</span></span><br><span class="line">							exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">							exp.setLastResult(<span class="string">"审核通过"</span>);</span><br><span class="line">							exp.setStatus(Constants.EXPENSE_STATUS_AUDITED); 						</span><br><span class="line">						&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">							<span class="comment">//添加审核记录</span></span><br><span class="line">							exp.setNextAuditor(<span class="string">"gaoqi"</span>);   <span class="comment">//交给下一个审核人，简化难度</span></span><br><span class="line">							<span class="comment">/*exp.setNextAuditor(audit.getExp().getNextAuditor()); */</span> </span><br><span class="line">							exp.setLastResult(Constants.EXPENSE_STATUS_AUDITING);</span><br><span class="line">							exp.setStatus(<span class="string">"1"</span>);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;<span class="comment">//小于 2500</span></span><br><span class="line">						exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">						exp.setLastResult(<span class="string">"审核通过"</span>);</span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_AUDITED); 						</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;<span class="comment">//审核没通过 ，一种是打回，一种是拒绝</span></span><br><span class="line">					exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">					exp.setLastResult(<span class="string">"未通过"</span>);</span><br><span class="line">					<span class="keyword">if</span>(<span class="string">"打回"</span>.equals(audit.getResult()))&#123;</span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_BACK); 						</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;<span class="comment">//拒绝</span></span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_REJECT); 						</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			expenseDao.update(exp); <span class="comment">//修改报销单状态</span></span><br><span class="line">			conn.commit();    <span class="comment">//提交事务</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			<span class="comment">//回滚</span></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				conn.rollback();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">				e1.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MyException(e.toString());</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			DBUtil2.closeAll(<span class="keyword">null</span>, <span class="keyword">null</span>, conn);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-7-使用常量类"><a href="#5-7-使用常量类" class="headerlink" title="5.7 使用常量类"></a>5.7 使用常量类</h2><blockquote>
<p>替代直接使用变量</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.util;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 常量类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//审核状态</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_AUDITING = <span class="string">"1"</span>;  <span class="comment">// 审核中</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_AUDITED = <span class="string">"2"</span>;   <span class="comment">// 审核完成</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_BACK = <span class="string">"3"</span>;      <span class="comment">// 打回</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_REJECT = <span class="string">"4"</span>;    <span class="comment">// 拒绝</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_CASHED = <span class="string">"5"</span>;    <span class="comment">// 打款</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//部门特殊职位姓名</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String POSITION_CEO = <span class="string">"gaoqi"</span>;    <span class="comment">//总裁</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String POSITION_CFO = <span class="string">"lifuying"</span>; <span class="comment">//首席账务官</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-8-bug之数据库连接关闭"><a href="#5-8-bug之数据库连接关闭" class="headerlink" title="5.8  bug之数据库连接关闭"></a>5.8  bug之数据库连接关闭</h2><blockquote>
<p>问题描述：最开始是使用一个用户处理报销单操作，审核没有问题，但是换到下一个用户时再处理报销单操作，出现审核失败，原因是数据库连接被关闭，但是数据库连接对象并没有被销毁。</p>
<p>解决：</p>
<p>在DBUtil2中，获取数据库连接方法中判断 conn 对象是否关闭 isClose()，若关闭则重新创建新的数据连接对象。</p>
<p>问题推测：可能是切换用户时，出现了数据库连接关闭或者 使用 ThreadLocal 管理 conn 对象的原因。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Connection conn=<span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 从 ThreadLocal 中获取 Connection 数据库连接对象</span></span><br><span class="line">		conn = threadLocal.get();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>( conn == <span class="keyword">null</span> || conn.isClosed())&#123;  <span class="comment">//第一次创建 Connection 数据库连接对象,并且判断当前数据库是否关闭，若关闭需要重新创建</span></span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					conn = DriverManager.getConnection(url, username, password);</span><br><span class="line">					<span class="comment">//将 conn 放入 ThreadLocal 中</span></span><br><span class="line">					threadLocal.set(conn);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">					<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/*try &#123;</span></span><br><span class="line"><span class="comment">			System.out.println("conn的状态："+conn.isClosed());</span></span><br><span class="line"><span class="comment">		&#125; catch (SQLException e1) &#123;</span></span><br><span class="line"><span class="comment">			// TODO Auto-generated catch block</span></span><br><span class="line"><span class="comment">			e1.printStackTrace();</span></span><br><span class="line"><span class="comment">		&#125;*/</span></span><br><span class="line">		<span class="keyword">return</span> conn;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h1 id="6-收支管理"><a href="#6-收支管理" class="headerlink" title="6 收支管理"></a>6 收支管理</h1><h2 id="6-1-echart-（Enterprise-charts-商业产品图标库）入门"><a href="#6-1-echart-（Enterprise-charts-商业产品图标库）入门" class="headerlink" title="6.1  echart （Enterprise charts 商业产品图标库）入门"></a>6.1  echart （Enterprise charts 商业产品图标库）入门</h2><blockquote>
<p>ECharts，一个使用 JavaScript 实现的开源可视化库，可以流畅的运行在 PC 和移动设备上，兼容当前绝大部分浏览器（IE8/9/10/11，Chrome，Firefox，Safari等），底层依赖轻量级的矢量图形库 <a href="https://github.com/ecomfe/zrender" target="_blank" rel="noopener">ZRender</a>，提供直观，交互丰富，可高度个性化定制的数据可视化图表。</p>
</blockquote>
<h3 id="6-1-1-特性"><a href="#6-1-1-特性" class="headerlink" title="6.1.1  特性"></a>6.1.1  特性</h3><ol>
<li><p>丰富的可视化类型</p>
<p>ECharts 提供了常规的<a href="https://echarts.baidu.com/option.html#series-line" target="_blank" rel="noopener">折线图</a>、<a href="https://echarts.baidu.com/option.html#series-line" target="_blank" rel="noopener">柱状图</a>、<a href="https://echarts.baidu.com/option.html#series-scatter" target="_blank" rel="noopener">散点图</a>、<a href="https://echarts.baidu.com/option.html#series-pie" target="_blank" rel="noopener">饼图</a>、<a href="https://echarts.baidu.com/option.html#series-candlestick" target="_blank" rel="noopener">K线图</a>，用于统计的<a href="https://echarts.baidu.com/option.html#series-boxplot" target="_blank" rel="noopener">盒形图</a>，用于地理数据可视化的<a href="https://echarts.baidu.com/option.html#series-map" target="_blank" rel="noopener">地图</a>、<a href="https://echarts.baidu.com/option.html#series-heatmap" target="_blank" rel="noopener">热力图</a>、<a href="https://echarts.baidu.com/option.html#series-lines" target="_blank" rel="noopener">线图</a>，用于关系数据可视化的<a href="https://echarts.baidu.com/option.html#series-graph" target="_blank" rel="noopener">关系图</a>、<a href="https://echarts.baidu.com/option.html#series-treemap" target="_blank" rel="noopener">treemap</a>、<a href="https://echarts.baidu.com/option.html#series-sunburst" target="_blank" rel="noopener">旭日图</a>，多维数据可视化的<a href="https://echarts.baidu.com/option.html#series-parallel" target="_blank" rel="noopener">平行坐标</a>，还有用于 BI 的<a href="https://echarts.baidu.com/option.html#series-funnel" target="_blank" rel="noopener">漏斗图</a>，<a href="https://echarts.baidu.com/option.html#series-gauge" target="_blank" rel="noopener">仪表盘</a>，并且支持图与图之间的混搭。</p>
</li>
<li><p>多种数据格式无需转换直接使用</p>
<p>ECharts 内置的 dataset 属性（4.0+）支持直接传入包括二维表，key-value 等多种格式的数据源，通过简单的设置 encode 属性就可以完成从数据到图形的映射，这种方式更符合可视化的直觉，省去了大部分场景下数据转换的步骤，而且多个组件能够共享一份数据而不用克隆</p>
</li>
</ol>
<h3 id="6-1-2-使用"><a href="#6-1-2-使用" class="headerlink" title="6.1.2 使用"></a>6.1.2 使用</h3><ul>
<li>导入 eCharts.js 文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入 eCharts 文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/echarts.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>新建一个 div ，并设置图标的格式和数据</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>eCharts 图标入门<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"pragma"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"cache-control"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"expires"</span> <span class="attr">content</span>=<span class="string">"0"</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"keywords"</span> <span class="attr">content</span>=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">"This is my page"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	&lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 导入 Jquery  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 导入 eCharts 文件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/echarts.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  	</span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">   		  <span class="comment">&lt;!-- 为 ECharts 准备一个具备大小（宽高）的 DOM --&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"main"</span> <span class="attr">style</span>=<span class="string">"width: 600px;height:400px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    	</span><br><span class="line">    	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">	        <span class="comment">// 基于准备好的dom，初始化echarts实例</span></span></span><br><span class="line"><span class="javascript">	        <span class="keyword">var</span> myChart = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">'main'</span>));</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">	        <span class="comment">// 指定图表的配置项和数据</span></span></span><br><span class="line"><span class="javascript">	        <span class="keyword">var</span> option = &#123;</span></span><br><span class="line">	            title: &#123;</span><br><span class="line"><span class="javascript">	                text: <span class="string">'ECharts 入门示例'</span></span></span><br><span class="line">	            &#125;,</span><br><span class="line">	            tooltip: &#123;&#125;,</span><br><span class="line">	            legend: &#123;</span><br><span class="line"><span class="javascript">	                data:[<span class="string">'销量'</span>]</span></span><br><span class="line">	            &#125;,</span><br><span class="line">	            xAxis: &#123;</span><br><span class="line"><span class="javascript">	                data: [<span class="string">"衬衫"</span>,<span class="string">"羊毛衫"</span>,<span class="string">"雪纺衫"</span>,<span class="string">"裤子"</span>,<span class="string">"高跟鞋"</span>,<span class="string">"袜子"</span>]</span></span><br><span class="line">	            &#125;,</span><br><span class="line">	            yAxis: &#123;&#125;,</span><br><span class="line">	            series: [&#123;</span><br><span class="line"><span class="javascript">	                name: <span class="string">'销量'</span>,</span></span><br><span class="line"><span class="javascript">	                type: <span class="string">'bar'</span>,  <span class="comment">//表示柱状图</span></span></span><br><span class="line">	                data: [5, 20, 36, 10, 10, 20]</span><br><span class="line">	            &#125;]</span><br><span class="line">	        &#125;;</span><br><span class="line">	</span><br><span class="line"><span class="javascript">	        <span class="comment">// 使用刚指定的配置项和数据显示图表。</span></span></span><br><span class="line">	        myChart.setOption(option);</span><br><span class="line">	   	 <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-1-3-效果"><a href="#6-1-3-效果" class="headerlink" title="6.1.3 效果"></a>6.1.3 效果</h3><p><img src="http://www.zwer.xyz/picGo/20190428205130.png" alt></p>
<h1 id="7-项目总结"><a href="#7-项目总结" class="headerlink" title="7 项目总结"></a>7 项目总结</h1><h2 id="7-1-项目核心知识点"><a href="#7-1-项目核心知识点" class="headerlink" title="7.1 项目核心知识点"></a>7.1 项目核心知识点</h2><ol>
<li>ServletAPI 的使用</li>
<li>JSP 四个作用域</li>
<li>JSTL 标签库与 EL 表达式</li>
</ol>
<h2 id="7-2-分层功能分配"><a href="#7-2-分层功能分配" class="headerlink" title="7.2 分层功能分配"></a>7.2 分层功能分配</h2><ul>
<li>实体类、dao 层基本上与数据库表相对应</li>
<li>业务层、控制层、视图层更倾向于按照模块划分</li>
</ul>
<h1 id="8-分页功能"><a href="#8-分页功能" class="headerlink" title="8 分页功能"></a>8 分页功能</h1><h2 id="8-1-分页的意义"><a href="#8-1-分页的意义" class="headerlink" title="8.1 分页的意义"></a>8.1 分页的意义</h2><ol>
<li>数据量较大，一次加载所需的时间长</li>
<li>数据量较大，浏览器页面不能全局显示，采用分页，数据更加清晰明了</li>
</ol>
<h2 id="8-2-PageBean-分页工具类"><a href="#8-2-PageBean-分页工具类" class="headerlink" title="8.2  PageBean 分页工具类"></a>8.2  PageBean 分页工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页的三个基本属性</span></span><br><span class="line"><span class="comment"> * 1.每页几条记录size  可以有默认值5</span></span><br><span class="line"><span class="comment"> * 2.当前页号  index    可以有默认值1</span></span><br><span class="line"><span class="comment"> * 3.记录总数totalCount：不可能有默认值，需要查询数据库获取真正的记录总数</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 4.一共多少页 ：totalPageCount=totalCount/size+1</span></span><br><span class="line"><span class="comment"> * 		5  30  31 32 33 34 35  </span></span><br><span class="line"><span class="comment"> * 5.上一页    index-1  当前页1，上一页1</span></span><br><span class="line"><span class="comment"> * 6.下一页   index+1  当前页是最后一页  下一页：还是最后一页</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 扩展</span></span><br><span class="line"><span class="comment"> * 分页Bean还可以放要查询的数据  protected List&lt;T&gt; list;</span></span><br><span class="line"><span class="comment"> * 分页Bean还可以放页码列表     [1]  2  3  4  5   private int[] numbers;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageBean</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">5</span>;<span class="comment">//每页显示记录  //</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> index = <span class="number">1</span>;<span class="comment">// 当前页号      </span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> totalCount = <span class="number">0</span>;<span class="comment">// 记录总数      ok</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> totalPageCount = <span class="number">1</span>;<span class="comment">// 总页数   ok</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span>[] numbers;<span class="comment">//展示页数集合  //ok</span></span><br><span class="line">	<span class="keyword">protected</span> List&lt;T&gt; list;<span class="comment">//要显示到页面的数据集  </span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 得到开始记录</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStartRow</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> (index - <span class="number">1</span>) * size;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 得到结束记录</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getEndRow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> index * size;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the size.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;		</span><br><span class="line">		<span class="keyword">return</span> size;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> size</span></span><br><span class="line"><span class="comment">	 * The size to set.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSize</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.size = size;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the currentPageNo.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (totalPageCount == <span class="number">0</span>) &#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> index;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> currentPageNo</span></span><br><span class="line"><span class="comment">	 * The currentPageNo to set.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.index = index;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the totalCount.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> totalCount;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> totalCount</span></span><br><span class="line"><span class="comment">	 *  The totalCount to set.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalCount</span><span class="params">(<span class="keyword">int</span> totalCount)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (totalCount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.totalCount = totalCount;</span><br><span class="line">			setTotalPageCountByRs();<span class="comment">//根据总记录数计算总页�?</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPageCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.totalPageCount;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据总记录数计算总页�?</span></span><br><span class="line"><span class="comment">	 * 5   </span></span><br><span class="line"><span class="comment">	 * 20    4</span></span><br><span class="line"><span class="comment">	 * 23    5</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setTotalPageCountByRs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.size &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.totalCount &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.totalCount % <span class="keyword">this</span>.size == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.totalPageCount = <span class="keyword">this</span>.totalCount / <span class="keyword">this</span>.size;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.size &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.totalCount &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.totalCount % <span class="keyword">this</span>.size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.totalPageCount = (<span class="keyword">this</span>.totalCount / <span class="keyword">this</span>.size) + <span class="number">1</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">this</span>.totalPageCount = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		setNumbers(totalPageCount);<span class="comment">//获取展示页数集合</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span>[] getNumbers() &#123;</span><br><span class="line">		<span class="keyword">return</span> numbers;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置显示页数集合</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * 默认显示10个页码</span></span><br><span class="line"><span class="comment">	 * 41  42  43  44    [45 ]   46  47  48  49  50</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 *  [1] 2  3 4  5 6 7 8  9  10</span></span><br><span class="line"><span class="comment">	 *  </span></span><br><span class="line"><span class="comment">	 *  41  42  43  44    45    46  47  [48]  49  50</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> totalPageCount</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumbers</span><span class="params">(<span class="keyword">int</span> totalPageCount)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(totalPageCount&gt;<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="comment">//!.当前数组的长度</span></span><br><span class="line">			<span class="keyword">int</span>[] numbers = <span class="keyword">new</span> <span class="keyword">int</span>[totalPageCount&gt;<span class="number">10</span>?<span class="number">10</span>:totalPageCount];<span class="comment">//页面要显示的页数集合</span></span><br><span class="line">			<span class="keyword">int</span> k =<span class="number">0</span>;</span><br><span class="line">			<span class="comment">//</span></span><br><span class="line">			<span class="comment">//1.数组长度&lt;10   1 2 3 4 ....   7</span></span><br><span class="line">			<span class="comment">//2.数组长度&gt;=10</span></span><br><span class="line">			<span class="comment">//     当前页&lt;=6  1 2 3 4    10</span></span><br><span class="line">			<span class="comment">//     当前页&gt;=总页数-5           ......12 13 14 15  </span></span><br><span class="line">			<span class="comment">//     其他                                5  6  7 8   9 当前页(10)  10  11 12  13</span></span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; totalPageCount;i++)&#123;</span><br><span class="line">				<span class="comment">//保证当前页为集合的中�?</span></span><br><span class="line">				<span class="keyword">if</span>((i&gt;=index- (numbers.length/<span class="number">2</span>+<span class="number">1</span>) || i &gt;= totalPageCount-numbers.length) &amp;&amp; k&lt;numbers.length)&#123;</span><br><span class="line">					numbers[k] = i+<span class="number">1</span>;</span><br><span class="line">					k++;</span><br><span class="line">				&#125;<span class="keyword">else</span> <span class="keyword">if</span>(k&gt;=numbers.length)&#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;				</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">this</span>.numbers = numbers;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumbers</span><span class="params">(<span class="keyword">int</span>[] numbers)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.numbers = numbers;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">getList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setList</span><span class="params">(List&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.list = list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	public static int getTotalPageCount(int iTotalRecordCount, int iPageSize) &#123;</span></span><br><span class="line"><span class="comment">		if (iPageSize == 0) &#123;</span></span><br><span class="line"><span class="comment">			return 0;</span></span><br><span class="line"><span class="comment">		&#125; else &#123;</span></span><br><span class="line"><span class="comment">			return (iTotalRecordCount % iPageSize) == 0 ? (iTotalRecordCount / iPageSize) : (iTotalRecordCount / iPageSize) + 1;</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">	&#125;*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-3-数据库分页"><a href="#8-3-数据库分页" class="headerlink" title="8.3 数据库分页"></a>8.3 数据库分页</h3><h3 id="8-3-1-Oracle-分页"><a href="#8-3-1-Oracle-分页" class="headerlink" title="8.3.1 Oracle 分页"></a>8.3.1 Oracle 分页</h3><blockquote>
<p>需要用到三层子查询，注意 rownum 不能使用 大于，否则查询不到记录。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span>(</span><br><span class="line">  <span class="keyword">select</span> <span class="keyword">rownum</span> rn,t.* <span class="keyword">from</span>(</span><br><span class="line">  <span class="keyword">select</span> * <span class="keyword">from</span> student  <span class="keyword">order</span> <span class="keyword">by</span> score <span class="keyword">desc</span> )t  </span><br><span class="line">  <span class="keyword">where</span> <span class="keyword">rownum</span> &lt;= <span class="number">10</span> <span class="comment">-- end 结束位置</span></span><br><span class="line">  )stu </span><br><span class="line">  <span class="keyword">where</span> rn &gt; <span class="number">5</span>  <span class="comment">-- 开始位置</span></span><br></pre></td></tr></table></figure>

<h3 id="8-3-2-MySql-分页"><a href="#8-3-2-MySql-分页" class="headerlink" title="8.3.2 MySql 分页"></a>8.3.2 MySql 分页</h3><blockquote>
<p>较为简单，只需使用 limit 子句</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- select * from tbl_book limit a,b ; </span></span><br><span class="line"><span class="comment">-- 第一参数 a(a&gt;=0) 表示从那条记录开始，第二个参数表示从索引 a(a&gt;=0)  开始以后的 b(b&gt;1) 条记录</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl_book <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">5</span>; </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl_book <span class="keyword">limit</span> <span class="number">5</span>,<span class="number">5</span>;  </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl_book <span class="keyword">limit</span> <span class="number">10</span>,<span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<h2 id="8-4-通过函数提交表单"><a href="#8-4-通过函数提交表单" class="headerlink" title="8.4  通过函数提交表单"></a>8.4  通过函数提交表单</h2><ol>
<li>使用 Js 方式提交表单数据</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;sciprt&gt;</span><br><span class="line"><span class="comment">//修改每页显示的记录数  可行</span></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex2</span>(<span class="params">size,index</span>)</span>&#123;</span><br><span class="line">			<span class="comment">//获取第一个表单的 action 属性</span></span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].action = <span class="string">"servlet/SizeServlet?size="</span>+size+<span class="string">"&amp;index="</span>+index;</span><br><span class="line">			</span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); <span class="comment">//提交表单</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//修改每页显示的记录数 可行</span></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex</span>(<span class="params">size,index</span>)</span>&#123;</span><br><span class="line">			<span class="comment">//赋值 当前表单项的 name 属性键的值</span></span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].size.value = size;</span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].index.value = index;</span><br><span class="line">			<span class="comment">//获取表单</span></span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); <span class="comment">//提交表单</span></span><br><span class="line">		&#125;</span><br><span class="line">&lt;<span class="regexp">/sciprt&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>栗子</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@taglib</span> <span class="attr">prefix</span>=<span class="string">"c"</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/core"</span>%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>查询并显示所有学生信息<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"pragma"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"cache-control"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"expires"</span> <span class="attr">content</span>=<span class="string">"0"</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"keywords"</span> <span class="attr">content</span>=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">"This is my page"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	&lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">		<span class="comment">//跳转到指定页码</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">chageIndex</span>(<span class="params">index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">/* window.location.href="servlet/ShowAllServlet?index="+index; */</span></span></span><br><span class="line"><span class="javascript">			<span class="built_in">window</span>.location.href=<span class="string">"servlet/SizeServlet?size="</span>+size+<span class="string">"&amp;index="</span>+index;</span></span><br><span class="line">		&#125;</span><br><span class="line"><span class="javascript">		<span class="comment">//修改每页显示的记录数   有问题</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex3</span>(<span class="params">size,index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> name = $(<span class="string">"input[name=name]"</span>).val();</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> score = $(<span class="string">"input[name=score]"</span>).val();</span></span><br><span class="line"><span class="javascript">			<span class="comment">//window.location.href="servlet/SizeServlet?size="+size+"&amp;index="+index+"&amp;name="+name+"&amp;score="+score;</span></span></span><br><span class="line">		&#125;</span><br><span class="line"><span class="javascript">		<span class="comment">//修改每页显示的记录数  可行</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex2</span>(<span class="params">size,index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//获取第一个表单的 action 属性</span></span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].action = <span class="string">"servlet/SizeServlet?size="</span>+size+<span class="string">"&amp;index="</span>+index;</span></span><br><span class="line">			</span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); <span class="comment">//提交表单</span></span></span><br><span class="line">		&#125;</span><br><span class="line"><span class="javascript">		<span class="comment">//修改每页显示的记录数 可行</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex</span>(<span class="params">size,index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//赋值 当前表单项的 name 属性键的值</span></span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].size.value = size;</span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].index.value = index;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//获取表单</span></span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); <span class="comment">//提交表单</span></span></span><br><span class="line">		&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">  	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">align</span>=<span class="string">"center"</span> <span class="attr">style</span>=<span class="string">"font-size:20px;font-weight: 400;margin-bottom:50px;"</span>&gt;</span>查询和分页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"servlet/SizeServlet"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"size"</span> <span class="attr">value</span>=<span class="string">"$&#123;pageBean.size&#125;"</span>&gt;</span></span><br><span class="line">  	    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"index"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">	  	姓名<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">"$&#123;student.name&#125;"</span>/&gt;</span>&amp;nbsp;&amp;nbsp;</span><br><span class="line">	  	<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;student.score == 0.0&#125;"</span>&gt;</span></span><br><span class="line">		  	成绩&gt;=<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"score"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">	  	<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">	  	<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;student.score != 0.0 &#125;"</span>&gt;</span></span><br><span class="line">		  	成绩&gt;=<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"score"</span> <span class="attr">value</span>=<span class="string">"$&#123;student.score&#125;"</span> /&gt;</span></span><br><span class="line">	  	<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">  	    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"查询"</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 显示所有学生   /stumanager/    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">align</span>=<span class="string">"center"</span> <span class="attr">border</span>=<span class="string">"1"</span> <span class="attr">width</span>=<span class="string">"60%"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>学生 编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>学生姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>学生年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>学生成绩<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>vs.index<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>更新操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>删除操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;pageBean.list&#125;"</span> <span class="attr">var</span>=<span class="string">"stu"</span> <span class="attr">varStatus</span>=<span class="string">"vs"</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.id &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.name &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.age &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.score &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;vs.index &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/stumanager/servlet/StudentServlet?operate=preupdate&amp;sid=$&#123;stu.id&#125;"</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/stumanager/servlet/StudentServlet?operate=delete&amp;sid=$&#123;stu.id&#125;"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">"6"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,1)"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.index-1 &gt;= 1&#125;"</span>&gt;</span></span><br><span class="line">	    			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;pageBean.index-1&#125;)"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.index-1 &lt; 1&#125;"</span>&gt;</span></span><br><span class="line">	    				上一页</span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;pageBean.numbers&#125;"</span> <span class="attr">var</span>=<span class="string">"nums"</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;nums == pageBean.index &#125;"</span>&gt;</span></span><br><span class="line">	    				[<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;nums&#125;)"</span>&gt;</span>$&#123;nums&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>]</span><br><span class="line">    				<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;nums != pageBean.index &#125;"</span>&gt;</span></span><br><span class="line">	    				<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;nums&#125;)"</span>&gt;</span>$&#123;nums&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.index+1 &lt;=pageBean.totalPageCount&#125;"</span>&gt;</span></span><br><span class="line">	    			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;pageBean.index+1&#125;)"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span>   </span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span>  			</span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.index+1 &gt; pageBean.totalPageCount&#125;"</span>&gt;</span></span><br><span class="line">	    				下一页							</span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span>  </span><br><span class="line">    			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;pageBean.totalPageCount&#125;)"</span>&gt;</span>尾页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    			每页显示多少条记录数  </span><br><span class="line">    			<span class="tag">&lt;<span class="name">%--</span> 明天开始任务 <span class="attr">--</span>%&gt;</span></span><br><span class="line">   				<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">onchange</span>=<span class="string">"changeSizeAndIndex(this.value,$&#123;pageBean.index&#125;)"</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">begin</span>=<span class="string">"5"</span> <span class="attr">end</span>=<span class="string">"25"</span> <span class="attr">step</span>=<span class="string">"5"</span> <span class="attr">var</span>=<span class="string">"i"</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.size == i&#125;"</span>&gt;</span></span><br><span class="line">	    					<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;i&#125;"</span> <span class="attr">selected</span>=<span class="string">"selected"</span>&gt;</span>$&#123;i&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.size != i&#125;"</span>&gt;</span></span><br><span class="line">	    					<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;i&#125;"</span>&gt;</span>$&#123;i&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">   				<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    			<span class="comment">&lt;!-- 跳转到第几页  --&gt;</span></span><br><span class="line">    			跳转到</span><br><span class="line">    			<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">onchange</span>=<span class="string">"changeSizeAndIndex($&#123;pageBean.size&#125;,this.value)"</span> &gt;</span></span><br><span class="line">	    			<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;pageBean.numbers&#125;"</span> <span class="attr">var</span>=<span class="string">"num"</span>&gt;</span></span><br><span class="line">	    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;num == pageBean.index&#125;"</span>&gt;</span></span><br><span class="line">	    					<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;num&#125;"</span> <span class="attr">selected</span>=<span class="string">"selected"</span>&gt;</span>$&#123;num &#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span>	    					</span><br><span class="line">	    				<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">	    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;num != pageBean.index&#125;"</span>&gt;</span></span><br><span class="line">	    					<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;num&#125;"</span>&gt;</span>$&#123;num &#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span>	    					</span><br><span class="line">	    				<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    			</span><br><span class="line">    	</span><br><span class="line">    			共有$&#123;pageBean.totalCount&#125; 条记录</span><br><span class="line">    		<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="9-文件上传与下载"><a href="#9-文件上传与下载" class="headerlink" title="9 文件上传与下载"></a>9 文件上传与下载</h1><h2 id="9-1-导入-jar-包"><a href="#9-1-导入-jar-包" class="headerlink" title="9.1 导入 jar 包"></a>9.1 导入 jar 包</h2><p>commons-fileupload.jar 依赖于下面的 commons-io.jar 。<br>commons-io.jar</p>
<h2 id="9-2-文件上传"><a href="#9-2-文件上传" class="headerlink" title="9.2 文件上传"></a>9.2 文件上传</h2><h3 id="9-2-1-获取动态上下文地址"><a href="#9-2-1-获取动态上下文地址" class="headerlink" title="9.2.1 获取动态上下文地址"></a>9.2.1 获取动态上下文地址</h3><blockquote>
<p>用于获取服务端存储文件的位置</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//File dir = new File("D:\\upload\\"); //这里指服务器的目录下</span></span><br><span class="line"><span class="comment">//File dir = new File("D:\\Program Files\\apache-tomcat-7.0.69-windows-x64\\apache-tomcat-7.0.69\\webapps\\updownload1\\WEB-INF\\upload"); //这里指服务器的目录下</span></span><br><span class="line"><span class="comment">//完善2：动态获取上下文路径</span></span><br><span class="line">File dir = <span class="keyword">new</span> File(<span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"upload"</span>));</span><br></pre></td></tr></table></figure>

<h3 id="9-2-2-上传文件的中文乱码问题"><a href="#9-2-2-上传文件的中文乱码问题" class="headerlink" title="9.2.2 上传文件的中文乱码问题"></a>9.2.2 上传文件的中文乱码问题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line"></span><br><span class="line">ServletFileUpload fileUpload = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">fileUpload.setHeaderEncoding(<span class="string">"utf-8"</span>);  <span class="comment">//设置上传文件的名字编码格式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//name </span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">"name"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">    name = fileItem.getString(<span class="string">"utf-8"</span>); <span class="comment">//按 utf-8 格式编码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-3-限制文件上传的类型"><a href="#9-2-3-限制文件上传的类型" class="headerlink" title="9.2.3  限制文件上传的类型"></a>9.2.3  限制文件上传的类型</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//完善4：限制上传文件的类型</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="string">"image/png"</span>.equals(photoType))&#123;</span><br><span class="line">    request.setAttribute(<span class="string">"mess"</span>, <span class="string">"文件的类型不正确，应为 png 格式的图片"</span>);</span><br><span class="line">    request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request,response);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-4-限制文件上传的大小"><a href="#9-2-4-限制文件上传的大小" class="headerlink" title="9.2.4 限制文件上传的大小"></a>9.2.4 限制文件上传的大小</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//完善3：限制上传文件的大小</span></span><br><span class="line">    <span class="comment">//设置单个上传文件的大小</span></span><br><span class="line">    fileUpload.setFileSizeMax(<span class="number">200</span>*<span class="number">1024</span>); <span class="comment">//限制的单个文件的大小为 200KB</span></span><br><span class="line">    <span class="comment">//设置上传文件的总大小</span></span><br><span class="line">    fileUpload.setSizeMax(<span class="number">5</span>*<span class="number">200</span>*<span class="number">1024</span>); <span class="comment">//限制上传文件的总大小为 1000KB</span></span><br><span class="line">    <span class="comment">//将表单数据封装到 FileItem 对象中</span></span><br><span class="line">    itemList = fileUpload.parseRequest(request);</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileUploadException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="comment">//若超出文件大小，则 itemList 为 null,直接返回客户端错误信息</span></span><br><span class="line">    request.setAttribute(<span class="string">"mess"</span>, <span class="string">"单个文件大小超过限制 200KB"</span>);</span><br><span class="line">    request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request,response);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-5-使用UUID"><a href="#9-2-5-使用UUID" class="headerlink" title="9.2.5 使用UUID"></a>9.2.5 使用UUID</h3><blockquote>
<p>用于图片名称，防止图片名重复。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UUID uuid = UUID.randomUUID(); <span class="comment">//获取32位的16进制的数</span></span><br><span class="line">String ufileName = uuid.toString(); <span class="comment">//图片 uuid 名</span></span><br><span class="line">String extName = </span><br><span class="line">realName.substring(realName.lastIndexOf(<span class="string">"."</span>)+<span class="number">1</span>).toLowerCase();<span class="comment">//图片格式扩展名</span></span><br><span class="line">photoName = ufileName+<span class="string">"."</span>+extName;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-6-栗子"><a href="#9-2-6-栗子" class="headerlink" title="9.2.6 栗子"></a>9.2.6 栗子</h3><blockquote>
<ol>
<li>创建 FileItemFactory 工厂</li>
<li>创建  ServletFileUpload 上传类</li>
<li>解析 request 对象，获取 FileItem集合 </li>
<li>遍历 FileItem 集合，获取表单数据和非表单数据</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItem;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileUploadException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.bjsxt.entity.Student;</span><br><span class="line"><span class="keyword">import</span> com.bjsxt.service.StudentService;</span><br><span class="line"><span class="keyword">import</span> com.bjsxt.service.impl.StudentServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doPost(request, response);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        <span class="comment">//创建 FileItemFactory 工厂</span></span><br><span class="line">        FileItemFactory factory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建  ServletFileUpload 上传类</span></span><br><span class="line">        ServletFileUpload fileUpload = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">        fileUpload.setHeaderEncoding(<span class="string">"utf-8"</span>);  <span class="comment">//设置上传文件的名字编码格式</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//解析 request 对象，获取 FileItem集合 </span></span><br><span class="line">        List&lt;FileItem&gt; itemList  = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//完善3：限制上传文件的大小</span></span><br><span class="line">            <span class="comment">//设置单个上传文件的大小</span></span><br><span class="line">            fileUpload.setFileSizeMax(<span class="number">200</span>*<span class="number">1024</span>); <span class="comment">//限制的单个文件的大小为 200KB</span></span><br><span class="line">            <span class="comment">//设置上传文件的总大小</span></span><br><span class="line">            fileUpload.setSizeMax(<span class="number">5</span>*<span class="number">200</span>*<span class="number">1024</span>); <span class="comment">//限制上传文件的总大小为 1000KB</span></span><br><span class="line">            <span class="comment">//将表单数据封装到 FileItem 对象中</span></span><br><span class="line">            itemList = fileUpload.parseRequest(request);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileUploadException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">//若超出文件大小，则 itemList 为 null,直接返回客户端错误信息</span></span><br><span class="line">            request.setAttribute(<span class="string">"mess"</span>, <span class="string">"单个文件大小超过限制 200KB"</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String name = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> age =  <span class="number">0</span>;</span><br><span class="line">        Double score = <span class="number">0.0</span>;</span><br><span class="line">        String realName = <span class="keyword">null</span>;  <span class="comment">//图片真实名称</span></span><br><span class="line">        String photoName = <span class="keyword">null</span>; <span class="comment">//图片名称</span></span><br><span class="line">        String photoType = <span class="keyword">null</span>; <span class="comment">//图片格式类型</span></span><br><span class="line">        <span class="comment">//遍历 FileItem 集合</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; itemList.size(); i++) &#123;</span><br><span class="line">            FileItem fileItem = itemList.get(i);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(fileItem.isFormField())&#123; <span class="comment">//是非 file 表单项</span></span><br><span class="line">                <span class="comment">//name </span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"name"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">                    name = fileItem.getString(<span class="string">"utf-8"</span>); <span class="comment">//按 utf-8 格式编码</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//age</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"age"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">                    age = Integer.valueOf(fileItem.getString());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//score</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"score"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">                    String sScore = fileItem.getString();</span><br><span class="line">                    score = Double.valueOf(sScore);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;<span class="comment">// 是 file 表单项</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"photo"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">                    realName = fileItem.getName();  <span class="comment">//获取上传图片名称</span></span><br><span class="line">                    photoType = fileItem.getContentType(); <span class="comment">//获取上传图片的类型</span></span><br><span class="line">                    <span class="comment">//String is = fileItem.getString(); //获取上传图片的资源</span></span><br><span class="line">                    <span class="comment">//System.out.println(photoName+"\t"+photoType+"\t");</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//完善4：限制上传文件的类型</span></span><br><span class="line">                    <span class="keyword">if</span>(!<span class="string">"image/png"</span>.equals(photoType))&#123;</span><br><span class="line">                        request.setAttribute(<span class="string">"mess"</span>, <span class="string">"文件的类型不正确，应为 png 格式的图片"</span>);</span><br><span class="line">                        request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request,response);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//File dir = new File("D:\\upload\\"); //这里指服务器的目录下</span></span><br><span class="line">                    <span class="comment">//File dir = new File("D:\\Program Files\\apache-tomcat-7.0.69-windows-x64\\apache-tomcat-7.0.69\\webapps\\updownload1\\WEB-INF\\upload"); //这里指服务器的目录下</span></span><br><span class="line">                    <span class="comment">//完善2：动态获取上下文路径</span></span><br><span class="line">                    File dir = <span class="keyword">new</span> File(<span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"upload"</span>));</span><br><span class="line">                    <span class="comment">//完善1：若文件夹不存在则创建该文件夹</span></span><br><span class="line">                    <span class="keyword">if</span>(!dir.exists())&#123;</span><br><span class="line">                        dir.mkdirs();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//完善5：使用UUID 作为图片名</span></span><br><span class="line">                    UUID uuid = UUID.randomUUID(); <span class="comment">//获取32位的16进制的数</span></span><br><span class="line">                    String ufileName = uuid.toString(); <span class="comment">//图片 uuid 名</span></span><br><span class="line">                    String extName = realName.substring(realName.lastIndexOf(<span class="string">"."</span>)+<span class="number">1</span>).toLowerCase();<span class="comment">//图片格式扩展名</span></span><br><span class="line">                    photoName = ufileName+<span class="string">"."</span>+extName;</span><br><span class="line">                    <span class="comment">//System.out.println("图片格式扩展名："+extName);</span></span><br><span class="line"></span><br><span class="line">                    File  file = <span class="keyword">new</span> File(dir,photoName);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//上传到指定的目录下</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        fileItem.write(file);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//System.out.println(name+"\t"+age+"\t"+score);</span></span><br><span class="line"></span><br><span class="line">        StudentService service = <span class="keyword">new</span> StudentServiceImpl();</span><br><span class="line">        Student stu = <span class="keyword">new</span> Student(name, age, score, realName, photoName, photoType);</span><br><span class="line">        <span class="keyword">int</span> n = service.save(stu) ; <span class="comment">//保存学生信息</span></span><br><span class="line">        <span class="comment">//页面跳转</span></span><br><span class="line">        <span class="keyword">if</span>(n!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//重定向:/后面要跟上下文路径  /stumgr   /stumgr2</span></span><br><span class="line"></span><br><span class="line">            response.sendRedirect(request.getContextPath()+<span class="string">"/servlet/ShowAllServlet"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            request.setAttribute(<span class="string">"mess"</span>, <span class="string">"添加失败!"</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request, response);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-3-文件下载"><a href="#9-3-文件下载" class="headerlink" title="9.3 文件下载"></a>9.3 文件下载</h2><blockquote>
<p>使用IO流的方式将服务器的文件资源发送给客户端</p>
<p>中间使用 IOUtils 工具类（org.apache.commons.io.IOUtils）。</p>
<p>注意：流使用后要关闭。</p>
<p>​          添加响应头说明该文件是的大小、类型及文件名</p>
</blockquote>
<h3 id="9-3-1-下载中文名乱码问题"><a href="#9-3-1-下载中文名乱码问题" class="headerlink" title="9.3.1 下载中文名乱码问题"></a>9.3.1 下载中文名乱码问题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">String realName = stu.getRealName();</span><br><span class="line"><span class="comment">/*byte[] bytes = realName.getBytes("utf-8");</span></span><br><span class="line"><span class="comment">			String realName2 = new String(bytes,"utf-8");*/</span> </span><br><span class="line">String realName2 = <span class="keyword">null</span>;</span><br><span class="line">String userAgent = req.getHeader(<span class="string">"User-Agent"</span>).toLowerCase();</span><br><span class="line"><span class="keyword">if</span>(userAgent.indexOf(<span class="string">"trident"</span>) &gt;= <span class="number">0</span>)&#123;<span class="comment">//如果是 IE 浏览器</span></span><br><span class="line">    realName2 = URLEncoder.encode(realName,<span class="string">"utf-8"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    realName2 = <span class="keyword">new</span> String(realName.getBytes(<span class="string">"utf-8"</span>),<span class="string">"iso-8859-1"</span>); <span class="comment">//服务器发送给客户端，Get 编码方式反过来</span></span><br><span class="line">&#125;</span><br><span class="line">resp.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span>+realName2);</span><br><span class="line">OutputStream out = resp.getOutputStream();</span><br></pre></td></tr></table></figure>

<h3 id="9-3-2-栗子"><a href="#9-3-2-栗子" class="headerlink" title="9.3.2 栗子"></a>9.3.2 栗子</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.bjsxt.entity.Student;</span><br><span class="line"><span class="keyword">import</span> com.bjsxt.service.StudentService;</span><br><span class="line"><span class="keyword">import</span> com.bjsxt.service.impl.StudentServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">			<span class="comment">//1. 接受请求数据，学生的ID</span></span><br><span class="line">			String sId = req.getParameter(<span class="string">"id"</span>);</span><br><span class="line">			<span class="keyword">int</span> id = -<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				id = Integer.valueOf(sId);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//2. 处理请求数据</span></span><br><span class="line">			StudentService service = <span class="keyword">new</span> StudentServiceImpl();</span><br><span class="line">			Student stu = service.findById(id);</span><br><span class="line">			<span class="comment">//3. 响应请求数据      使用IO流的方式</span></span><br><span class="line">			<span class="comment">//3.1  获取输入输出流</span></span><br><span class="line">			String realPath = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"upload"</span>);</span><br><span class="line">			File file = <span class="keyword">new</span> File(realPath+<span class="string">"/"</span>+stu.getPhotoName());</span><br><span class="line">			InputStream is  = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">			<span class="comment">// 添加响应头信息</span></span><br><span class="line">			resp.setContentLength((<span class="keyword">int</span>)file.length()); <span class="comment">//设置响应内容的长度</span></span><br><span class="line">			resp.setContentType(stu.getPhotoType()); <span class="comment">//设置响应内容的格式</span></span><br><span class="line">			<span class="comment">//处理图片真实名称中文乱码问题</span></span><br><span class="line">			String realName = stu.getRealName();</span><br><span class="line">			<span class="comment">/*byte[] bytes = realName.getBytes("utf-8");</span></span><br><span class="line"><span class="comment">			String realName2 = new String(bytes,"utf-8");*/</span> </span><br><span class="line">			String realName2 = <span class="keyword">null</span>;</span><br><span class="line">			String userAgent = req.getHeader(<span class="string">"User-Agent"</span>).toLowerCase();</span><br><span class="line">			<span class="keyword">if</span>(userAgent.indexOf(<span class="string">"trident"</span>) &gt;= <span class="number">0</span>)&#123;<span class="comment">//如果是 IE 浏览器</span></span><br><span class="line">				realName2 = URLEncoder.encode(realName,<span class="string">"utf-8"</span>);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				realName2 = <span class="keyword">new</span> String(realName.getBytes(<span class="string">"utf-8"</span>),<span class="string">"iso-8859-1"</span>); <span class="comment">//服务器发送给客户端，Get 编码方式反过来</span></span><br><span class="line">			&#125;</span><br><span class="line">			resp.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span>+realName2);</span><br><span class="line">			OutputStream out = resp.getOutputStream();</span><br><span class="line">			<span class="comment">//3.2 将输入流复制到输出流中</span></span><br><span class="line">			IOUtils.copy(is, out);</span><br><span class="line">			<span class="comment">//3.3 关闭流</span></span><br><span class="line">			is.close();</span><br><span class="line">			out.close();</span><br><span class="line">			</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="10-版本管理与SVN-入门"><a href="#10-版本管理与SVN-入门" class="headerlink" title="10 版本管理与SVN 入门"></a>10 版本管理与SVN 入门</h1><h2 id="10-1-版本管理的概念"><a href="#10-1-版本管理的概念" class="headerlink" title="10.1 版本管理的概念"></a>10.1 版本管理的概念</h2><blockquote>
<p>解决：代码合并、历史版本中的迭代、重复</p>
</blockquote>
<h3 id="10-1-2-版本控制软件"><a href="#10-1-2-版本控制软件" class="headerlink" title="10.1.2  版本控制软件"></a>10.1.2  版本控制软件</h3><p>a) VSS：Microsoft 提供，Window 平台，小型开发团队所适合的工具。</p>
<p>b) CVS：开源工具，跨平台。绝大多数 CVS 服务已改用 SVN。CVS 已停止维护</p>
<p>c) SVN（Subversion）：开源，跨平台，在 CVS 的基础上开发。使用企业众多， 稳定安全，操作简单。集中式版本控制系统。</p>
<p>d) GIT：开源的分布式版本控制系统，用以有效高速的处理从很小到非常大的项</p>
<p>目版本管理。（GITHUB 是一个用 GIT 做版本控制的项目托管平台，B/S 架构。放到 GITHUB 上的代码需要开源，并且是互联网开发）</p>
<p><img src="http://www.zwer.xyz/picGo/20190506083256.png" alt></p>
<h2 id="10-2-SVN入门"><a href="#10-2-SVN入门" class="headerlink" title="10.2 SVN入门"></a>10.2 SVN入门</h2><h3 id="10-2-1-安装软件"><a href="#10-2-1-安装软件" class="headerlink" title="10.2.1 安装软件"></a>10.2.1 安装软件</h3><p>a) 指定软件安装位置和版本库位置</p>
<p>b) 默认端口 443</p>
<p>c) 使用 SVN authentication</p>
<h3 id="10-2-2-创建版本库"><a href="#10-2-2-创建版本库" class="headerlink" title="10.2.2  创建版本库"></a>10.2.2  创建版本库</h3><p>a) 创建默认结构 use default struction</p>
<p>b) 默认结构的含义</p>
<p>i. trunk：主干    开发时代码存储的位置，永远是最新的代码</p>
<p>ii. brank：分支    在不影响Trunk 其它用户情况下进行一些关于新功能的探索性或实验性的开发，待新功能完善后它也可以合并到 Trunk 中</p>
<p>iii. tags：标签 历史版本 阶段性里程碑版本 比如 1.0 2.0 3.0</p>
<h3 id="10-2-3-创建用户"><a href="#10-2-3-创建用户" class="headerlink" title="10.2.3 创建用户"></a>10.2.3 创建用户</h3><h3 id="10-2-4-创建组"><a href="#10-2-4-创建组" class="headerlink" title="10.2.4 创建组"></a>10.2.4 创建组</h3><h3 id="1-0-2-5-为组指定用户"><a href="#1-0-2-5-为组指定用户" class="headerlink" title="1 0.2.5 为组指定用户"></a>1 0.2.5 为组指定用户</h3><h3 id="10-2-6-为组指定对版本库的操作权限"><a href="#10-2-6-为组指定对版本库的操作权限" class="headerlink" title="10.2.6  为组指定对版本库的操作权限"></a>10.2.6  为组指定对版本库的操作权限</h3><p>​    a) 默认 everyone 具有 read/write 权限，无法删除，要修改为 no access</p>
<h3 id="10-2-7-通过浏览器访问服务器端"><a href="#10-2-7-通过浏览器访问服务器端" class="headerlink" title="10.2.7  通过浏览器访问服务器端"></a>10.2.7  通过浏览器访问服务器端</h3><h3 id="10-3-客户端-subclipse"><a href="#10-3-客户端-subclipse" class="headerlink" title="10.3 客户端 subclipse"></a>10.3 客户端 subclipse</h3><blockquote>
<p>一款 eclipse 中的 SNV 客户端插件。</p>
</blockquote>
<h3 id="10-3-1-安装"><a href="#10-3-1-安装" class="headerlink" title="10.3.1 安装"></a>10.3.1 安装</h3><p>a) 解压后将其中的 features 和 plugin 文件夹放入MyEclipse 的 dropins 目录下</p>
<p>b) 重新启动MyEclipse，即可自动发现并安装</p>
<p>c) 安装后在 window——preferrences——team 中可以看到 SVN</p>
<h3 id="10-3-2-提交项目到服务器端"><a href="#10-3-2-提交项目到服务器端" class="headerlink" title="10.3.2  提交项目到服务器端"></a>10.3.2  提交项目到服务器端</h3><p>a) 选中项目右键——–team—-share project    选择 SVN</p>
<p>b) 提交版本位置、用户名、密码都会由相关服务器管理人员提供。</p>
<p><img src="http://www.zwer.xyz/picGo/20190506083833.png" alt></p>
<p>a) 可以选择记住密码，避免多次的重复输入。</p>
<p>b) 提交后会跳到 team synchronizing view，还需要真正同步代码到服务器，同步之前可以选择哪些代码不需要使用 svn 进行管理</p>
<p>c) 提交成功后可以观察版本库容量的变化</p>
<p>d) 提交成功后客户端项目会显示专门的标记，并且增加了相应的.svn 项目，来存储操作记录</p>
<p><img src="http://www.zwer.xyz/picGo/20190506083935.png" alt></p>
<p><img src="http://www.zwer.xyz/picGo/20190506083951.png" alt></p>
<h3 id="10-3-4-断开和服务器连接"><a href="#10-3-4-断开和服务器连接" class="headerlink" title="10.3.4 断开和服务器连接"></a>10.3.4 断开和服务器连接</h3><p>a) team—断开连接    从项目中删除 SVN 元信息</p>
<h3 id="10-3-5-客户端从-SVN-检出项目"><a href="#10-3-5-客户端从-SVN-检出项目" class="headerlink" title="10.3.5 客户端从 SVN 检出项目"></a>10.3.5 客户端从 SVN 检出项目</h3><p>a) new— Project…——–SVN    从 SVN 检出项目</p>
<h3 id="10-3-6-更新和提交操作"><a href="#10-3-6-更新和提交操作" class="headerlink" title="10.3.6 更新和提交操作"></a>10.3.6 更新和提交操作</h3><p>a) 更新将服务器最新代码更新到本地；提交是将本地最新代码提交到服务器</p>
<p>b) <strong>提交之前要先更新</strong>，因为可能其他程序员期间以及提交了最新代码到服务器</p>
<p>c) <strong>提交一定要给出注释</strong>，对提交内容进行说明，作为以后辨别版本的主要依据。</p>
<h3 id="10-3-7-解决冲突"><a href="#10-3-7-解决冲突" class="headerlink" title="10.3.7 解决冲突"></a>10.3.7 解决冲突</h3><p>a) 模拟两个用户对一个类进行修改，分别修改相同的方法和增加一个新方法</p>
<p>b) 更新后出现冲突，和冲突方沟通后，对冲突文件给出最终解决方案</p>
<p>c) 还需要 team    标记为解决，相应冲突文件为自动删除，当前文件由冲突状态</p>
<p>转换为已修改状态，待提交</p>
<h4 id="10-3-8-还原没有提交的提交的代码"><a href="#10-3-8-还原没有提交的提交的代码" class="headerlink" title="10.3.8 还原没有提交的提交的代码"></a>10.3.8 还原没有提交的提交的代码</h4><p>a) team    还原</p>
<h4 id="10-3-9-还原已经提交的代码"><a href="#10-3-9-还原已经提交的代码" class="headerlink" title="10.3.9 还原已经提交的代码"></a>10.3.9 还原已经提交的代码</h4><p>a) 如果最新的代码出现问题，可以直接修改，也可以回滚到之前的某个历史版本，直接使用或者进行修改</p>
<p>b) 查看资源历史记录</p>
<p>c) 根据注释确定要还原的版本，无法确定可以查看或者比较代码</p>
<p>d) 确定版本后，右键选择”从修订班x 回复更改”</p>
<p>e) 可能出现冲突，解决后提交代码到服务器</p>
<h1 id="Bug-与-技巧"><a href="#Bug-与-技巧" class="headerlink" title="Bug 与 技巧"></a>Bug 与 技巧</h1><ol>
<li>使用 try catch 提高程序健壮性。列如在 servlet 中接受数字类型参数，需要格式转换，这时可以使用 trycatch语句，防止传入的参数有 null 和 空字符串或者其他的字符等等。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取请求参数</span></span><br><span class="line"><span class="comment">// 1.1 获取每页的记录数</span></span><br><span class="line">String sSize = req.getParameter(<span class="string">"size"</span>);</span><br><span class="line"><span class="keyword">int</span> size = <span class="number">5</span>; <span class="comment">//每页记录数</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    size = Integer.valueOf(sSize);</span><br><span class="line">&#125;<span class="keyword">catch</span>(NumberFormatException e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1.2 获取页码索引</span></span><br><span class="line">String sIndex = req.getParameter(<span class="string">"index"</span>);</span><br><span class="line"><span class="keyword">int</span> index = <span class="number">1</span>;<span class="comment">//页码索引 </span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    index = Integer.valueOf(sIndex);  <span class="comment">//null ," "				</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;	</span><br><span class="line"><span class="comment">// 1.3 获取当前成绩</span></span><br><span class="line">String sScore = req.getParameter(<span class="string">"score"</span>);</span><br><span class="line">Double score = <span class="number">0.0</span>;		 		</span><br><span class="line"><span class="keyword">if</span>(sScore == <span class="keyword">null</span> || sScore.equals(<span class="string">""</span>))&#123;</span><br><span class="line">    sScore = <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    score = Double.parseDouble(sScore);</span><br><span class="line">&#125;<span class="keyword">catch</span>(NumberFormatException e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1.4 获取学生姓名</span></span><br><span class="line">String name = req.getParameter(<span class="string">"name"</span>);</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/04/03/20190403 过滤器和监听器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/04/03/20190403 过滤器和监听器/" class="post-title-link" itemprop="url">20190403 过滤器和监听器</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-04-03 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-03T00:00:00+08:00">2019-04-03</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-09-08 20:03:30" itemprop="dateModified" datetime="2019-09-08T20:03:30+08:00">2019-09-08</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-监听器"><a href="#1-监听器" class="headerlink" title="1 监听器"></a>1 监听器</h1><blockquote>
<p>serlvet 监听器是 serlvet 规范中定义中一种特殊的类，用于监听 <code>ServeltContext</code>、<code>HttpSession</code> 和<code>ServletRequest</code> 等域对象的创建与销毁事件，以及监听这些域对象属性发生改变的事件。</p>
<p>监听对象：applicatin 、 session 、 request</p>
<p>监听内容：创建、销毁、属性改变</p>
<p>监听作用：在事件发生前与事件发生后做一些处理，比如在线人数统计。</p>
<p>使用： 监听 request </p>
<ol>
<li><p>创建一个普通 java 类实现指定的接口</p>
<pre><code>1. 监听 request 的创建和销毁：ServletRequestListener 
     2. 监听 request 作用域数据的变更：ServletRequestAttributeListener </code></pre><ol start="2">
<li>在项目中的 web.xml 中配置监听器，让监听器生效</li>
</ol>
</li>
</ol>
</blockquote>
<h2 id="1-1-测试代码"><a href="#1-1-测试代码" class="headerlink" title="1.1 测试代码"></a>1.1 测试代码</h2><h3 id="1-1-1-MyServletListener-java"><a href="#1-1-1-MyServletListener-java" class="headerlink" title="1.1.1  MyServletListener.java"></a>1.1.1  MyServletListener.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextAttributeEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextAttributeListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestAttributeEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestAttributeListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionActivationListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionAttributeListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionBindingEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionBindingListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	实现监听器的步骤</span></span><br><span class="line"><span class="comment"> *		1. 实现监听器特定的接口</span></span><br><span class="line"><span class="comment"> *			1. 实现 ServletRequestListener 接口，监听 request 对象的创建和销毁 </span></span><br><span class="line"><span class="comment"> *			2. 实现 ServletRequestAttributeListener 接口， 监听 request 对象中属性的添加电、删除和数据更新</span></span><br><span class="line"><span class="comment"> *		2. 配置 web.xml 路径，让服务器知道该监听器的存在</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServletListener</span>  <span class="keyword">implements</span> <span class="title">ServletRequestListener</span>,<span class="title">ServletRequestAttributeListener</span>,<span class="title">HttpSessionListener</span>,<span class="title">HttpSessionAttributeListener</span>,<span class="title">ServletContextListener</span>,<span class="title">ServletContextAttributeListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//实现 ServletRequestListener ，监听 request 对象的创建和销毁 </span></span><br><span class="line">	<span class="comment">// request 对象在一次请求结束后即销毁了</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"request 被销毁了...."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> </span>&#123;</span><br><span class="line">		ServletRequest request = sre.getServletRequest();</span><br><span class="line">		request.setAttribute(<span class="string">"hello"</span>, <span class="string">"HeloListener"</span>);</span><br><span class="line">		System.out.println(<span class="string">"request 被创建了...."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//实现 ServletRequestAttributeListener 接口，监听 request 对象中属性的添加、删除、替换（数据更新）</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span><span class="params">(ServletRequestAttributeEvent srae)</span> </span>&#123;</span><br><span class="line">		String key = srae.getName();</span><br><span class="line">		Object value = srae.getValue();</span><br><span class="line">		System.out.println(<span class="string">"request 对象中 "</span>+key+<span class="string">"被添加,其值为"</span>+value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span><span class="params">(ServletRequestAttributeEvent srae)</span> </span>&#123;</span><br><span class="line">		String key = srae.getName();</span><br><span class="line">		System.out.println(<span class="string">"request 对象中 "</span>+key+<span class="string">"被移除了"</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span><span class="params">(ServletRequestAttributeEvent srae)</span> </span>&#123;</span><br><span class="line">		String key = srae.getName();</span><br><span class="line">		Object value = srae.getValue();</span><br><span class="line">		System.out.println(<span class="string">"request 对象中 "</span>+key+<span class="string">"被更新了,更新后的其值为"</span>+value);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 监听 session 对象的创建、销毁</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session 对象被创建了"</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session 对象被销毁了"</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 监听 session 对象的添加、删除、数据更新</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span><span class="params">(HttpSessionBindingEvent event)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session 对象中添加属性"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span><span class="params">(HttpSessionBindingEvent event)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session 对象中移除属性"</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span><span class="params">(HttpSessionBindingEvent event)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session 对象中更新属性"</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 监听 context 对象的属性的添加、删除和数据更新</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span><span class="params">(ServletContextAttributeEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span><span class="params">(ServletContextAttributeEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span><span class="params">(ServletContextAttributeEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 监听 context 对象的初始化和销毁</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"context 对象初始化..."</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"context 对象被销毁了..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-1-2-web-xml"><a href="#1-1-2-web-xml" class="headerlink" title="1.1.2  web.xml"></a>1.1.2  web.xml</h2><blockquote>
<p>配置监听器的格式<br>  <listener><br>       <listener-class>监听器的全限定路径名</listener-class><br>  </listener></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>TestListener<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置监听器  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">  	 <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.szxy.listener.MyServletListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.szxy.servlet.MyServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/my<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-2-监听器应用之统计在线用户数"><a href="#1-2-监听器应用之统计在线用户数" class="headerlink" title="1.2 监听器应用之统计在线用户数"></a>1.2 监听器应用之统计在线用户数</h2><blockquote>
<p>bug: 只要用户登录该网站无须登录，也算在在线用户数中</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 统计当前在线人数 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 1. 实现 ServletContextListener 和 HttpSessionListener 接口</span></span><br><span class="line"><span class="comment"> * 用 application 对象保存 当前人数的值</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 2. 在 web.xml 中配置监听器 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CurrentNetUserListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span>,<span class="title">HttpSessionListener</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"....  开启服务器        ...."</span>);</span><br><span class="line">		<span class="comment">// 获取 application 对象</span></span><br><span class="line">		ServletContext context = sce.getServletContext();</span><br><span class="line">		<span class="comment">// 创建计数器 将计数器放入 application 对象中保存</span></span><br><span class="line">		context.setAttribute(<span class="string">"count"</span>, <span class="number">0</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 获取服务器 application 对象</span></span><br><span class="line">		ServletContext context = se.getSession().getServletContext();</span><br><span class="line">		<span class="comment">// 获取当前计数器</span></span><br><span class="line">		<span class="keyword">int</span> count = (<span class="keyword">int</span>) context.getAttribute(<span class="string">"count"</span>);</span><br><span class="line">		<span class="comment">// 计数器 +1</span></span><br><span class="line">		++count;</span><br><span class="line">		context.setAttribute(<span class="string">"count"</span>, count);</span><br><span class="line">		System.out.println(<span class="string">"session 对象被创建 "</span>+count);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 获取服务器 application 对象</span></span><br><span class="line">		ServletContext context = se.getSession().getServletContext();</span><br><span class="line">		<span class="comment">// 获取当前计数器</span></span><br><span class="line">		<span class="keyword">int</span> count = (<span class="keyword">int</span>) context.getAttribute(<span class="string">"count"</span>);</span><br><span class="line">		<span class="comment">// 计数器 -1</span></span><br><span class="line">		<span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">			--count;			</span><br><span class="line">		&#125;</span><br><span class="line">		context.setAttribute(<span class="string">"count"</span>, count);</span><br><span class="line">		System.out.println(<span class="string">"session 对象被销毁 "</span>+count);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-过滤器"><a href="#2-过滤器" class="headerlink" title="2 过滤器"></a>2 过滤器</h1><h2 id="2-1-过滤器的原理"><a href="#2-1-过滤器的原理" class="headerlink" title="2.1 过滤器的原理"></a>2.1 过滤器的原理</h2><blockquote>
<p>作用：保证数据的安全，保护服务器中的资源。</p>
<p>使用：可以拦截浏览器的任意请求，所以可以在访问 servlet 之前校验请求的合法性，符合要求再调用对应的 servlet 。</p>
</blockquote>
<p><img src="http://www.zwer.xyz/picGo/20190403214151.png" alt></p>
<h2 id="2-2-过滤器的使用"><a href="#2-2-过滤器的使用" class="headerlink" title="2.2 过滤器的使用"></a>2.2 过滤器的使用</h2><blockquote>
<p>使用：根据需求拦截对应路径的 <code>servlet</code></p>
<pre><code>1. 创建一个 普通 java 类，并实现 Filter 接口
2.  在` web.xml` 配置过滤器</code></pre></blockquote>
<h3 id="2-2-1-doFilter方法"><a href="#2-2-1-doFilter方法" class="headerlink" title="2.2.1 doFilter方法"></a>2.2.1 <code>doFilter</code>方法</h3><blockquote>
<p>作用：服务器在接收到浏览器发过来的请求后，先解析请求信息</p>
<p>创建对象 request 和 response ，然后根据请求 URL 地址判断如果符合过滤器的过滤范围，则会调用过滤器中 <code>doFilter</code> 来进行请求拦截，并将 request 和 response 对象作为实参传递给 doFilter 方法。所以可以在 <code>doFilter</code> 方法中声明过滤器拦截代码。</p>
<p>参数： </p>
<p>​    <code>servletRequest</code>：接受此次拦截的 request 参数</p>
<p>​    <code>servletResponse</code>： 接受此次拦截的 response 参数</p>
<p>​    <code>FilterChain</code>： 可以进行请求放行   <code>chain.doFilter(req,resp);</code>  相当于请求转发，后面的代码可以加 return ;</p>
</blockquote>
<h3 id="2-2-2init-方法-和-destory-方法"><a href="#2-2-2init-方法-和-destory-方法" class="headerlink" title="2.2.2init 方法 和 destory 方法"></a>2.2.2<code>init</code> 方法 和 <code>destory</code> 方法</h3><blockquote>
<p>init 方法：服务器启动时调用</p>
<p>destory 方法: 服务器关闭时调用</p>
<p>即：过滤器的生命周期为服务器启动到服务器关闭。</p>
</blockquote>
<h3 id="2-2-3-拦截范围配置"><a href="#2-2-3-拦截范围配置" class="headerlink" title="2.2.3 拦截范围配置"></a>2.2.3 拦截范围配置</h3><ol>
<li>拦截所有      <code>/*</code></li>
<li>拦截部分 <code>servlet</code> 请求     栗子： <code>*.do</code></li>
<li>拦截特定 <code>servlet</code> 请求    与要拦截的 <code>servlet</code> 的 <code>url-pattern</code> 的路径相同      栗子：<code>/xxx</code></li>
</ol>
<p>注意： 过滤器之间会出现多重拦截，web.xml 配置范围先大后小。</p>
<p>如果是按照拦截范围的大小在 web.xml 中自大而小的配置，则会</p>
<p>先执行大范围的拦截器，再执行小范围的拦截器。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置过滤器: 全局拦截器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>myFilter3<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.szxy.filter.MyFilter3<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>myFilter3<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置过滤器: 部分拦截器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>myFilter2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.szxy.filter.MyFilter2<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>myFilter2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置过滤器: 特定拦截器  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>MyFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.szxy.filter.MyFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>MyFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/my.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.szxy.servlet.MyServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/my.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-3-测试代码"><a href="#2-3-测试代码" class="headerlink" title="2.3 测试代码"></a>2.3 测试代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 过滤器的使用</span></span><br><span class="line"><span class="comment"> * 	1. 实现 Filter 接口</span></span><br><span class="line"><span class="comment"> * 	2. 在 web.xml 中 Filter</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"MyFilter.init() 初始化....."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">			FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">			System.out.println(<span class="string">"MyFilter.doFilter(张三家的保安...)"</span>);</span><br><span class="line">			<span class="comment">//放行</span></span><br><span class="line">			chain.doFilter(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"MyFilter.destroy() 销毁...."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-web-xml"><a href="#2-4-web-xml" class="headerlink" title="2.4 web.xml"></a>2.4 web.xml</h2><blockquote>
<p>配置过滤器的格式<br>  <filter><br>      <filter-name>过滤器名</filter-name><br>      <filter-class>过滤器的全限定路径名</filter-class><br>  </filter><br>  <filter-mapping><br>      <filter-name>过滤器名</filter-name><br>      <url-pattern>拦截路径</url-pattern><br>  </filter-mapping></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置过滤器  --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>MyFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.szxy.filter.MyFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>MyFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/my<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="3-过滤器之统一请求编码"><a href="#3-过滤器之统一请求编码" class="headerlink" title="3  过滤器之统一请求编码"></a>3  过滤器之统一请求编码</h1><blockquote>
<p>拦截范围：拦截所有请求，设置请求响应编码格式</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">			FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">			<span class="comment">//设置请求编码格式</span></span><br><span class="line">			request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">			<span class="comment">//设置响应编码格式</span></span><br><span class="line">			response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">        	<span class="comment">//放行</span></span><br><span class="line">			chain.doFilter(request, response);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-过滤器之-session-管理（sesson-统一校验）"><a href="#4-过滤器之-session-管理（sesson-统一校验）" class="headerlink" title="4  过滤器之 session 管理（sesson 统一校验）"></a>4  过滤器之 session 管理（sesson 统一校验）</h1><blockquote>
<p>拦截范围：拦截所有请求</p>
<p>判断 session 对象是否失效，若不存在则重定向到登录界面上，反之则放行。</p>
<p>问题：</p>
<p>​    在过滤器中使用 session 校验后，造成重定向死循环。</p>
<p>解决：</p>
<p>​    <strong>放行对登录界面和登录请求不做拦截处理</strong></p>
<p>问题：过滤器会拦截所有的请求，包括静态资源 (css资源、js资源、图片资源)</p>
<p>解决：</p>
<p>​    对静态资源放行。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	过滤器的使用：</span></span><br><span class="line"><span class="comment"> *	1. 统一编码格式</span></span><br><span class="line"><span class="comment"> *	2. 管理 session   </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"服务器开启...."</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">			FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">			<span class="comment">//设置请求编码格式</span></span><br><span class="line">			request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">			<span class="comment">//设置响应编码格式</span></span><br><span class="line">			response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">			<span class="comment">//强转 ServletRequest 对象</span></span><br><span class="line">			HttpServletRequest req = ((HttpServletRequest)request);</span><br><span class="line">			<span class="comment">//强转 ServletResponse 对象</span></span><br><span class="line">			HttpServletResponse resp = ((HttpServletResponse)response);</span><br><span class="line">			<span class="comment">//获取当前请求 uri</span></span><br><span class="line">			String uri = req.getRequestURI();</span><br><span class="line">			<span class="comment">/*System.out.println(uri);*/</span></span><br><span class="line">			String method = req.getParameter(<span class="string">"method"</span>);</span><br><span class="line">		<span class="comment">/*	System.out.println(method);*/</span></span><br><span class="line">			<span class="comment">// 放行登录界面，登录请求,静态资源</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="string">"/projectsxt2/login.jsp"</span>.equals(uri) || (<span class="string">"/projectsxt2/register.jsp"</span>.equals(uri) ) ||((<span class="string">"/projectsxt2/data"</span>.equals(uri) &amp;&amp; method.equals(<span class="string">"userLogin"</span>))) || ((<span class="string">"/projectsxt2/data"</span>.equals(uri) &amp;&amp; method.equals(<span class="string">"userRegister"</span>)))|| uri.startsWith(<span class="string">"/projectsxt2/css/"</span>) || uri.startsWith(<span class="string">"/projectsxt2/js/"</span>) ||uri.startsWith(<span class="string">"/projectsxt2/images/"</span>))&#123;</span><br><span class="line">				<span class="comment">//放行</span></span><br><span class="line">				chain.doFilter(request, response);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">//获取 session 对象</span></span><br><span class="line">				HttpSession session = req.getSession();</span><br><span class="line">				Object obj = session.getAttribute(<span class="string">"user"</span>);</span><br><span class="line">				<span class="keyword">if</span>(obj != <span class="keyword">null</span>)&#123;</span><br><span class="line">					chain.doFilter(request, response);</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="comment">//重定向</span></span><br><span class="line">					resp.sendRedirect(<span class="string">"/projectsxt2/login.jsp"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"服务器关闭..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>user.jsp </li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params">uid</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">if</span>( confirm(<span class="string">"您确定要删除吗?"</span>))&#123;</span></span><br><span class="line"><span class="javascript">		<span class="comment">//使用 ajax 发送请求</span></span></span><br><span class="line"><span class="javascript">		$.<span class="keyword">get</span>("data",&#123;method:<span class="string">"delUserInfo"</span>,<span class="attr">uid</span>:uid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span>(data != <span class="string">"true"</span>)&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"登录已过期，请重新登录"</span>);</span></span><br><span class="line"><span class="javascript">				<span class="built_in">window</span>.top.location.href = <span class="string">"/projectsxt2/login.jsp"</span>;</span></span><br><span class="line">			&#125;</span><br><span class="line"><span class="javascript">			<span class="comment">//响应数据</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span>(<span class="built_in">eval</span>(data))&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"该用户已被删除"</span>);</span></span><br><span class="line"><span class="javascript">				<span class="comment">//刷新当前浏览器，重新发送请求</span></span></span><br><span class="line"><span class="javascript">				<span class="built_in">window</span>.location.href = <span class="string">"data?method=selAllUsers"</span>;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>设置 login.jsp 为最顶层界面</li>
</ul>
<blockquote>
<p>在login.jsp 的头部添加如下代码</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 声明 JS 代码域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="comment">//判断login.jsp 是否是顶层界面，若不是则跳转到顶层界面中</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">if</span>(<span class="built_in">window</span> != top)&#123;</span></span><br><span class="line"><span class="javascript">		<span class="built_in">window</span>.top.location.href = <span class="built_in">window</span>.location.href; </span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="5-过滤器之-权限管理"><a href="#5-过滤器之-权限管理" class="headerlink" title="5 过滤器之 权限管理"></a>5 过滤器之 权限管理</h1><blockquote>
<p>需求：不同的用户在对同一个功能使用是，有的用户可以直接使用，有的</p>
<p>用户会被提示权限不足。</p>
<p>思路：</p>
<p>​    1、 在数据库中创建一个URL 权限表，该表存储了该系统需要被管理的URI</p>
<p>​    2、 在数据库中创建用户权限中间表，用来进行权限分配</p>
<p>​    3、在数据库中将权限给用户分配好</p>
<p>​    4、在用户登录成功后查询该用户具备的URL 权限，存储到该用户的session中。</p>
<p>​    5、在过滤器中对当前发起请求的用户的请求地址进行校验，校验该用户是否</p>
<p>具备该请求地址的权限，如果具备则放行执行，如果不具备则提示权限不足。</p>
<p>数据库设计：<br>    URL 权限表：t_url</p>
<p>​        编号： url_id</p>
<p>​        url地址： location</p>
<p>​        描述：remark</p>
<p>​    用户权限中间表： t_user_url</p>
<p>​        uid</p>
<p>​        urlid</p>
<p>​    SQL 语句的设计</p>
<p>​        select * from t_url where urlid in (select urlid from t_user_url where user_id = ?);    </p>
</blockquote>
<h2 id="5-1-MyFilter-java"><a href="#5-1-MyFilter-java" class="headerlink" title="5.1 MyFilter.java"></a>5.1 MyFilter.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">			FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">			<span class="comment">//设置请求编码格式</span></span><br><span class="line">			request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">			<span class="comment">//设置响应编码格式</span></span><br><span class="line">			response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">			<span class="comment">//强转 ServletRequest 对象</span></span><br><span class="line">			HttpServletRequest req = ((HttpServletRequest)request);</span><br><span class="line">			<span class="comment">//强转 ServletResponse 对象</span></span><br><span class="line">			HttpServletResponse resp = ((HttpServletResponse)response);</span><br><span class="line">			<span class="comment">//获取当前请求 uri</span></span><br><span class="line">			String uri = req.getRequestURI();</span><br><span class="line">			System.out.println(uri);</span><br><span class="line">			String method = req.getParameter(<span class="string">"method"</span>);</span><br><span class="line">		<span class="comment">/*	System.out.println(method);*/</span></span><br><span class="line">			<span class="comment">// 放行登录界面，登录请求,静态资源</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="string">"/projectsxt2/login.jsp"</span>.equals(uri) || (<span class="string">"/projectsxt2/register.jsp"</span>.equals(uri) ) ||((<span class="string">"/projectsxt2/data"</span>.equals(uri) &amp;&amp; method.equals(<span class="string">"userLogin"</span>))) || ((<span class="string">"/projectsxt2/data"</span>.equals(uri) &amp;&amp; method.equals(<span class="string">"userRegister"</span>)))|| uri.startsWith(<span class="string">"/projectsxt2/css/"</span>) || uri.startsWith(<span class="string">"/projectsxt2/js/"</span>) ||uri.startsWith(<span class="string">"/projectsxt2/images/"</span>))&#123;</span><br><span class="line">				<span class="comment">//放行</span></span><br><span class="line">				chain.doFilter(request, response);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">//获取 session 对象</span></span><br><span class="line">				HttpSession session = req.getSession();</span><br><span class="line">				Object obj = session.getAttribute(<span class="string">"user"</span>);</span><br><span class="line">				<span class="keyword">if</span>(obj != <span class="keyword">null</span>)&#123;</span><br><span class="line">					List&lt;URL&gt; list = (List&lt;URL&gt;) session.getAttribute(<span class="string">"power"</span>);</span><br><span class="line">					<span class="keyword">for</span> (URL u : list) &#123;</span><br><span class="line">						<span class="keyword">if</span>(u.getLocation().equals(method) || u.getLocation().equals(uri))&#123;</span><br><span class="line">							<span class="comment">// 放行</span></span><br><span class="line">							chain.doFilter(request, response);							</span><br><span class="line">							<span class="comment">//后面的 for 循环直接终止，返回。</span></span><br><span class="line">							<span class="keyword">return</span>;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="comment">//响应     权限不足</span></span><br><span class="line">					resp.getWriter().print(<span class="string">"power"</span>);</span><br><span class="line">					</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="comment">//重定向</span></span><br><span class="line">					resp.sendRedirect(<span class="string">"/projectsxt2/login.jsp"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-DataServlet-java"><a href="#5-2-DataServlet-java" class="headerlink" title="5.2 DataServlet.java"></a>5.2 DataServlet.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户登录</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userLogin</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="comment">//System.out.println("DataServlet.userLogin() 处理请求...");</span></span><br><span class="line">		<span class="comment">// 获取请求数据</span></span><br><span class="line">		String uname = req.getParameter(<span class="string">"uname"</span>);</span><br><span class="line">		String pwd = req.getParameter(<span class="string">"pwd"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 处理请求数据</span></span><br><span class="line">		<span class="comment">// 获取 业务逻辑层对象</span></span><br><span class="line">		UserService service = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">		User u = service.getUserInfoService(uname, pwd);</span><br><span class="line">		<span class="comment">//System.out.println(u);</span></span><br><span class="line">		<span class="comment">// 获取或创建 session 对象</span></span><br><span class="line">		HttpSession session = req.getSession();</span><br><span class="line">		<span class="comment">// 设置 session 有效期,以秒为单位</span></span><br><span class="line">		<span class="comment">/*session.setMaxInactiveInterval(10);*/</span></span><br><span class="line">		<span class="comment">// 检查用户名和密码</span></span><br><span class="line">		<span class="keyword">if</span> (u != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">// 获取当前用户权限信息</span></span><br><span class="line">			List&lt;URL&gt; list = service.getUserPowerInfoService(u.getUid());</span><br><span class="line">			System.out.println(list);</span><br><span class="line">			session.setAttribute(<span class="string">"power"</span>, list);</span><br><span class="line">			<span class="comment">// 处理响应结果</span></span><br><span class="line">			session.setAttribute(<span class="string">"user"</span>, u);</span><br><span class="line">			session.setAttribute(<span class="string">"uname"</span>, uname);</span><br><span class="line">			session.setAttribute(<span class="string">"pwd"</span>, pwd);</span><br><span class="line">			<span class="comment">// 重定向</span></span><br><span class="line">			resp.sendRedirect(<span class="string">"/projectsxt2/index.jsp"</span>);</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 处理响应结果</span></span><br><span class="line">			session.setAttribute(<span class="string">"flag"</span>, <span class="string">"LoginFailure"</span>);</span><br><span class="line">			<span class="comment">// 重定向</span></span><br><span class="line">			resp.sendRedirect(<span class="string">"/projectsxt2/login.jsp"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-3-User-jsp"><a href="#5-3-User-jsp" class="headerlink" title="5.3 User.jsp"></a>5.3 User.jsp</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params">uid</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">if</span>( confirm(<span class="string">"您确定要删除吗?"</span>))&#123;</span></span><br><span class="line"><span class="javascript">		<span class="comment">//使用 ajax 发送请求</span></span></span><br><span class="line"><span class="javascript">		$.<span class="keyword">get</span>("data",&#123;method:<span class="string">"delUserInfo"</span>,<span class="attr">uid</span>:uid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span>(data == <span class="string">"power"</span>)&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"权限不足"</span>);</span></span><br><span class="line"><span class="javascript">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(data != <span class="string">"true"</span>)&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"登录已过期，请重新登录"</span>);</span></span><br><span class="line"><span class="javascript">				<span class="built_in">window</span>.top.location.href = <span class="string">"/projectsxt2/login.jsp"</span>;</span></span><br><span class="line"><span class="javascript">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">eval</span>(data))&#123;<span class="comment">//响应数据</span></span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"该用户已被删除"</span>);</span></span><br><span class="line"><span class="javascript">				<span class="comment">//刷新当前浏览器，重新发送请求</span></span></span><br><span class="line"><span class="javascript">				<span class="built_in">window</span>.location.href = <span class="string">"data?method=selAllUsers"</span>;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-3-总结"><a href="#5-3-总结" class="headerlink" title="5.3 总结"></a>5.3 总结</h2><blockquote>
<ol>
<li><p>通过使用拦截器，可以通过 session 管理的方式控制用户权限，只让用户访问自己权限内的页面和数据。</p>
</li>
<li><p>数据库权限表的设计可以为每个用户分配权限。</p>
</li>
</ol>
</blockquote>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/03/12/20190312 AJax 异步技术和 json /">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/03/12/20190312 AJax 异步技术和 json /" class="post-title-link" itemprop="url">20190312 AJax 异步技术和json</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-03-12 00:00:00" itemprop="dateCreated datePublished" datetime="2019-03-12T00:00:00+08:00">2019-03-12</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-09-08 19:50:10" itemprop="dateModified" datetime="2019-09-08T19:50:10+08:00">2019-09-08</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-删除用户信息"><a href="#1-删除用户信息" class="headerlink" title="1 删除用户信息"></a>1 删除用户信息</h1><blockquote>
<p>·delUserInfo 方法</p>
<p>将当前用户的信息删除，浏览器会刷新当前页，转向新的响应内容页面。</p>
<p>缺点：不能在保留当前页的情况下，将用户删除并显示。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span>  t_user <span class="keyword">where</span> uid = ？;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"button border-red"</span> </span><br><span class="line">    href=<span class="string">"data?method=delUserInfo&amp;uid=$&#123;user.uid&#125;"</span> </span><br><span class="line">    onclick=<span class="string">"return del()"</span>&gt;</span><br><span class="line">     &lt;span class="icon-trash-o"&gt;&lt;/span&gt; 删除</span><br><span class="line">&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function">function <span class="title">del</span><span class="params">()</span></span>&#123;	</span><br><span class="line">	<span class="keyword">return</span> confirm(<span class="string">"您确定要删除吗?"</span>);	</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除用户信息</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delUserInfo</span><span class="params">(HttpServletRequest req,HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		</span><br><span class="line">			<span class="comment">//获取请求信息</span></span><br><span class="line">				String uid = req.getParameter(<span class="string">"uid"</span>);</span><br><span class="line">			<span class="comment">//处理请求信息</span></span><br><span class="line">				<span class="comment">// 创建业务层对象</span></span><br><span class="line">				UserService us = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">				<span class="keyword">int</span> i = us.delUserInfo(uid);</span><br><span class="line">				<span class="keyword">if</span>(i &gt; <span class="number">0</span>)&#123;</span><br><span class="line">					resp.getWriter().print(<span class="string">"uid为 "</span>+uid+<span class="string">" 的用户已被删除"</span>);</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					resp.getWriter().print(<span class="string">"uid为 "</span>+uid+<span class="string">" 的用户删除失败"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="comment">//响应处理结果</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-AJax-技术概述和访问原理"><a href="#2-AJax-技术概述和访问原理" class="headerlink" title="2 AJax 技术概述和访问原理"></a>2 AJax 技术概述和访问原理</h1><blockquote>
<p>ajax 学习：</p>
<p>​    问题： 怎么在保留当前页面信息的基础上显示新的信息呢?</p>
<p>​    解决：使用 ajax</p>
<p>​    特点： 实现网页的局部刷新</p>
<p>   应用前景:  </p>
<p>​         搜索框提示语</p>
<p>​         地图</p>
<p>​         网页的其他功能(增加删除)</p>
</blockquote>
<h2 id="2-1-Ajax-访问原理"><a href="#2-1-Ajax-访问原理" class="headerlink" title="2.1  Ajax 访问原理"></a>2.1  Ajax 访问原理</h2><blockquote>
<p>请求方式：</p>
<p>​    form 标签中 action属性</p>
<p>​    a 标签中 href 属性</p>
<p>​    js中 window.location.href=””</p>
<p>对于服务器来说，请求方式来自哪里服务器不知道，只处理请求。</p>
<p>ajax 引擎对象：XMLHttpRequest </p>
<p>open 方法，创建请求对象</p>
<p>send 方法，发送请求数据</p>
</blockquote>
<p><img src="http://www.zwer.xyz/picGo/20190313083321.png" alt></p>
<h2 id="2-2-ajax-与-非ajax"><a href="#2-2-ajax-与-非ajax" class="headerlink" title="2.2 ajax 与 非ajax"></a>2.2 ajax 与 非ajax</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;title&gt; ajax 技术 &lt;/title&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"pragma"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"cache-control"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"expires"</span> content=<span class="string">"0"</span>&gt;    </span><br><span class="line">	&lt;meta http-equiv=<span class="string">"keywords"</span> content=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"description"</span> content=<span class="string">"This is my page"</span>&gt;</span><br><span class="line">	&lt;!--</span><br><span class="line">	&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"styles.css"</span>&gt;</span><br><span class="line">	--&gt;</span><br><span class="line">	&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		<span class="comment">//非 ajax</span></span><br><span class="line">		<span class="function">function <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			window.location.href=<span class="string">"my"</span>;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// ajax</span></span><br><span class="line">		<span class="function">function <span class="title">testAjax</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="comment">//声明 ajax 对象</span></span><br><span class="line">			<span class="keyword">var</span> ajax;</span><br><span class="line">			<span class="comment">//创建 ajax 对象</span></span><br><span class="line">			<span class="keyword">if</span>(window.XMLHttpRequest)&#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line">				<span class="comment">// 获取 ajax 引擎对象</span></span><br><span class="line">				ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">				</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(window.addObject)&#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">				ajax = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//声明 接受服务器的响应结果</span></span><br><span class="line">			<span class="comment">// 存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</span></span><br><span class="line">			ajax.onreadystatechange=function()&#123;</span><br><span class="line">				</span><br><span class="line">				 <span class="comment">//获取响应内容	</span></span><br><span class="line">				 <span class="keyword">var</span> data = ajax.responseText;</span><br><span class="line">				 <span class="comment">// 获取 div 对象</span></span><br><span class="line">				 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">				 <span class="comment">// 将 响应显示在 div 中</span></span><br><span class="line">				 div.innerHTML = data;</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//向服务器发送请求</span></span><br><span class="line">			ajax.open(<span class="string">"get"</span>,<span class="string">"my"</span>);</span><br><span class="line">			ajax.send(<span class="keyword">null</span>);</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="function">function <span class="title">testJs</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">var</span>  btn = document.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">			<span class="comment">//绑定事件</span></span><br><span class="line">			btn.onclick = function()&#123;</span><br><span class="line">				</span><br><span class="line">				alert(<span class="string">"绑定事件提示"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">	</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body onload=<span class="string">"testJs()"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"非ajax"</span>  onclick=<span class="string">"test()"</span>&gt;</span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"ajax"</span>  onclick=<span class="string">"testAjax()"</span>&gt;</span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"ajax"</span> id=<span class="string">"btn"</span>&gt;</span><br><span class="line">    	&lt;hr /&gt;</span><br><span class="line">    	&lt;div id=<span class="string">"divShow"</span> style=<span class="string">"width: 200px;height:200px;border:solid 1px"</span>&gt;</span><br><span class="line">    	</span><br><span class="line">    	</span><br><span class="line">    	&lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-Ajax-流程"><a href="#2-3-Ajax-流程" class="headerlink" title="2.3  Ajax 流程"></a>2.3  Ajax 流程</h2><blockquote>
<ol>
<li><p>创建 Ajax 引擎对象</p>
</li>
<li><p>声明 事件监听：监听ajax对象的属性readyState的值，一旦 readyState 的值发生变化就会触发声明函数的执行</p>
<ol>
<li><p>ajax 状态码 之 readyState的值</p>
<p>0： 表示创建 ajax 独享</p>
<p>1： 表示请求创建但是未发送</p>
<p>2： 表示请求发送</p>
<p>3： 请求处理完毕，正在接收响应内容</p>
<p>4：响应内容接收完毕</p>
</li>
</ol>
</li>
<li><p>创建并发送 ajax 对象</p>
<ol>
<li><p>创建 ajax 请求(设置异步或者同步)</p>
<p>ajax.open(method,url,ansyc)</p>
<p>method: 表示请求方式</p>
<p>​    get 方法：以  ？ 方法拼接在 url 的后面参数间用 &amp; 隔开。注意请求数据不能写在               send方法中</p>
<p>​    post 方法：需要单独的进行请求数据的设置。使用 ajax.</p>
<p>​             设置请求数据为键值对数据。如果有请求数据则 ajax.send(“键值对数据&amp;键值对数据…”) ，如果没有请求数据，则 ajax.send(null)</p>
<p>​    </p>
<p>url: 请求地址</p>
<p>ansyc 设置异步或者同步</p>
<p>​    异步：当前 Js 函数继续执行，无须等待ajax响应及响应处理</p>
<p>​    同步：当前 JS 函数不不继续执行，等待 ajax 响应及响应处理</p>
</li>
</ol>
</li>
</ol>
</blockquote>
<h1 id="3-Ajax-状态码-之-readyState"><a href="#3-Ajax-状态码-之-readyState" class="headerlink" title="3 Ajax 状态码 之 readyState"></a>3 Ajax 状态码 之 readyState</h1><blockquote>
<p> 0： 表示创建 ajax 引擎对象</p>
<p>1： 表示请求创建但是未发送</p>
<p>2： 表示请求发送</p>
<p>3： 请求处理完毕，正在接收响应内容</p>
<p>4：响应内容接收完毕(重要状态)</p>
<p>通过 ajax 状态码，可以明确知道请求在什么时候创建，什么时候发送，以及什么时候接受响应数据，响应数据完全接受的状态。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查看 ajax 状态码</span></span><br><span class="line">alert(ajax.readyState);</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;title&gt; ajax 技术 &lt;/title&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"pragma"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"cache-control"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"expires"</span> content=<span class="string">"0"</span>&gt;    </span><br><span class="line">	&lt;meta http-equiv=<span class="string">"keywords"</span> content=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"description"</span> content=<span class="string">"This is my page"</span>&gt;</span><br><span class="line">	&lt;!--</span><br><span class="line">	&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"styles.css"</span>&gt;</span><br><span class="line">	--&gt;</span><br><span class="line">	&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		<span class="comment">//非 ajax</span></span><br><span class="line">		<span class="function">function <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			window.location.href=<span class="string">"my"</span>;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// ajax</span></span><br><span class="line">		<span class="function">function <span class="title">testAjax</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="comment">//声明 ajax 对象</span></span><br><span class="line">			<span class="keyword">var</span> ajax;</span><br><span class="line">			<span class="comment">//创建 ajax 对象</span></span><br><span class="line">			<span class="keyword">if</span>(window.XMLHttpRequest)&#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line">				<span class="comment">// 获取 ajax 引擎对象</span></span><br><span class="line">				ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">					</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(window.addObject)&#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">				ajax = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//声明 接受服务器的响应结果</span></span><br><span class="line">			<span class="comment">// 存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</span></span><br><span class="line">			ajax.onreadystatechange=function()&#123;</span><br><span class="line">				<span class="comment">//小优化</span></span><br><span class="line">				<span class="comment">// 当响应内容完全接受完毕时，将响应内容显示到页面中</span></span><br><span class="line">				<span class="keyword">if</span>(ajax.readyState == <span class="number">4</span>)&#123;</span><br><span class="line">					 <span class="comment">//获取响应内容	</span></span><br><span class="line">					 <span class="keyword">var</span> data = ajax.responseText;</span><br><span class="line">					 <span class="comment">// 获取 div 对象</span></span><br><span class="line">					 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">					 <span class="comment">// 将 响应显示在 div 中</span></span><br><span class="line">					 div.innerHTML = data; 						</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//向服务器发送请求</span></span><br><span class="line">			ajax.open(<span class="string">"get"</span>,<span class="string">"my"</span>);</span><br><span class="line">			ajax.send(<span class="keyword">null</span>);</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="function">function <span class="title">testJs</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">var</span>  btn = document.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">			<span class="comment">//绑定事件</span></span><br><span class="line">			btn.onclick = function()&#123;</span><br><span class="line">				</span><br><span class="line">				alert(<span class="string">"绑定事件提示"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">	</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body onload=<span class="string">"testJs()"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"非ajax"</span>  onclick=<span class="string">"test()"</span>&gt;</span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"ajax"</span>  onclick=<span class="string">"testAjax()"</span>&gt;</span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"ajax"</span> id=<span class="string">"btn"</span>&gt;</span><br><span class="line">    	&lt;hr /&gt;</span><br><span class="line">    	&lt;div id=<span class="string">"divShow"</span> style=<span class="string">"width: 200px;height:200px;border:solid 1px"</span>&gt;</span><br><span class="line">    	</span><br><span class="line">    	</span><br><span class="line">    	&lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="4-Ajax-响应状态码-status"><a href="#4-Ajax-响应状态码-status" class="headerlink" title="4 Ajax 响应状态码 status"></a>4 Ajax 响应状态码 status</h1><blockquote>
<p>200  表示一切正常</p>
<p>404 请求资源不存在</p>
<p>500 服务内部错误(繁忙)</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ajax.status == <span class="number">404</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;title&gt; ajax 技术 &lt;/title&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"pragma"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"cache-control"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"expires"</span> content=<span class="string">"0"</span>&gt;    </span><br><span class="line">	&lt;meta http-equiv=<span class="string">"keywords"</span> content=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"description"</span> content=<span class="string">"This is my page"</span>&gt;</span><br><span class="line">	&lt;!--</span><br><span class="line">	&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"styles.css"</span>&gt;</span><br><span class="line">	--&gt;</span><br><span class="line">	&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		<span class="comment">//非 ajax</span></span><br><span class="line">		<span class="function">function <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			window.location.href=<span class="string">"my"</span>;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// ajax</span></span><br><span class="line">		<span class="function">function <span class="title">testAjax</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="comment">//声明 ajax 对象</span></span><br><span class="line">			<span class="keyword">var</span> ajax;</span><br><span class="line">			<span class="comment">//创建 ajax 对象</span></span><br><span class="line">			<span class="keyword">if</span>(window.XMLHttpRequest)&#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line">				<span class="comment">// 获取 ajax 引擎对象</span></span><br><span class="line">				ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">					</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(window.addObject)&#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">				ajax = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//声明 接受服务器的响应结果</span></span><br><span class="line">			<span class="comment">// 存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</span></span><br><span class="line">			ajax.onreadystatechange=function()&#123;</span><br><span class="line">				<span class="comment">//小优化</span></span><br><span class="line">				<span class="comment">// 当响应内容完全接受完毕时，将响应内容显示到页面中</span></span><br><span class="line">				<span class="keyword">if</span>(ajax.readyState == <span class="number">4</span>)&#123;</span><br><span class="line">					<span class="comment">//如果响应码正常</span></span><br><span class="line">					<span class="keyword">if</span>(ajax.status == <span class="number">200</span>)&#123;</span><br><span class="line">						 <span class="comment">//获取响应内容	</span></span><br><span class="line">						 <span class="keyword">var</span> data = ajax.responseText;</span><br><span class="line">						 <span class="comment">// 获取 div 对象</span></span><br><span class="line">						 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">						 <span class="comment">// 将 响应显示在 div 中</span></span><br><span class="line">						 div.innerHTML = data; 	</span><br><span class="line">						 </span><br><span class="line">						&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ajax.status == <span class="number">404</span>)&#123;</span><br><span class="line">							 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">							 div.innerHTML = <span class="string">"请求资源不存在"</span>; 	</span><br><span class="line">						&#125;</span><br><span class="line">						&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ajax.status == <span class="number">500</span>)&#123;</span><br><span class="line">							 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">							 div.innerHTML = <span class="string">"内部服务器繁忙"</span>; 	</span><br><span class="line">						&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">							 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">							 div.innerHTML = <span class="string">"未知错误"</span>; 		</span><br><span class="line">						&#125;</span><br><span class="line">	</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//向服务器发送请求</span></span><br><span class="line">			ajax.open(<span class="string">"get"</span>,<span class="string">"my"</span>);</span><br><span class="line">			ajax.send(<span class="keyword">null</span>);</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="function">function <span class="title">testJs</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">var</span>  btn = document.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">			<span class="comment">//绑定事件</span></span><br><span class="line">			btn.onclick = function()&#123;</span><br><span class="line">				</span><br><span class="line">				alert(<span class="string">"绑定事件提示"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">	</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body onload=<span class="string">"testJs()"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"非ajax"</span>  onclick=<span class="string">"test()"</span>&gt;</span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"ajax"</span>  onclick=<span class="string">"testAjax()"</span>&gt;</span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"ajax"</span> id=<span class="string">"btn"</span>&gt;</span><br><span class="line">    	&lt;hr /&gt;</span><br><span class="line">    	&lt;div id=<span class="string">"divShow"</span> style=<span class="string">"width: 200px;height:200px;border:solid 1px"</span>&gt;</span><br><span class="line">    	</span><br><span class="line">    	</span><br><span class="line">    	&lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="5-异步同步技术-async"><a href="#5-异步同步技术-async" class="headerlink" title="5  异步同步技术 async"></a>5  异步同步技术 async</h1><blockquote>
<p>​    ansyc 设置异步或者同步</p>
<p>​    异步：当前 Js 函数继续执行，无须等待ajax响应及响应处理</p>
<p>​    同步：当前 JS 函数不不继续执行，等待 ajax 响应及响应处理</p>
<p>​    <code>ajax.open(method,url,asyn);</code></p>
<p>​    <code>asyn = true</code> 表示异步，默认为异步</p>
<p>​     <code>asyn = false</code> 表示异步同步，等待服务器响应结果回来，再继续执行该函数</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="built_in">String</span> path = request.getContextPath();</span><br><span class="line"><span class="built_in">String</span> basePath = request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;base href=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;title&gt;ajax 技术&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;meta http-equiv="pragma" content="no-cache"&gt;</span></span><br><span class="line"><span class="regexp">&lt;meta http-equiv="cache-control" content="no-cache"&gt;</span></span><br><span class="line"><span class="regexp">&lt;meta http-equiv="expires" content="0"&gt;</span></span><br><span class="line"><span class="regexp">&lt;meta http-equiv="keywords" content="keyword1,keyword2,keyword3"&gt;</span></span><br><span class="line"><span class="regexp">&lt;meta http-equiv="description" content="This is my page"&gt;</span></span><br><span class="line"><span class="regexp">&lt;!--</span></span><br><span class="line"><span class="regexp">	&lt;link rel="stylesheet" type="text/</span>css<span class="string">" href="</span>styles.css<span class="string">"&gt;</span></span><br><span class="line"><span class="string">	--&gt;</span></span><br><span class="line"><span class="string">&lt;script type="</span>text/javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">		//非 ajax</span></span><br><span class="line"><span class="string">		function test()&#123;</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string">			window.location.href="</span>my<span class="string">";</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">		// ajax</span></span><br><span class="line"><span class="string">		function testAjax()&#123;</span></span><br><span class="line"><span class="string">			//声明 ajax 对象</span></span><br><span class="line"><span class="string">			var ajax;</span></span><br><span class="line"><span class="string">			//创建 ajax 对象</span></span><br><span class="line"><span class="string">			if(window.XMLHttpRequest)&#123;// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line"><span class="string">				// 获取 ajax 引擎对象</span></span><br><span class="line"><span class="string">				ajax = new XMLHttpRequest();</span></span><br><span class="line"><span class="string">					</span></span><br><span class="line"><span class="string">			&#125;else if(window.addObject)&#123;// code for IE6, IE5</span></span><br><span class="line"><span class="string">				ajax = new ActiveXObject("</span>Microsoft.XMLHTTP<span class="string">");</span></span><br><span class="line"><span class="string">			&#125;</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string">			//声明 接受服务器的响应结果</span></span><br><span class="line"><span class="string">			// 存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</span></span><br><span class="line"><span class="string">			ajax.onreadystatechange=function()&#123;</span></span><br><span class="line"><span class="string">				//小优化</span></span><br><span class="line"><span class="string">				// 当响应内容完全接受完毕时，将响应内容显示到页面中</span></span><br><span class="line"><span class="string">				if(ajax.readyState == 4)&#123;</span></span><br><span class="line"><span class="string">					//如果响应码正常</span></span><br><span class="line"><span class="string">					if(ajax.status == 200)&#123;</span></span><br><span class="line"><span class="string">						 //获取响应内容	</span></span><br><span class="line"><span class="string">						 var data = ajax.responseText;</span></span><br><span class="line"><span class="string">						 // 获取 div 对象</span></span><br><span class="line"><span class="string">						 var div = document.getElementById("</span>divShow<span class="string">");</span></span><br><span class="line"><span class="string">						 // 将 响应显示在 div 中</span></span><br><span class="line"><span class="string">						 div.innerHTML = data; 		 </span></span><br><span class="line"><span class="string">					&#125;else if(ajax.status == 404)&#123;</span></span><br><span class="line"><span class="string">						 var div = document.getElementById("</span>divShow<span class="string">");</span></span><br><span class="line"><span class="string">						 div.innerHTML = "</span>请求资源不存在<span class="string">"; 	</span></span><br><span class="line"><span class="string">					&#125;else if(ajax.status == 500)&#123;</span></span><br><span class="line"><span class="string">						 var div = document.getElementById("</span>divShow<span class="string">");</span></span><br><span class="line"><span class="string">						 div.innerHTML = "</span>内部服务器繁忙<span class="string">"; 	</span></span><br><span class="line"><span class="string">					&#125;else&#123;</span></span><br><span class="line"><span class="string">						 var div = document.getElementById("</span>divShow<span class="string">");</span></span><br><span class="line"><span class="string">						 div.innerHTML = "</span>未知错误<span class="string">"; 		</span></span><br><span class="line"><span class="string">					&#125;</span></span><br><span class="line"><span class="string">				&#125;</span></span><br><span class="line"><span class="string">			&#125;</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string">			//创建 ajax 请求</span></span><br><span class="line"><span class="string">			ajax.open("</span><span class="keyword">get</span>","my",false);</span><br><span class="line">			//发送 ajax 请求</span><br><span class="line">			ajax.send(null);</span><br><span class="line">			//异步同步</span><br><span class="line">			alert("异步同步");</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		function testJs()&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">var</span>  btn = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">			<span class="comment">//绑定事件</span></span><br><span class="line">			btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">				</span><br><span class="line">				alert(<span class="string">"绑定事件提示"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body onload=<span class="string">"testJs()"</span>&gt;</span><br><span class="line"></span><br><span class="line">	&lt;input type=<span class="string">"button"</span> value=<span class="string">"非ajax"</span> onclick=<span class="string">"test()"</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">"button"</span> value=<span class="string">"ajax"</span> onclick=<span class="string">"testAjax()"</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">"button"</span> value=<span class="string">"ajax"</span> id=<span class="string">"btn"</span>&gt;</span><br><span class="line">	&lt;hr /&gt;</span><br><span class="line">	&lt;div id=<span class="string">"divShow"</span> style=<span class="string">"width: 200px;height:200px;border:solid 1px"</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://www.zwer.xyz/picGo/ajax%E4%B9%8Basyn.gif" alt></p>
<h1 id="6-Get-和-Post-请求方法"><a href="#6-Get-和-Post-请求方法" class="headerlink" title="6 Get 和 Post 请求方法"></a>6 Get 和 Post 请求方法</h1><blockquote>
<p>get 方法：以  ？ 方法拼接在 url 的后面参数间用 &amp; 隔开。</p>
<p>​        注意请求数据不能写在send方法中。</p>
<p>post 方法：需要单独的进行请求数据的设置。使用 ajax.</p>
<p>​             设置请求数据为键值对数据。如果有请求数据则 ajax.send(“键值对数据&amp;键值对数据…”) ，</p>
<p>​          如果没有请求数据，则 ajax.send(null)</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建 ajax 请求</span></span><br><span class="line">ajax.open(<span class="string">"get"</span>,<span class="string">"my?uname=张三&amp;pwd=123"</span>,<span class="literal">false</span>);</span><br><span class="line"><span class="comment">//发送 ajax 请求</span></span><br><span class="line">ajax.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// post 请求</span></span><br><span class="line"><span class="comment">// 创建 ajax 请求</span></span><br><span class="line">ajax.open(<span class="string">"post"</span>, <span class="string">"my"</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">//设置请求头</span></span><br><span class="line">ajax.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>)</span><br><span class="line"><span class="comment">//发送 ajax 请求</span></span><br><span class="line">ajax.send(<span class="string">"uname=张三&amp;pwd=123"</span>);</span><br></pre></td></tr></table></figure>

<h1 id="7-Json-对象与响应数据"><a href="#7-Json-对象与响应数据" class="headerlink" title="7 Json 对象与响应数据"></a>7 Json 对象与响应数据</h1><h2 id="7-1-Json-对象"><a href="#7-1-Json-对象" class="headerlink" title="7.1 Json 对象"></a>7.1 Json 对象</h2><blockquote>
<p>json 是一种 Js 创建对象中声明的一种格式</p>
<p>使用 Json 对象的好处：保证对象中数据的紧密性和完整性</p>
<p>使用 ：在服务器端将要响应的数据拼接成 json 格式的字符串。这样客户端（浏览器端）在接受到响应数据后可以 使用 eval 方法将 json 格式的字符串数据直接转换为 对应的 JS 对象，便于数据的操作。在服务器端使用类似 Gson 的工具包完成 json格式的字符串的拼接。</p>
<p>Json 的格式：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var 对象名 = &#123;</span><br><span class="line"></span><br><span class="line">	键名："值"，</span><br><span class="line">	键名："值"，</span><br><span class="line">	...</span><br><span class="line">	键名："值"，</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种方法创建 json 对象</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">obj.name = <span class="string">"张三"</span>;</span><br><span class="line">obj.pwd = <span class="string">"123"</span>;</span><br><span class="line"><span class="comment">//第二种方法创建 json 对象</span></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">    name:<span class="string">"李四"</span>,</span><br><span class="line">    pwd:<span class="string">"123"</span>,</span><br><span class="line">    sex:<span class="string">"男"</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//输出</span></span><br><span class="line">alert(obj.name+<span class="string">"  "</span>+obj2.name);</span><br></pre></td></tr></table></figure>

<h2 id="7-2-Ajax-之-响应数据"><a href="#7-2-Ajax-之-响应数据" class="headerlink" title="7.2 Ajax 之 响应数据"></a>7.2 Ajax 之 响应数据</h2><blockquote>
<p>服务器响应给浏览器的数据应该是字符串类型</p>
<p>但是如果数据量比较大，我们就需要在服务端将数据拼接上一个良好的字符串格式数据，</p>
<p>响应给浏览器根据格式进行数据的解析和使用</p>
<p>问题： </p>
<p>​    什么昂的格式算是良好格式呢？</p>
<p>解决：</p>
<p>​    使用 json 数据格式  </p>
<p>​    使用  js 中 eval 方法将字符串转成 JS 对象</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.szxy.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAjax</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">				<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">				</span><br><span class="line">			</span><br><span class="line">					<span class="comment">//设置请求编码格式</span></span><br><span class="line">					req.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">					<span class="comment">//设置响应编码格式</span></span><br><span class="line">					resp.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">					<span class="comment">//获取请求数据</span></span><br><span class="line">					String uname = req.getParameter(<span class="string">"uname"</span>);</span><br><span class="line">					String pwd = req.getParameter(<span class="string">"pwd"</span>);</span><br><span class="line">					</span><br><span class="line">					System.out.println(uname+<span class="string">"----"</span>+pwd);</span><br><span class="line">					</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="keyword">new</span> Thread().sleep(<span class="number">2000</span>);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="comment">//处理请求数据</span></span><br><span class="line">					<span class="comment">//int i = 1/0;</span></span><br><span class="line">					User user = <span class="keyword">new</span> User();</span><br><span class="line">					user.setName(<span class="string">"张三"</span>);</span><br><span class="line">					user.setPwd(<span class="string">"123"</span>);</span><br><span class="line">					user.setSex(<span class="string">"男"</span>);</span><br><span class="line">					user.setAge(<span class="number">20</span>);</span><br><span class="line">					</span><br><span class="line">					<span class="comment">//将 user 对象中的数据转换成 json 格式的数据</span></span><br><span class="line">				<span class="comment">//	String str = new String("&#123;uname:'张三',pwd:'123',sex:'男',age:20&#125;");</span></span><br><span class="line">					String str= <span class="keyword">new</span> Gson().toJson(user);</span><br><span class="line">					System.out.println(str);</span><br><span class="line">					</span><br><span class="line">					<span class="comment">//响应处理结果</span></span><br><span class="line">					PrintWriter out = resp.getWriter();</span><br><span class="line">					<span class="comment">/*out.write("ajax学习");*/</span></span><br><span class="line">					out.write(str);</span><br><span class="line">				</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;base href=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;title&gt;ajax 技术&lt;/title&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"pragma"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"cache-control"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"expires"</span> content=<span class="string">"0"</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"keywords"</span> content=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"description"</span> content=<span class="string">"This is my page"</span>&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">	&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"styles.css"</span>&gt;</span><br><span class="line">	--&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		<span class="comment">//非 ajax</span></span><br><span class="line">		<span class="function">function <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			window.location.href=<span class="string">"my"</span>;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// ajax</span></span><br><span class="line">		<span class="function">function <span class="title">testAjax</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="comment">//声明 ajax 对象</span></span><br><span class="line">			<span class="keyword">var</span> ajax;</span><br><span class="line">			<span class="comment">//创建 ajax 对象</span></span><br><span class="line">			<span class="keyword">if</span>(window.XMLHttpRequest)&#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line">				<span class="comment">// 获取 ajax 引擎对象</span></span><br><span class="line">				ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">					</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(window.addObject)&#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">				ajax = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//声明 接受服务器的响应结果</span></span><br><span class="line">			<span class="comment">// 存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</span></span><br><span class="line">			ajax.onreadystatechange=function()&#123;</span><br><span class="line">				<span class="comment">//小优化</span></span><br><span class="line">				<span class="comment">// 当响应内容完全接受完毕时，将响应内容显示到页面中</span></span><br><span class="line">				<span class="keyword">if</span>(ajax.readyState == <span class="number">4</span>)&#123;</span><br><span class="line">					<span class="comment">//如果响应码正常</span></span><br><span class="line">					<span class="keyword">if</span>(ajax.status == <span class="number">200</span>)&#123;</span><br><span class="line">						 <span class="comment">//获取响应内容	</span></span><br><span class="line">						 <span class="keyword">var</span> data = ajax.responseText;</span><br><span class="line">						 <span class="comment">//处理响应内容</span></span><br><span class="line">						 eval(<span class="string">"var obj="</span>+data);</span><br><span class="line">						 <span class="comment">// 获取 div 对象</span></span><br><span class="line">						 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">						 <span class="comment">// 将 响应显示在 div 中</span></span><br><span class="line">						 div.innerHTML = obj.name; 		 </span><br><span class="line">					&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ajax.status == <span class="number">404</span>)&#123;</span><br><span class="line">						 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">						 div.innerHTML = <span class="string">"请求资源不存在"</span>; 	</span><br><span class="line">					&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ajax.status == <span class="number">500</span>)&#123;</span><br><span class="line">						 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">						 div.innerHTML = <span class="string">"内部服务器繁忙"</span>; 	</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">						 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">						 div.innerHTML = <span class="string">"未知错误"</span>; 		</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// get 请求</span></span><br><span class="line">			<span class="comment">/* //创建 ajax 请求</span></span><br><span class="line"><span class="comment">			ajax.open("get","my?uname=张三&amp;pwd=123",false);</span></span><br><span class="line"><span class="comment">			//发送 ajax 请求</span></span><br><span class="line"><span class="comment">			ajax.send(null); */</span></span><br><span class="line">			<span class="comment">// post 请求</span></span><br><span class="line">			<span class="comment">// 创建 ajax 请求</span></span><br><span class="line">			ajax.open(<span class="string">"post"</span>, <span class="string">"my"</span>, <span class="keyword">false</span>);</span><br><span class="line">			<span class="comment">//设置请求头</span></span><br><span class="line">			ajax.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>)</span><br><span class="line">			<span class="comment">//发送 ajax 请求</span></span><br><span class="line">			ajax.send(<span class="string">"uname=张三&amp;pwd=123"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//异步同步</span></span><br><span class="line">			 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);			</span><br><span class="line">			alert(div.innerHTML);</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="function">function <span class="title">testJs</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">var</span>  btn = document.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">			<span class="comment">//绑定事件</span></span><br><span class="line">			btn.onclick = function()&#123;</span><br><span class="line">				</span><br><span class="line">				alert(<span class="string">"绑定事件提示"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//第一种方法创建 json 对象</span></span><br><span class="line">		<span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">		obj.name = <span class="string">"张三"</span>;</span><br><span class="line">		obj.pwd = <span class="string">"123"</span>;</span><br><span class="line">		<span class="comment">//第二种方法创建 json 对象</span></span><br><span class="line">		<span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">				name:<span class="string">"李四"</span>,</span><br><span class="line">				pwd:<span class="string">"123"</span>,</span><br><span class="line">				sex:<span class="string">"男"</span></span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="comment">//输出</span></span><br><span class="line">		alert(obj.name+<span class="string">"  "</span>+obj2.name);</span><br><span class="line">		</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body onload=<span class="string">"testJs()"</span>&gt;</span><br><span class="line"></span><br><span class="line">	&lt;input type=<span class="string">"button"</span> value=<span class="string">"非ajax"</span> onclick=<span class="string">"test()"</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">"button"</span> value=<span class="string">"ajax"</span> onclick=<span class="string">"testAjax()"</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">"button"</span> value=<span class="string">"ajax"</span> id=<span class="string">"btn"</span>&gt;</span><br><span class="line">	&lt;hr /&gt;</span><br><span class="line">	&lt;div id=<span class="string">"divShow"</span> style=<span class="string">"width: 200px;height:200px;border:solid 1px"</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="8-Ajax-流程"><a href="#8-Ajax-流程" class="headerlink" title="8 Ajax 流程"></a>8 Ajax 流程</h1><blockquote>
<ol>
<li><p>创建 ajax 引擎对象  XMLHttpRequest</p>
</li>
<li><p>声明事件监听</p>
<p>​    ajax 状态码等于 4</p>
<p>​         ajax 响应码</p>
<p>​            获取响应内容(普通格式字符串或者 Json格式的字符串)</p>
<p>​            处理响应内容</p>
</li>
<li><p>创建并发送 ajax 请求</p>
<ol>
<li>创建 ajax 请求(请求方式，请求地址，同步或异步)</li>
<li>发送 ajax 请求</li>
</ol>
</li>
<li><p>其他操作</p>
</li>
</ol>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[创建 Ajax 对象] --&gt; B[声明事件监听]</span><br><span class="line">B--&gt;C[创建并发送 ajax 请求]</span><br><span class="line">C--&gt;D[其他操作]</span><br></pre></td></tr></table></figure>

<h1 id="9-用户注册"><a href="#9-用户注册" class="headerlink" title="9 用户注册"></a>9 用户注册</h1><blockquote>
<p>功能：用户名是否被注册校验</p>
<p>思路：</p>
<pre><code>1. 用户书写用户名信息，在失去焦点是进行用户校验
2. 失去焦点发送请求到服务器，服务器根据用户名信息去数据库中查询该用户名是否存在
3. 将校验结果响应客户端
4. 在当前页面，失去焦点后用户名输入框后显示提示语</code></pre><p>技术：</p>
<p>​    使用 ajax 技术</p>
</blockquote>
<h2 id="9-1-前端代码"><a href="#9-1-前端代码" class="headerlink" title="9.1 前端代码"></a>9.1 前端代码</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;title&gt;注册&lt;/title&gt;</span><br><span class="line">    </span><br><span class="line">	&lt;meta http-equiv=<span class="string">"pragma"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"cache-control"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"expires"</span> content=<span class="string">"0"</span>&gt;    </span><br><span class="line">	&lt;meta http-equiv=<span class="string">"keywords"</span> content=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"description"</span> content=<span class="string">"This is my page"</span>&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;script&gt;</span><br><span class="line">		<span class="comment">// 检查用户是否已被注册</span></span><br><span class="line">		<span class="function">function <span class="title">checkName</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="comment">// 创建 ajax 对象</span></span><br><span class="line">			<span class="keyword">var</span> ajax = <span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">if</span>(window.XMLHttpRequest)&#123;</span><br><span class="line">				ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(window.addObject)&#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">				ajax = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//声明事件监听</span></span><br><span class="line">			ajax.onreadystatechange=function()&#123;</span><br><span class="line">				<span class="comment">//判断 ajax 状态码</span></span><br><span class="line">				<span class="keyword">if</span>(ajax.readyState == <span class="number">4</span>)&#123;</span><br><span class="line">					<span class="comment">//判断 ajax 响应码</span></span><br><span class="line">					<span class="keyword">if</span>(ajax.status == <span class="number">200</span>)&#123;</span><br><span class="line">						<span class="comment">// 获取响应内容</span></span><br><span class="line">						<span class="keyword">var</span> data = ajax.responseText;</span><br><span class="line">						<span class="comment">// 处理响应内容</span></span><br><span class="line">						<span class="keyword">var</span> span = document.getElementById(<span class="string">"unameSpan"</span>);</span><br><span class="line">						<span class="keyword">if</span>(eval(data))&#123;</span><br><span class="line">							span.innerHTML = <span class="string">"用户名 OK"</span>;</span><br><span class="line">							span.style.color = <span class="string">"green"</span>;</span><br><span class="line">						&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">							span.innerHTML = <span class="string">"用户名已被注册"</span>;</span><br><span class="line">							span.style.color = <span class="string">"red"</span>;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; </span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 创建并发送请求</span></span><br><span class="line">			<span class="comment">//声明事件监听</span></span><br><span class="line">			<span class="keyword">var</span> input = document.getElementById(<span class="string">"uname"</span>);</span><br><span class="line">			<span class="keyword">var</span> val = input.value;</span><br><span class="line">			ajax.open(<span class="string">"get"</span>, <span class="string">"data?uname="</span>+val,<span class="keyword">true</span>);</span><br><span class="line">			<span class="comment">//发送请求</span></span><br><span class="line">			ajax.send(<span class="keyword">null</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body&gt;</span><br><span class="line">   		&lt;form action=<span class="string">"#"</span> &gt;</span><br><span class="line">   			&lt;label&gt;用户名: &lt;/label&gt;</span><br><span class="line">   			&lt;input type="text" name="uname" id="uname" onblur="checkName()"/&gt;&amp;nbsp;&lt;span id="unameSpan"&gt;&lt;/span&gt;</span><br><span class="line">   		&lt;/form&gt;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9-2-后端代码"><a href="#9-2-后端代码" class="headerlink" title="9.2 后端代码"></a>9.2 后端代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.szxy.service.DataService;</span><br><span class="line"><span class="keyword">import</span> cn.szxy.service.impl.DataServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="comment">//声明  业务层对象</span></span><br><span class="line">	DataService service = <span class="keyword">new</span> DataServiceImpl();</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//设置请求编码格式</span></span><br><span class="line">			req.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">			<span class="comment">//设置响应编码格式</span></span><br><span class="line">			resp.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">			<span class="comment">//获取请求数据</span></span><br><span class="line">			String uname = req.getParameter(<span class="string">"uname"</span>);</span><br><span class="line">			<span class="comment">//处理请求数据</span></span><br><span class="line">			<span class="keyword">boolean</span> flag = service.selUserByName(uname);</span><br><span class="line">			<span class="comment">//响应处理结果</span></span><br><span class="line">			<span class="keyword">if</span>(!flag)&#123;<span class="comment">//表示该用户名未被注册</span></span><br><span class="line">				resp.getWriter().write(<span class="string">"true"</span>);<span class="comment">//直接响应 true ,可以降低 前端与后端之间的耦合</span></span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;<span class="comment">//表示该用户名已被注册</span></span><br><span class="line">				resp.getWriter().write(<span class="string">"false"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.szxy.dao.DataDao;</span><br><span class="line"><span class="keyword">import</span> cn.szxy.dao.impl.DataDaoImpl;</span><br><span class="line"><span class="keyword">import</span> cn.szxy.service.DataService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataServiceImpl</span> <span class="keyword">implements</span> <span class="title">DataService</span></span>&#123;</span><br><span class="line">	<span class="comment">// 获取 dao 层对象</span></span><br><span class="line">	DataDao dao = <span class="keyword">new</span> DataDaoImpl();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//根据用户名查询指定用户信息</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">selUserByName</span><span class="params">(String uname)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dao.selUserByName(uname);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.szxy.dao.DataDao;</span><br><span class="line"><span class="keyword">import</span> cn.szxy.util.DBUtil;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataDaoImpl</span> <span class="keyword">implements</span> <span class="title">DataDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 查询用户是否已经被注册</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">selUserByName</span><span class="params">(String uname)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//声明变量</span></span><br><span class="line">		Connection conn = <span class="keyword">null</span>;</span><br><span class="line">		PreparedStatement pstmt = <span class="keyword">null</span>;</span><br><span class="line">		ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 判断用户是否已被注册的标志，false 表示未被注册</span></span><br><span class="line">		<span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//获取数据库连接</span></span><br><span class="line">			conn = DBUtil.getConnection();</span><br><span class="line">			<span class="comment">//定义 sql 语句</span></span><br><span class="line">			String sql = <span class="string">"select * from t_user where name = ?"</span>;</span><br><span class="line">			<span class="comment">//获取 预处理发射器</span></span><br><span class="line">			pstmt = conn.prepareStatement(sql);</span><br><span class="line">			<span class="comment">//占位符</span></span><br><span class="line">			pstmt.setString(<span class="number">1</span>, uname);</span><br><span class="line">			<span class="comment">//执行 sql 语句，得到结果集</span></span><br><span class="line">			rs = pstmt.executeQuery();</span><br><span class="line">			<span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">				flag = <span class="keyword">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//判断</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="comment">//关闭资源</span></span><br><span class="line">			DBUtil.closeAll(rs, pstmt, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//返回结果</span></span><br><span class="line">		<span class="keyword">return</span> flag;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-3-效果图"><a href="#9-3-效果图" class="headerlink" title="9.3 效果图"></a>9.3 效果图</h2><p><img src="http://www.zwer.xyz/picGo/%E6%B5%8B%E8%AF%95ajax112.gif" alt></p>
<h1 id="10-Ajax-封装"><a href="#10-Ajax-封装" class="headerlink" title="10  Ajax 封装"></a>10  Ajax 封装</h1><blockquote>
<p>解决：编写代码时出现了重复编写，影响了开发的效率</p>
<p>实现：相同的保留，不同的传参</p>
<p>请求方式：method</p>
<p>请求地址：url</p>
<p>请求参数：data 请求参数的格式为键值对，不同的键值对使用&amp;隔开</p>
<p>​         实例：”a=1&amp;b=2”</p>
<p>异步同步设置：ansyc</p>
<p>响应处理函数：deal200 该参数接受一个 JS 的 函数对象，函数对象中声明 ajax 响应数据的处理逻辑代码。</p>
<p>​            注意：函数对象需要声明一个形参用来接受要处理的响应数据</p>
<p>JS 函数可以不传值，默认值</p>
</blockquote>
<ul>
<li>ajax.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装 Ajax 工具类</span></span><br><span class="line"><span class="comment"> * @param method  	请求方式 Get、Post</span></span><br><span class="line"><span class="comment"> * @param url    	请求地址</span></span><br><span class="line"><span class="comment"> * @param data	  	请求路径</span></span><br><span class="line"><span class="comment"> * @param deal200	处理请求的函数</span></span><br><span class="line"><span class="comment"> * @param ansyc		异步同步</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myAjax</span>(<span class="params">method, url, data, deal200, ansyc</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//创建 ajax 引擎对象</span></span><br><span class="line">	<span class="keyword">var</span> ajax = <span class="literal">null</span>;</span><br><span class="line">	<span class="comment">//判断浏览器类型</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span><br><span class="line">		ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">window</span>.addObject)&#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">		ajax = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//声明事件监听</span></span><br><span class="line">	ajax.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="comment">//判断 ajax状态码   等于4表示响应结果接受完毕</span></span><br><span class="line">		<span class="keyword">if</span> (ajax.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">			<span class="comment">//判断 ajax 响应码</span></span><br><span class="line">			<span class="keyword">if</span> (ajax.status == <span class="number">200</span>) &#123;</span><br><span class="line">				<span class="comment">//获取响应数据</span></span><br><span class="line">				<span class="keyword">var</span> data = ajax.responseText;</span><br><span class="line">				<span class="keyword">if</span> (deal200) &#123;</span><br><span class="line">					deal200(data);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断请求方式</span></span><br><span class="line">	<span class="keyword">if</span> (method == <span class="string">"get"</span>) &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建并发送 ajax 请求</span></span><br><span class="line">		ajax.open(method, url + (data == <span class="literal">null</span> ? <span class="string">""</span> : <span class="string">"?"</span>+data), ansyc);</span><br><span class="line">		ajax.send(<span class="literal">null</span>);</span><br><span class="line">		</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (method == <span class="string">"post"</span>) &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建 ajax 请求</span></span><br><span class="line">		ajax.open(method, url, ansyc);</span><br><span class="line">		<span class="comment">//设置请求头,以键值对的方式发送表单数据</span></span><br><span class="line">		ajax.setRequestHeader(<span class="string">"Content-Type"</span>,</span><br><span class="line">				<span class="string">"application/x-www-form-urlencoded"</span>);</span><br><span class="line">		<span class="comment">//发送 ajax 请求	</span></span><br><span class="line">		ajax.send((data == <span class="literal">null</span> ? <span class="string">""</span> : data));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试 ajax.js 工具类</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>封装 Ajax <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  引入 ajax 工具类 --&gt;</span>  </span><br><span class="line">  	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>  <span class="attr">src</span>=<span class="string">"js/ajaxUtil.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  	</span><br><span class="line">  	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">  		<span class="comment">// 调用 工具类</span></span></span><br><span class="line"><span class="javascript">		myAjax(<span class="string">"get"</span>,<span class="string">"/ajax/my"</span>,<span class="literal">null</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			alert(<span class="string">"Test"</span>);</span></span><br><span class="line">			alert(data);</span><br><span class="line"><span class="javascript">		&#125;,<span class="literal">true</span>);</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"测试 ajax"</span>  <span class="attr">onclick</span>=<span class="string">"myAjax()"</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="11-Jquery-封装-AJax"><a href="#11-Jquery-封装-AJax" class="headerlink" title="11  Jquery 封装  AJax"></a>11  Jquery 封装  AJax</h1><blockquote>
<p>Jquery 是 Js 的一个轻量性框架，已经将 JS 创建的操作进行了封装，而 Ajax 也是</p>
<p>一部分，所以 JQuery 也已经将 ajax 进行了封装。</p>
</blockquote>
<h2 id="11-1-封装"><a href="#11-1-封装" class="headerlink" title="11.1  封装"></a>11.1  封装</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="keyword">get</span>(url,data,function)   //<span class="keyword">get</span>  请求方式   适用于简单的业务逻辑规则</span><br><span class="line">$.post(url,data,function)  //post 请求方式   适用于简单的业务逻辑规则</span><br><span class="line">$.ajax(&#123;json格式&#125;)  <span class="comment">// 适用于复杂的业务逻辑规则</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// url 请求地址</span></span><br><span class="line"><span class="comment">// data 请求参数</span></span><br></pre></td></tr></table></figure>

<h2 id="11-2-栗子"><a href="#11-2-栗子" class="headerlink" title="11.2 栗子"></a>11.2 栗子</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="comment">// ajax 方式发送请求</span></span></span><br><span class="line"><span class="javascript">    $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">    type: <span class="string">"get"</span>,</span></span><br><span class="line"><span class="javascript">    url: <span class="string">"data"</span>,</span></span><br><span class="line"><span class="javascript">    data: <span class="string">"uname="</span>+$(<span class="string">"#uname"</span>).val(),</span></span><br><span class="line"><span class="javascript">    success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;alert(data)&#125;</span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入 Jquery  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#uname"</span>).blur(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $.<span class="keyword">get</span>("data",&#123;uname:($(<span class="string">"#uname"</span>).val())&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// 处理响应内容</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> span = $(<span class="string">"#unameSpan"</span>);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(<span class="built_in">eval</span>(data))&#123;</span></span><br><span class="line"><span class="javascript">                    span.html(<span class="string">"用户名 OK"</span>);</span></span><br><span class="line"><span class="javascript">                    span.css(<span class="string">"color"</span>,<span class="string">"green"</span>);</span></span><br><span class="line"><span class="javascript">                &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">                    span.html(<span class="string">"用户名已被注册"</span>);</span></span><br><span class="line"><span class="javascript">                    span.css(<span class="string">"color"</span>,<span class="string">"red"</span>);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="12-Ajax-案例之省市区三级联动"><a href="#12-Ajax-案例之省市区三级联动" class="headerlink" title="12 Ajax 案例之省市区三级联动"></a>12 Ajax 案例之省市区三级联动</h1><blockquote>
<p>三级联动定义：页面中有三个下拉框选项，分别为</p>
<p>省、市、县下拉框，选择对应的框，显示对应的省、市、县信息。</p>
<p>技术分析：ajax技术+jsp+servlet+jdbc</p>
<p>需求分析（思路）：</p>
<p>​    1、 创建页面：页面中有三个下拉框，分别为省、市、县区</p>
<p>​    2、页面加载成功发起 ajax 请求，请求省的信息，并将响应的经过填充到省下拉框中</p>
<p>​    3、选择省信息，请求对应的市信息，并将响应结果填充到下拉框中</p>
<p>​    4、选择市信息，请求对应的区/县信息，并将响应结果填充到下拉框中</p>
<p>数据库设计：</p>
<p>​    创建表（area） ： 存储了省、市、区/县信息</p>
<p>​    设计表实现一：只存储了数据，但是数据的层次关系没有体现</p>
<p>​        地区id：areaid</p>
<p>​        地区名：areaname</p>
<p>​    设计表实现二：</p>
<p>​        地区id：areaid</p>
<p>​        地区名：areaname</p>
<p>​        地区上级id：parentid </p>
<p>​    sql语句设计：</p>
<p>​        查询所有的省信息 ：select * from area where parentid=0; </p>
<p>​        查询选择的省下的市信息（假如：选择的省的areaid 为110000）</p>
<p>​                        select * from area  where areaid  = 110000；</p>
<p>​        查询选择市下的县/区信息（假如：选择的市的areaid 为120000）：</p>
<p>​                        select * from area where areaid =  120000；</p>
<p>​        代码： select  * from area  where areaid = ？；</p>
<p>​    数据库实现：导入 area.sql 语句执行</p>
<p>代码缺陷：</p>
<p>​    代码的重复冗余大</p>
<p>解决：相同的保留，不同的传参</p>
</blockquote>
<p>​        </p>
<h2 id="12-1-代码实现"><a href="#12-1-代码实现" class="headerlink" title="12.1 代码实现"></a>12.1 代码实现</h2><blockquote>
<p>只展现前端代码，后面只做一个事情。</p>
<p>bug，选择每个下拉框的第一个地区，体验不好。</p>
</blockquote>
<h3 id="12-1-1-未加联动"><a href="#12-1-1-未加联动" class="headerlink" title="12.1.1 未加联动"></a>12.1.1 未加联动</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>地区<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入 Jquery  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">  			$.<span class="keyword">get</span>("area",&#123;<span class="string">"parentid"</span>:<span class="number">0</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    		<span class="comment">/* 	 alert(data); */</span></span></span><br><span class="line"><span class="javascript">    			<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">    			<span class="built_in">eval</span>(<span class="string">"var areas ="</span>+data);</span></span><br><span class="line"><span class="javascript">    			<span class="comment">//获取省下拉框</span></span></span><br><span class="line"><span class="javascript">    			<span class="keyword">var</span> prov = $(<span class="string">"#province"</span>);</span></span><br><span class="line"><span class="javascript">    			<span class="comment">//清空省下拉框</span></span></span><br><span class="line">    			prov.empty();</span><br><span class="line"><span class="javascript">    			<span class="comment">//将所有省的信息填充到省下拉框中</span></span></span><br><span class="line"><span class="javascript">    			<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i &lt; areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">    				<span class="built_in">console</span>.log(i+<span class="string">"\t"</span>+areas[i].areaname);</span></span><br><span class="line"><span class="javascript">    				prov.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>);</span></span><br><span class="line">    			&#125;</span><br><span class="line"><span class="javascript">    			<span class="comment">//选择对应省下的市信息</span></span></span><br><span class="line"><span class="javascript">    			$(<span class="string">"#province"</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    				<span class="comment">//获取省的地区号</span></span></span><br><span class="line"><span class="javascript">    				<span class="keyword">var</span> areaid = $(<span class="string">"#province"</span>).val();</span></span><br><span class="line"><span class="javascript">    				<span class="comment">/* alert(areaid); */</span></span></span><br><span class="line"><span class="javascript">    				$.<span class="keyword">get</span>("area",&#123;<span class="string">"parentid"</span>:areaid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    					<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">    					<span class="built_in">eval</span>(<span class="string">"var areas="</span>+data);</span></span><br><span class="line"><span class="javascript">    					<span class="comment">//获取区对象</span></span></span><br><span class="line"><span class="javascript">    					<span class="keyword">var</span> city = $(<span class="string">"#city"</span>);</span></span><br><span class="line"><span class="javascript">    					<span class="comment">//清空市下拉框</span></span></span><br><span class="line">    					city.empty();</span><br><span class="line"><span class="javascript">    					<span class="comment">//将所有市的信息填充到市下拉框</span></span></span><br><span class="line"><span class="javascript">    					<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">    						city.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>)</span></span><br><span class="line">    					&#125;</span><br><span class="line">    				&#125;);</span><br><span class="line">    			&#125;);</span><br><span class="line"><span class="javascript">    			<span class="comment">//获取区/县信息</span></span></span><br><span class="line"><span class="javascript">    			$(<span class="string">"#city"</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    				<span class="comment">//获取市的地区号</span></span></span><br><span class="line"><span class="javascript">    				<span class="keyword">var</span> areaid = $(<span class="string">"#city"</span>).val();</span></span><br><span class="line"><span class="javascript">    				<span class="comment">//ajax 请求</span></span></span><br><span class="line"><span class="javascript">    				$.<span class="keyword">get</span>("area",&#123;parentid:areaid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    					<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">    					<span class="built_in">eval</span>(<span class="string">"var areas="</span>+data);</span></span><br><span class="line"><span class="javascript">    					<span class="comment">//获取区/县</span></span></span><br><span class="line"><span class="javascript">    					<span class="keyword">var</span> area = $(<span class="string">"#area"</span>);</span></span><br><span class="line"><span class="javascript">    					<span class="comment">//清空下拉框</span></span></span><br><span class="line">    					area.empty();</span><br><span class="line"><span class="javascript">    					<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">    						area.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>)</span></span><br><span class="line">    					&#125;</span><br><span class="line">    				&#125;);</span><br><span class="line">    				</span><br><span class="line">    			&#125;);</span><br><span class="line"><span class="javascript">    			<span class="comment">//选择对应市下的区/县信息</span></span></span><br><span class="line">    			</span><br><span class="line">    		&#125;);</span><br><span class="line">  		&#125;);</span><br><span class="line">    	</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"background-color:gray;"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin:auto;width:1000px;margin-top:200px;"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">"text-align: center;font-weight:500;font-family:楷体;"</span>&gt;</span>地区选择三级联动<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line">  			 省/直辖市：<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"province"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span>dsf<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  			 市:<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"city"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  			县/区：<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"area"</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span>	</span><br><span class="line">  		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    	</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="12-1-2-添加联动"><a href="#12-1-2-添加联动" class="headerlink" title="12.1.2 添加联动"></a>12.1.2 添加联动</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>地区<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入 Jquery  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">  			<span class="comment">//获取省信息</span></span></span><br><span class="line"><span class="javascript">  			$.<span class="keyword">get</span>("area",&#123;<span class="string">"parentid"</span>:<span class="number">0</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    		<span class="comment">/* 	 alert(data); */</span></span></span><br><span class="line"><span class="javascript">    			<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">    			<span class="built_in">eval</span>(<span class="string">"var areas ="</span>+data);</span></span><br><span class="line"><span class="javascript">    			<span class="comment">//获取省下拉框</span></span></span><br><span class="line"><span class="javascript">    			<span class="keyword">var</span> prov = $(<span class="string">"#province"</span>);</span></span><br><span class="line"><span class="javascript">    			<span class="comment">//清空省下拉框</span></span></span><br><span class="line">    			prov.empty();</span><br><span class="line"><span class="javascript">    			<span class="comment">//将所有省的信息填充到省下拉框中</span></span></span><br><span class="line"><span class="javascript">    			<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i &lt; areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">    				<span class="comment">/* console.log(i+"\t"+areas[i].areaname); */</span></span></span><br><span class="line"><span class="javascript">    				prov.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>);</span></span><br><span class="line">    			&#125;</span><br><span class="line"><span class="javascript">    			<span class="comment">//填充省下拉框时触发市的信息,联动的关键</span></span></span><br><span class="line"><span class="javascript">    			 $(<span class="string">"#province"</span>).trigger(<span class="string">"change"</span>);</span></span><br><span class="line">    		&#125;);</span><br><span class="line"><span class="javascript">  			<span class="comment">//选择对应省下的市信息</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#province"</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="comment">//获取省的地区号</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> areaid = $(<span class="string">"#province"</span>).val();</span></span><br><span class="line"><span class="javascript">				<span class="comment">/* alert(areaid); */</span></span></span><br><span class="line"><span class="javascript">				$.<span class="keyword">get</span>("area",&#123;<span class="string">"parentid"</span>:areaid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">					<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">					<span class="built_in">eval</span>(<span class="string">"var areas="</span>+data);</span></span><br><span class="line"><span class="javascript">					<span class="comment">//获取区对象</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">var</span> city = $(<span class="string">"#city"</span>);</span></span><br><span class="line"><span class="javascript">					<span class="comment">//清空市下拉框</span></span></span><br><span class="line">					city.empty();</span><br><span class="line"><span class="javascript">					<span class="comment">//将所有市的信息填充到市下拉框</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">						city.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>);</span></span><br><span class="line">					&#125;</span><br><span class="line"><span class="javascript">					<span class="comment">////填充市下拉框时触发区/县的信息，联动的关键</span></span></span><br><span class="line"><span class="javascript">					$(<span class="string">"#city"</span>).trigger(<span class="string">"change"</span>);</span></span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br><span class="line">  			</span><br><span class="line"><span class="javascript">			<span class="comment">//获取区/县信息</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#city"</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="comment">//获取市的地区号</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> areaid = $(<span class="string">"#city"</span>).val();</span></span><br><span class="line"><span class="javascript">				<span class="comment">//ajax 请求</span></span></span><br><span class="line"><span class="javascript">				$.<span class="keyword">get</span>("area",&#123;parentid:areaid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">					<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">					<span class="built_in">eval</span>(<span class="string">"var areas="</span>+data);</span></span><br><span class="line"><span class="javascript">					<span class="comment">//获取区/县</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">var</span> area = $(<span class="string">"#area"</span>);</span></span><br><span class="line"><span class="javascript">					<span class="comment">//清空下拉框</span></span></span><br><span class="line">					area.empty();</span><br><span class="line"><span class="javascript">					<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">						area.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>);</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;);</span><br><span class="line">				</span><br><span class="line">			&#125;);</span><br><span class="line"><span class="javascript">			<span class="comment">//选择对应市下的区/县信息</span></span></span><br><span class="line">			</span><br><span class="line">  			</span><br><span class="line">  			</span><br><span class="line">  		&#125;);</span><br><span class="line">    	</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"background-color:gray;"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin:auto;width:720px;margin-top:200px;"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">"text-align: center;font-weight:500;font-family:楷体;margin-bottom: 50px;"</span>&gt;</span>地区选择三级联动<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line">  			 省/直辖市：<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"province"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  			 市:<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"city"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  			县/区：<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"area"</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span>	</span><br><span class="line">  		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    	</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="12-1-3-封装"><a href="#12-1-3-封装" class="headerlink" title="12.1.3 封装"></a>12.1.3 封装</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>地区<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入 Jquery  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">  			<span class="comment">//获取省信息</span></span></span><br><span class="line"><span class="javascript">  			getArea(<span class="string">"province"</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">  			<span class="comment">//选择对应省下的市信息</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#province"</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="comment">//获取省的地区号</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> areaid = $(<span class="string">"#province"</span>).val();</span></span><br><span class="line"><span class="javascript">				getArea(<span class="string">"city"</span>,areaid);</span></span><br><span class="line">			&#125;);</span><br><span class="line">  			</span><br><span class="line"><span class="javascript">			<span class="comment">//获取区/县信息</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#city"</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="comment">//获取市的地区号</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> areaid = $(<span class="string">"#city"</span>).val();</span></span><br><span class="line"><span class="javascript">				getArea(<span class="string">"area"</span>,areaid);</span></span><br><span class="line">			&#125;);</span><br><span class="line"><span class="javascript">			<span class="comment">//封装</span></span></span><br><span class="line"><span class="javascript">			<span class="function"><span class="keyword">function</span> <span class="title">getArea</span>(<span class="params">areaname,sid</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">   				<span class="comment">//获取地区信息</span></span></span><br><span class="line"><span class="javascript">    			 $.<span class="keyword">get</span>("area",&#123;<span class="string">"parentid"</span>:sid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    				<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">    	    			<span class="built_in">eval</span>(<span class="string">"var areas ="</span>+data);</span></span><br><span class="line"><span class="javascript">    	    			<span class="comment">//获取省下拉框</span></span></span><br><span class="line"><span class="javascript">    	    			<span class="keyword">var</span> prov = $(<span class="string">"#"</span>+areaname);</span></span><br><span class="line"><span class="javascript">    	    			<span class="comment">//清空省下拉框</span></span></span><br><span class="line">    	    			prov.empty();</span><br><span class="line"><span class="javascript">    	    			<span class="comment">//将所有省的信息填充到省下拉框中</span></span></span><br><span class="line"><span class="javascript">    	    			<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i &lt; areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">    	    				prov.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>);</span></span><br><span class="line">    	    			&#125;</span><br><span class="line"><span class="javascript">    	    			<span class="comment">//填充省下拉框时触发市的信息</span></span></span><br><span class="line"><span class="javascript">    	    			$(<span class="string">"#"</span>+areaname).trigger(<span class="string">"change"</span>);		</span></span><br><span class="line">    		    &#125;);</span><br><span class="line">			&#125;</span><br><span class="line">  		&#125;);</span><br><span class="line">    	</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"background-color:gray;"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin:auto;width:720px;margin-top:200px;"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">"text-align: center;font-weight:500;font-family:楷体;margin-bottom: 50px;"</span>&gt;</span>地区选择三级联动<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line">  			 省/直辖市：<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"province"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  			 市:<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"city"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  			县/区：<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"area"</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span>	</span><br><span class="line">  		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    	</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="12-2-效果图"><a href="#12-2-效果图" class="headerlink" title="12.2 效果图"></a>12.2 效果图</h2><ul>
<li>未加联动</li>
</ul>
<p><img src="http://www.zwer.xyz/picGo/ajax%E5%9C%B0%E5%8C%BA%E4%B8%89%E7%BA%A7%E8%81%94%E5%8A%A8.gif" alt></p>
<ul>
<li>加联动</li>
</ul>
<p>![](<a href="http://www.zwer.xyz/picGo/ajax_area" target="_blank" rel="noopener">http://www.zwer.xyz/picGo/ajax_area</a> - 副本.gif)</p>
<h2 id="12-3-总结"><a href="#12-3-总结" class="headerlink" title="12.3 总结"></a>12.3 总结</h2><ol>
<li><p>良好的数据库设计，可让后期操作更加便捷。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  * <span class="keyword">from</span> area  <span class="keyword">where</span> areaid = ？；</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现联动的代码<strong>举例</strong>：</p>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="comment">//填充省下拉框时触发市的信息,联动的关键</span></span></span><br><span class="line"><span class="javascript">	$(<span class="string">"#province"</span>).trigger(<span class="string">"change"</span>);	</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="13-ajax-案例之搜索框提示语"><a href="#13-ajax-案例之搜索框提示语" class="headerlink" title="13 ajax 案例之搜索框提示语"></a>13 ajax 案例之搜索框提示语</h1><blockquote>
<p>功能需求：</p>
<p>​    用户再搜索框中输入关键字，然后搜索框习出现下拉选项，提示关键字的提示语</p>
<p>​    用户可以使用鼠标进行提示语的选择，也可以使用键盘的上下键选择</p>
<p>技术分析：</p>
<p>​    ajax技术+servlet+jsp+jdbc</p>
<p>功能分析（思路）：</p>
<p>​    1、创建搜索界面（搜索框和提示语div 和搜索按钮）</p>
<p>​    2、 给搜索框添加 onkeyup 时间， 键盘弹起时发送 ajax 请求</p>
<p>​        请求当前用户输入的信息对应的提示语数据</p>
<p>​    3、将提示语数据填充到搜索框下的div 中</p>
<p>​    4、实现使用鼠标选择提示语</p>
<p>​    5、实现使用键盘的上和下键选择提示语</p>
<p>​    6、实现鼠标和键盘的联动操作</p>
<p>​    7、将显示提示语的 div 进行隐藏，当有提示语的时候进行显示</p>
<p>完善：</p>
<p>​    问题：只要用户在搜索框中出现键盘点击动作，都会触发键盘事件的执行</p>
<p>​    而只要数据符合要求，都会发送 ajax 请求，请求提示语信息。点击一次都发一次。</p>
<p>​    但是其实只需求最后一次进行请求发生即可。</p>
<p>​    解决1：</p>
<p>​        使用延迟发送请求</p>
<p>​    使用1：</p>
<p>​        window.setTimeout()</p>
<p>​    问题2：</p>
<p>​        even 对象在火狐浏览器中使用window.event 获取不到</p>
<p>​    解决：</p>
<p>​        函数声明形参 event，必须是event </p>
<p>​     var reg =  /^\s+$/g/ 空格校验</p>
</blockquote>
<blockquote>
<p>数据库设计：</p>
<p>​    创建表：（data）存储了常用的关键字数据</p>
<p>​        关键字编号：id</p>
<p>​        关键字数据：title     </p>
<p>​        次数：count</p>
<p>​        说明：remark</p>
<p>​    添加测试数据：要求前期测试数据为英文单词</p>
<p>​    SQL 语句设计：查询以用户当前搜索框数据开头的关键字    </p>
<p>​            select * from data where title  like ‘a%’;</p>
<p>​    </p>
</blockquote>
<h2 id="13-1-添加鼠标悬停事件"><a href="#13-1-添加鼠标悬停事件" class="headerlink" title="13.1 添加鼠标悬停事件"></a>13.1 添加鼠标悬停事件</h2><blockquote>
<p>小技巧：将 css 赋于空字符串，即可清空属性值</p>
<p>注意：事件一定是添加已经存在的 html 代码上的，即注意事件添加的位置</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="comment">// 等服务器把提示语发送给客户端，再添加鼠标放上事件</span></span></span><br><span class="line"><span class="javascript">    $(<span class="string">"#prompt-box div"</span>).mouseover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//清空提示框中提示语的背景颜色</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#prompt-box div"</span>).css(<span class="string">"background-color"</span>,<span class="string">""</span>); </span></span><br><span class="line"><span class="javascript">        <span class="comment">//选择当前鼠标选择的 div ,并修改其 div 上的背景颜色</span></span></span><br><span class="line"><span class="javascript">        $(<span class="keyword">this</span>).css(<span class="string">"background-color"</span>,<span class="string">"gray"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//获取当前选择提示语的位置</span></span></span><br><span class="line"><span class="javascript">        count = $(<span class="keyword">this</span>).index();</span></span><br><span class="line"><span class="javascript">        <span class="comment">//通过鼠标单击提示语，将提示语放在搜索框中</span></span></span><br><span class="line"><span class="javascript">        $(<span class="keyword">this</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#input-search"</span>).val($(<span class="keyword">this</span>).html());</span></span><br><span class="line"><span class="javascript">            <span class="comment">//隐藏 提示语 div</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#prompt-box"</span>).css(<span class="string">"display"</span>,<span class="string">"none"</span>);</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;); </span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="13-2-键盘上下键选择"><a href="#13-2-键盘上下键选择" class="headerlink" title="13.2 键盘上下键选择"></a>13.2 键盘上下键选择</h2><blockquote>
<p>选择当前 div 的位置，通过全局变量 count 控制。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//添加键盘下键，选择提示语</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span>(code == <span class="number">40</span> ||code == <span class="number">38</span>)&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> divLength = ($(<span class="string">"#prompt-box div"</span>).length<span class="number">-1</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//注意要使用 ++count，而不是 count++</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(code == <span class="number">40</span>)&#123;</span></span><br><span class="line">            count = count &lt; divLength?++count:0;						</span><br><span class="line"><span class="javascript">        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line">            count = count &gt;= 0?--count:divLength;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="comment">//清空提示语背景颜色</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#prompt-box div"</span>).css(<span class="string">"background-color"</span>,<span class="string">""</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//选择提示语，修改背景颜色</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#prompt-box div:eq("</span>+count+<span class="string">")"</span>).css(<span class="string">"background-color"</span>,<span class="string">"gray"</span>);	</span></span><br><span class="line"><span class="javascript">        <span class="comment">//将提示语放入搜索框中</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#input-search"</span>).val($(<span class="string">"#prompt-box div:eq("</span>+count+<span class="string">")"</span>).html());</span></span><br><span class="line">    &#125;	</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="13-3-获取键盘输入的-javascript-码值"><a href="#13-3-获取键盘输入的-javascript-码值" class="headerlink" title="13.3 获取键盘输入的 javascript 码值"></a>13.3 获取键盘输入的 javascript 码值</h2><blockquote>
<p>利用 BOM 对象中 window.event.keyCode </p>
<p>注意：keyCode 中 k  小写</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> event = <span class="built_in">window</span>.event || event;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 获取 javascript 对应的键盘的值</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> code  = event.keyCode; <span class="comment">//k 小写</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// code = 8  表示删除键</span></span></span><br><span class="line"><span class="xml">    if((code &gt;=65 &amp;&amp; code <span class="tag">&lt;<span class="name">=90)</span> || <span class="attr">code</span> == <span class="string">8</span> || <span class="attr">code</span> == <span class="string">32</span> || (<span class="attr">code</span> &gt;</span>=49 &amp;&amp; code <span class="tag">&lt;<span class="name">=57))&#123;</span></span></span></span><br><span class="line"><span class="javascript">    	<span class="comment">//省略代码</span></span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="13-4-延迟函数"><a href="#13-4-延迟函数" class="headerlink" title="13.4 延迟函数"></a>13.4 延迟函数</h2><blockquote>
<p>var id = window.setTimeout(function(){},delay) ,注意 id 相当于线程号</p>
<p>window.clearTimeout(id) ，清空当前延时线程，防止每次键盘弹出都发送一个 ajax 请求，浪费资源</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="comment">// 清空延时 线程，防止每次键盘弹出都发送一个 ajax 请求，浪费资源</span></span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.clearTimeout(id);</span></span><br><span class="line"><span class="javascript"><span class="comment">// 设置延时,延迟发送 ajax</span></span></span><br><span class="line"><span class="javascript">id = <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">$.<span class="keyword">get</span>("search",&#123;title:search_title&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">sdata</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"><span class="comment">/* alert(sdata);  */</span></span></span><br><span class="line"><span class="javascript"><span class="built_in">eval</span>(<span class="string">"var data="</span>+sdata);</span></span><br><span class="line"><span class="javascript"><span class="keyword">if</span>(data.length &gt; <span class="number">0</span>)&#123;<span class="comment">//有提示语才显示提示框</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 显示提示框</span></span></span><br><span class="line"><span class="javascript">$(<span class="string">"#prompt-box"</span>).css(<span class="string">"display"</span>,<span class="string">""</span>);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="comment">//清空提示框中的内容</span></span></span><br><span class="line"><span class="javascript">$(<span class="string">"#prompt-box"</span>).empty();</span></span><br><span class="line"><span class="javascript"><span class="comment">//注意单词使用 区分 sdata ，data</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;data.length<span class="number">-1</span>;i++)&#123;</span></span><br><span class="line"><span class="javascript">   $(<span class="string">"#prompt-box"</span>).append(<span class="string">"&lt;div style='margin-bottom:3px;'&gt;"</span>+data[i].title+<span class="string">"&lt;/div&gt;"</span>);	    &#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">// 等服务器把提示语发送给客户端，再添加鼠标放上事件</span></span></span><br><span class="line"><span class="javascript">$(<span class="string">"#prompt-box div"</span>).mouseover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">	<span class="comment">//清空提示框中提示语的背景颜色</span></span></span><br><span class="line"><span class="javascript">	 $(<span class="string">"#prompt-box div"</span>).css(<span class="string">"background-color"</span>,<span class="string">""</span>); </span></span><br><span class="line"><span class="javascript">   		 <span class="comment">//选择当前鼠标选择的 div ,并修改其 div 上的背景颜色</span></span></span><br><span class="line"><span class="javascript">   		 $(<span class="keyword">this</span>).css(<span class="string">"background-color"</span>,<span class="string">"gray"</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    	 <span class="comment">//获取当前选择提示语的位置</span></span></span><br><span class="line"><span class="javascript">     	 count = $(<span class="keyword">this</span>).index();</span></span><br><span class="line"><span class="javascript">    	 <span class="comment">//通过鼠标单击提示语，将提示语放在搜索框中</span></span></span><br><span class="line"><span class="javascript">      	 $(<span class="keyword">this</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">         $(<span class="string">"#input-search"</span>).val($(<span class="keyword">this</span>).html());</span></span><br><span class="line"><span class="javascript">         <span class="comment">//隐藏 提示语 div</span></span></span><br><span class="line"><span class="javascript">         $(<span class="string">"#prompt-box"</span>).css(<span class="string">"display"</span>,<span class="string">"none"</span>);</span></span><br><span class="line"> 	&#125;);</span><br><span class="line">  			&#125;); </span><br><span class="line"> 	&#125;);		</span><br><span class="line">  &#125;, 500);				</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="13-5-代码"><a href="#13-5-代码" class="headerlink" title="13. 5 代码"></a>13. 5 代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>搜索框提示语<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入 Jquery 库 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">// 计数器</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> count = <span class="number">-1</span>;</span></span><br><span class="line"><span class="javascript">			<span class="comment">// 获取当前 延时线程的 id </span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> id = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">			<span class="comment">/* 键盘弹起 */</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#input-search"</span>).keyup(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;<span class="comment">//形参 event，兼容低版本的火狐浏览器</span></span></span><br><span class="line"><span class="javascript">				<span class="comment">//只发送符合条件的关键字数据</span></span></span><br><span class="line"><span class="javascript">				<span class="comment">//获取 event 对象</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> event = <span class="built_in">window</span>.event || event;</span></span><br><span class="line"><span class="javascript">				<span class="comment">// 获取 javascript 对应的键盘的值</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> code  = event.keyCode; <span class="comment">//k 小写</span></span></span><br><span class="line"><span class="javascript">				<span class="comment">// code = 8  表示删除键</span></span></span><br><span class="line"><span class="xml">				if((code &gt;=65 &amp;&amp; code <span class="tag">&lt;<span class="name">=90)</span> || <span class="attr">code</span> == <span class="string">8</span> || <span class="attr">code</span> == <span class="string">32</span> || (<span class="attr">code</span> &gt;</span>=49 &amp;&amp; code <span class="tag">&lt;<span class="name">=57))&#123;</span></span></span></span><br><span class="line"><span class="javascript">					<span class="comment">// 发送 ajax 请求,返回响应是搜索提示语语句</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">var</span> search_title = $(<span class="string">"#input-search"</span>).val(); </span></span><br><span class="line"><span class="javascript">					<span class="comment">/* alert(search_title); */</span></span></span><br><span class="line"><span class="javascript">					<span class="comment">//判断搜索框中的值是否空，若为空，则直接返回</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">if</span>(search_title == <span class="string">""</span>)&#123;</span></span><br><span class="line"><span class="javascript">						<span class="comment">//清空提示框中提示语</span></span></span><br><span class="line"><span class="javascript">						$(<span class="string">"#prompt-box"</span>).empty();</span></span><br><span class="line"><span class="javascript">						<span class="keyword">return</span>; <span class="comment">//即不执行下面的代码，不发送 ajax 请求</span></span></span><br><span class="line">					&#125;</span><br><span class="line"><span class="javascript">					<span class="comment">// 清空延时 线程，防止每次键盘弹出都发送一个 ajax 请求，浪费资源</span></span></span><br><span class="line"><span class="javascript">					<span class="built_in">window</span>.clearTimeout(id);</span></span><br><span class="line"><span class="javascript">					<span class="comment">// 设置延时,延迟发送 ajax</span></span></span><br><span class="line"><span class="javascript">					id = <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">						$.<span class="keyword">get</span>("search",&#123;title:search_title&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">sdata</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">							 <span class="comment">/* alert(sdata);  */</span></span></span><br><span class="line"><span class="javascript">							<span class="built_in">eval</span>(<span class="string">"var data="</span>+sdata);</span></span><br><span class="line"><span class="javascript">							<span class="keyword">if</span>(data.length &gt; <span class="number">0</span>)&#123;<span class="comment">//有提示语才显示提示框</span></span></span><br><span class="line"><span class="javascript">								<span class="comment">// 显示提示框</span></span></span><br><span class="line"><span class="javascript">							 	$(<span class="string">"#prompt-box"</span>).css(<span class="string">"display"</span>,<span class="string">""</span>);</span></span><br><span class="line">							&#125;</span><br><span class="line"><span class="javascript">							<span class="comment">//清空提示框中的内容</span></span></span><br><span class="line"><span class="javascript">							$(<span class="string">"#prompt-box"</span>).empty();</span></span><br><span class="line"><span class="javascript">							<span class="comment">//注意单词使用 区分 sdata ，data</span></span></span><br><span class="line"><span class="javascript">							<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;data.length<span class="number">-1</span>;i++)&#123;</span></span><br><span class="line"><span class="javascript">								$(<span class="string">"#prompt-box"</span>).append(<span class="string">"&lt;div style='margin-bottom:3px;'&gt;"</span>+data[i].title+<span class="string">"&lt;/div&gt;"</span>);					</span></span><br><span class="line">							&#125;</span><br><span class="line"><span class="javascript">							<span class="comment">// 等服务器把提示语发送给客户端，再添加鼠标放上事件</span></span></span><br><span class="line"><span class="javascript">							$(<span class="string">"#prompt-box div"</span>).mouseover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">								<span class="comment">//清空提示框中提示语的背景颜色</span></span></span><br><span class="line"><span class="javascript">							 	$(<span class="string">"#prompt-box div"</span>).css(<span class="string">"background-color"</span>,<span class="string">""</span>); </span></span><br><span class="line"><span class="javascript">								<span class="comment">//选择当前鼠标选择的 div ,并修改其 div 上的背景颜色</span></span></span><br><span class="line"><span class="javascript">								$(<span class="keyword">this</span>).css(<span class="string">"background-color"</span>,<span class="string">"gray"</span>);</span></span><br><span class="line">								</span><br><span class="line"><span class="javascript">								<span class="comment">//获取当前选择提示语的位置</span></span></span><br><span class="line"><span class="javascript">								count = $(<span class="keyword">this</span>).index();</span></span><br><span class="line"><span class="javascript">								<span class="comment">//通过鼠标单击提示语，将提示语放在搜索框中</span></span></span><br><span class="line"><span class="javascript">								$(<span class="keyword">this</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">									$(<span class="string">"#input-search"</span>).val($(<span class="keyword">this</span>).html());</span></span><br><span class="line"><span class="javascript">									<span class="comment">//隐藏 提示语 div</span></span></span><br><span class="line"><span class="javascript">									$(<span class="string">"#prompt-box"</span>).css(<span class="string">"display"</span>,<span class="string">"none"</span>);</span></span><br><span class="line">								&#125;);</span><br><span class="line">							&#125;); </span><br><span class="line">						&#125;);		</span><br><span class="line">					&#125;, 500);</span><br><span class="line">				&#125;</span><br><span class="line">			/* 	//添加键盘下键，选择提示语</span><br><span class="line"><span class="javascript">				$(<span class="string">"#input-search"</span>).focus(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">					alert(<span class="string">"------"</span>) *<span class="regexp">/</span></span></span><br><span class="line"><span class="javascript">				<span class="comment">//添加键盘下键，选择提示语</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">if</span>(code == <span class="number">40</span> ||code == <span class="number">38</span>)&#123;</span></span><br><span class="line"><span class="javascript">					<span class="keyword">var</span> divLength = ($(<span class="string">"#prompt-box div"</span>).length<span class="number">-1</span>);</span></span><br><span class="line"><span class="javascript">					<span class="comment">//注意要使用 ++count，而不是 count++</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">if</span>(code == <span class="number">40</span>)&#123;</span></span><br><span class="line">						count = count &lt; divLength?++count:0;						</span><br><span class="line"><span class="javascript">					&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line">						count = count &gt;= 0?--count:divLength;</span><br><span class="line">					&#125;</span><br><span class="line"><span class="javascript">					<span class="comment">//清空提示语背景颜色</span></span></span><br><span class="line"><span class="javascript">					$(<span class="string">"#prompt-box div"</span>).css(<span class="string">"background-color"</span>,<span class="string">""</span>);</span></span><br><span class="line"><span class="javascript">					<span class="comment">//选择提示语，修改背景颜色</span></span></span><br><span class="line"><span class="javascript">					$(<span class="string">"#prompt-box div:eq("</span>+count+<span class="string">")"</span>).css(<span class="string">"background-color"</span>,<span class="string">"gray"</span>);	</span></span><br><span class="line"><span class="javascript">					<span class="comment">//将提示语放入搜索框中</span></span></span><br><span class="line"><span class="javascript">					$(<span class="string">"#input-search"</span>).val($(<span class="string">"#prompt-box div:eq("</span>+count+<span class="string">")"</span>).html());</span></span><br><span class="line">				&#125;	</span><br><span class="line">			&#125;);</span><br><span class="line">			</span><br><span class="line"><span class="javascript">			<span class="comment">//注意该事件不能放在这里，因为ajax 请求选择是异步</span></span></span><br><span class="line"><span class="javascript">			<span class="comment">// 这时 服务器响应还没有发过来，但是事件已经执行完毕了。</span></span></span><br><span class="line">			/* //通过鼠标选择提示语</span><br><span class="line"><span class="javascript">			$(<span class="string">"#prompt-box div"</span>).mouseover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"123"</span>);</span></span><br><span class="line">			&#125;); */</span><br><span class="line">		&#125;);</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  		<span class="comment">&lt;!-- 容器框 ，作用：将搜索框和提示语框绑定在一定--&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"containter"</span> <span class="attr">style</span>=<span class="string">"width:650px;margin:auto;"</span>&gt;</span></span><br><span class="line">  			<span class="comment">&lt;!-- 标题 --&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">"font-family:微软雅黑;font-size:50px;font-weight:600;color:#2ECC71;text-align:center;margin-top:100px;margin-left:-50px;"</span>&gt;</span>搜索框提示语<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	  		<span class="comment">&lt;!-- 搜索框  --&gt;</span></span><br><span class="line">	  		<span class="comment">&lt;!-- margin:auto; 是相对于离它最近的外层 div 居中 --&gt;</span></span><br><span class="line">	    	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div-search"</span> <span class="attr">style</span>=<span class="string">"width:650px;margin:auto;"</span>&gt;</span></span><br><span class="line">	    		<span class="comment">&lt;!-- 搜索输入框 --&gt;</span></span><br><span class="line">	    		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"input-search"</span> <span class="attr">style</span>=<span class="string">"width:500px;height:40px;border:solid 2px #AED6F1;"</span>&gt;</span></span><br><span class="line">	    		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"搜索"</span> <span class="attr">style</span>=<span class="string">"width:120px;height:43px;border:solid 2px #AED6F1;border-radius:10px;background-color:#5499C7 ;color:white;"</span>&gt;</span></span><br><span class="line">	    	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	    	<span class="comment">&lt;!-- 搜索提示语提示框 --&gt;</span></span><br><span class="line">	    	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"prompt-box"</span> <span class="attr">style</span>=<span class="string">"width:496px;height:300px;border:solid 2px #AED6F1;border-top:none;display: none"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  		</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="13-6-总结"><a href="#13-6-总结" class="headerlink" title="13.6 总结"></a>13.6 总结</h2><ol>
<li>搜索提示语设计涉及的 js 知识较多，其中 BOM 对象使用不太熟悉。</li>
<li>搜索提示语其中的细节比较多。</li>
</ol>
<h1 id="14-ajax-整合项目之删除用户"><a href="#14-ajax-整合项目之删除用户" class="headerlink" title="14 ajax  整合项目之删除用户"></a>14 ajax  整合项目之删除用户</h1><blockquote>
<p>功能分析：在当前页面上删除用户，然后刷新当前浏览器。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params">uid</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">if</span>( confirm(<span class="string">"您确定要删除吗?"</span>))&#123;</span></span><br><span class="line"><span class="javascript">		<span class="comment">//使用 ajax 发送请求</span></span></span><br><span class="line"><span class="javascript">		$.<span class="keyword">get</span>("data",&#123;method:<span class="string">"delUserInfo"</span>,<span class="attr">uid</span>:uid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//响应数据</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span>(<span class="built_in">eval</span>(data))&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"该用户已被删除"</span>);</span></span><br><span class="line"><span class="javascript">				<span class="comment">//刷新当前浏览器，重新发送请求</span></span></span><br><span class="line"><span class="javascript">				<span class="built_in">window</span>.location.href = <span class="string">"data?method=selAllUsers"</span>;</span></span><br><span class="line"><span class="javascript">			&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"该用户删除失败"</span>)</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/03/09/20190309 EL表达式和JSTL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/03/09/20190309 EL表达式和JSTL/" class="post-title-link" itemprop="url">20190309 EL表达式和JSTL标签库</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-03-09 00:00:00" itemprop="dateCreated datePublished" datetime="2019-03-09T00:00:00+08:00">2019-03-09</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-03-12 23:43:59" itemprop="dateModified" datetime="2019-03-12T23:43:59+08:00">2019-03-12</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-EL-表达式"><a href="#1-EL-表达式" class="headerlink" title="1 EL 表达式"></a>1 EL 表达式</h1><h2 id="1-1-JSP-获取作用域数据"><a href="#1-1-JSP-获取作用域数据" class="headerlink" title="1.1 JSP 获取作用域数据"></a>1.1 JSP 获取作用域数据</h2><blockquote>
<p>将流转数据吓死你好到浏览器中：使用传统方式    </p>
<p>缺点：</p>
<pre><code>1. 需要导包
2. 书写复杂
3.  需要强转</code></pre></blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--  使用 jsp --%&gt;</span><br><span class="line">&lt;h1&gt;传统方式获取作用域数据&lt;/h1&gt;</span><br><span class="line">&lt;%=(String)request.getAttribute(<span class="string">"flag"</span>) %&gt; &lt;br /&gt;</span><br><span class="line">&lt;%=((User)request.getAttribute(<span class="string">"user"</span>)).getHobby()%&gt;&lt;br /&gt;</span><br><span class="line">&lt;%=((ArrayList)request.getAttribute(<span class="string">"list"</span>)).get(<span class="number">0</span>)%&gt;&lt;br /&gt;</span><br><span class="line">&lt;%= ((User)((ArrayList)request.getAttribute(<span class="string">"list"</span>)).get(<span class="number">1</span>)).getName() %&gt;&lt;br/&gt;</span><br><span class="line">&lt;%=((HashMap)request.getAttribute(<span class="string">"map"</span>)).get(<span class="string">"name"</span>) %&gt;&lt;br/&gt;</span><br><span class="line">&lt;%=((User)((HashMap)request.getAttribute(<span class="string">"map"</span>)).get(<span class="string">"user"</span>)).getHobby() %&gt;&lt;br/&gt;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-EL-表达式"><a href="#1-2-EL-表达式" class="headerlink" title="1.2  EL 表达式"></a>1.2  EL 表达式</h2><blockquote>
<p>格式 <code>${表达式}</code></p>
<p>注意： 自带响应功能</p>
<p>EL 表达式的使用：</p>
<p>​    EL表达式获取请求数据</p>
<p>​    EL表达式获取作用域数据（重点）</p>
<p>​    EL表达式获取逻辑运算</p>
<p>​    EL表达式 Empty 判断</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$&#123;flag&#125;&lt;br/&gt;</span><br><span class="line">$&#123;user.hobby&#125;&lt;br/&gt;</span><br><span class="line">$&#123;list.get(<span class="number">0</span>)&#125;&amp;nbsp;&amp;nbsp;$&#123;list[<span class="number">0</span>]&#125;&lt;br/&gt;</span><br><span class="line">$&#123;list.get(<span class="number">1</span>).name&#125;&amp;nbsp;&amp;nbsp;$&#123;list[<span class="number">1</span>].name&#125;&lt;br/&gt;</span><br><span class="line">$&#123;map.get(<span class="string">"name"</span>)&#125;&amp;nbsp;&amp;nbsp;$&#123;map.name&#125;&lt;br/&gt;</span><br><span class="line">$&#123;map.get(<span class="string">"user"</span>).hobby&#125;&amp;nbsp;&amp;nbsp;$&#123;map.user.hobby&#125;&lt;br/&gt;</span><br></pre></td></tr></table></figure>

<h2 id="1-3-EL表达式获取请求数据"><a href="#1-3-EL表达式获取请求数据" class="headerlink" title="1.3 EL表达式获取请求数据"></a>1.3 EL表达式获取请求数据</h2><blockquote>
<p>获取用户请求数据(请求实体)    </p>
<p>​    <code>${param.键名}</code> 获取请求数据中一个键一个值的数据</p>
<p>​       <code>${paramValus.键名[i]}</code>获取请求数据中一个键多个值的数据，返回 String 类型数组</p>
<p>获取请求头数据 </p>
<p>​    <code>${header}</code>  返回所有的请求头数据，键值形式</p>
<p>​    <code>${header[&quot;键名&quot;]}</code> 获取指定的请求头数据</p>
<p>​       <code>${headerValues[&quot;键名&quot;]}</code>  获取指定请求数据存储的值</p>
<p>获取 cookie 数据</p>
<pre><code>`${cookie}`  获取所有的 Cookie </code></pre><p>​    <code>${cookie.Coolie对象的键名}</code> 获取存储了指定Cookie 数据的Cookie对象</p>
<p>​    <code>${cookie.Cookie对象的键名.name}</code> 获取存储了指定 Cookie 数据的Cookie对象的存储的键</p>
<p>​      <code>${cookie.Cookie 对象的键名.value}</code> 获取存储了指定 Cookie 数据的Cookie 对象的存储的值</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;h1&gt;获取请求数据&lt;/h1&gt;</span><br><span class="line">&lt;h3&gt;获取请求数据(请求实体)&lt;/h3&gt;</span><br><span class="line">&lt;%=request.getParameter(<span class="string">"uname"</span>) %&gt; -- $&#123;param.uname&#125;&lt;br/&gt;</span><br><span class="line">&lt;%=request.getParameterValues(<span class="string">"fv"</span>)[<span class="number">1</span>]%&gt;--$&#123;paramValues.fv[<span class="number">1</span>]&#125;&lt;br/&gt;</span><br><span class="line">&lt;h3&gt;获取请求头数据&lt;/h3&gt;</span><br><span class="line">&lt;%=request.getHeader(<span class="string">"User-Agent"</span>) %&gt;&lt;br/&gt;</span><br><span class="line">$&#123;header[<span class="string">"User-Agent"</span>]&#125;&lt;br/&gt;</span><br><span class="line">$&#123;header[<span class="string">"Accept"</span>]&#125;&lt;br/&gt;</span><br><span class="line">&lt;%=request.getHeaders(<span class="string">"Accept"</span>).nextElement() %&gt;&lt;br&gt;</span><br><span class="line">$&#123;headerValues[<span class="string">"Accept-Language"</span>][<span class="number">0</span>]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;h3&gt;获取 cookie 数据&lt;/h3&gt;</span><br><span class="line">$&#123;cookie&#125;&lt;br/&gt;</span><br><span class="line">$&#123;cookie.JSESSIONID&#125;&lt;br/&gt;</span><br><span class="line">$&#123;cookie.JSESSIONID.name&#125;--$&#123;cookie.JSESSIONID.value&#125;&lt;br/&gt;</span><br></pre></td></tr></table></figure>

<h2 id="1-4-EL表达式获取作用域数据（重点）"><a href="#1-4-EL表达式获取作用域数据（重点）" class="headerlink" title="1.4  EL表达式获取作用域数据（重点）"></a>1.4  EL表达式获取作用域数据（重点）</h2><blockquote>
<p>作用域对象：<code>pageContext</code>  <code>request</code>  <code>session</code>   <code>application</code></p>
<p>作用域数据：使用 <code>setAttribute</code> 方法存储的数据</p>
<p>获取：</p>
<p>​    普通字符串数据 <code>${键名}</code></p>
<p>​    对象数据 <code>${键名.属性名}</code></p>
<p>​    集合数据</p>
<p>​        list 集合 <code>${键名[角标]}</code></p>
<p>​        Map 集合 <code>${map集合作用域存储的键名.Map集合存储数据的键名}</code></p>
<p>作用域查找的顺序</p>
<p>​    <code>pageContext</code> &gt; <code>request</code> &gt;<code>session</code>  &gt;<code>application</code></p>
<p>注意：如果找到了，则不往下查找，若都没有找到，则什么也不显示</p>
<p>指定作用域查找</p>
<p>​    <code>${pageScope.键名}</code>      指明 <code>pageContext</code>作用域中的数据</p>
<p>​    <code>${requestScope.键名}</code>    指明 <code>requestScopt</code>作用域中的数据</p>
<p>​    <code>${sessionScope.键名}</code>    指明<code>session</code>作用域中的数据</p>
<p>​    <code>${applicationScope.键名}</code>   指明 <code>application</code> 作用域中的数据</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;作用域查找顺序&lt;/h3&gt;</span><br><span class="line">&lt;%pageContext.setAttribute(<span class="string">"hello"</span>, <span class="string">"hello PageContext"</span>);%&gt;</span><br><span class="line">&lt;%request.setAttribute(<span class="string">"hello"</span>,<span class="string">"hello reqeust"</span>); %&gt;</span><br><span class="line">&lt;%session.setAttribute(<span class="string">"hello"</span>,<span class="string">"hello session"</span>);%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	<span class="comment">/* session.invalidate();//销毁 session  */</span></span><br><span class="line">	application.setAttribute(<span class="string">"hello"</span>,<span class="string">"hello Application"</span>);</span><br><span class="line">	</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">$&#123;hello&#125;&lt;br/&gt;</span><br><span class="line">$&#123;pageScope.hello &#125; &lt;br /&gt;</span><br><span class="line">$&#123;requestScope.hello &#125; &lt;br /&gt;</span><br><span class="line">$&#123;sessionScope.hello &#125; &lt;br /&gt;</span><br><span class="line">$&#123;applicationScope.hello &#125; &lt;br /&gt;</span><br></pre></td></tr></table></figure>

<p>·</p>
<h2 id="1-5-EL-表达式的逻辑运算"><a href="#1-5-EL-表达式的逻辑运算" class="headerlink" title="1.5 EL 表达式的逻辑运算"></a>1.5 EL 表达式的逻辑运算</h2><blockquote>
<p>​    算术运算： + ，-，*，/     </p>
<p>​            注意： + 表示算术运算，不能用于字符串拼接</p>
<p>​    逻辑运算:  &amp;&amp;，||，！</p>
<p>​            注意：没有单 &amp;，或 |</p>
<p>​    比较运算:  &gt;,&lt;,==,&gt;=,&lt;=</p>
<p>​    三目运算符：<code>${条件?值:值}</code></p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;逻辑运算&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;h3&gt;算术运算&lt;/h3&gt;</span><br><span class="line">&lt;%request.setAttribute(<span class="string">"a"</span>,<span class="string">"1"</span>) ;%&gt;</span><br><span class="line">$&#123;<span class="number">4</span>*<span class="number">3</span>+<span class="number">8</span>&#125;&lt;br /&gt;</span><br><span class="line">$&#123;<span class="number">3</span>+a&#125;&lt;br /&gt;</span><br><span class="line">$&#123;<span class="number">1</span>+<span class="string">"2"</span>&#125;&lt;br /&gt;</span><br><span class="line">&lt;h3&gt;逻辑运算&lt;/h3&gt;</span><br><span class="line">$&#123;<span class="number">4</span>&gt;<span class="number">1</span>&amp;&amp;<span class="number">5</span>&lt;<span class="number">2</span>&#125;</span><br><span class="line">$&#123;<span class="number">4</span>&gt;<span class="number">1</span>||<span class="number">5</span>&lt;<span class="number">2</span>&#125;</span><br><span class="line">$&#123;!(<span class="number">4</span>&gt;<span class="number">1</span>&amp;&amp;<span class="number">5</span>&lt;<span class="number">2</span>)&#125;</span><br><span class="line">&lt;h3&gt;三目运算符&lt;/h3&gt;</span><br><span class="line">$&#123;a&gt;<span class="number">0</span>?<span class="string">"a"</span>:<span class="string">"不存在"</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-6-EL表达式的-empty-判断"><a href="#1-6-EL表达式的-empty-判断" class="headerlink" title="1.6 EL表达式的 empty 判断"></a>1.6 EL表达式的 empty 判断</h2><blockquote>
<p>格式： <code>${empty 键名}</code></p>
<p>作用：判断该键是否存储有效数据,，返回 boolean 类型</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;empty&lt;/h1&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	request.setAttribute(<span class="string">"a"</span>,<span class="string">""</span>);</span><br><span class="line">	User u = <span class="keyword">new</span> User();</span><br><span class="line">	pageContext.setAttribute(<span class="string">"u"</span>, u);</span><br><span class="line">	ArrayList al = <span class="keyword">new</span> ArrayList();</span><br><span class="line">	request.setAttribute(<span class="string">"list"</span>,al);</span><br><span class="line">	</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">$&#123;a&#125;&lt;br /&gt;</span><br><span class="line">$&#123;u&#125;&lt;br/&gt;</span><br><span class="line">$&#123;list&#125;&lt;br/&gt;</span><br><span class="line">&lt;hr /&gt;</span><br><span class="line">$&#123;empty a&#125;&lt;br /&gt;</span><br><span class="line">$&#123;empty u&#125;&lt;br/&gt;</span><br><span class="line">$&#123;empty list&#125;&lt;br/&gt;</span><br></pre></td></tr></table></figure>

<h1 id="2-上节项目修改"><a href="#2-上节项目修改" class="headerlink" title="2 上节项目修改"></a>2 上节项目修改</h1><blockquote>
<p>新增功能：</p>
<p>查询用户信息: 我们点击查询用户信息菜单，然后在网站的 iframe 中显示所有的用户信息</p>
<ol>
<li>创建用户信息显示界面(userList.jsp)</li>
<li>点击查询用户信息请求发送 DataServlet </li>
<li>在 DataServlet 中获取所有的用户信息</li>
<li>将数据存储进行 request 作用域对象中，请求转发给 userList.jsp</li>
<li>在 userList.jsp 中获取从DataServlet 中流转过来的用户数据,显示给浏览器</li>
</ol>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"panel admin-panel"</span>&gt;</span><br><span class="line">  &lt;div class="panel-head"&gt;&lt;strong class="icon-reorder"&gt; 用户列表&lt;/strong&gt;&lt;/div&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-hover text-center"</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">       &lt;%-- th 表示表头信息 --%&gt;</span><br><span class="line">      &lt;th width="5%"&gt;ID&lt;/th&gt;     </span><br><span class="line">      &lt;th&gt;用户名&lt;/th&gt;  </span><br><span class="line">      &lt;th&gt;密码&lt;/th&gt;     </span><br><span class="line">      &lt;th&gt;性别&lt;/th&gt;     </span><br><span class="line">      &lt;th&gt;年龄&lt;/th&gt;     </span><br><span class="line">      &lt;th&gt;生日&lt;/th&gt;     </span><br><span class="line">      &lt;th width="250"&gt;操作&lt;/th&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">   </span><br><span class="line">   	&lt;%-- 展现用户信息 --%&gt;</span><br><span class="line">   	&lt;%</span><br><span class="line">   		List&lt;User&gt; lu = (ArrayList)request.getAttribute(<span class="string">"lu"</span>);</span><br><span class="line">   		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;lu.size();i++)&#123;</span><br><span class="line">   	%&gt;</span><br><span class="line">	    &lt;tr&gt;</span><br><span class="line">	      &lt;td&gt;&lt;%=lu.get(i).getUid() %&gt;&lt;/td&gt;      </span><br><span class="line">	      &lt;td&gt;&lt;%=lu.get(i).getName() %&gt;&lt;/td&gt;      </span><br><span class="line">	      &lt;td&gt;&lt;%=lu.get(i).getPwd() %&gt;&lt;/td&gt;      </span><br><span class="line">	      &lt;td&gt;&lt;%=lu.get(i).getSex() %&gt;&lt;/td&gt;      </span><br><span class="line">	      &lt;td&gt;&lt;%=lu.get(i).getAge() %&gt;&lt;/td&gt;      </span><br><span class="line">	      &lt;td&gt;&lt;%=lu.get(i).getBirthday() %&gt;&lt;/td&gt;       </span><br><span class="line">	      &lt;td&gt;</span><br><span class="line">	      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"button-group"</span>&gt;</span><br><span class="line">	      &lt;a type="button" class="button border-main" href="#"&gt;&lt;span class="icon-edit"&gt;&lt;/span&gt;修改&lt;/a&gt;</span><br><span class="line">	       &lt;a class="button border-red" href="javascript:void(0)" onclick="return del(17)"&gt;&lt;span class="icon-trash-o"&gt;&lt;/span&gt; 删除&lt;/a&gt;</span><br><span class="line">	      &lt;/div&gt;</span><br><span class="line">	      &lt;/td&gt;</span><br><span class="line">	      </span><br><span class="line">	    &lt;/tr&gt; </span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/table&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h4 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h4><p><img src="http://www.zwer.xyz/picGo/20190311202457.png" alt></p>
<h1 id="3-JSTL-标签库"><a href="#3-JSTL-标签库" class="headerlink" title="3 JSTL 标签库"></a>3 JSTL 标签库</h1><blockquote>
<p>首先它是一个标签库,是对 EL 表达式的补充。</p>
<p>作用： 在 <code>jsp</code> 页面使用其可以非常方便的进行数据的处理。</p>
<p>较于使用 java 代码快方法，更加简单，更加简洁</p>
<p>流程: 导入 jar 包，引入标签库</p>
</blockquote>
<h2 id="3-1-引入核心标签库"><a href="#3-1-引入核心标签库" class="headerlink" title="3.1 引入核心标签库"></a>3.1 引入核心标签库</h2><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"c"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> %&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-基本标签"><a href="#3-2-基本标签" class="headerlink" title="3.2  基本标签"></a>3.2  基本标签</h2><h3 id="3-2-1-out-标签"><a href="#3-2-1-out-标签" class="headerlink" title="3.2.1 out 标签"></a>3.2.1 out 标签</h3><blockquote>
<p>格式：<code>&lt;c:out value=&quot;&quot; defalut=&quot;&quot;&gt;&lt;/c:out&gt;</code></p>
<p>作用：补充 EL 表达式 无法做逻辑判断处理。</p>
<p>示例：<code>&lt;c:out value=&quot;${flag2}&quot; default=&quot;抱歉未找到&quot;&gt;&lt;/c:out&gt;</code></p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 用于页面输出， </span><br><span class="line">	 value  要在页面输出的值</span><br><span class="line">	 <span class="keyword">default</span> 默认值</span><br><span class="line">	 使用： 结合 EL表达式 将数据响应给浏览器	</span><br><span class="line">		   如果 value 中值为空，则返回 <span class="keyword">default</span> 中的默认值</span><br><span class="line">	 作用: 补充 EL 表达式 无法做逻辑的处理</span><br><span class="line">--&gt;</span><br><span class="line">&lt;c:out value="" defalut=""&gt;&lt;/c:out&gt;</span><br></pre></td></tr></table></figure>

<p>Demo </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%-- 导入 JSTL 标签库  --%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span>  prefix=<span class="string">"c"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;学习 JSTL 标签库&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;% </span><br><span class="line"></span><br><span class="line">	request.setAttribute(<span class="string">"flag"</span>, <span class="string">"学习 JSTL,真不好用----真香"</span>);</span><br><span class="line">	</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%=request.getAttribute(<span class="string">"flag"</span>) %&gt; === $&#123;flag&#125; &lt;br/&gt;</span><br><span class="line">&lt;c:out value="学习 JSTL,真不好用----真香"&gt;&lt;/c:out&gt; == 学习 JSTL,真不好用----真香 &lt;br/&gt;</span><br><span class="line">&lt;c:out value="$&#123;flag&#125;"&gt;&lt;/c:out&gt; &lt;br/&gt;</span><br><span class="line">&lt;c:out value="$&#123;flag2&#125;" default="抱歉未找到"&gt;&lt;/c:out&gt;</span><br></pre></td></tr></table></figure>

<p><img src="http://www.zwer.xyz/picGo/20190311205309.png" alt></p>
<h2 id="3-2-2-set-标签"><a href="#3-2-2-set-标签" class="headerlink" title="3.2.2 set 标签"></a>3.2.2 set 标签</h2><blockquote>
<p>格式 <code>&lt;c:set var=&quot;&quot; value=&quot;&quot; scope=&quot;&quot;&gt;&lt;/c:set&gt;</code></p>
<p> 注意： scope 的值为 page reqeust session application </p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">		 <span class="keyword">var</span>    键名</span><br><span class="line">		 value  数据</span><br><span class="line">		 scope  作用域名   </span><br><span class="line">		 作用：将数据存储到指定的作用中，默认作用域为 pageContext 作用域</span><br><span class="line">		 注意： scope 的值为 page reqeust session application </span><br><span class="line">		 替代：xx.setAttribute 方法(xx:request,page,session.application)</span><br><span class="line">--&gt;</span><br><span class="line">&lt;c:set value="要新增数据的值" var="要新增数据的键" scope="作用域名"&gt;&lt;/c:set&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;c:set value="hello pageContext" var="hello" scope="page"&gt;&lt;/c:set&gt;</span><br><span class="line">&lt;c:set value="hello request" var="hello" scope="request"&gt;&lt;/c:set&gt;</span><br><span class="line">&lt;c:set value="hello session" var="hello" scope="session"&gt;&lt;/c:set&gt;</span><br><span class="line">&lt;c:set value="hello application" var="hello" scope="application"&gt;&lt;/c:set&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-3-remove-标签"><a href="#3-2-3-remove-标签" class="headerlink" title="3.2.3  remove 标签"></a>3.2.3  remove 标签</h2><blockquote>
<p>格式：<code>&lt;c:remove var=&quot;&quot; scope=&quot;&quot;&gt;&lt;/c:remove&gt;</code></p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">		<span class="keyword">var</span>     要删除数据的键名</span><br><span class="line">		scope   作用域名</span><br><span class="line">		作用：删除作用域中的数据，默认是删除四个作用域中的符合的数据</span><br><span class="line">		但是可以通过 scope 删除指定作用域的数据。</span><br><span class="line">		</span><br><span class="line">--&gt;</span><br><span class="line">&lt;c:remove var="要删除数据的键名"  scope="作用域名" &gt;&lt;/c:remove&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line"> 	 	pageContext.removeAttribute(<span class="string">"键名"</span>)</span><br><span class="line">		<span class="comment">// scope: 1:pageContext 2:request 3:session  4:application</span></span><br><span class="line">	     pageContext.removeAttribute(String key,<span class="keyword">int</span> scope)</span><br><span class="line">		</span><br><span class="line">--&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	<span class="comment">//删除四个作用域中所有键名为 hello 的值。</span></span><br><span class="line">	pageContext.removeAttribute(<span class="string">"hello"</span>);</span><br><span class="line">	<span class="comment">//下面的作用域-只删除本身作用域的键的值</span></span><br><span class="line">	reqeust.removeAttribute(<span class="string">"hello"</span>)</span><br><span class="line">    reqeust.removeAttribute(<span class="string">"hello"</span>)</span><br><span class="line">    reqeust.removeAttribute(<span class="string">"hello"</span>)</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-3-逻辑判断"><a href="#3-3-逻辑判断" class="headerlink" title="3.3  逻辑判断"></a>3.3  逻辑判断</h2><h3 id="3-3-1-单分支-判断"><a href="#3-3-1-单分支-判断" class="headerlink" title="3.3.1 单分支 判断"></a>3.3.1 单分支 判断</h3><blockquote>
<p>格式：<code>&lt;c:if test=&quot;条件&quot;&gt;&lt;/c:if&gt;</code></p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">    	    test 表示判断条件</span><br><span class="line">    	    作用：可以根据 EL 表达式进行一定程序的单分支逻辑判断</span><br><span class="line">    	    注意：</span><br><span class="line">    	    	test 属性中书写是 EL  表达式，或者是 EL表达式的逻辑判断</span><br><span class="line">    	    	该标签只能进行 EL 表达式相关的逻辑判断，不能获取 EL表达式 不能获取的数据</span><br><span class="line">    	    	</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;c:if test="条件"&gt;&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-多分支逻辑判断"><a href="#3-3-2-多分支逻辑判断" class="headerlink" title="3.3.2 多分支逻辑判断"></a>3.3.2 多分支逻辑判断</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">	 注意： 符合条件只会执行一个分支，其他分支不会执行</span><br><span class="line">--&gt;</span><br><span class="line">&lt;c:chooose&gt;</span><br><span class="line">	&lt;c:when test=<span class="string">"$&#123;表达式&#125;"</span>&gt;</span><br><span class="line">    	执行语句</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">"$&#123;表达式&#125;"</span>&gt;</span><br><span class="line">    	执行语句</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">    ..</span><br><span class="line">    &lt;c:otherwise&gt;</span><br><span class="line">    	执行语句</span><br><span class="line">    &lt;/c:otherwise&gt;</span><br><span class="line">&lt;/c:chooose&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Demo</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt; 多分支标签 &lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">&lt;c:set  var="score" value="59"&gt;&lt;/c:set&gt;</span><br><span class="line">&lt;c:choose&gt;</span><br><span class="line">	&lt;c:when test=<span class="string">"$&#123;score &lt;= 100 &amp;&amp; score &gt;=90&#125;"</span>&gt;</span><br><span class="line">		&lt;i&gt;优秀&lt;/i&gt;</span><br><span class="line">	&lt;/c:when&gt;</span><br><span class="line">	&lt;c:when test=<span class="string">"$&#123;score&lt;90 &amp;&amp; score&gt;=80&#125;"</span>&gt;</span><br><span class="line">		&lt;i&gt;良好&lt;/i&gt;</span><br><span class="line">	&lt;/c:when&gt;</span><br><span class="line">	&lt;c:when test=<span class="string">"$&#123;score &lt;79 &amp;&amp; score &gt;=60&#125;"</span>&gt;</span><br><span class="line">		&lt;i&gt;及格&lt;/i&gt;</span><br><span class="line">	&lt;/c:when&gt;</span><br><span class="line">	&lt;c:otherwise&gt;</span><br><span class="line">		&lt;i&gt;不及格&lt;/i&gt;</span><br><span class="line">	&lt;/c:otherwise&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-4-循环标签"><a href="#3-4-循环标签" class="headerlink" title="3.4  循环标签"></a>3.4  循环标签</h2><blockquote>
<p>格式一：<code>&lt;c:foreach begin=&quot;&quot; end=&quot;&quot; step=&quot;&quot; valueStatus=&quot;&quot;&gt;&lt;/c:foreach&gt;</code></p>
<p>格式二：<code>&lt;c:foreach items=&quot;&quot; var=&quot;&quot;&gt;&lt;/c:foreach&gt;</code></p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">	    begin： 声明循环开始位置</span><br><span class="line">		end: 声明循环结束位置</span><br><span class="line">		step: 声明循环的步长</span><br><span class="line">		varStatus: 声明变量记录循环状态，声明的变量为i</span><br><span class="line">			注意：记录的数据存储了作用域中可以直接使用 EL 表达式进行获取。</span><br><span class="line">			示例：</span><br><span class="line">				$&#123;i.index&#125; 获取当次循环的下标</span><br><span class="line">				$&#123;i.count&#125; 获取当次循环的次数</span><br><span class="line">				$&#123;i.first&#125; 判断是否循环的第一个</span><br><span class="line">				$&#123;i.last&#125; 判断是否是最后一个</span><br><span class="line">--&gt;</span><br><span class="line">&lt;c:foreach begin=<span class="string">""</span> end=<span class="string">""</span> step=<span class="string">""</span> varstatus=<span class="string">""</span>&gt;</span><br><span class="line">	循环体</span><br><span class="line">&lt;/c:foreach&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">	items: 声明要遍历的数据，可以是集合和数组等</span><br><span class="line">	<span class="keyword">var</span>: 声明变量记录每次遍历的结果，可以在循环体中使用 EL 表达式表示</span><br><span class="line">	作用： 可以使用 list 集合 和 map 集合遍历</span><br><span class="line">-&gt;</span><br><span class="line">&lt;c:forEach items items=<span class="string">""</span> <span class="keyword">var</span>=<span class="string">" "</span>&gt;</span><br><span class="line">	循环体</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;循环结构&lt;/h1&gt;</span><br><span class="line">&lt;c:forEach begin=<span class="string">"0"</span> end=<span class="string">"6"</span> step=<span class="string">"1"</span> varStatus=<span class="string">"i"</span>&gt;</span><br><span class="line">	<span class="number">11</span> --$&#123;i.index&#125;--$&#123;i.count&#125;--$&#123;i.first&#125;--$&#123;i.last&#125;&lt;br/&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br><span class="line">&lt;h3&gt; list 集合 &lt;/h3&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	 List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">	 list.add(<span class="string">"黑凤梨"</span>);</span><br><span class="line">	 list.add(<span class="string">"大香蕉"</span>);</span><br><span class="line">	 list.add(<span class="string">"菠萝蜜"</span>);</span><br><span class="line">	pageContext.setAttribute(<span class="string">"list"</span>, list);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;c:forEach items=<span class="string">"$&#123;list&#125;"</span> <span class="keyword">var</span>=<span class="string">"i"</span>&gt; </span><br><span class="line">	$&#123;i&#125;&lt;br/&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line">&lt;h3&gt; Map 集合&lt;/h3&gt;</span><br><span class="line">&lt;%</span><br><span class="line"></span><br><span class="line">	Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;String,String&gt;();	</span><br><span class="line">	map.put(<span class="string">"index0"</span>, <span class="string">"大菠萝"</span>);</span><br><span class="line">	map.put(<span class="string">"index1"</span>,<span class="string">"大西瓜"</span>);</span><br><span class="line">	map.put(<span class="string">"index2"</span>,<span class="string">"大香蕉"</span>);</span><br><span class="line">	</span><br><span class="line">	request.setAttribute(<span class="string">"map"</span>, map);</span><br><span class="line"></span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;c:forEach items=<span class="string">"$&#123;map&#125;"</span> <span class="keyword">var</span>=<span class="string">"j"</span>&gt;</span><br><span class="line">	$&#123;j&#125; -- $&#123;j.key&#125; --$&#123;j.value&#125;&lt;br/&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<p>效果图</p>
<p><img src="http://www.zwer.xyz/picGo/20190312211630.png" alt></p>
<h1 id="4-项目修改"><a href="#4-项目修改" class="headerlink" title="4 项目修改"></a>4 项目修改</h1><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"> &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">"table table-hover text-center"</span>&gt;</span><br><span class="line">   &lt;tr&gt;</span><br><span class="line">      &lt;%-- th 表示表头信息 --%&gt;</span><br><span class="line">     &lt;th width="5%"&gt;ID&lt;/th&gt;     </span><br><span class="line">     &lt;th&gt;用户名&lt;/th&gt;  </span><br><span class="line">     &lt;th&gt;密码&lt;/th&gt;     </span><br><span class="line">     &lt;th&gt;性别&lt;/th&gt;     </span><br><span class="line">     &lt;th&gt;年龄&lt;/th&gt;     </span><br><span class="line">     &lt;th&gt;生日&lt;/th&gt;     </span><br><span class="line">     &lt;th width="250"&gt;操作&lt;/th&gt;</span><br><span class="line">   &lt;/tr&gt;</span><br><span class="line">  </span><br><span class="line">  	&lt;%-- 展现用户信息 --%&gt;</span><br><span class="line">  	&lt;c:forEach items=<span class="string">"$&#123;lu&#125;"</span> <span class="keyword">var</span>=<span class="string">"user"</span>&gt;</span><br><span class="line">  		&lt;tr&gt;</span><br><span class="line">  			&lt;td&gt;$&#123;user.uid&#125;&lt;/td&gt;</span><br><span class="line">  			&lt;td&gt;$&#123;user.name&#125;&lt;/td&gt;</span><br><span class="line">  			&lt;td&gt;$&#123;user.pwd&#125;&lt;/td&gt;</span><br><span class="line">  			&lt;td&gt;$&#123;user.sex&#125;&lt;/td&gt;</span><br><span class="line">  			&lt;td&gt;$&#123;user.age&#125;&lt;/td&gt;</span><br><span class="line">  			&lt;td&gt;$&#123;user.birthday&#125;&lt;/td&gt;</span><br><span class="line">  			&lt;td&gt;</span><br><span class="line">     	 &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"button-group"</span>&gt;</span><br><span class="line">      		&lt;a type="button" class="button border-main" href="#"&gt;&lt;span class="icon-edit"&gt;&lt;/span&gt;修改&lt;/a&gt;</span><br><span class="line">      		 &lt;a class="button border-red" href="javascript:void(0)" onclick="return del(17)"&gt;&lt;span class="icon-trash-o"&gt;&lt;/span&gt; 删除&lt;/a&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;/td&gt;</span><br><span class="line">  		&lt;/tr&gt;</span><br><span class="line">  	&lt;/c:forEach&gt;</span><br><span class="line">  			</span><br><span class="line"> &lt;%--  	&lt;%</span><br><span class="line">  		List&lt;User&gt; lu = (ArrayList)request.getAttribute(<span class="string">"lu"</span>);</span><br><span class="line">  		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;lu.size();i++)&#123;</span><br><span class="line">  	%&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td&gt;&lt;%=lu.get(i).getUid() %&gt;&lt;/td&gt;      </span><br><span class="line">      &lt;td&gt;&lt;%=lu.get(i).getName() %&gt;&lt;/td&gt;      </span><br><span class="line">      &lt;td&gt;&lt;%=lu.get(i).getPwd() %&gt;&lt;/td&gt;      </span><br><span class="line">      &lt;td&gt;&lt;%=lu.get(i).getSex() %&gt;&lt;/td&gt;      </span><br><span class="line">      &lt;td&gt;&lt;%=lu.get(i).getAge() %&gt;&lt;/td&gt;      </span><br><span class="line">      &lt;td&gt;&lt;%=lu.get(i).getBirthday() %&gt;&lt;/td&gt;       </span><br><span class="line">      &lt;td&gt;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"button-group"</span>&gt;</span><br><span class="line">      &lt;a type="button" class="button border-main" href="#"&gt;&lt;span class="icon-edit"&gt;&lt;/span&gt;修改&lt;/a&gt;</span><br><span class="line">       &lt;a class="button border-red" href="javascript:void(0)" onclick="return del(17)"&gt;&lt;span class="icon-trash-o"&gt;&lt;/span&gt; 删除&lt;/a&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;/td&gt;</span><br><span class="line">      </span><br><span class="line">    &lt;/tr&gt; </span><br><span class="line">   &lt;% &#125; %&gt;</span><br><span class="line">--%&gt;</span><br></pre></td></tr></table></figure>

<p><img src="http://www.zwer.xyz/picGo/20190311202457.png" alt></p>
<h1 id="5-总结"><a href="#5-总结" class="headerlink" title="5 总结"></a>5 总结</h1><p>EL 表达式配合 JSTL 标签库可以比较好展示数据。其中 EL 表达式要注意从哪个作用域(page,request,)取数据，以及删除数据时，最好要指明从哪个作用域中删除数据。使用JSTL 时，注意 Map 集合的遍历。</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/03/07/20190307 JSP和Servlet整合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/03/07/20190307 JSP和Servlet整合/" class="post-title-link" itemprop="url">JSP 和 Servlet 整合</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-03-07 00:00:00" itemprop="dateCreated datePublished" datetime="2019-03-07T00:00:00+08:00">2019-03-07</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-06-16 08:30:46" itemprop="dateModified" datetime="2019-06-16T08:30:46+08:00">2019-06-16</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-登录模块套用"><a href="#1-登录模块套用" class="headerlink" title="1 登录模块套用"></a>1 登录模块套用</h1><h2 id="1-1-添加插件"><a href="#1-1-添加插件" class="headerlink" title="1.1 添加插件"></a>1.1 添加插件</h2><blockquote>
<p>添加前端书写插件，把插件放在 MyEclipse 的安装目录中 drops 文件中，然后重启</p>
<p>MyElipse，即可使用前端书写快捷键 <code>Ctrl+E</code></p>
</blockquote>
<h2 id="1-2-套用登录模块"><a href="#1-2-套用登录模块" class="headerlink" title="1.2 套用登录模块"></a>1.2 套用登录模块</h2><blockquote>
<p>先创建一个 JSP 页面，然后剪切 <code>&lt;base href=&quot;&lt;%=basePath%&gt;&quot;&gt;</code></p>
<p>复制 模块.html 中的代码到 JSP界面。</p>
</blockquote>
<h1 id="2-项目系统分析"><a href="#2-项目系统分析" class="headerlink" title="2 项目系统分析"></a>2 项目系统分析</h1><p>项目名称：</p>
<p>​    后台管理系统</p>
<p>项目需求：</p>
<p>​    实现用户登录</p>
<p>​    实现用户退出</p>
<p>​    实现用户注册</p>
<p>功能分析</p>
<p>​    用户登录</p>
<p>​    用户退出</p>
<p>​    用户注册</p>
<p>数据库设计</p>
<p>​    用户表</p>
<p>​        字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">project</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user(</span><br><span class="line">	uid <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line">    pwd <span class="keyword">String</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    age <span class="built_in">int</span>(<span class="number">3</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    sex <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    birthday <span class="built_in">date</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">)<span class="keyword">engine</span>=INoDB,<span class="keyword">charset</span>=utf8</span><br></pre></td></tr></table></figure>

<p>SQL 语句设计</p>
<p>​    用户登录  </p>
<p>​    用户注册</p>
<hr>
<p>代码实现：</p>
<p>​    参照源码</p>
<hr>
<p>问题1：</p>
<p>​    现在我们一个请求或者一个独立的业务逻辑都单独进行一个Servlet的创建进行请求处理。</p>
<p>但是一个网站的功能是非常的多，如果每个都创建单独的Servlet进行处理，这样造成</p>
<p>Servlet 过多。造成资源浪费。</p>
<p>解决：</p>
<p>​    服务器在接受到浏览器发送的请求后，会调用对应的Servlet进行请求</p>
<p>​    然后调用 Servlet 中 Service 方法进行处理</p>
<p>​    我们将不同功能的处理封装成对应的方法。</p>
<p>​    在service方法中 调用其对应的功能处理方法进行请求处理</p>
<p>​    这样Servlet 我们只需要一个</p>
<p>新的问题：</p>
<p>​    如何在 Service 方法中实现根据请求动态的调用器功能处理方法呢？</p>
<p>解决：</p>
<p>​    使用反射动态的获取 Servlet 中的方法</p>
<p>注意：<strong>请求中要附带方法的名称</strong></p>
<hr>
<p>问题2： 现在使用反射我们事先了在service 方法中动态的根据请求调用对应的方法</p>
<p>进行请求处理，但是真实开发过程中，不对每个功能都创建一个servlet ，但是</p>
<p>也不会只使用一个 Servlet ，我们的 Servlet 不只是一个。</p>
<p>一般是一个独立的功能模块一个servlet 。我们需要在这些 servlet 中的  service 中</p>
<p>都要将 反射的代码声明一个遍。</p>
<h1 id="3-登录-Servlet-创建和MVC思想"><a href="#3-登录-Servlet-创建和MVC思想" class="headerlink" title="3  登录 Servlet 创建和MVC思想"></a>3  登录 Servlet 创建和MVC思想</h1><blockquote>
<p>用户登录：</p>
<p>​    用户点击登录发送请求到 UserServet</p>
<p>​    tomcat 服务器接受到</p>
<p>MVC 分层开发；</p>
<p>​    M：model  service层、dao层和 实体类</p>
<p>​    V： view     视图层   JSP 页面</p>
<p>​    C：controller   控制层 Servlet</p>
</blockquote>
<p>注意： 定义birthday 属性可以使用 String 类型。</p>
<p>service层： getUserInfoService(String name,String pwd)</p>
<p>dao 层： getUserInfoDao(String uname,String pwd)   查询用户信息</p>
<h1 id="4-用户登录失败和成功处理"><a href="#4-用户登录失败和成功处理" class="headerlink" title="4 用户登录失败和成功处理"></a>4 用户登录失败和成功处理</h1><blockquote>
<p>在用户登录失败的页面上，打印用户登录失败的提示，使用 JSP 和 session。</p>
<p>在用户成功登录后，在合适的位置打印当前用户登录名。</p>
<p>在 JSP 界面寻找合适的位置的方法：</p>
<p>方法可以先使用行内样式<code>border: solid 3px red</code>,确定边框的大小和位置</p>
<p>然后通过添加 span 标签或其他标签内，声明 java 代码.</p>
</blockquote>
<h1 id="5-用户退出"><a href="#5-用户退出" class="headerlink" title="5 用户退出"></a>5 用户退出</h1><blockquote>
<p>点击 退出按钮，使用 JS 确认框，询问用户是否退出。</p>
<p>若退出，选择是，否则不执行退出操作</p>
</blockquote>
<h2 id="5-1-LoginOutServlet-java"><a href="#5-1-LoginOutServlet-java" class="headerlink" title="5.1  LoginOutServlet.java"></a>5.1  LoginOutServlet.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 用户退出</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 销毁session </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginOutServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">				<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">			  	<span class="comment">//设置请求编码格式</span></span><br><span class="line">				req.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">				<span class="comment">//设置响应编码格式</span></span><br><span class="line">				resp.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">				<span class="comment">//响应处理结果</span></span><br><span class="line">					<span class="comment">//获取session 对象</span></span><br><span class="line">					HttpSession session = req.getSession();</span><br><span class="line">					<span class="comment">//销毁 session 对象</span></span><br><span class="line">					session.invalidate();</span><br><span class="line">					<span class="comment">//重定向</span></span><br><span class="line">					resp.sendRedirect(<span class="string">"/projectsxt/login.jsp"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-JS-事件绑定"><a href="#5-2-JS-事件绑定" class="headerlink" title="5.2  JS 事件绑定"></a>5.2  JS 事件绑定</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">/* 	function loginOut()&#123;</span></span><br><span class="line"><span class="comment">    			</span></span><br><span class="line"><span class="comment">    		return window.confirm("您确定要退出嘛？");</span></span><br><span class="line"><span class="comment">    			</span></span><br><span class="line"><span class="comment">    	&#125;  */</span></span><br><span class="line">    	</span><br><span class="line">    	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    		<span class="comment">/* </span></span><br><span class="line"><span class="comment">    			ID 选择器 ，注意前面加 井号# </span></span><br><span class="line"><span class="comment">            	事件绑定函数</span></span><br><span class="line"><span class="comment">            */</span>	</span><br><span class="line">    		$(<span class="string">"#out"</span>).click(</span><br><span class="line">    			</span><br><span class="line">    			<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    				<span class="comment">/*</span></span><br><span class="line"><span class="comment">    					确定框，如果点 "是" ,则返回 true，这样就触发 a 标签的 href 属性</span></span><br><span class="line"><span class="comment">    					反之，则什么也不做，不会触发 a 标签的 href 属性。</span></span><br><span class="line"><span class="comment">    				*/</span></span><br><span class="line">    				<span class="keyword">return</span> <span class="built_in">window</span>.confirm(<span class="string">"您确定要退出嘛？"</span>);</span><br><span class="line">    		&#125;);</span><br><span class="line">    		</span><br><span class="line">    	&#125;);</span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"head-l"</span> <span class="attr">style</span>=<span class="string">"position: relative; left: 850px; color:white; font-size: 15px;"</span>&gt;</span> 	  当前用户:<span class="tag">&lt;<span class="name">%=(String)session.getAttribute("uname")</span> %&gt;</span></span><br><span class="line">     &amp;nbsp;&amp;nbsp;</span><br><span class="line">     <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"out"</span> <span class="attr">class</span>=<span class="string">"button button-little bg-red"</span> <span class="attr">href</span>=<span class="string">"user/out"</span> <span class="attr">onclick</span>=<span class="string">"loginOut()"</span>&gt;</span>			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-power-off"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>退出登录</span><br><span class="line">     <span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="6-用户注册"><a href="#6-用户注册" class="headerlink" title="6 用户注册"></a>6 用户注册</h1><h2 id="6-1-用户注册界面"><a href="#6-1-用户注册界面" class="headerlink" title="6.1 用户注册界面"></a>6.1 用户注册界面</h2><blockquote>
<p>找用户注册界面相似的模块进行修改</p>
<p>MySQL 会将字符类型的数据，按照隐形转换成数字和日期类型</p>
<p>regUserInfoDao 方法</p>
<p>regUserInfoService 方法</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 选择出生日期  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"label"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"sitename"</span>&gt;</span>出生日期：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"field"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置 type 的属性为 date ，选择日期 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"date"</span> <span class="attr">class</span>=<span class="string">"input w50"</span> <span class="attr">id</span>=<span class="string">"mpass"</span> <span class="attr">name</span>=<span class="string">"mpass"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">size</span>=<span class="string">"50"</span>  /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">	</span><br><span class="line">		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			</span><br><span class="line">				<span class="comment">/**    设置性别选择                   ****/</span></span><br><span class="line">				$(<span class="string">"#male"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">					</span><br><span class="line">					$(<span class="string">"#span_male"</span>).addClass(<span class="string">"icon-check"</span>);</span><br><span class="line">					$(<span class="string">"#span_female"</span>).removeClass(<span class="string">"icon-check"</span>);</span><br><span class="line">					</span><br><span class="line">				&#125;);</span><br><span class="line">			</span><br><span class="line">				$(<span class="string">"#female"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">					</span><br><span class="line">					$(<span class="string">"#span_female"</span>).addClass(<span class="string">"icon-check"</span>);</span><br><span class="line">					$(<span class="string">"#span_male"</span>).removeClass(<span class="string">"icon-check"</span>);</span><br><span class="line">					</span><br><span class="line">				&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="7-项目改良"><a href="#7-项目改良" class="headerlink" title="7 项目改良"></a>7 项目改良</h1><blockquote>
<p>用一个 Servlet 解决，使用反射的方法，获取方法名，然后执行相应的方法。</p>
<p>方法：请求附带方法名的方式</p>
<p>一、使用隐藏标签发送附带请求信息</p>
<p>二、使用超链接附带请求信息</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 隐藏标签 请求的方法名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"method"</span>  <span class="attr">value</span>=<span class="string">"方法名"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 超链接 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"data?method="</span>某某方法名"&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用 js --&gt;</span></span><br><span class="line">window.location.href="data?method="某某方法名"</span><br></pre></td></tr></table></figure>

<h2 id="7-1-DataServlet"><a href="#7-1-DataServlet" class="headerlink" title="7.1 DataServlet"></a>7.1 DataServlet</h2><blockquote>
<p>用户模块 </p>
<p>​    用户登录</p>
<p>​    用户注销</p>
<p>​    用户注册</p>
<p>将原来的三个 Servlet 变为一个 Servlet ，使用反射动态获取请求方法。</p>
<p>好处：减少 servlet 的数量，从服务器角度来说，serlvet 从第一次启动就会一直运行，直到服务器结束运行，这样对服务器的压力比较大，尤其是当前业务比较多的时候。减少多余代码的书写，将原来每个细小的模块都放在一个大的模块中作为一个 servlet。</p>
<p>注意：请求方法在请求中附带，可使用 <code>input</code> 隐藏标签</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.szxy.pojo.User;</span><br><span class="line"><span class="keyword">import</span> cn.szxy.service.UserService;</span><br><span class="line"><span class="keyword">import</span> cn.szxy.service.impl.UserServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 使用一个 servlet 动态分发一个模块的请求方法</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 设置请求编码格式</span></span><br><span class="line">		req.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		<span class="comment">// 设置响应编码格式</span></span><br><span class="line">		resp.setContentType(<span class="string">"text/html;utf-8"</span>);</span><br><span class="line">		<span class="comment">// 获取请求的方法名</span></span><br><span class="line">		String methodName = req.getParameter(<span class="string">"method"</span>);</span><br><span class="line">		<span class="comment">// 根据方法名的不同动态选择方法对应处理请求</span></span><br><span class="line">		<span class="comment">// 获取该类的类对象</span></span><br><span class="line">		Class clazz = <span class="keyword">this</span>.getClass();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 获取该类的方法</span></span><br><span class="line">			Method method = clazz.getMethod(methodName,</span><br><span class="line">					HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">			<span class="comment">// 执行对应的请求方法</span></span><br><span class="line">			method.invoke(<span class="keyword">this</span>, req, resp);</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 用户登录</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userLogin</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"DataServlet.userLogin() 处理请求..."</span>);</span><br><span class="line">		<span class="comment">// 获取请求数据</span></span><br><span class="line">		String uname = req.getParameter(<span class="string">"uname"</span>);</span><br><span class="line">		String pwd = req.getParameter(<span class="string">"pwd"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 处理请求数据</span></span><br><span class="line">		<span class="comment">// 获取 业务逻辑层对象</span></span><br><span class="line">		UserService service = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">		User u = service.getUserInfoService(uname, pwd);</span><br><span class="line">		System.out.println(u);</span><br><span class="line">		<span class="comment">// 获取或创建 session 对象</span></span><br><span class="line">		HttpSession session = req.getSession();</span><br><span class="line">		<span class="comment">// 检查用户名和密码</span></span><br><span class="line">		<span class="keyword">if</span> (u != <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 处理响应结果</span></span><br><span class="line">			session.setAttribute(<span class="string">"uname"</span>, uname);</span><br><span class="line">			session.setAttribute(<span class="string">"pwd"</span>, pwd);</span><br><span class="line">			<span class="comment">// 重定向</span></span><br><span class="line">			resp.sendRedirect(<span class="string">"/projectsxt2/index.jsp"</span>);</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 处理响应结果</span></span><br><span class="line">			session.setAttribute(<span class="string">"flag"</span>, <span class="string">"LoginFailure"</span>);</span><br><span class="line">			<span class="comment">// 重定向</span></span><br><span class="line">			resp.sendRedirect(<span class="string">"/projectsxt2/login.jsp"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 用户退出</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userLoginOut</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"DataServlet.userLoginOut() 处理请求"</span>);</span><br><span class="line">		<span class="comment">// 响应处理结果</span></span><br><span class="line">		<span class="comment">// 获取session 对象</span></span><br><span class="line">		HttpSession session = req.getSession();</span><br><span class="line">		<span class="comment">// 销毁 session 对象</span></span><br><span class="line">		session.invalidate();</span><br><span class="line">		<span class="comment">// 重定向</span></span><br><span class="line">		resp.sendRedirect(<span class="string">"/projectsxt2/login.jsp"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 用户注册</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userRegister</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"DataServlet.userRegister() 处理请求"</span>);</span><br><span class="line">		<span class="comment">// 获取请求数据</span></span><br><span class="line">		String uname = req.getParameter(<span class="string">"uname"</span>);</span><br><span class="line">		String pwd = req.getParameter(<span class="string">"pwd"</span>);</span><br><span class="line">		String sex = req.getParameter(<span class="string">"sex"</span>);</span><br><span class="line">		<span class="keyword">int</span> age = Integer.valueOf(req.getParameter(<span class="string">"age"</span>));</span><br><span class="line">		String birthday = req.getParameter(<span class="string">"birthday"</span>);</span><br><span class="line">		<span class="comment">// System.out.println(uname+" "+pwd+" "+sex+" "+age+" "+birthday);</span></span><br><span class="line">		<span class="comment">// 处理请求数据</span></span><br><span class="line">		<span class="comment">// 获取业务层对象</span></span><br><span class="line">		UserService service = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">		<span class="keyword">int</span> flag = service.regUserInfoService(uname, pwd, sex, age, birthday);</span><br><span class="line">		<span class="comment">// 创建 session 对象</span></span><br><span class="line">		HttpSession session = req.getSession();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (flag != -<span class="number">1</span>) &#123;</span><br><span class="line">			session.setAttribute(<span class="string">"flag"</span>, <span class="string">"RegisterSuccess"</span>);</span><br><span class="line">			<span class="comment">// 重定向</span></span><br><span class="line">			resp.sendRedirect(<span class="string">"/projectsxt2/login.jsp"</span>);</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">			session.setAttribute(<span class="string">"flag"</span>, <span class="string">"RegisterFailure"</span>);</span><br><span class="line">			<span class="comment">// 重定向</span></span><br><span class="line">			resp.sendRedirect(<span class="string">"/projectsxt2/login.jsp"</span>);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="8-BaseServlet"><a href="#8-BaseServlet" class="headerlink" title="8  BaseServlet"></a>8  BaseServlet</h1><blockquote>
<p>向上抽取成父类，解决多个模块书写相同代码的问题</p>
<p>注意：</p>
<p>一： BaseServlet 不能被访问 ，在 web.xml 不配置 BaseServlet</p>
<p>二： BaseServlet 不能被实例化，改为 abstract 类</p>
<p>使用：</p>
<p>一： 创建 Servlet 继承 BaseServlet 即可。</p>
<p>二：在自己的 Servlet 中 不要声明  service 方法</p>
<p>三：正常访问我们自己的servlet</p>
<p>注意：<strong>请求必须附带要被执行的方法名</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.szxy.pojo.User;</span><br><span class="line"><span class="keyword">import</span> cn.szxy.service.UserService;</span><br><span class="line"><span class="keyword">import</span> cn.szxy.service.impl.UserServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Servlet 工具类</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 不配置 web.xml 访问路径</span></span><br><span class="line"><span class="comment"> * 抽象类不能被实例化</span></span><br><span class="line"><span class="comment"> * 父类的 this 指针指向 子类对象</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 使用：</span></span><br><span class="line"><span class="comment"> * 	  只要继承该类就可以了，不可以重写 HttpServlt父类的方法</span></span><br><span class="line"><span class="comment"> * 	 在自己的  servlet 中只写 请求方法</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span>  <span class="class"><span class="keyword">class</span> <span class="title">BaseServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 设置请求编码格式</span></span><br><span class="line">		req.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		<span class="comment">// 设置响应编码格式</span></span><br><span class="line">		resp.setContentType(<span class="string">"text/html;utf-8"</span>);</span><br><span class="line">		<span class="comment">// 获取请求的方法名</span></span><br><span class="line">		String methodName = req.getParameter(<span class="string">"method"</span>);</span><br><span class="line">		<span class="comment">// 根据方法名的不同动态选择方法对应处理请求</span></span><br><span class="line">		<span class="comment">// 获取该类的类对象</span></span><br><span class="line">		Class clazz = <span class="keyword">this</span>.getClass();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 获取该类的方法</span></span><br><span class="line">			Method method = clazz.getMethod(methodName,</span><br><span class="line">					HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">			<span class="comment">// 执行对应的请求方法</span></span><br><span class="line">			method.invoke(<span class="keyword">this</span>, req, resp);</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="9-总结"><a href="#9-总结" class="headerlink" title="9 总结"></a>9 总结</h1><ol>
<li><p>套用模板进行页面快速构建</p>
<p>在自己的项目中常见 jsp 文件，然后将模板中的前端相关代码赋值到</p>
<p>自己的jsp 文件中，将静态资源赋值到 webRoot 下</p>
</li>
<li><p>MVC的开发流程</p>
<p>M： model      service dao pojo </p>
<p>v：view         Jsp js  css html</p>
<p>c：controller   Servlet 控制</p>
</li>
<li><p>Servlet+jsp+jdbc 的功能开发流程</p>
<p>浏览器发起页面请求直接给 jsp </p>
<p>浏览器发起功能请求给 servlet ，servlet 调用service， service 进行业务逻辑处理</p>
<p>service  调用dao，dao 进行数据库操作( jdbc)，dao 层将处理结果返回给 servcie </p>
<p>servcie 再将结果返回给 servlet ，请求转发或重定向给 jsp ，jsp 做出页面响应</p>
</li>
<li><p>request 和session 作用有的使用</p>
<p>request： 请求转发的数据流转的载体</p>
<p>session： 重定向类型的数据流转的载体(但是 session 可以解决 同一个用户不同请求的数据共享)</p>
</li>
<li><p>浏览器发起请求到服务器请求发起的方式(重点记忆)</p>
<ol>
<li>非 ajxk</li>
</ol>
<p>form 表单提交： action 数据提交地址，method：数据提交方法</p>
<p>超链接标签（相当于 get 请求） href:为数据提交地址，可以直接使用？拼接请求数据</p>
<p>js中的window.location.herf ：为数据提交地址，可以直接使用？拼接请求数据</p>
<p>注意：</p>
<p>​    使用以上请求发起的请求，浏览器在接收到响应内容后，会原有内容覆盖，显示响应效果</p>
<ol start="6">
<li><p>ajax 技术</p>
<p>在整个页面中局部的页面刷新操作</p>
</li>
</ol>
</li>
<li><p>BaeSrrvlet 的抽去和使用</p>
<ol>
<li><p>反射</p>
</li>
<li><p>抽象类</p>
</li>
</ol>
</li>
<li><p>项目缺陷</p>
<ol>
<li><p>在jsp中获取从Servlet 流转过来的数据特别麻烦   </p>
<p>解决:使用 EL 表达式</p>
<ol>
<li>在 jsp 页面中使用 java 代码块进行逻辑处理书写和阅读极不方便</li>
</ol>
<p>解决：使用 JSTL 标签库</p>
<ol>
<li><p>使用 session 进行数据流转是很方便的，但是 session 失效了，所有 依赖 session 都会失效。</p>
</li>
<li><p>响应结果都是覆盖原有内容显示给用户</p>
</li>
</ol>
<p>解决：使用 ajax 技术</p>
</li>
</ol>
</li>
<li><p>删除用户信息</p>
<p>delUserInfo 下一章节</p>
<p>问题： 在删除成功后，响应内容会将请求页面的所有的内容覆盖</p>
<p>​    显示新的内容，但是我们希望在保留当前请求页信息的基础上显示新的内容</p>
<p>明确：</p>
<p>(没有指明资源显示位置)指的不一定是浏览器中一个标签页，一般 frameset 标签中都的划分区域，</p>
<p>都是单独的。如果某个区域发起了请求，则该区域可以称为当前请求页</p>
<p>也就是说浏览器在当前页向服务器发出请求，服务器接受请求，处理请求数据，在未指明资源显示位置，a 标签 默认将响应结果发送给浏览器当前页上，会覆盖之前的响应内容，显示新的响应内容。</p>
<pre><code>解决：使用 ajax 技术</code></pre><ol start="9">
<li><p>显示当前在线人数:</p>
<p>统计当前系统的 session 的个数，一个 session就是一个用户在线。</p>
<p>在 session 被创建的使用计数器+1，session 数据被销毁时计数器 -1</p>
<p>问题：</p>
<p>​    我怎么能在 session 创建的时触发计数器执行 +1</p>
</li>
</ol>
<p>​        </p>
</li>
</ol>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/03/03/markdown/搭建安卓开发环境/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/03/03/markdown/搭建安卓开发环境/" class="post-title-link" itemprop="url">安卓开发</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-03-03 00:00:00" itemprop="dateCreated datePublished" datetime="2019-03-03T00:00:00+08:00">2019-03-03</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-03-04 09:17:51" itemprop="dateModified" datetime="2019-03-04T09:17:51+08:00">2019-03-04</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-搭建环境"><a href="#1-搭建环境" class="headerlink" title="1 搭建环境"></a>1 搭建环境</h1><blockquote>
<p>ADT </p>
</blockquote>
<h4 id="1-1-下载-ADT-Bundle-开发工具集合"><a href="#1-1-下载-ADT-Bundle-开发工具集合" class="headerlink" title="1.1 下载 ADT Bundle 开发工具集合"></a>1.1 下载 ADT Bundle 开发工具集合</h4><pre><code>1. 下载 adt-bundle-windows-x86_64_20140101 ，然后解压到本地磁盘上
2.  打开 SDKManager.exe ，下载相应的安装包，不需要全部下载
3.  将 platform-tools 目录下的 adb.exe ，添加到环境变量中，方便之后调试</code></pre><h4 id="1-2-实现-HelloWorld"><a href="#1-2-实现-HelloWorld" class="headerlink" title="1.2 实现 HelloWorld"></a>1.2 实现 HelloWorld</h4><ol>
<li>新建一个 安卓模拟器，注意打开后不要关闭了，方便后面项目使用，DDMS</li>
<li>新建一个 android application project 项目</li>
<li>点击 Run 运行该HelloWorld 项目，即可在安卓模拟器看到 HelloWorld 项目的app</li>
<li>打包 apk导出到本地磁盘</li>
</ol>
<h1 id="2-UI"><a href="#2-UI" class="headerlink" title="2 UI"></a>2 UI</h1><blockquote>
<p>按照自己的意图排列图标、图片、按钮等在界面上的位置 </p>
</blockquote>
<h2 id="2-1-相对布局"><a href="#2-1-相对布局" class="headerlink" title="2.1 相对布局"></a>2.1 相对布局</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- RelationLayout 相对布局  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"top"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingBottom</span>=<span class="string">"@dimen/activity_vertical_margin"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingLeft</span>=<span class="string">"@dimen/activity_horizontal_margin"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingRight</span>=<span class="string">"@dimen/activity_horizontal_margin"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingTop</span>=<span class="string">"@dimen/activity_vertical_margin"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">".HelloWorldActivity"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    	 文本控件： 设置 RelationLayout 宽         高</span></span><br><span class="line"><span class="comment">    	 match_parent 使视图扩展到父元素大小  </span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/textView1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/hello_world"</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    	 centerHorizeontal 居中</span></span><br><span class="line"><span class="comment">    	 wrap_content   适配屏幕</span></span><br><span class="line"><span class="comment">    	</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/button1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentTop</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"120dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/login"</span>  /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 注意 string 中 s 小写 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/button2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignBottom</span>=<span class="string">"@+id/button1"</span></span></span><br><span class="line"><span class="tag">    	<span class="attr">android:layout_marginBottom</span>=<span class="string">"50dp"</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_toRightOf</span>=<span class="string">"@+id/button1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/regsiter"</span>  /&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://www.zwer.xyz/picGo/20190304091743.png" alt></p>
<h2 id="2-2-流式布局"><a href="#2-2-流式布局" class="headerlink" title="2.2 流式布局"></a>2.2 流式布局</h2><blockquote>
<p>应用场景：用户登录</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span> &gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    		LinearLayout 线性布局</span></span><br><span class="line"><span class="comment">    		android:orientation="vertical" 表示垂直  vertical  默认</span></span><br><span class="line"><span class="comment">    		android:orientation="horizontal" 表示水平 horizontal</span></span><br><span class="line"><span class="comment">    		</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        	<span class="attr">android:id</span>=<span class="string">"@+id/button1"</span> </span></span><br><span class="line"><span class="tag">        	<span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        	<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> </span></span><br><span class="line"><span class="tag">        	<span class="attr">android:text</span>=<span class="string">"@string/button1"</span>    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        	<span class="attr">android:id</span>=<span class="string">"@+id/button2"</span> </span></span><br><span class="line"><span class="tag">        	<span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        	<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> </span></span><br><span class="line"><span class="tag">        	<span class="attr">android:text</span>=<span class="string">"@string/button2"</span>    /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        	<span class="attr">android:id</span>=<span class="string">"@+id/button3"</span> </span></span><br><span class="line"><span class="tag">        	<span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        	<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> </span></span><br><span class="line"><span class="tag">        	<span class="attr">android:text</span>=<span class="string">"@string/button3"</span>    /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-3-表格布局"><a href="#2-3-表格布局" class="headerlink" title="2.3 表格布局"></a>2.3 表格布局</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">TableLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:stretchColumns</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">   	   </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    	 android:stretchColumns="2" 表示第三列拉伸</span></span><br><span class="line"><span class="comment">    	 TableRow 表示表格</span></span><br><span class="line"><span class="comment">    	   android:layout_column="0"  列号从 0 开始</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">   	 <span class="tag">&lt;<span class="name">TableRow</span>&gt;</span></span><br><span class="line">   	     <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:id</span>=<span class="string">"@+id/btn1"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> </span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_column</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:text</span>=<span class="string">"@string/btn1"</span> /&gt;</span>  </span><br><span class="line">   	    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:id</span>=<span class="string">"@+id/btn2"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> </span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_column</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:text</span>=<span class="string">"@string/btn2"</span> /&gt;</span>    </span><br><span class="line">   	 <span class="tag">&lt;/<span class="name">TableRow</span>&gt;</span>   </span><br><span class="line">   	 </span><br><span class="line">   	<span class="tag">&lt;<span class="name">TableRow</span>&gt;</span></span><br><span class="line">   	    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:id</span>=<span class="string">"@+id/btn3"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> </span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_column</span>=<span class="string">"1"</span>  </span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:text</span>=<span class="string">"@string/btn3"</span> /&gt;</span>  </span><br><span class="line">   	          <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:id</span>=<span class="string">"@+id/bt4"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> </span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_column</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:text</span>=<span class="string">"@string/btn4"</span> /&gt;</span>      </span><br><span class="line">   	 <span class="tag">&lt;/<span class="name">TableRow</span>&gt;</span>   </span><br><span class="line">   	 </span><br><span class="line">  	<span class="tag">&lt;<span class="name">TableRow</span>&gt;</span></span><br><span class="line">   	    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:id</span>=<span class="string">"@+id/btn5"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> </span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:layout_column</span>=<span class="string">"2"</span></span></span><br><span class="line"><span class="tag">   	        <span class="attr">android:text</span>=<span class="string">"@string/btn5"</span> /&gt;</span>  </span><br><span class="line">   	         </span><br><span class="line">   	 <span class="tag">&lt;/<span class="name">TableRow</span>&gt;</span>   </span><br><span class="line">   	 </span><br><span class="line"><span class="tag">&lt;/<span class="name">TableLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://www.zwer.xyz/picGo/20190304090610.png" alt></p>
<h2 id="2-4-网格布局"><a href="#2-4-网格布局" class="headerlink" title="2.4 网格布局"></a>2.4 网格布局</h2><blockquote>
<p>从安卓 4.0 以后开始支持的</p>
<p>所需的  SDK 版本最低位 14</p>
<p>应用场景：布局</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">GridLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:columnCount</span>=<span class="string">"4"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">Button</span> </span></span><br><span class="line"><span class="tag">	    <span class="attr">android:layout_column</span>=<span class="string">"3"</span></span></span><br><span class="line"><span class="tag">	    <span class="attr">android:text</span>=<span class="string">"@string/div"</span></span></span><br><span class="line"><span class="tag">	 /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:text</span>=<span class="string">"@string/s1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:text</span>=<span class="string">"@string/s2"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:text</span>=<span class="string">"@string/s3"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:text</span>=<span class="string">"@string/plus"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:text</span>=<span class="string">"@string/s4"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:text</span>=<span class="string">"@string/s5"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:text</span>=<span class="string">"@string/s6"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:text</span>=<span class="string">"@string/sub"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">     <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:text</span>=<span class="string">"@string/s7"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:text</span>=<span class="string">"@string/s8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:text</span>=<span class="string">"@string/s9"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"fill"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_rowSpan</span>=<span class="string">"3"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/add"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"fill"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_columnSpan</span>=<span class="string">"2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/zero"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:text</span>=<span class="string">"@string/doublezero"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">     <span class="tag">&lt;<span class="name">Button</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_columnSpan</span>=<span class="string">"3"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"fill"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/equal"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">GridLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://www.zwer.xyz/picGo/20190304090511.png" alt></p>
<h2 id="2-5-布局总结"><a href="#2-5-布局总结" class="headerlink" title="2.5 布局总结"></a>2.5 布局总结</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//自动设置宽髙</span><br><span class="line">android:layout_width="match_parent"     </span><br><span class="line">android:layout_height="match_parent"</span><br></pre></td></tr></table></figure>

<h2 id="2-5-其他标签"><a href="#2-5-其他标签" class="headerlink" title="2.5 其他标签"></a>2.5 其他标签</h2><p><code>TextView</code>标签  文本提示框</p>
<p><code>EditText</code>标签  文本输入框，属性有 <code>inputType</code></p>
<p><code>Button</code>标签  按钮</p>
<p><code>radioButton</code>标签  单选按钮，用 <code>radioGroup</code>包裹</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/03/02/20190302 搭建 structs 环境md/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/03/02/20190302 搭建 structs 环境md/" class="post-title-link" itemprop="url">搭建 structs 环境</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-03-02 00:00:00 / Modified: 18:46:32" itemprop="dateCreated datePublished" datetime="2019-03-02T00:00:00+08:00">2019-03-02</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p>环境:  window 10 ,JDK 1.8  ,Tomcat 7 ,MyEclipse 2014 pro</p>
</blockquote>
<h1 id="搭建-SSH-环境的步骤"><a href="#搭建-SSH-环境的步骤" class="headerlink" title="搭建 SSH 环境的步骤"></a>搭建 SSH 环境的步骤</h1><ol>
<li><p>创建 JavaWeb 项目</p>
</li>
<li><p>导入 structs2 的jar包，只需导入13个基础 jar 包即可，后续 jar 包根据需要导入。</p>
<p>asm-3.3.jar<br>asm-commons-3.3.jar<br>asm-tree-3.3.jar<br>commons-fileupload-1.3.1.jar<br>commons-io-2.2.jar<br>commons-lang3-3.2.jar<br>freemarker-2.3.22.jar<br>javassist-3.11.0.GA.jar<br>log4j-api-2.2.jar<br>log4j-core-2.2.jar<br>ognl-3.0.6.jar<br>struts2-core-2.3.24.jar<br>xwork-core-2.3.24.jar</p>
</li>
<li><p>web.xml 配置  structs2 核心过滤器（很重要）。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:web</span>=<span class="string">"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee </span></span></span><br><span class="line"><span class="tag"><span class="string">                             http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="4">
<li>定义处理用户请求的 Action 类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.action;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在项目目录 src 下，新建一个 structs.xml，书写下面的代码。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定Struts2配置文件的DTD信息 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Struts2配置文件的根元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Struts2的Action必须放在指定的包空间下定义 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"hello"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/*"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义 action，该action对应的类为cn.itcast.action.HelloWorldAction类 </span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"helloWorld"</span> <span class="attr">class</span>=<span class="string">"cn.itcast.action.HelloWorldAction"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 定义处理结果和视图资源之间的映射关系 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li><p>创建访问视图 </p>
<ol>
<li>index.jsp</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">   pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;title&gt;首页&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;h1&gt;Welcome To Struts 2!&lt;/h1&gt;</span><br><span class="line">		&lt;a href=<span class="string">"$&#123;pageContext.request.contextPath &#125;/helloWorld.action"</span>&gt;</span><br><span class="line">   		Hello World</span><br><span class="line">		&lt;/a&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>success.jsp</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;title&gt;成功页面&lt;/title&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		欢迎学习第一个Struts2程序！</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="6">
<li>效果图</li>
</ol>
<p><img src="https://img2018.cnblogs.com/blog/1569987/201903/1569987-20190302183446846-1844507426.gif" alt></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><blockquote>
<p>注意别忘记在 web.xml 里配置 structs2 核心过滤器。</p>
<p>HelloAction 类继承 ActionSupport 要覆写父类的 execute 方法。</p>
<p>execute 方法中返回值 <code>SUCCESS</code> 是常量。</p>
</blockquote>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zwer</p>
  <div class="site-description" itemprop="description">记录学习的日常</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">74</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span>
        
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">tags</span>
        
      </div>
    
  </nav>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zwer</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.4.0</div>

        












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/muse.js?v=7.4.0"></script>
<script src="/js/next-boot.js?v=7.4.0"></script>



  





















  

  

  

</body>
</html>
