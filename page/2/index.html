<!DOCTYPE html>





<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="记录学习的日常">
<meta name="keywords" content="zwer">
<meta property="og:type" content="website">
<meta property="og:title" content="zwer 的博客空间">
<meta property="og:url" content="http://zwer.xyz/page/2/index.html">
<meta property="og:site_name" content="zwer 的博客空间">
<meta property="og:description" content="记录学习的日常">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zwer 的博客空间">
<meta name="twitter:description" content="记录学习的日常">
  <link rel="canonical" href="http://zwer.xyz/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>zwer 的博客空间</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zwer 的博客空间</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">上善若水 自强不息</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <div id="posts" class="posts-expand">
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/06/05/20190605 ActionMQ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/06/05/20190605 ActionMQ/" class="post-title-link" itemprop="url">20190605 ActionMQ</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-06-05 00:00:00" itemprop="dateCreated datePublished" datetime="2019-06-05T00:00:00+08:00">2019-06-05</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-06-10 08:24:48" itemprop="dateModified" datetime="2019-06-10T08:24:48+08:00">2019-06-10</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-ActionMQ"><a href="#1-ActionMQ" class="headerlink" title="1 ActionMQ"></a>1 ActionMQ</h1><p>ActiveMQ 是由 Apache 出品的一款开源消息中间件，旨在为应用程序提供高效、可扩展、稳定、安全的企业级消息通信。 它的设计目标是提供标准的、面向消息的、多语言的应用集成消息通信中间件。ActiveMQ 实现了 JMS 1.1 并提供了很多附加的特性，比如 JMX 管理、主从管理、消息组通信、消息优先级、延迟接收消息、虚拟接收者、消息持久化、消息队列监控等等。</p>
<p>特性：支持 JMS1.1（Java Message Server）和 J2EE 1.4 规范</p>
<h3 id="消息"><a href="#消息" class="headerlink" title="消息"></a>消息</h3><p>计算机之间消息的传递</p>
<h3 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h3><p>FIFO（First in First out）先进先去</p>
<h3 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h3><h3 id="消息服务应用"><a href="#消息服务应用" class="headerlink" title="消息服务应用"></a>消息服务应用</h3><p>ActionMQ</p>
<p>RabbitMQ</p>
<p>RocketMQ </p>
<h1 id="2-消息服务的应用场景"><a href="#2-消息服务的应用场景" class="headerlink" title="2  消息服务的应用场景"></a>2  消息服务的应用场景</h1><h3 id="异步处理"><a href="#异步处理" class="headerlink" title="异步处理"></a>异步处理</h3><p>用户注册</p>
<h3 id="应用的解耦"><a href="#应用的解耦" class="headerlink" title="应用的解耦"></a>应用的解耦</h3><p>订单处理</p>
<h3 id="流量的顶峰"><a href="#流量的顶峰" class="headerlink" title="流量的顶峰"></a>流量的顶峰</h3><p>秒杀功能</p>
<h1 id="3-JMS"><a href="#3-JMS" class="headerlink" title="3 JMS"></a>3 JMS</h1><p>Java Messaging Service </p>
<h2 id="JMS-模型"><a href="#JMS-模型" class="headerlink" title="JMS 模型"></a>JMS 模型</h2><h3 id="点对点模型"><a href="#点对点模型" class="headerlink" title="点对点模型"></a>点对点模型</h3><p>消息的发送方只发送给一个消息的接收方</p>
<h3 id="发布订阅模型"><a href="#发布订阅模型" class="headerlink" title="发布订阅模型"></a>发布订阅模型</h3><p>消息的发布方往消息中间件发布信息，只有订阅该消息的消息订阅方</p>
<p>才可以接受到消息</p>
<h1 id="4-安装-ActiveMQ"><a href="#4-安装-ActiveMQ" class="headerlink" title="4 安装 ActiveMQ"></a>4 安装 ActiveMQ</h1><h3 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h3><p>ActionMQ 5.10.x 以上版本必须使用 JDK1.8 以上</p>
<p>ActionMQ 5.10.x 以下版本使用 JDK1.7即可。</p>
<h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><ul>
<li><p>上传 Linux 服务器</p>
</li>
<li><p>解压该压缩包</p>
</li>
<li><p>复制应用到本地目录</p>
</li>
<li><p>启动 AcitonMQ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./bin/actionmq start</span><br><span class="line"></span><br><span class="line">./bin/actionmy restart</span><br><span class="line"></span><br><span class="line">./bin/actionmy stop</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="管理界面"><a href="#管理界面" class="headerlink" title="管理界面"></a>管理界面</h3><p><a href="http://ip:8161/admin" target="_blank" rel="noopener">http://ip:8161/admin</a></p>
<p>用户名：admin</p>
<p>密码：admin</p>
<p><img src="http://img.zwer.xyz/blog/20190605134112.png" alt></p>
<h4 id="修改访问端口"><a href="#修改访问端口" class="headerlink" title="修改访问端口"></a>修改访问端口</h4><p>actionmq/conf/jetty.xml</p>
<h4 id="修改用户名密码"><a href="#修改用户名密码" class="headerlink" title="修改用户名密码"></a>修改用户名密码</h4><p>users.properties</p>
<h3 id="配置Actionmq-xml"><a href="#配置Actionmq-xml" class="headerlink" title="配置Actionmq.xml"></a>配置Actionmq.xml</h3><p>该配置文件是 ActionMQ 的核心配置信息，是提供服务时使用的配置。</p>
<p>可以修改启动的访问端口。即 java 编程中访问 ActionMQ 的访问端口</p>
<p>默认端口为： 61616</p>
<p>使用协议：tcp协议</p>
<p>修改端口后，保存并重启 ActionMQ 服务即可</p>
<h1 id="5-ActionMQ-目录介绍"><a href="#5-ActionMQ-目录介绍" class="headerlink" title="5 ActionMQ 目录介绍"></a>5 ActionMQ 目录介绍</h1><table>
<thead>
<tr>
<th>目录名称</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>bin</td>
<td>ActionMQ的启动、重启、关闭</td>
</tr>
<tr>
<td>conf</td>
<td>基本配置文件</td>
</tr>
<tr>
<td>data</td>
<td>查看日志</td>
</tr>
<tr>
<td>docs</td>
<td>说明文档</td>
</tr>
<tr>
<td>examples</td>
<td>简单的实例</td>
</tr>
<tr>
<td>lib</td>
<td>存放的是 ActionMQ 所需 jar 包</td>
</tr>
<tr>
<td>webapps</td>
<td>存放项目的目录</td>
</tr>
</tbody></table>
<h1 id="6-ActionMQ-术语"><a href="#6-ActionMQ-术语" class="headerlink" title="6 ActionMQ 术语"></a>6 ActionMQ 术语</h1><table>
<thead>
<tr>
<th>术语</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>Destination</td>
<td>目的地（消息中间件）</td>
</tr>
<tr>
<td>Producer</td>
<td>消费生产者</td>
</tr>
<tr>
<td>Consumer|Receiver</td>
<td>消息消费者</td>
</tr>
<tr>
<td>Message</td>
<td>消息</td>
</tr>
</tbody></table>
<h1 id="7-ActionMQ-常用-API"><a href="#7-ActionMQ-常用-API" class="headerlink" title="7 ActionMQ 常用 API"></a>7 ActionMQ 常用 API</h1><table>
<thead>
<tr>
<th>接口名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>ConnectionFacotry</td>
<td>链接工厂</td>
</tr>
<tr>
<td>Connection</td>
<td>链接</td>
</tr>
<tr>
<td>Destination</td>
<td>目的地</td>
</tr>
<tr>
<td>Session</td>
<td>会话</td>
</tr>
<tr>
<td>MessageConsumer</td>
<td>消息消费者</td>
</tr>
<tr>
<td>MessageProducer</td>
<td>消息提供者</td>
</tr>
<tr>
<td>Message</td>
<td>消息的顶级接口</td>
</tr>
</tbody></table>
<h2 id="7-2-使用"><a href="#7-2-使用" class="headerlink" title="7.2 使用"></a>7.2 使用</h2><p>生产者发送文本、对象消息</p>
<p>消费者接受文本、对象消息</p>
<h4 id="HelloWorldActionMQProducer-java"><a href="#HelloWorldActionMQProducer-java" class="headerlink" title="HelloWorldActionMQProducer.java"></a>HelloWorldActionMQProducer.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.producer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jms.Connection;</span><br><span class="line"><span class="keyword">import</span> javax.jms.ConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Destination;</span><br><span class="line"><span class="keyword">import</span> javax.jms.JMSException;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Message;</span><br><span class="line"><span class="keyword">import</span> javax.jms.MessageProducer;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Session;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQMessageProducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.command.ActiveMQDestination;</span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.command.ActiveMQQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.Users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldActionMQProducer</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送文本消息</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> megTest</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">(String msgTest)</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建链接工厂</span></span><br><span class="line">		ConnectionFactory connectionFactory = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//创建链接</span></span><br><span class="line">		Connection connection = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//创建目的地</span></span><br><span class="line">		Destination destination = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//创建会话</span></span><br><span class="line">		Session session = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//创建消息生产者</span></span><br><span class="line">		MessageProducer messageProducer = <span class="keyword">null</span>; </span><br><span class="line">		<span class="comment">//创建消息</span></span><br><span class="line">		Message message = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//创建链接工厂</span></span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 *   userName :链接 ActionMQ 服务的用户名</span></span><br><span class="line"><span class="comment">			 *   password ：链接 ActionMQ 服务的密码 </span></span><br><span class="line"><span class="comment">			 *   			//在 conf/jetty-realm.properties 可以修改默认的用户名和密码</span></span><br><span class="line"><span class="comment">			 *   brokerURL :链接ActionMQ的位置 协议://主机名:port</span></span><br><span class="line"><span class="comment">			 *   </span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			String userName = <span class="string">"admin"</span>;</span><br><span class="line">			String password = <span class="string">"admin"</span>;</span><br><span class="line">			String brokerURL = <span class="string">"tcp://192.168.170.4:61616"</span>;</span><br><span class="line">			connectionFactory = <span class="keyword">new</span>  ActiveMQConnectionFactory(userName, password, brokerURL);</span><br><span class="line">			<span class="comment">//创建链接对象</span></span><br><span class="line">			connection = connectionFactory.createConnection();</span><br><span class="line">			<span class="comment">//开启链接,一定要开启链接</span></span><br><span class="line">			connection.start();</span><br><span class="line">			<span class="comment">//创建 session 对象</span></span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 *  transacted:是否开启事务，true表示开启，false 表示不开启</span></span><br><span class="line"><span class="comment">			 *  		   当为 true 时，则 acknowMode 选择  AUTO_ACKNOWLEDGE</span></span><br><span class="line"><span class="comment">			 *  acknowledgeMode:确认模型</span></span><br><span class="line"><span class="comment">			 *  		  AUTO_ACKNOWLEDGE   自动确认模式</span></span><br><span class="line"><span class="comment">			 *			  CLIENT_ACKNOWLEDGE 客户端确认模式</span></span><br><span class="line"><span class="comment">			 *			  DUPS_OK_ACKNOWLEDGE 第三方脚本确认模式</span></span><br><span class="line"><span class="comment">			 *			  SESSION_TRANSACTED  事务确认模式</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">			<span class="comment">//创建消息中间件</span></span><br><span class="line">			destination = session.createQueue(<span class="string">"HelloWorld-destination"</span>);</span><br><span class="line">			<span class="comment">//创建消息生产者</span></span><br><span class="line">			messageProducer = session.createProducer(destination);</span><br><span class="line">			<span class="comment">//创建消息</span></span><br><span class="line">			message = session.createTextMessage(msgTest);</span><br><span class="line">			<span class="comment">//发送消息</span></span><br><span class="line">			messageProducer.send(message);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(messageProducer !=<span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					messageProducer.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(session != <span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					session.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(connection != <span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					connection.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送对象消息</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> msgTest</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">(Users user)</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建链接工厂</span></span><br><span class="line">		ConnectionFactory connectionFactory = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//创建链接</span></span><br><span class="line">		Connection connection = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//创建目的地</span></span><br><span class="line">		Destination destination = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//创建会话</span></span><br><span class="line">		Session session = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//创建消息生产者</span></span><br><span class="line">		MessageProducer messageProducer = <span class="keyword">null</span>; </span><br><span class="line">		<span class="comment">//创建消息</span></span><br><span class="line">		Message message = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//创建链接工厂</span></span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 *   userName :链接 ActionMQ 服务的用户名</span></span><br><span class="line"><span class="comment">			 *   password ：链接 ActionMQ 服务的密码 </span></span><br><span class="line"><span class="comment">			 *   			//在 conf/jetty-realm.properties 可以修改默认的用户名和密码</span></span><br><span class="line"><span class="comment">			 *   brokerURL :链接ActionMQ的位置 协议://主机名:port</span></span><br><span class="line"><span class="comment">			 *   </span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			String userName = <span class="string">"admin"</span>;</span><br><span class="line">			String password = <span class="string">"admin"</span>;</span><br><span class="line">			String brokerURL = <span class="string">"tcp://192.168.170.4:61616"</span>;</span><br><span class="line">			connectionFactory = <span class="keyword">new</span>  ActiveMQConnectionFactory(userName, password, brokerURL);</span><br><span class="line">			<span class="comment">//创建链接对象</span></span><br><span class="line">			connection = connectionFactory.createConnection();</span><br><span class="line">			<span class="comment">//开启链接,一定要开启链接</span></span><br><span class="line">			connection.start();</span><br><span class="line">			<span class="comment">//创建 session 对象</span></span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 *  transacted:是否开启事务，true表示开启，false 表示不开启</span></span><br><span class="line"><span class="comment">			 *  		   当为 true 时，则 acknowMode 选择  AUTO_ACKNOWLEDGE</span></span><br><span class="line"><span class="comment">			 *  acknowledgeMode:确认模型</span></span><br><span class="line"><span class="comment">			 *  		  AUTO_ACKNOWLEDGE   自动确认模式</span></span><br><span class="line"><span class="comment">			 *			  CLIENT_ACKNOWLEDGE 客户端确认模式</span></span><br><span class="line"><span class="comment">			 *			  DUPS_OK_ACKNOWLEDGE 第三方脚本确认模式</span></span><br><span class="line"><span class="comment">			 *			  SESSION_TRANSACTED  事务确认模式</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">			<span class="comment">//创建消息中间件</span></span><br><span class="line">			destination = session.createQueue(<span class="string">"user-queue"</span>);</span><br><span class="line">			<span class="comment">//创建消息生产者</span></span><br><span class="line">			messageProducer = session.createProducer(destination);</span><br><span class="line">			<span class="comment">//创建对象消息</span></span><br><span class="line">			message = session.createObjectMessage(user);</span><br><span class="line">			<span class="comment">//发送消息</span></span><br><span class="line">			messageProducer.send(message);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(messageProducer !=<span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					messageProducer.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(session != <span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					session.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(connection != <span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					connection.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="HelloWorldActionMQConsumer-java"><a href="#HelloWorldActionMQConsumer-java" class="headerlink" title="HelloWorldActionMQConsumer.java"></a>HelloWorldActionMQConsumer.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jms.Connection;</span><br><span class="line"><span class="keyword">import</span> javax.jms.ConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Destination;</span><br><span class="line"><span class="keyword">import</span> javax.jms.JMSException;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Message;</span><br><span class="line"><span class="keyword">import</span> javax.jms.MessageConsumer;</span><br><span class="line"><span class="keyword">import</span> javax.jms.ObjectMessage;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Session;</span><br><span class="line"><span class="keyword">import</span> javax.jms.TextMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.Users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldActionMQconsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送文本消息</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> megTest</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 创建链接工厂</span></span><br><span class="line">		ConnectionFactory connectionFactory = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建链接</span></span><br><span class="line">		Connection connection = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建目的地</span></span><br><span class="line">		Destination destination = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建会话</span></span><br><span class="line">		Session session = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建消息消费者</span></span><br><span class="line">		MessageConsumer messageConsumer = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建消息</span></span><br><span class="line">		Message message = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 创建链接工厂</span></span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * userName :链接 ActionMQ 服务的用户名 password ：链接 ActionMQ 服务的密码</span></span><br><span class="line"><span class="comment">			 *           在 conf/jetty-realm.properties 可以修改默认的用户名和密码 brokerURL</span></span><br><span class="line"><span class="comment">			 * :链接ActionMQ的位置 协议://主机名:port</span></span><br><span class="line"><span class="comment">			 * </span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			String userName = <span class="string">"admin"</span>;</span><br><span class="line">			String password = <span class="string">"admin"</span>;</span><br><span class="line">			String brokerURL = <span class="string">"tcp://192.168.170.4:61616"</span>;</span><br><span class="line">			connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(userName, password, brokerURL);</span><br><span class="line">			<span class="comment">// 创建链接对象</span></span><br><span class="line">			connection = connectionFactory.createConnection();</span><br><span class="line">			<span class="comment">// 开始链接</span></span><br><span class="line">			connection.start();</span><br><span class="line">			<span class="comment">// 创建 session 对象</span></span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * transacted:是否开启事务，true表示开启，false 表示不开启 当为 true 时，则 acknowMode 选择</span></span><br><span class="line"><span class="comment">			 * AUTO_ACKNOWLEDGE acknowledgeMode:确认模型 AUTO_ACKNOWLEDGE 自动确认模式</span></span><br><span class="line"><span class="comment">			 * CLIENT_ACKNOWLEDGE 客户端确认模式 DUPS_OK_ACKNOWLEDGE 第三方脚本确认模式</span></span><br><span class="line"><span class="comment">			 * SESSION_TRANSACTED 事务确认模式</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">			<span class="comment">// 创建消息中间件</span></span><br><span class="line">			destination = session.createQueue(<span class="string">"HelloWorld-destination"</span>);</span><br><span class="line">			<span class="comment">// 创建消息消费者</span></span><br><span class="line">			messageConsumer = session.createConsumer(destination);</span><br><span class="line">			<span class="comment">// 接受消息</span></span><br><span class="line">			message = messageConsumer.receive();</span><br><span class="line">			<span class="comment">// 转化消息类型,获取文本消息</span></span><br><span class="line">			String msg = ((TextMessage) message).getText();</span><br><span class="line">			<span class="comment">// 打印消息</span></span><br><span class="line">			System.out.println(<span class="string">"mgs:"</span> + msg);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (messageConsumer != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					messageConsumer.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					session.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (connection != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					connection.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *  接受 object 消息</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readObjectMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 创建链接工厂</span></span><br><span class="line">		ConnectionFactory connectionFactory = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建链接</span></span><br><span class="line">		Connection connection = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建目的地</span></span><br><span class="line">		Destination destination = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建会话</span></span><br><span class="line">		Session session = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建消息消费者</span></span><br><span class="line">		MessageConsumer messageConsumer = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建消息</span></span><br><span class="line">		Message message = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 创建链接工厂</span></span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * userName :链接 ActionMQ 服务的用户名 password ：链接 ActionMQ 服务的密码</span></span><br><span class="line"><span class="comment">			 *           在 conf/jetty-realm.properties 可以修改默认的用户名和密码 brokerURL</span></span><br><span class="line"><span class="comment">			 * :链接ActionMQ的位置 协议://主机名:port</span></span><br><span class="line"><span class="comment">			 * </span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			String userName = <span class="string">"admin"</span>;</span><br><span class="line">			String password = <span class="string">"admin"</span>;</span><br><span class="line">			String brokerURL = <span class="string">"tcp://192.168.170.4:61616"</span>;</span><br><span class="line">			connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(userName, password, brokerURL);</span><br><span class="line">			<span class="comment">// 创建链接对象</span></span><br><span class="line">			connection = connectionFactory.createConnection();</span><br><span class="line">			<span class="comment">// 开始链接</span></span><br><span class="line">			connection.start();</span><br><span class="line">			<span class="comment">// 创建 session 对象</span></span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * transacted:是否开启事务，true表示开启，false 表示不开启 当为 true 时，则 acknowMode 选择</span></span><br><span class="line"><span class="comment">			 * AUTO_ACKNOWLEDGE acknowledgeMode:确认模型 AUTO_ACKNOWLEDGE 自动确认模式</span></span><br><span class="line"><span class="comment">			 * CLIENT_ACKNOWLEDGE 客户端确认模式 DUPS_OK_ACKNOWLEDGE 第三方脚本确认模式</span></span><br><span class="line"><span class="comment">			 * SESSION_TRANSACTED 事务确认模式</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">			<span class="comment">// 创建消息中间件</span></span><br><span class="line">			destination = session.createQueue(<span class="string">"user-queue"</span>);</span><br><span class="line">			<span class="comment">// 创建消息消费者</span></span><br><span class="line">			messageConsumer = session.createConsumer(destination);</span><br><span class="line">			<span class="comment">// 接受消息</span></span><br><span class="line">			message = messageConsumer.receive();</span><br><span class="line">			<span class="comment">// 转化消息类型,获取文本消息</span></span><br><span class="line">			Users user = (Users) ((ObjectMessage) message).getObject();</span><br><span class="line">			<span class="comment">// 打印消息</span></span><br><span class="line">			System.out.println(<span class="string">"mgs:"</span> + user);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (messageConsumer != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					messageConsumer.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					session.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (connection != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					connection.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="TestProducer-java"><a href="#TestProducer-java" class="headerlink" title="TestProducer.java"></a>TestProducer.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.mqTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.Users;</span><br><span class="line"><span class="keyword">import</span> com.szxy.producer.HelloWorldActionMQProducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MQProducerTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		HelloWorldActionMQProducer producer = <span class="keyword">new</span> HelloWorldActionMQProducer();</span><br><span class="line">		<span class="comment">//发送文本消息</span></span><br><span class="line">		<span class="comment">/*producer.sendMsg("Hello ActionMQ");*/</span></span><br><span class="line">		<span class="comment">//发送对象消息</span></span><br><span class="line">		Users user = <span class="keyword">new</span> Users();</span><br><span class="line">		user.setUserid(<span class="number">1001</span>);</span><br><span class="line">		user.setUsername(<span class="string">"zwz"</span>);</span><br><span class="line">		user.setUserage(<span class="number">21</span>);</span><br><span class="line">		producer.sendMsg(user);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="TestConsumer-java"><a href="#TestConsumer-java" class="headerlink" title="TestConsumer.java"></a>TestConsumer.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.mqTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.HelloWorldActionMQconsumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MQConsumerTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		HelloWorldActionMQconsumer consumer = <span class="keyword">new</span> HelloWorldActionMQconsumer();</span><br><span class="line">		<span class="comment">//发送文本消息</span></span><br><span class="line">		<span class="comment">/*consumer.readMsg();*/</span></span><br><span class="line">		<span class="comment">//发送对象消息</span></span><br><span class="line">		consumer.readObjectMsg();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：使用 Connection 对象时，一定要开启 start 方法。</p>
<p><img src="http://img.zwer.xyz/blog/20190605194257.png" alt></p>
<h2 id="7-3-JMS-消息队列服务监听"><a href="#7-3-JMS-消息队列服务监听" class="headerlink" title="7.3  JMS -消息队列服务监听"></a>7.3  JMS -消息队列服务监听</h2><p>消息队列服务监听使用了<strong>观察者模式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *  队列消息监听</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readTxtMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建链接工厂</span></span><br><span class="line">    ConnectionFactory connectionFactory = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 创建链接</span></span><br><span class="line">    Connection connection = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 创建目的地</span></span><br><span class="line">    Destination destination = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 创建会话</span></span><br><span class="line">    Session session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 创建消息消费者</span></span><br><span class="line">    MessageConsumer messageConsumer = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 创建消息</span></span><br><span class="line">    Message message = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 创建链接工厂</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * userName :链接 ActionMQ 服务的用户名 password ：链接 ActionMQ 服务的密码</span></span><br><span class="line"><span class="comment">			 *           在 conf/jetty-realm.properties 可以修改默认的用户名和密码 brokerURL</span></span><br><span class="line"><span class="comment">			 * :链接ActionMQ的位置 协议://主机名:port</span></span><br><span class="line"><span class="comment">			 * </span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">        String userName = <span class="string">"admin"</span>;</span><br><span class="line">        String password = <span class="string">"admin"</span>;</span><br><span class="line">        String brokerURL = <span class="string">"tcp://192.168.170.4:61616"</span>;</span><br><span class="line">        connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(userName, password, brokerURL);</span><br><span class="line">        <span class="comment">// 创建链接对象</span></span><br><span class="line">        connection = connectionFactory.createConnection();</span><br><span class="line">        <span class="comment">// 开始链接</span></span><br><span class="line">        connection.start();</span><br><span class="line">        <span class="comment">// 创建 session 对象</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * transacted:是否开启事务，true表示开启，false 表示不开启 当为 true 时，则 acknowMode 选择</span></span><br><span class="line"><span class="comment">			 * AUTO_ACKNOWLEDGE acknowledgeMode:确认模型 AUTO_ACKNOWLEDGE 自动确认模式</span></span><br><span class="line"><span class="comment">			 * CLIENT_ACKNOWLEDGE 客户端确认模式 DUPS_OK_ACKNOWLEDGE 第三方脚本确认模式</span></span><br><span class="line"><span class="comment">			 * SESSION_TRANSACTED 事务确认模式</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">        session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">        <span class="comment">// 创建消息中间件</span></span><br><span class="line">        destination = session.createQueue(<span class="string">"listener"</span>);</span><br><span class="line">        <span class="comment">// 创建消息消费者</span></span><br><span class="line">        messageConsumer = session.createConsumer(destination);</span><br><span class="line">        <span class="comment">// 接受消息</span></span><br><span class="line">        <span class="comment">//message = messageConsumer.receive();</span></span><br><span class="line">        messageConsumer.setMessageListener(<span class="keyword">new</span> MessageListener() &#123;</span><br><span class="line">            String msg = <span class="keyword">null</span>;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 转化消息类型,获取文本消息</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    msg = ((TextMessage) message).getText();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 打印消息</span></span><br><span class="line">                System.out.println(<span class="string">"mgs:"</span> + msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">//使用 JMS 队列服务监听不需要关闭资源</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="8-Topic-模型"><a href="#8-Topic-模型" class="headerlink" title="8 Topic 模型"></a>8 Topic 模型</h1><p>Pushlied/Subcribe  发布订阅模型，发布到 topic 的消息会被<strong>所有订阅者消费</strong></p>
<p>注意：当生产者发布消息，不管是否有消费者，都不会保存消息</p>
<p><strong>一定先有消息的消费者，后有消息的生产者</strong></p>
<h3 id="消息生产者"><a href="#消息生产者" class="headerlink" title="消息生产者"></a>消息生产者</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.producer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jms.Connection;</span><br><span class="line"><span class="keyword">import</span> javax.jms.ConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Destination;</span><br><span class="line"><span class="keyword">import</span> javax.jms.JMSException;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Message;</span><br><span class="line"><span class="keyword">import</span> javax.jms.MessageProducer;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Session;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionMQProducerTopic</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送文本消息</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> megTest</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">(String msgTest)</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建链接工厂</span></span><br><span class="line">		ConnectionFactory connectionFactory = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//创建链接</span></span><br><span class="line">		Connection connection = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//创建目的地</span></span><br><span class="line">		Destination destination = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//创建会话</span></span><br><span class="line">		Session session = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//创建消息生产者</span></span><br><span class="line">		MessageProducer messageProducer = <span class="keyword">null</span>; </span><br><span class="line">		<span class="comment">//创建消息</span></span><br><span class="line">		Message message = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//创建链接工厂</span></span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 *   userName :链接 ActionMQ 服务的用户名</span></span><br><span class="line"><span class="comment">			 *   password ：链接 ActionMQ 服务的密码 </span></span><br><span class="line"><span class="comment">			 *   			//在 conf/jetty-realm.properties 可以修改默认的用户名和密码</span></span><br><span class="line"><span class="comment">			 *   brokerURL :链接ActionMQ的位置 协议://主机名:port</span></span><br><span class="line"><span class="comment">			 *   </span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			String userName = <span class="string">"admin"</span>;</span><br><span class="line">			String password = <span class="string">"admin"</span>;</span><br><span class="line">			String brokerURL = <span class="string">"tcp://192.168.170.4:61616"</span>;</span><br><span class="line">			connectionFactory = <span class="keyword">new</span>  ActiveMQConnectionFactory(userName, password, brokerURL);</span><br><span class="line">			<span class="comment">//创建链接对象</span></span><br><span class="line">			connection = connectionFactory.createConnection();</span><br><span class="line">			<span class="comment">//开启链接,一定要开启链接</span></span><br><span class="line">			connection.start();</span><br><span class="line">			<span class="comment">//创建 session 对象</span></span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 *  transacted:是否开启事务，true表示开启，false 表示不开启</span></span><br><span class="line"><span class="comment">			 *  		   当为 true 时，则 acknowMode 选择  AUTO_ACKNOWLEDGE</span></span><br><span class="line"><span class="comment">			 *  acknowledgeMode:确认模型</span></span><br><span class="line"><span class="comment">			 *  		  AUTO_ACKNOWLEDGE   自动确认模式</span></span><br><span class="line"><span class="comment">			 *			  CLIENT_ACKNOWLEDGE 客户端确认模式</span></span><br><span class="line"><span class="comment">			 *			  DUPS_OK_ACKNOWLEDGE 第三方脚本确认模式</span></span><br><span class="line"><span class="comment">			 *			  SESSION_TRANSACTED  事务确认模式</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">			<span class="comment">//创建消息中间件</span></span><br><span class="line">			<span class="comment">//采用 topic 发布订阅模型</span></span><br><span class="line">			destination = session.createTopic(<span class="string">"mytopic"</span>);</span><br><span class="line">			messageProducer = session.createProducer(destination);</span><br><span class="line">			<span class="comment">//创建消息</span></span><br><span class="line">			message = session.createTextMessage(msgTest);</span><br><span class="line">			<span class="comment">//发送消息</span></span><br><span class="line">			messageProducer.send(message);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(messageProducer !=<span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					messageProducer.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(session != <span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					session.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(connection != <span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					connection.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="消息订阅者"><a href="#消息订阅者" class="headerlink" title="消息订阅者"></a>消息订阅者</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jms.Connection;</span><br><span class="line"><span class="keyword">import</span> javax.jms.ConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Destination;</span><br><span class="line"><span class="keyword">import</span> javax.jms.JMSException;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Message;</span><br><span class="line"><span class="keyword">import</span> javax.jms.MessageConsumer;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Session;</span><br><span class="line"><span class="keyword">import</span> javax.jms.TextMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionMQConsumerTopic</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送消息</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> megTest</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 创建链接工厂</span></span><br><span class="line">		ConnectionFactory connectionFactory = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建链接</span></span><br><span class="line">		Connection connection = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建目的地</span></span><br><span class="line">		Destination destination = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建会话</span></span><br><span class="line">		Session session = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建消息消费者</span></span><br><span class="line">		MessageConsumer messageConsumer = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 创建消息</span></span><br><span class="line">		Message message = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 创建链接工厂</span></span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * userName :链接 ActionMQ 服务的用户名 password ：链接 ActionMQ 服务的密码</span></span><br><span class="line"><span class="comment">			 *           在 conf/jetty-realm.properties 可以修改默认的用户名和密码 brokerURL</span></span><br><span class="line"><span class="comment">			 * :链接ActionMQ的位置 协议://主机名:port</span></span><br><span class="line"><span class="comment">			 * </span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			String userName = <span class="string">"admin"</span>;</span><br><span class="line">			String password = <span class="string">"admin"</span>;</span><br><span class="line">			String brokerURL = <span class="string">"tcp://192.168.170.4:61616"</span>;</span><br><span class="line">			connectionFactory = <span class="keyword">new</span> ActiveMQConnectionFactory(userName, password, brokerURL);</span><br><span class="line">			<span class="comment">// 创建链接对象</span></span><br><span class="line">			connection = connectionFactory.createConnection();</span><br><span class="line">			<span class="comment">// 开始链接</span></span><br><span class="line">			connection.start();</span><br><span class="line">			<span class="comment">// 创建 session 对象</span></span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * transacted:是否开启事务，true表示开启，false 表示不开启 当为 true 时，则 acknowMode 选择</span></span><br><span class="line"><span class="comment">			 * AUTO_ACKNOWLEDGE acknowledgeMode:确认模型 AUTO_ACKNOWLEDGE 自动确认模式</span></span><br><span class="line"><span class="comment">			 * CLIENT_ACKNOWLEDGE 客户端确认模式 DUPS_OK_ACKNOWLEDGE 第三方脚本确认模式</span></span><br><span class="line"><span class="comment">			 * SESSION_TRANSACTED 事务确认模式</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			session = connection.createSession(<span class="keyword">false</span>, Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">			<span class="comment">// 创建消息中间件---topic 主题</span></span><br><span class="line">			destination = session.createTopic(<span class="string">"mytopic"</span>);</span><br><span class="line">			<span class="comment">// 创建消息消费者</span></span><br><span class="line">			messageConsumer = session.createConsumer(destination);</span><br><span class="line">			<span class="comment">// 接受消息</span></span><br><span class="line">			message = messageConsumer.receive();</span><br><span class="line">			<span class="comment">// 转化消息类型,获取文本消息</span></span><br><span class="line">			String msg = ((TextMessage) message).getText();</span><br><span class="line">			<span class="comment">// 打印消息</span></span><br><span class="line">			System.out.println(<span class="string">"mgs 1:"</span> + msg);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (messageConsumer != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					messageConsumer.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					session.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (connection != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					connection.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.readMsg();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="9-Spring-整合ActionMQ"><a href="#9-Spring-整合ActionMQ" class="headerlink" title="9  Spring 整合ActionMQ"></a>9  Spring 整合ActionMQ</h1><p>项目架构：Spring+SpringMVC+ActionMQ </p>
<p>需求：</p>
<p>实现添加用户功能</p>
<p>在页面上填写用户信息，将信息传递到后端消息提供者，调用业务层，发送消息到消息中间件。</p>
<p>在消息消费者监听消息队列，一旦目的地（消息中间件）有消息产生，就将消息取出来，打印在控制台</p>
<h3 id="消息提供者"><a href="#消息提供者" class="headerlink" title="消息提供者"></a>消息提供者</h3><h4 id="parent-项目的-pom-xml"><a href="#parent-项目的-pom-xml" class="headerlink" title="parent 项目的 pom.xml"></a>parent 项目的 pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.szxy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 对依赖的jar包的版本统一进行定义 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">activemq.version</span>&gt;</span>5.9.0<span class="tag">&lt;/<span class="name">activemq.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">xbean.version</span>&gt;</span>4.5<span class="tag">&lt;/<span class="name">xbean.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">jms.version</span>&gt;</span>4.1.6.RELEASE<span class="tag">&lt;/<span class="name">jms.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">activemq-pool.version</span>&gt;</span>5.9.0<span class="tag">&lt;/<span class="name">activemq-pool.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">solrj.version</span>&gt;</span>4.10.3<span class="tag">&lt;/<span class="name">solrj.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">jedis.version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">jedis.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.1.3.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>3.2.8<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mybatis.spring.version</span>&gt;</span>1.2.2<span class="tag">&lt;/<span class="name">mybatis.spring.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.32<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.6.4<span class="tag">&lt;/<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.0.9<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">jstl.version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">jstl.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-api.version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">servlet-api.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tomcat.version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">tomcat.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">jsp-api.version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">jsp-api.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">zkClient-version</span>&gt;</span>0.10<span class="tag">&lt;/<span class="name">zkClient-version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dubbo-version</span>&gt;</span>2.5.4<span class="tag">&lt;/<span class="name">dubbo-version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">jackson.version</span>&gt;</span>2.4.2<span class="tag">&lt;/<span class="name">jackson.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">commons-net.version</span>&gt;</span>3.3<span class="tag">&lt;/<span class="name">commons-net.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">commons-fileupload.version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">commons-fileupload.version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- jar包的依赖注入 ，由于该工程是一个父工程，所以jar包在该pom文件中只是声明 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- ActiveMQ客户端完整jar包依赖 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activemq.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- ActiveMQ和Spring整合配置文件标签处理jar包依赖 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.xbean<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xbean-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;xbean.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- Spring-JMS插件相关jar包依赖 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jms.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- Spring-JMS插件相关jar包依赖 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-pool<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activemq-pool.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-jms-pool<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activemq-pool.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.solr<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>solr-solrj<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;solrj.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jedis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 单元测试 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 日志处理 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- Mybatis --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- MySql --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 连接池 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- Spring --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- JSP相关 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jstl.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;servlet-api.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jsp-api.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 文件上传组件 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-fileupload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			</span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-net<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-net<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-net.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">&lt;!-- Jackson Json处理工具包 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- tomcat插件，由于子项目不一定每个都是web项目，所以该插件只是声明，并未开启 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 配置Tomcat插件 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;tomcat.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="applicationContext-jms-xml"><a href="#applicationContext-jms-xml" class="headerlink" title="applicationContext-jms.xml"></a>applicationContext-jms.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:jms</span>=<span class="string">"http://www.springframework.org/schema/jms"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:amq</span>=<span class="string">"http://activemq.apache.org/schema/core"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/jms</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/jms/spring-jms.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://activemq.apache.org/schema/core</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://activemq.apache.org/schema/core/activemq-core.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 需要创建一个连接工厂,连接ActiveMQ. ActiveMQConnectionFactory. 需要依赖ActiveMQ提供的amq标签 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- amq:connectionFactory 是bean标签的子标签, 会在spring容器中创建一个bean对象. 可以为对象命名. </span></span><br><span class="line"><span class="comment">		类似: &lt;bean id="" class="ActiveMQConnectionFactory"&gt;&lt;/bean&gt; --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">amq:connectionFactory</span> <span class="attr">brokerURL</span>=<span class="string">"tcp://192.168.170.4:61616"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">userName</span>=<span class="string">"admin"</span> <span class="attr">password</span>=<span class="string">"admin"</span> <span class="attr">id</span>=<span class="string">"amqConnectionFactory"</span> /&gt;</span></span><br><span class="line">		</span><br><span class="line">	<span class="comment">&lt;!-- 配置池化的ConnectionFactory。 为连接 ActiveMQ 的 connectionFactory 提供连接池 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"pooledConnectionFactory"</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.pool.PooledConnectionFactoryBean"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"amqConnectionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxConnections"</span> <span class="attr">value</span>=<span class="string">"10"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- spring管理JMS相关代码的时候,必须依赖jms标签库. spring-jms提供的标签库. --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 定义Spring-JMS中的连接工厂对象 CachingConnectionFactory - spring框架提供的连接工厂对象. </span></span><br><span class="line"><span class="comment">		不能真正的访问MOM容器. 类似一个工厂的代理对象. 需要提供一个真实工厂,实现MOM容器的连接访问. --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置有缓存的ConnectionFactory，session的缓存大小可定制。 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"connectionFactory"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">"org.springframework.jms.connection.CachingConnectionFactory"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetConnectionFactory"</span> <span class="attr">ref</span>=<span class="string">"amqConnectionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionCacheSize"</span> <span class="attr">value</span>=<span class="string">"3"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- JmsTemplate配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"template"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.core.JmsTemplate"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 给定连接工厂, 必须是spring创建的连接工厂. --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 可选 - 默认目的地命名 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultDestinationName"</span> <span class="attr">value</span>=<span class="string">"test-spring"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="applicationContext-service-xml"><a href="#applicationContext-service-xml" class="headerlink" title="applicationContext-service.xml"></a>applicationContext-service.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:resource.properties"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 扫描bean对象 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.service"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="springmvc-xml"><a href="#springmvc-xml" class="headerlink" title="springmvc.xml"></a>springmvc.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 包的扫描器主要是扫描@controller --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.web.controller"</span>/&gt;</span>  </span><br><span class="line"></span><br><span class="line">	   <span class="comment">&lt;!-- 注册两个新对象 主要是为了来处理springmvc中的其他anntation 如：@requestmapping --&gt;</span>	</span><br><span class="line">	   <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">	   </span><br><span class="line">	   <span class="comment">&lt;!-- 视图解析器 --&gt;</span></span><br><span class="line">	   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span> /&gt;</span><span class="comment">&lt;!-- jsp所在的前缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置静态资源映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/css/"</span> <span class="attr">mapping</span>=<span class="string">"/css/**"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/js/"</span> <span class="attr">mapping</span>=<span class="string">"/js/**"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 上下文参数,告诉Spring配置文件路径 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext-*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 配置springmvc --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="消息消费者"><a href="#消息消费者" class="headerlink" title="消息消费者"></a>消息消费者</h3><h4 id="applicationContext-jms-xml-1"><a href="#applicationContext-jms-xml-1" class="headerlink" title="applicationContext-jms.xml"></a>applicationContext-jms.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:jms</span>=<span class="string">"http://www.springframework.org/schema/jms"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:amq</span>=<span class="string">"http://activemq.apache.org/schema/core"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/jms</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/jms/spring-jms.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://activemq.apache.org/schema/core</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://activemq.apache.org/schema/core/activemq-core.xsd"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 需要创建一个连接工厂,连接ActiveMQ. ActiveMQConnectionFactory. 需要依赖ActiveMQ提供的amq标签 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- amq:connectionFactory 是bean标签的子标签, 会在spring容器中创建一个bean对象.</span></span><br><span class="line"><span class="comment">		可以为对象命名. 类似: &lt;bean id="" class="ActiveMQConnectionFactory"&gt;&lt;/bean&gt;</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">amq:connectionFactory</span> <span class="attr">brokerURL</span>=<span class="string">"tcp://192.168.170.4:61616"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">userName</span>=<span class="string">"admin"</span> <span class="attr">password</span>=<span class="string">"admin"</span> <span class="attr">id</span>=<span class="string">"amqConnectionFactory"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- spring管理JMS相关代码的时候,必须依赖jms标签库. spring-jms提供的标签库. --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 定义Spring-JMS中的连接工厂对象</span></span><br><span class="line"><span class="comment">		CachingConnectionFactory - spring框架提供的连接工厂对象. 不能真正的访问MOM容器.</span></span><br><span class="line"><span class="comment">			类似一个工厂的代理对象. 需要提供一个真实工厂,实现MOM容器的连接访问.</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"connectionFactory"</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">"org.springframework.jms.connection.CachingConnectionFactory"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetConnectionFactory"</span> <span class="attr">ref</span>=<span class="string">"amqConnectionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionCacheSize"</span> <span class="attr">value</span>=<span class="string">"3"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 注册监听器 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 开始注册监听. </span></span><br><span class="line"><span class="comment">		需要的参数有:</span></span><br><span class="line"><span class="comment">			acknowledge - 消息确认机制</span></span><br><span class="line"><span class="comment">			container-type - 容器类型 default|simple</span></span><br><span class="line"><span class="comment">			simple:SimpleMessageListenerContainer最简单的消息监听器容器，只能处理固定数量的JMS会话，且不支持事务。</span></span><br><span class="line"><span class="comment">			default:DefaultMessageListenerContainer是一个用于异步消息监听器容器 ，且支持事务         </span></span><br><span class="line"><span class="comment">			destination-type - 目的地类型. 使用队列作为目的地.</span></span><br><span class="line"><span class="comment">			connection-factory - 连接工厂, spring-jms使用的连接工厂,必须是spring自主创建的</span></span><br><span class="line"><span class="comment">			不能使用三方工具创建的工程. 如: ActiveMQConnectionFactory.</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">jms:listener-container</span> <span class="attr">acknowledge</span>=<span class="string">"auto"</span> <span class="attr">container-type</span>=<span class="string">"default"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">destination-type</span>=<span class="string">"queue"</span> <span class="attr">connection-factory</span>=<span class="string">"connectionFactory"</span> &gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 在监听器容器中注册某监听器对象.</span></span><br><span class="line"><span class="comment">			destination - 设置目的地命名</span></span><br><span class="line"><span class="comment">			ref - 指定监听器对象</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">jms:listener</span> <span class="attr">destination</span>=<span class="string">"test-spring"</span> <span class="attr">ref</span>=<span class="string">"myListener"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">jms:listener-container</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="applicationContext-service-xml-1"><a href="#applicationContext-service-xml-1" class="headerlink" title="applicationContext-service.xml"></a>applicationContext-service.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 扫描bean对象 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.service,com.szxy.listener"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="MyListener-java"><a href="#MyListener-java" class="headerlink" title="MyListener.java"></a>MyListener.java</h4><p>消息队列服务监听</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jms.JMSException;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Message;</span><br><span class="line"><span class="keyword">import</span> javax.jms.MessageListener;</span><br><span class="line"><span class="keyword">import</span> javax.jms.ObjectMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jms.core.JmsTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.Users;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  监听消息服务</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span>(value=<span class="string">"myListener"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">implements</span> <span class="title">MessageListener</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> UserService userService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">		Users user = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取对象消息类型的用户信息</span></span><br><span class="line">			user = (Users) ((ObjectMessage)message).getObject();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		userService.showUser(user);	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="MQTes-java"><a href="#MQTes-java" class="headerlink" title="MQTes.java"></a>MQTes.java</h4><table>
<thead>
<tr>
<th>方法名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>public ClassPathXmlApplicationContext(String… configLocations)</td>
<td>一次性加载多个 spring 配置文件。传入的参数是 String 类型的数组</td>
</tr>
<tr>
<td>public void start()</td>
<td>开启 spring 容器</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.mqTest;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MQTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 *  spring 同时加载多个配置文件使用 String 类型的数组</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		ClassPathXmlApplicationContext ac = </span><br><span class="line">		<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="keyword">new</span> String[]&#123;<span class="string">"classpath:applicationContext-jms.xml"</span>,<span class="string">"classpath:applicationContext-service.xml"</span>&#125;);</span><br><span class="line">		<span class="comment">//启动 spring 容器</span></span><br><span class="line">		ac.start();</span><br><span class="line">		System.out.println(<span class="string">"开启 spring 容器..."</span>);</span><br><span class="line">		<span class="comment">//线程阻塞,防止主线程死掉</span></span><br><span class="line">		System.in.read();</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/06/02/20190602 Solar/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/06/02/20190602 Solar/" class="post-title-link" itemprop="url">20190602 Solr</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-06-02 00:00:00" itemprop="dateCreated datePublished" datetime="2019-06-02T00:00:00+08:00">2019-06-02</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-06-05 12:20:54" itemprop="dateModified" datetime="2019-06-05T12:20:54+08:00">2019-06-05</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Solr"><a href="#1-Solr" class="headerlink" title="1 Solr"></a>1 Solr</h1><h2 id="全文检索"><a href="#全文检索" class="headerlink" title="全文检索"></a>全文检索</h2><p>结构化数据</p>
<p>如:有明确的类型和结构，使用 SQL 检索</p>
<p>非结构化数据</p>
<p>如：文档，邮件等，这些搜索使用全文检索引擎</p>
<h2 id="Lucene"><a href="#Lucene" class="headerlink" title="Lucene"></a>Lucene</h2><p>提供全文检索的应用程序接口 API</p>
<h3 id="Solr-简介"><a href="#Solr-简介" class="headerlink" title="Solr 简介"></a>Solr 简介</h3><p>Solr 是基于 Lecene 的面向企业搜索的 web 应用</p>
<h1 id="2-Solr-单机版"><a href="#2-Solr-单机版" class="headerlink" title="2 Solr 单机版"></a>2 Solr 单机版</h1><h2 id="2-1-环境要求"><a href="#2-1-环境要求" class="headerlink" title="2.1 环境要求"></a>2.1 环境要求</h2><p>JDK 1.8  、 Tomcat 7</p>
<h2 id="2-2-安装-solr"><a href="#2-2-安装-solr" class="headerlink" title="2.2 安装 solr"></a>2.2 安装 solr</h2><p>解压 solr -4.10.3 压缩包</p>
<table>
<thead>
<tr>
<th>目录</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>bin</td>
<td>启动 solr 的一些脚本，但是需要依赖 jetty 容器</td>
</tr>
<tr>
<td>contrib</td>
<td>存放的是 solr 对第三方插件的支持</td>
</tr>
<tr>
<td>dist</td>
<td>solr 编译后所产生一些文件夹 war 或者是 jar</td>
</tr>
<tr>
<td>example</td>
<td>solr 的案例</td>
</tr>
<tr>
<td>example/webapps</td>
<td>在该目录中存放了 solr 的 war 包</td>
</tr>
<tr>
<td>example/solr</td>
<td>solr 的一个标签的索引库示例</td>
</tr>
<tr>
<td>example/lib/ext</td>
<td>该目录下存放的是一些日志处理的 jar 包 。在安装 Solr 的web服务，需求将这些日志 jar 包 拷贝到 solr web 服务的 lib 目录下</td>
</tr>
</tbody></table>
<h3 id="添加-solr-web-应用"><a href="#添加-solr-web-应用" class="headerlink" title="添加 solr web 应用"></a>添加 solr web 应用</h3><p>solr.war 的位置在 examle 目录的 webapps 目录下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>拷贝当前目录所有文件到指定目录下</span><br><span class="line">cp * /usr/local/tomcat/webapps/solr/WEB-INF/lib/</span><br></pre></td></tr></table></figure>

<h3 id="添加-solr-索引库"><a href="#添加-solr-索引库" class="headerlink" title="添加 solr 索引库"></a>添加 solr 索引库</h3><p>配置 solr 索引库</p>
<p>新建一个目录，用于存放 solr 索引库。</p>
<p>将 solr 解压目录下 example 目录下的 solr 目录拷贝之前新建的目录中</p>
<p>并赋值该新建的目录的绝对路径</p>
<p>在 solr web项目修改 web.xml 文件，添加之前的路径即可。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">env-entry</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">env-entry-name</span>&gt;</span>solr/home<span class="tag">&lt;/<span class="name">env-entry-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">env-entry-value</span>&gt;</span>/usr/local/solrhome/solr<span class="tag">&lt;/<span class="name">env-entry-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">env-entry-type</span>&gt;</span>java.lang.String<span class="tag">&lt;/<span class="name">env-entry-type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">env-entry</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-solr-索引库"><a href="#3-solr-索引库" class="headerlink" title="3 solr 索引库"></a>3 solr 索引库</h2><h2 id="3-1-solr-home-目录结构"><a href="#3-1-solr-home-目录结构" class="headerlink" title="3.1 solr home 目录结构"></a>3.1 solr home 目录结构</h2><table>
<thead>
<tr>
<th>文件名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>solr.xml</td>
<td>配置 solr 集群</td>
</tr>
<tr>
<td>collection1</td>
<td>索引库：solr core</td>
</tr>
<tr>
<td>core.properties</td>
<td>配置索引库的名称，默认的索引库的名称为 collection1</td>
</tr>
<tr>
<td>data</td>
<td>存放索引</td>
</tr>
<tr>
<td>conf</td>
<td>索引库的配置目录</td>
</tr>
<tr>
<td>conf/schema.xml</td>
<td>配置字段以及字段类型</td>
</tr>
</tbody></table>
<h2 id="3-2-索引库的配置"><a href="#3-2-索引库的配置" class="headerlink" title="3.2 索引库的配置"></a>3.2 索引库的配置</h2><p>schema.xml 是用来定义索引数据中的域的，包括域名称，域类型，域是否索引，是否分词，是否存储等等。</p>
<h3 id="定义索引库中的-Field"><a href="#定义索引库中的-Field" class="headerlink" title="定义索引库中的 Field"></a>定义索引库中的 Field</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	定义域</span></span><br><span class="line"><span class="comment">--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"_version_"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="定义索引库中的-FileType"><a href="#定义索引库中的-FileType" class="headerlink" title="定义索引库中的 FileType"></a>定义索引库中的 FileType</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	定义域的类型</span></span><br><span class="line"><span class="comment">--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"long"</span> <span class="attr">class</span>=<span class="string">"solr.TrieLongField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="定义索引库中的-CopyFiled"><a href="#定义索引库中的-CopyFiled" class="headerlink" title="定义索引库中的 CopyFiled"></a>定义索引库中的 CopyFiled</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	复制域,目的实现读写分离</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"title"</span> <span class="attr">dest</span>=<span class="string">"text"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-3-索引机制"><a href="#3-3-索引机制" class="headerlink" title="3.3 索引机制"></a>3.3 索引机制</h2><h3 id="正排索引"><a href="#正排索引" class="headerlink" title="正排索引"></a>正排索引</h3><p>效率低，不常用</p>
<h3 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h3><p><strong>倒排索引</strong>（英语：Inverted index），也常被称为<strong>反向索引</strong>、<strong>置入档案</strong>或<strong>反向档案</strong>，是一种<a href="https://zh.wikipedia.org/wiki/索引" target="_blank" rel="noopener">索引</a>方法，被用来<a href="https://zh.wikipedia.org/w/index.php?title=存储&action=edit&redlink=1" target="_blank" rel="noopener">存储</a>在<a href="https://zh.wikipedia.org/w/index.php?title=全文搜索&action=edit&redlink=1" target="_blank" rel="noopener">全文搜索</a>下某个单词在一个文档或者一组文档中的<a href="https://zh.wikipedia.org/w/index.php?title=存储位置&action=edit&redlink=1" target="_blank" rel="noopener">存储位置</a>的<a href="https://zh.wikipedia.org/wiki/映射" target="_blank" rel="noopener">映射</a>。它是<a href="https://zh.wikipedia.org/w/index.php?title=文档检索系统&action=edit&redlink=1" target="_blank" rel="noopener">文档检索系统</a>中最常用的<a href="https://zh.wikipedia.org/wiki/数据结构" target="_blank" rel="noopener">数据结构</a>。</p>
<p>有两种不同的反向索引形式：</p>
<ul>
<li>一条记录的水平反向索引（或者反向档案索引）包含每个引用单词的文档的<a href="https://zh.wikipedia.org/wiki/列表" target="_blank" rel="noopener">列表</a>。</li>
<li>一个单词的水平反向索引（或者完全反向索引）又包含每个单词在一个文档中的位置。<a href="https://zh.wikipedia.org/wiki/倒排索引#cite_note-isbn0-201-39829-X-p192-1" target="_blank" rel="noopener">[1]</a></li>
</ul>
<p>后者的形式提供了更多的<a href="https://zh.wikipedia.org/wiki/兼容性" target="_blank" rel="noopener">兼容性</a>（比如<a href="https://zh.wikipedia.org/w/index.php?title=短语搜索&action=edit&redlink=1" target="_blank" rel="noopener">短语搜索</a>），但是需要更多的时间和空间来创建。</p>
<h4 id="配置中文分词器（IK-Analyzer）"><a href="#配置中文分词器（IK-Analyzer）" class="headerlink" title="配置中文分词器（IK Analyzer）"></a>配置中文分词器（IK Analyzer）</h4><h4 id="上传中文分词器"><a href="#上传中文分词器" class="headerlink" title="上传中文分词器"></a>上传中文分词器</h4><p>将 中文分词器的压缩包解压，并将中文分词器的配置文件拷贝到 solr 的web服务目录下 WEB-INF/classes目录下，并将相应的 jar 包拷贝到对应的 WEB-INF/lib  目录下</p>
<h4 id="配置中文分词器"><a href="#配置中文分词器" class="headerlink" title="配置中文分词器"></a>配置中文分词器</h4><p>在 schema.xml 添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--中文分词器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ik"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">class</span>=<span class="string">"org.wltea.analyzer.lucene.IKAnalyzer"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="4-Solr-管理界面"><a href="#4-Solr-管理界面" class="headerlink" title="4 Solr 管理界面"></a>4 Solr 管理界面</h1><h2 id="Dashboard-（仪表盘）"><a href="#Dashboard-（仪表盘）" class="headerlink" title="Dashboard （仪表盘）"></a>Dashboard （仪表盘）</h2><p><img src="http://img.zwer.xyz/blog/20190603095943.png" alt></p>
<h2 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h2><p>文档的更新和删除操作</p>
<p><img src="http://img.zwer.xyz/blog/20190604174045.png" alt></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">query</span>&gt;</span>*:*<span class="tag">&lt;/<span class="name">query</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">commit</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h2><p>查询</p>
<h1 id="5-业务字段"><a href="#5-业务字段" class="headerlink" title="5  业务字段"></a>5  业务字段</h1><h2 id="1-表结构"><a href="#1-表结构" class="headerlink" title="1 表结构"></a>1 表结构</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_item`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'商品id，同时也是商品编号'</span>,</span><br><span class="line">  <span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'商品标题'</span>,</span><br><span class="line">  <span class="string">`sell_point`</span> <span class="built_in">varchar</span>(<span class="number">500</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'商品卖点'</span>,</span><br><span class="line">  <span class="string">`price`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'商品价格，单位为：分'</span>,</span><br><span class="line">  <span class="string">`num`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'库存数量'</span>,</span><br><span class="line">  <span class="string">`barcode`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'商品条形码'</span>,</span><br><span class="line">  <span class="string">`image`</span> <span class="built_in">varchar</span>(<span class="number">500</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'商品图片'</span>,</span><br><span class="line">  <span class="string">`cid`</span> <span class="built_in">bigint</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'所属类目，叶子类目'</span>,</span><br><span class="line">  <span class="string">`status`</span> <span class="built_in">tinyint</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'商品状态，1-正常，2-下架，3-删除'</span>,</span><br><span class="line">  <span class="string">`created`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  <span class="string">`updated`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'更新时间'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`cid`</span> (<span class="string">`cid`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`status`</span> (<span class="string">`status`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`updated`</span> (<span class="string">`updated`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'商品表'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="2-定义域"><a href="#2-定义域" class="headerlink" title="2 定义域"></a>2 定义域</h2><p>定义域的字段根据查询时，需要作为查询条件的字段和查询后要显示的字段</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加业务字段  </span></span><br><span class="line"><span class="comment">	 域名称 id 的索引为 true，不能修改为 false ，默认为 true</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">required</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"item_title"</span> <span class="attr">type</span>=<span class="string">"text_ik"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"item_sell_point"</span> <span class="attr">type</span>=<span class="string">"text_ik"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"item_image"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"false"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"item_price"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"false"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-定义默认检索域"><a href="#3-定义默认检索域" class="headerlink" title="3 定义默认检索域"></a>3 定义默认检索域</h2><p>根据域的字段是否参与检索或者排序</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 默认作用域 </span></span><br><span class="line"><span class="comment">   作用：使更新与查询的操作分离</span></span><br><span class="line"><span class="comment">   复制域选择既参加索引又参加排序的域字段</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"item_keywords"</span> <span class="attr">type</span>=<span class="string">"text_ik"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"false"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"item_title"</span> <span class="attr">dest</span>=<span class="string">"item_keywords"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"item_sell_point"</span> <span class="attr">dest</span>=<span class="string">"item_keywords"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="6-SolrJ"><a href="#6-SolrJ" class="headerlink" title="6 SolrJ"></a>6 SolrJ</h1><p>SolrJ 是访问 Solr 服务的 Java 客户端，提供索引和搜索的请求方法，SolrJ 通常嵌入在业务系统中，通过 solrJ 的API 接口操作 Solr 服务</p>
<p><img src="http://img.zwer.xyz/blog/20190603123430.png" alt></p>
<h2 id="操作-Solr-单机版"><a href="#操作-Solr-单机版" class="headerlink" title="操作 Solr 单机版"></a>操作 Solr 单机版</h2><h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.solr/solr-solrj --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.solr<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>solr-solrj<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="添加文档"><a href="#添加文档" class="headerlink" title="添加文档"></a>添加文档</h3><p>就是向 Solr 中添加数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 添加文档</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> SolrServerException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addDocument</span><span class="params">()</span> <span class="keyword">throws</span> SolrServerException, IOException</span>&#123;</span><br><span class="line">    <span class="comment">//连接到 Solr 应用服务</span></span><br><span class="line">    HttpSolrServer server = </span><br><span class="line">        <span class="keyword">new</span> HttpSolrServer(<span class="string">"http://192.168.170.4:8080/solr"</span>);</span><br><span class="line">    <span class="comment">//创建文档 Document</span></span><br><span class="line">    SolrInputDocument doc = <span class="keyword">new</span> SolrInputDocument();</span><br><span class="line">    <span class="comment">//添加域</span></span><br><span class="line">    doc.addField(<span class="string">"id"</span>, <span class="string">"Hello Solr"</span>);</span><br><span class="line">    doc.addField(<span class="string">"item_title"</span>, <span class="string">"真的好"</span>);</span><br><span class="line">    <span class="comment">//添加到 server 中</span></span><br><span class="line">    server.add(doc);</span><br><span class="line">    <span class="comment">//提交事务</span></span><br><span class="line">    server.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 删除文档</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> SolrServerException </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteDocument</span><span class="params">()</span> <span class="keyword">throws</span> SolrServerException, IOException</span>&#123;</span><br><span class="line">    <span class="comment">//连接到 Solr 应用服务</span></span><br><span class="line">    HttpSolrServer server = </span><br><span class="line">        <span class="keyword">new</span> HttpSolrServer(<span class="string">"http://192.168.170.4:8080/solr"</span>);</span><br><span class="line">    <span class="comment">//删除文档</span></span><br><span class="line">    <span class="comment">//1. 根据 ID 条件删除</span></span><br><span class="line">    <span class="comment">//server.deleteById("delete");</span></span><br><span class="line">    <span class="comment">//2. 根据查询条件删除</span></span><br><span class="line">    <span class="comment">//server.deleteByQuery("id:greet");</span></span><br><span class="line">    server.deleteByQuery(<span class="string">"*:*"</span>);</span><br><span class="line">    <span class="comment">//提交事务</span></span><br><span class="line">    server.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 查询索引库的文档</span></span><br><span class="line"><span class="comment">	 * 查询索引库中文档必须含有 Id 属性</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> SolrServerException </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">QueryDocument</span><span class="params">()</span> <span class="keyword">throws</span> SolrServerException</span>&#123;</span><br><span class="line">    <span class="comment">//连接到 Solr 应用服务</span></span><br><span class="line">    HttpSolrServer server = </span><br><span class="line">        <span class="keyword">new</span> HttpSolrServer(<span class="string">"http://192.168.170.4:8080/solr"</span>);</span><br><span class="line">    <span class="comment">//创建 查询 Query 对象</span></span><br><span class="line">    SolrQuery query = <span class="keyword">new</span> SolrQuery();</span><br><span class="line">    <span class="comment">//确定查询条件</span></span><br><span class="line">    query.setQuery(<span class="string">"真的好"</span>);</span><br><span class="line">    <span class="comment">//设置默认查询域</span></span><br><span class="line">    query.set(<span class="string">"df"</span>,<span class="string">"item_keywords"</span>);</span><br><span class="line">    <span class="comment">//设置分页,类似于 mysql 数据库的分页</span></span><br><span class="line">    <span class="comment">//指定分页开始的位置，及从开始的位置后多少行</span></span><br><span class="line">    query.setStart(<span class="number">0</span>);</span><br><span class="line">    query.setRows(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">//添加 server </span></span><br><span class="line">    <span class="comment">//QueryResponse 返回查询响应结果</span></span><br><span class="line">    QueryResponse resp = server.query(query);</span><br><span class="line">    <span class="comment">//获取结果集</span></span><br><span class="line">    SolrDocumentList results = resp.getResults();</span><br><span class="line">    System.out.println(<span class="string">"总条数："</span>+results.getNumFound());</span><br><span class="line">    <span class="keyword">for</span> (SolrDocument doc : results) &#123;</span><br><span class="line">        System.out.println(doc.getFieldValue(<span class="string">"id"</span>));			</span><br><span class="line">        System.out.println(doc.getFieldValue(<span class="string">"item_title"</span>));			</span><br><span class="line">        System.out.println(doc.getFieldValue(<span class="string">"item_price"</span>));			</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="7-Solr-集群-SolrCloud"><a href="#7-Solr-集群-SolrCloud" class="headerlink" title="7 Solr 集群( SolrCloud)"></a>7 Solr 集群( SolrCloud)</h1><p>Solr 集群需要 zookepper 集群配置</p>
<p>搭建 Solr 集群，需要将之前使用 Solr 单机版中数据全部删除了。</p>
<p>这里搭建的集群都是伪集群</p>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>安装 zookeeper 集群</p>
<p>创建 4个 tomcat 实例，修改其端口为 8080-8083</p>
<p>使用已安装好的单机版 solr 作为集群的节点使用（注意：将原来索引库中的数据删除）</p>
<h2 id="搭建-solrCloud"><a href="#搭建-solrCloud" class="headerlink" title="搭建 solrCloud"></a>搭建 solrCloud</h2><p><strong>step1：</strong>创建 solrcloud 目录</p>
<p><strong>step2：</strong>安装 zookeeper 集群</p>
<p><strong>step3：</strong>安装 tomcat 实例并将 tomcat 与索引库拷贝到 solrCloud 目录中</p>
<p><strong>step4：</strong>修改 tomcat 端口</p>
<p><strong>step5：</strong>修改 solr 服务中指向 solr 索引库的路径</p>
<p><strong>step6：</strong>创建集群</p>
<ul>
<li><p>上传索引库配置文件</p>
<p>注意：这里使用 zookeeper 客户端是 solr 案例中自带的 zookeeper 客户端，而不是 zookeeper 集群中客户端</p>
</li>
</ul>
<p><img src="http://img.zwer.xyz/blog/20190603202652.png" alt></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./zkcli.sh -zkhost 192.168.170.4:2181, 192.168.170.4:2182, 192.168.170.4:2183 -cmd upconfig -confdir /usr/local/solrCloud/solrhome01/solr/collection1/conf -confname myconf</span><br></pre></td></tr></table></figure>

<ul>
<li>修改 solrhome 下的 solr.xml ,指定当前实例运行的 ip 地址及端口号</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">solrcloud</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">str</span> <span class="attr">name</span>=<span class="string">"host"</span>&gt;</span>$&#123;host:192.168.170.4&#125;<span class="tag">&lt;/<span class="name">str</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">"hostPort"</span>&gt;</span>$&#123;jetty.port:8083&#125;<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">str</span> <span class="attr">name</span>=<span class="string">"hostContext"</span>&gt;</span>$&#123;hostContext:solr&#125;<span class="tag">&lt;/<span class="name">str</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">"zkClientTimeout"</span>&gt;</span>$&#123;zkClientTimeout:30000&#125;<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bool</span> <span class="attr">name</span>=<span class="string">"genericCoreNodeNames"</span>&gt;</span>$&#123;genericCoreNodeNames:true&#125;<span class="tag">&lt;/<span class="name">bool</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">solrcloud</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>修改每一台 solr 的 tomcat 的bin 目录下 catalina.sh 文件中加入 DzKHost 指定 zookeeper 服务器地址</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS=<span class="string">"-DzkHost=192.168.170.4:2181,192.168.170.4:2182,192.168.170.4:2183"</span></span><br></pre></td></tr></table></figure>

<p><strong>step7：</strong>开启 tomcat</p>
<p><img src="http://img.zwer.xyz/blog/20190603204454.png" alt></p>
<p><strong>step7：</strong> 创建新的逻辑索引库分片</p>
<p>创建一个新的collection，并分两片，每片是一主一备。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.170.4:8080/solr/admin/collections?action=CREATE&amp;name=collection2&amp;numShards=2&amp;replicationFactor=2</span><br></pre></td></tr></table></figure>

<p><img src="http://img.zwer.xyz/blog/20190603204810.png" alt></p>
<p><strong>step7：</strong> 删除原来的逻辑索引库</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.170.4:8080/solr/admin/collections?action=DELETE&amp;name=collection1</span><br></pre></td></tr></table></figure>

<p><img src="http://img.zwer.xyz/blog/20190603204937.png" alt></p>
<h2 id="操作-Solr-集群版"><a href="#操作-Solr-集群版" class="headerlink" title="操作 Solr 集群版"></a>操作 Solr 集群版</h2><h3 id="添加文档-1"><a href="#添加文档-1" class="headerlink" title="添加文档"></a>添加文档</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *  向集群中插入文档</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> SolrServerException </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">solrCloudInsert</span><span class="params">()</span> <span class="keyword">throws</span> SolrServerException, IOException</span>&#123;</span><br><span class="line">    <span class="comment">//zookeeperCluster 的地址</span></span><br><span class="line">    String zkHost = <span class="string">"192.168.170.4:2181,192.168.170.4:2182,192.168.170.4:2183,192.168.170.4:2184"</span>;</span><br><span class="line">    <span class="comment">//创建 solrCloud</span></span><br><span class="line">    CloudSolrServer server = <span class="keyword">new</span>  CloudSolrServer(zkHost);</span><br><span class="line">    <span class="comment">//确定索引库</span></span><br><span class="line">    server.setDefaultCollection(<span class="string">"collection3"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">        <span class="comment">//创建文档</span></span><br><span class="line">        SolrInputDocument doc = <span class="keyword">new</span> SolrInputDocument();</span><br><span class="line">        doc.addField(<span class="string">"id"</span>, <span class="string">"Cloud"</span>+i);</span><br><span class="line">        doc.addField(<span class="string">"item_title"</span>, <span class="string">"Solr 集群"</span>+i);</span><br><span class="line">        doc.addField(<span class="string">"item_price"</span>, <span class="number">100</span>);</span><br><span class="line">        server.add(doc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//提交事务</span></span><br><span class="line">    server.commit();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除文档-1"><a href="#删除文档-1" class="headerlink" title="删除文档"></a>删除文档</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 删除</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> SolrServerException </span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">solrCloudDelete</span><span class="params">()</span> <span class="keyword">throws</span> SolrServerException, IOException</span>&#123;</span><br><span class="line">    <span class="comment">//zookeeperCluster 的地址</span></span><br><span class="line">    String zkHost = <span class="string">"192.168.170.4:2181,192.168.170.4:2182,192.168.170.4:2183,192.168.170.4:2184"</span>;</span><br><span class="line">    <span class="comment">//创建 solrCloud</span></span><br><span class="line">    CloudSolrServer cloud = <span class="keyword">new</span>  CloudSolrServer(zkHost);</span><br><span class="line">    <span class="comment">//确定索引库</span></span><br><span class="line">    cloud.setDefaultCollection(<span class="string">"collection3"</span>);</span><br><span class="line">    <span class="comment">//确定删除条件</span></span><br><span class="line">    cloud.deleteById(<span class="string">"Cloud"</span>);</span><br><span class="line">    <span class="comment">//提交事务</span></span><br><span class="line">    cloud.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询文档-1"><a href="#查询文档-1" class="headerlink" title="查询文档"></a>查询文档</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *  查询</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> SolrServerException </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">solrCloudQuery</span><span class="params">()</span> <span class="keyword">throws</span> SolrServerException</span>&#123;</span><br><span class="line">    <span class="comment">//zookeeperCluster 的地址</span></span><br><span class="line">    String zkHost = <span class="string">"192.168.170.4:2181,192.168.170.4:2182,192.168.170.4:2183,192.168.170.4:2184"</span>;</span><br><span class="line">    <span class="comment">//创建 solrCloud</span></span><br><span class="line">    CloudSolrServer cloud = <span class="keyword">new</span>  CloudSolrServer(zkHost);</span><br><span class="line">    <span class="comment">//确定索引库</span></span><br><span class="line">    cloud.setDefaultCollection(<span class="string">"collection3"</span>);</span><br><span class="line">    <span class="comment">//创建 query 对象</span></span><br><span class="line">    SolrQuery query = <span class="keyword">new</span> SolrQuery();</span><br><span class="line">    <span class="comment">//确定查询内容</span></span><br><span class="line">    query.setQuery(<span class="string">"Solr 集群"</span>);</span><br><span class="line">    <span class="comment">//确定默认查询域</span></span><br><span class="line">    query.set(<span class="string">"df"</span>,<span class="string">"item_keywords"</span>);</span><br><span class="line">    <span class="comment">//设置分页</span></span><br><span class="line">    query.setStart(<span class="number">0</span>);</span><br><span class="line">    query.setRows(<span class="number">10</span>);</span><br><span class="line">    <span class="comment">//查询</span></span><br><span class="line">    QueryResponse resp = cloud.query(query);</span><br><span class="line">    SolrDocumentList docs = resp.getResults();</span><br><span class="line">    System.out.println(<span class="string">"总条数："</span>+docs.getNumFound());</span><br><span class="line">    <span class="keyword">for</span> (SolrDocument doc:docs) &#123;</span><br><span class="line">        System.out.println(doc.getFieldValue(<span class="string">"id"</span>));</span><br><span class="line">        System.out.println(doc.getFieldValue(<span class="string">"item_title"</span>));</span><br><span class="line">        System.out.println(doc.getFieldValue(<span class="string">"item_price"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="8-Spring-整合-SolrJ"><a href="#8-Spring-整合-SolrJ" class="headerlink" title="8 Spring 整合 SolrJ"></a>8 Spring 整合 SolrJ</h1><ul>
<li><p>新建 war 类型 的maven 项目，选择 parent 的maven 父项目</p>
</li>
<li><p>在子项目的 pom.xml 文件 添加所需要的依赖，以及资源拷贝插件和 tomcat 的maven 插件</p>
</li>
<li><p>在添加 web.xml 、spring 的xml文件、springmvc的xml文件、mybatis 的xml文件以及db.properties</p>
</li>
</ul>
<h3 id="applicationContext-solrJ-xml"><a href="#applicationContext-solrJ-xml" class="headerlink" title="applicationContext-solrJ.xml"></a>applicationContext-solrJ.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">	   http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd "</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:resource.properties"</span> <span class="attr">ignore-unresolvable</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- Solr 单机版 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"httpSolrServer"</span> <span class="attr">class</span>=<span class="string">"org.apache.solr.client.solrj.impl.HttpSolrServer"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"baseURL"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;SOLR_SERVER_BASEURL&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- SolrCloud 集群版 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"cloudSolrServer"</span> <span class="attr">class</span>=<span class="string">"org.apache.solr.client.solrj.impl.CloudSolrServer"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 构造注入 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"zkHost"</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">					注意：$&#123;SOLR_SERVER_ZKHOST&#125; 不能有空格，</span></span><br><span class="line"><span class="comment">					否则出现 NumberFormatException 错误</span></span><br><span class="line"><span class="comment">				 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;SOLR_CLOUD_SERVER_ZKHOST&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 设值注入 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultCollection"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;SOLR_CLOUD_SERVER_DEFAULTCOLLECTION&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="测试-SolrJ-与Spring-整合"><a href="#测试-SolrJ-与Spring-整合" class="headerlink" title="测试 SolrJ 与Spring 整合"></a>测试 SolrJ 与Spring 整合</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestSolr</span><span class="params">()</span> <span class="keyword">throws</span> SolrServerException, IOException</span>&#123;</span><br><span class="line">		</span><br><span class="line">		ApplicationContext ac =</span><br><span class="line">	<span class="keyword">new</span>  ClassPathXmlApplicationContext(<span class="string">"classpath:applicationContext-solrJ.xml"</span>);</span><br><span class="line">		</span><br><span class="line">		CloudSolrServer server = ac.getBean(<span class="string">"cloudSolrServer"</span>,CloudSolrServer.class);</span><br><span class="line">	</span><br><span class="line">		</span><br><span class="line">		SolrInputDocument doc = <span class="keyword">new</span> SolrInputDocument();</span><br><span class="line">		doc.addField(<span class="string">"id"</span>, <span class="string">"Cloud"</span>);</span><br><span class="line">		doc.addField(<span class="string">"item_title"</span>, <span class="string">"Solr 集群"</span>);</span><br><span class="line">		doc.addField(<span class="string">"item_price"</span>, <span class="number">100L</span>);</span><br><span class="line">		</span><br><span class="line">		server.add(doc);</span><br><span class="line">		server.commit();</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="导入数据到-Solr-索引库中"><a href="#导入数据到-Solr-索引库中" class="headerlink" title="导入数据到 Solr 索引库中"></a>导入数据到 Solr 索引库中</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrServerException;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.impl.CloudSolrServer;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrInputDocument;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.mapper.TbItemMapper;</span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.TbItem;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImportDataServiceImpl</span> <span class="keyword">implements</span> <span class="title">ImportDataService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> TbItemMapper tbItemMapper;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> CloudSolrServer cloudSolrServer;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">importDataFromDB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//查询数据库</span></span><br><span class="line">			List&lt;TbItem&gt; items = tbItemMapper.selectAllItems();</span><br><span class="line">			List&lt;SolrInputDocument&gt;  docs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">			<span class="comment">//将信息导入到 Solr 索引库</span></span><br><span class="line">			<span class="keyword">for</span>(TbItem item:items)&#123;</span><br><span class="line">				SolrInputDocument doc = <span class="keyword">new</span> SolrInputDocument();</span><br><span class="line">				doc.addField(<span class="string">"id"</span>,item.getId());</span><br><span class="line">				doc.addField(<span class="string">"item_title"</span>,item.getTitle());</span><br><span class="line">				doc.addField(<span class="string">"item_sell_point"</span>,item.getSell_point());</span><br><span class="line">				doc.addField(<span class="string">"item_image"</span>,item.getImage());</span><br><span class="line">				doc.addField(<span class="string">"item_price"</span>, item.getPrice());</span><br><span class="line">				docs.add(doc);</span><br><span class="line">			&#125;</span><br><span class="line">			cloudSolrServer.add(docs);</span><br><span class="line">			cloudSolrServer.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SolrImpl-java"><a href="#SolrImpl-java" class="headerlink" title="SolrImpl.java"></a>SolrImpl.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrQuery;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.impl.CloudSolrServer;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.response.QueryResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrDocumentList;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.SolrDao;</span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.PageItems;</span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.TbItem;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SolrDaoImpl</span> <span class="keyword">implements</span> <span class="title">SolrDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> CloudSolrServer cloudSolrServer;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> PageItems <span class="title">selectItems</span><span class="params">(SolrQuery query)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//获取查询结果对象</span></span><br><span class="line">		QueryResponse resp = <span class="keyword">this</span>.cloudSolrServer.query(query);</span><br><span class="line">		PageItems pageItems = <span class="keyword">new</span> PageItems();</span><br><span class="line">		<span class="comment">//获取高亮信息</span></span><br><span class="line">		Map&lt;String, Map&lt;String, List&lt;String&gt;&gt;&gt; highlighting = resp.getHighlighting();		</span><br><span class="line">		<span class="comment">//获取查询结果集</span></span><br><span class="line">		SolrDocumentList results = resp.getResults();</span><br><span class="line">		<span class="comment">//设置总条数</span></span><br><span class="line">		pageItems.setTotalNums(results.getNumFound());</span><br><span class="line">		List&lt;TbItem&gt; tbItems = pageItems.getTbItems();</span><br><span class="line">		<span class="comment">//将查询结果集封装到 PageItem 对象中</span></span><br><span class="line">		<span class="keyword">for</span> (SolrDocument doc : results) &#123;</span><br><span class="line">			TbItem item = <span class="keyword">new</span> TbItem();</span><br><span class="line">			item.setId(Long.parseLong((String)doc.getFieldValue(<span class="string">"id"</span>)));</span><br><span class="line">			<span class="comment">//item.setTitle((String)doc.getFieldValue("item_title"));</span></span><br><span class="line">			item.setSell_point((String)doc.getFieldValue(<span class="string">"item_sell_point"</span>));</span><br><span class="line">			item.setPrice((<span class="keyword">long</span>)doc.getFieldValue(<span class="string">"item_price"</span>));</span><br><span class="line">			item.setImage((String)doc.getFirstValue(<span class="string">"item_image"</span>));</span><br><span class="line">			<span class="comment">//获取搜索关键字高亮信息</span></span><br><span class="line">			Map&lt;String, List&lt;String&gt;&gt; map = highlighting.get((String)doc.get(<span class="string">"id"</span>));</span><br><span class="line">			List&lt;String&gt; h = map.get(<span class="string">"item_title"</span>);</span><br><span class="line">			String title = <span class="string">""</span>;</span><br><span class="line">			<span class="keyword">if</span>(h != <span class="keyword">null</span> &amp;&amp; h.size() &gt;<span class="number">0</span>)&#123;</span><br><span class="line">				title = h.get(<span class="number">0</span>) ;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				title = (String)doc.getFieldValue(<span class="string">"item_title"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			item.setTitle(title);</span><br><span class="line">			tbItems.add(item);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> pageItems;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SearchItemServiceImpl-java"><a href="#SearchItemServiceImpl-java" class="headerlink" title="SearchItemServiceImpl.java"></a>SearchItemServiceImpl.java</h3><p>注意获取高亮数据是个 Map&lt;String,Map&lt;String,List<string>&gt;&gt; 类型</string></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrQuery;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrServerException;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.impl.CloudSolrServer;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.response.QueryResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.common.SolrDocumentList;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.SolrDao;</span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.PageItems;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.SearchItemService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * solr 搜索服务</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchItemServiceImpl</span> <span class="keyword">implements</span> <span class="title">SearchItemService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SolrDao solrDao;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> PageItems <span class="title">searchItem</span><span class="params">(String title, Integer pageIndex, Integer rows)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//创建搜索对象</span></span><br><span class="line">		SolrQuery query = <span class="keyword">new</span> SolrQuery();</span><br><span class="line">		<span class="comment">//设置搜索内容</span></span><br><span class="line">		query.setQuery(title);</span><br><span class="line">		<span class="comment">//设置默认搜索域</span></span><br><span class="line">		query.set(<span class="string">"df"</span>, <span class="string">"item_keywords"</span>);</span><br><span class="line">		<span class="comment">//设置结果分页</span></span><br><span class="line">		Integer start = (pageIndex-<span class="number">1</span>)*rows;</span><br><span class="line">		query.setStart(start);</span><br><span class="line">		query.setRows(rows);</span><br><span class="line">		<span class="comment">//设置高亮开启、选择高亮目标、使用 Html 标签</span></span><br><span class="line">		query.setHighlight(<span class="keyword">true</span>);<span class="comment">//开启搜索关键字高亮显示</span></span><br><span class="line">		query.addHighlightField(<span class="string">"item_title"</span>); <span class="comment">//针对关键词高亮</span></span><br><span class="line">		query.setHighlightSimplePre(<span class="string">"&lt;em style='color:red;'&gt;"</span>);</span><br><span class="line">		query.setHighlightSimplePost(<span class="string">"&lt;/em&gt;"</span>);</span><br><span class="line">		<span class="comment">//调用 SolrDao </span></span><br><span class="line">		PageItems pageItems = solrDao.selectItems(query);</span><br><span class="line">		<span class="comment">//设置分页的总数</span></span><br><span class="line">		<span class="keyword">int</span> totalPages = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">long</span> totalNums = pageItems.getTotalNums();</span><br><span class="line">		<span class="keyword">if</span>(totalNums % rows ==<span class="number">0</span>)&#123;</span><br><span class="line">			totalPages = (<span class="keyword">int</span>) (totalNums/rows);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			totalPages = (<span class="keyword">int</span>) (totalNums/rows)+<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		pageItems.setTotalPages(totalPages);</span><br><span class="line">		<span class="comment">//设置当前页</span></span><br><span class="line">		pageItems.setPageIndex(pageIndex);</span><br><span class="line">		<span class="keyword">return</span> pageItems;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SearchItemController-java"><a href="#SearchItemController-java" class="headerlink" title="SearchItemController.java"></a>SearchItemController.java</h3><p>@RequetParam 注解可以为请求参数设置默认值，使用方法加在方法参数前即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.PageItems;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.SearchItemService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/search"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchItemController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SearchItemService searchItemService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/searchItem"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">searchItem</span><span class="params">(String title,</span></span></span><br><span class="line"><span class="function"><span class="params">	@RequestParam(value=<span class="string">"pageIndex"</span>,defaultValue=<span class="string">"1"</span>)</span>Integer pageIndex,</span></span><br><span class="line"><span class="function">	@<span class="title">RequestParam</span><span class="params">(value=<span class="string">"rows"</span>,defaultValue=<span class="string">"5"</span>)</span>Integer rows,Model model)</span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			PageItems pageItems = <span class="keyword">this</span>.searchItemService.searchItem(title, pageIndex, rows);</span><br><span class="line">			model.addAttribute(<span class="string">"pageItems"</span>, pageItems);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"SearchItems"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SearchItems-jsp"><a href="#SearchItems-jsp" class="headerlink" title="SearchItems.jsp"></a>SearchItems.jsp</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"c"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span>  %&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	当前页：$&#123;pageItems.pageIndex&#125;总页数:$&#123;pageItems.totalPages&#125; 总数据数:$&#123;pageItems.totalNums&#125;</span><br><span class="line">	&lt;br/&gt;</span><br><span class="line">	&lt;table border=<span class="string">"1"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;th&gt;Id&lt;/th&gt;</span><br><span class="line">			&lt;th&gt;标题&lt;/th&gt;</span><br><span class="line">			&lt;th&gt;卖点&lt;/th&gt;</span><br><span class="line">			&lt;th&gt;价格&lt;/th&gt;</span><br><span class="line">			&lt;th&gt;图片&lt;/th&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">		&lt;c:forEach items=<span class="string">"$&#123;pageItems.tbItems&#125;"</span> <span class="keyword">var</span>=<span class="string">"tbItem"</span>&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;$&#123;tbItem.id&#125;&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;$&#123;tbItem.title&#125;&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;$&#123;tbItem.sell_point&#125;&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;$&#123;tbItem.price&#125;&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;$&#123;tbItem.image&#125;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">		&lt;/c:forEach&gt;</span><br><span class="line">	&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="Bug"><a href="#Bug" class="headerlink" title="Bug"></a>Bug</h1><p>org.apache.solr.common.SolrException: java.lang.NumberFormatException: For input string: “2184  “<br>    at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:151)<br>    at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:114)<br>    at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:104)<br>    at org.apache.solr.common.cloud.ZkStateReader.<init>(ZkStateReader.java:212)<br>    at org.apache.solr.client.solrj.impl.CloudSolrServer.connect(CloudSolrServer.java:241)<br>    at org.apache.solr.client.solrj.impl.CloudSolrServer.request(CloudSolrServer.java:524)<br>    at org.apache.solr.client.solrj.request.AbstractUpdateRequest.process(AbstractUpdateRequest.java:124)<br>    at org.apache.solr.client.solrj.SolrServer.add(SolrServer.java:116)<br>    at org.apache.solr.client.solrj.SolrServer.add(SolrServer.java:102)<br>    at com.szxy.solrTest.SpringAndSolrTest.TestSolr(SpringAndSolrTest.java:29)<br>    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)<br>    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)<br>    at java.lang.reflect.Method.invoke(Method.java:498)<br>    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)<br>    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)<br>    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)<br>    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)<br>    at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)<br>    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)<br>    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)<br>    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)<br>    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)<br>    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)<br>    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)<br>    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)<br>    at org.junit.runners.ParentRunner.run(ParentRunner.java:363)<br>    at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:86)<br>    at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)<br>    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:459)<br>    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:675)<br>    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:382)<br>    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:192)<br>Caused by: java.lang.NumberFormatException: For input string: “2184  “<br>    at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)<br>    at java.lang.Integer.parseInt(Integer.java:580)<br>    at java.lang.Integer.parseInt(Integer.java:615)<br>    at org.apache.zookeeper.client.ConnectStringParser.<init>(ConnectStringParser.java:72)<br>    at org.apache.zookeeper.ZooKeeper.<init>(ZooKeeper.java:443)<br>    at org.apache.zookeeper.ZooKeeper.<init>(ZooKeeper.java:380)<br>    at org.apache.solr.common.cloud.SolrZooKeeper.<init>(SolrZooKeeper.java:41)<br>    at org.apache.solr.common.cloud.DefaultConnectionStrategy.connect(DefaultConnectionStrategy.java:37)<br>    at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:126)<br>    … 32 more</init></init></init></init></init></init></init></init></init></p>
<p>由于 <code>&lt;value&gt;${SOLR_SERVER_ZKHOST}  &lt;/value&gt;</code> 中存在空格，导致 NumberFormatException 出现错误</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- SolrCloud 集群版 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"cloudSolrServer"</span> <span class="attr">class</span>=<span class="string">"org.apache.solr.client.solrj.impl.CloudSolrServer"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 构造注入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"zkHost"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">     注意：$&#123;SOLR_SERVER_ZKHOST&#125; 不能有空格，</span></span><br><span class="line"><span class="comment">     否则出现 NumberFormatException 错误</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;SOLR_CLOUD_SERVER_ZKHOST&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设值注入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultCollection"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;SOLR_CLOUD_SERVER_DEFAULTCOLLECTION&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="Maven-项目调试"><a href="#Maven-项目调试" class="headerlink" title="Maven 项目调试"></a>Maven 项目调试</h1><p>设置断点后，以 debug 方式运行。</p>
<p>当程序运行到断点前，会出现 source no found 的情况</p>
<p>这里需要编辑 源码路径    <code>Edit Source Lookup path</code></p>
<p>去掉 DeFault 项目，选择自己当前的项目即可。</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/30/markdown/20190530 使用 Mybatis 遇到的坑/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/30/markdown/20190530 使用 Mybatis 遇到的坑/" class="post-title-link" itemprop="url">20190530 哪些年使用 Mybatis 遇到的坑</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-30 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-30T00:00:00+08:00">2019-05-30</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-06-18 22:58:13" itemprop="dateModified" datetime="2019-06-18T22:58:13+08:00">2019-06-18</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="XML-开发遇到的坑"><a href="#XML-开发遇到的坑" class="headerlink" title="XML 开发遇到的坑"></a>XML 开发遇到的坑</h3><h4 id="接口名与映射文件名不一致"><a href="#接口名与映射文件名不一致" class="headerlink" title="接口名与映射文件名不一致"></a>接口名与映射文件名不一致</h4><p>比如：UserMapper.java 与 UsersMapper.xml ，导致 Mybatis 无法找到对应映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">org.apache.ibatis.binding.BindingException: Invalid bound statement (not found):</span></span><br><span class="line"><span class="comment">cn.szxy.mapper.UsersMapper.selUserByName</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">原因：mybatis找不到该配置文件，因为 接口名与映射文件配置名不同</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="映射文件中传值的格式错误"><a href="#映射文件中传值的格式错误" class="headerlink" title="映射文件中传值的格式错误"></a>映射文件中传值的格式错误</h4><p>比如：#{name} 写成了 ${name},导致 SQL 语法错误，并且这个错误还易察觉</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">org.springframework.jdbc.BadSqlGrammarException:</span></span><br><span class="line"><span class="comment">### Error updating database.  Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException:</span></span><br><span class="line"><span class="comment"> Unknown column 'book_name' in 'field list'</span></span><br><span class="line"><span class="comment">### The error may involve cn.szxy.mapper.BookMapper.updateBookById-Inline</span></span><br><span class="line"><span class="comment">### The error occurred while setting parameters</span></span><br><span class="line"><span class="comment">### SQL: update tbl_book set price=11.0,book_name=K1va where book_id=?</span></span><br><span class="line"><span class="comment">### Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException:</span></span><br><span class="line"><span class="comment"> Unknown column 'book_name' in 'field list'; </span></span><br><span class="line"><span class="comment">bad SQL grammar []; nested exception is com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: </span></span><br><span class="line"><span class="comment">Unknown column 'book_name' in 'field list'</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">报错原因：没有正确使用参数传值，采用$&#123;name&#125;,而不是#&#123;name&#125;,导致传进去的 name 值被mysql 当成列 column，出现 SQL 语法错误</span></span><br><span class="line"><span class="comment">&lt;update id="updateBookById" parameterType="cn.szxy.pojo.Books"&gt;</span></span><br><span class="line"><span class="comment">        update tbl_book set price=$&#123;price&#125;,book_name=$&#123;name&#125; where book_id=#&#123;bookId&#125;</span></span><br><span class="line"><span class="comment">&lt;/update&gt;</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateBookById"</span> <span class="attr">parameterType</span>=<span class="string">"cn.szxy.pojo.Books"</span>&gt;</span></span><br><span class="line">        update tbl_book set price=#&#123;price&#125;,name=#&#123;name&#125; where book_id=#&#123;bookId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="bean-类没有提供无参构造函数"><a href="#bean-类没有提供无参构造函数" class="headerlink" title="bean 类没有提供无参构造函数"></a>bean 类没有提供无参构造函数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*   </span></span><br><span class="line"><span class="comment">org.mybatis.spring.MyBatisSystemException: nested exception is 	 	    	org.apache.ibatis.reflection.ReflectionException: Error instantiating class cn.szxy.pojo.Books with invalid types () or values ().</span></span><br><span class="line"><span class="comment">Cause: java.lang.NoSuchMethodException: cn.szxy.pojo.Books.&lt;init&gt;()</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*   原因：没有为 Books 类提供无参构造函数</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="注解开发遇到的坑"><a href="#注解开发遇到的坑" class="headerlink" title="注解开发遇到的坑"></a>注解开发遇到的坑</h3><h4 id="一对多与多对一查询综合"><a href="#一对多与多对一查询综合" class="headerlink" title="一对多与多对一查询综合"></a>一对多与多对一查询综合</h4><p>@one 用于多对一</p>
<p>@Many 用于一对多</p>
<p>注意：数据库列名与实体属性名对应关系</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据 ID 查找订单</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> orderid</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select</span>(<span class="string">"select * from tbl_orderform where orderform_id = #&#123;orderId&#125;"</span>)</span><br><span class="line">		<span class="meta">@Results</span>(value=&#123;</span><br><span class="line">				<span class="meta">@Result</span>(column=<span class="string">"orderform_id"</span>,property=<span class="string">"id"</span>,id=<span class="keyword">true</span>),</span><br><span class="line">				<span class="meta">@Result</span>(column=<span class="string">"cost"</span>,property=<span class="string">"cost"</span>),</span><br><span class="line">				<span class="meta">@Result</span>(column=<span class="string">"orderdate"</span>,property=<span class="string">"orderdate"</span>),</span><br><span class="line">				<span class="meta">@Result</span>(column=<span class="string">"shipaddress_id"</span>,property=<span class="string">"sadres"</span>,</span><br><span class="line">			one=<span class="meta">@One</span>(select=<span class="string">"cn.szxy.mapper.ShipAddressMapper.getShipAddressById"</span>)),</span><br><span class="line">				<span class="meta">@Result</span>(column=<span class="string">"customer_id"</span>,property=<span class="string">"cus"</span>,</span><br><span class="line">				one=<span class="meta">@One</span>(select=<span class="string">"cn.szxy.mapper.UserMapper.getCustomerById"</span>)),</span><br><span class="line">				<span class="meta">@Result</span>(column=<span class="string">"orderform_id"</span>,property=<span class="string">"lines"</span>,</span><br><span class="line">			many=<span class="meta">@Many</span>(select=<span class="string">"cn.szxy.mapper.OrderLineMapper.ListAllOrderLines"</span>))	</span><br><span class="line">		&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="模糊查询中不能直接字符串"><a href="#模糊查询中不能直接字符串" class="headerlink" title="模糊查询中不能直接字符串"></a>模糊查询中不能直接字符串</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">注意：mybatis 中模糊查询，不能采用 字符串 	selec *  from tbl_book where name like Ja<span class="string">'%'</span></span><br><span class="line">	 * 否则查不到数据</span><br><span class="line">	 * </span><br><span class="line">	 * 解决方法：采用 concat 函数连接两个字符串</span><br><span class="line">	 * select * <span class="function">from tbl_book where name like <span class="title">concat</span><span class="params">(#&#123;name&#125;,<span class="string">'%'</span>)</span></span></span><br></pre></td></tr></table></figure>

<h4 id="多表连接"><a href="#多表连接" class="headerlink" title="多表连接"></a>多表连接</h4><p>通过主表通过外键连接其他表的字段，可通过 属性名.字段 的方式</p>
<p>如 <code>&lt;result column=&quot;nickname&quot; property=&quot;user.nickname&quot;/&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.szxy.mapper.IArticleDao"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Article"</span> <span class="attr">id</span>=<span class="string">"artMap"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span>  <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"title"</span> <span class="attr">property</span>=<span class="string">"title"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"summary"</span>  <span class="attr">property</span>=<span class="string">"summary"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"content"</span> <span class="attr">property</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"releaseDate"</span> <span class="attr">property</span>=<span class="string">"releaseDate"</span> &gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"clickTimes"</span> <span class="attr">property</span>=<span class="string">"clickTimes"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"backgroundMusicUrl"</span> <span class="attr">property</span>=<span class="string">"backgroundMusicUrl"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"pictureUrls"</span> <span class="attr">property</span>=<span class="string">"pictureUrls"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"videoUrl"</span> <span class="attr">property</span>=<span class="string">"videoUrl"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"type"</span> <span class="attr">property</span>=<span class="string">"type"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"state"</span> <span class="attr">property</span>=<span class="string">"state"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 来自其他表的属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"nickname"</span> <span class="attr">property</span>=<span class="string">"user.nickname"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"cateName"</span> <span class="attr">property</span>=<span class="string">"category.name"</span>/&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"likeState"</span>  <span class="attr">property</span>=<span class="string">"isLike"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"collectState"</span>  <span class="attr">property</span>=<span class="string">"isCollection"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"reportState"</span>  <span class="attr">property</span>=<span class="string">"isReport"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findArticlesByClickTimes"</span> <span class="attr">resultMap</span>=<span class="string">"artMap"</span>&gt;</span></span><br><span class="line">		select a.*,u.nickname,c.name cateName,lk.state likeState,coll.state collectState,rep.state reportState</span><br><span class="line">		from article a</span><br><span class="line">		join user u on u.id = a.user_id</span><br><span class="line">		join category c on c.id = a.category_id</span><br><span class="line">		left join user_likes lk on lk.user_id = #&#123;1&#125;</span><br><span class="line">		left join user_collection coll on coll.user_id = #&#123;1&#125;</span><br><span class="line">		left join user_report rep on rep.user_id = #&#123;1&#125;</span><br><span class="line">		order by clickTimes limit #&#123;0&#125;;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/27/20190528 IDEAJ 的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/27/20190528 IDEAJ 的使用/" class="post-title-link" itemprop="url">20190527 IDEA 的使用</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-27 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-27T00:00:00+08:00">2019-05-27</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-28 19:22:26" itemprop="dateModified" datetime="2019-05-28T19:22:26+08:00">2019-05-28</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/工具/" itemprop="url" rel="index"><span itemprop="name">工具</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="IDEA-版本"><a href="#IDEA-版本" class="headerlink" title="IDEA 版本"></a>IDEA 版本</h1><p>IntelliJ IDEA 2018.2.4 (Ultimate Edition)<br>Build #IU-182.4505.22, built on September 18, 2018<br>Licensed to Nss Im<br>Subscription is active until November 7, 2019<br>JRE: 1.8.0_152-release-1248-b8 amd64<br>JVM: OpenJDK 64-Bit Server VM by JetBrains s.r.o<br>Windows 10 10.0</p>
<h1 id="IDEA-配置"><a href="#IDEA-配置" class="headerlink" title="IDEA 配置"></a>IDEA 配置</h1><h3 id="配置字体和字号及主题"><a href="#配置字体和字号及主题" class="headerlink" title="配置字体和字号及主题"></a>配置字体和字号及主题</h3><p>选择  setting  -&gt; Editor-&gt; Color Scheme -&gt; Color Scheme Font   修改字体和字号</p>
<h3 id="配置-Maven-的-setting-文件"><a href="#配置-Maven-的-setting-文件" class="headerlink" title="配置 Maven 的 setting 文件"></a>配置 Maven 的 setting 文件</h3><p>过滤 Idea 中项目配置文件</p>
<p>Editor —&gt; File type 添加过滤文件 .ldea;*.iml，这样项目目录就不会出现 .Idea 文件和以  .iml 结尾的文件，但是上述文件在文件系统中仍然能找到，只不过被过滤了，不在 idea 项目目录中显示而已</p>
<h3 id="移除形参名提示"><a href="#移除形参名提示" class="headerlink" title="移除形参名提示"></a>移除形参名提示</h3><p>Editor -&gt; appearance -&gt; show parameter name hints 取消勾选即可</p>
<h3 id="IDEA-创建项目"><a href="#IDEA-创建项目" class="headerlink" title="IDEA 创建项目"></a>IDEA 创建项目</h3><p>菜单栏中 File -&gt; new -&gt; 点击 Projects 或者 Module 创建项目</p>
<p>创建 Project 与Module 的区别</p>
<ol>
<li>Project 项目，一个窗口只能创建一个 Project 项目</li>
<li>Module 模块，一个窗口中可以创建多个 Module 模块</li>
</ol>
<h1 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h1><p>IDEA 中的常用的快捷键</p>
<table>
<thead>
<tr>
<th>IDEA 快捷键</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>Ctrl+N</td>
<td>搜索类、接口</td>
</tr>
<tr>
<td>Ctrl+Shirt+N</td>
<td>搜索文件</td>
</tr>
<tr>
<td>Ctrl+D</td>
<td>复制行和粘贴光标所在行</td>
</tr>
<tr>
<td>Ctrl+ y</td>
<td>删除鼠标所在行</td>
</tr>
<tr>
<td>Alt+enter</td>
<td>导包，创建局部变量</td>
</tr>
<tr>
<td>Shirtf + F6</td>
<td>点击类名，重命名</td>
</tr>
<tr>
<td>Ctrl +/</td>
<td>单行注释</td>
</tr>
<tr>
<td>Ctrl+Shirt+/</td>
<td>多行注释</td>
</tr>
<tr>
<td>Trycatch 语句块</td>
<td>Ctrl+Alt+T</td>
</tr>
<tr>
<td>生成 setter和getter 方法</td>
<td>Alt+Insert</td>
</tr>
<tr>
<td>Ctrl+Q</td>
<td>查看代码提示及内容</td>
</tr>
<tr>
<td>Ctrl+B</td>
<td>查看类的声明</td>
</tr>
<tr>
<td>Ctrl+Alt+backspace</td>
<td>代码提示</td>
</tr>
<tr>
<td>Ctrl+Shirt+up or down</td>
<td>移动当前行</td>
</tr>
<tr>
<td>Ctrl+H</td>
<td>查看类结构</td>
</tr>
</tbody></table>
<h3 id="修改为-Eclipse-快捷键"><a href="#修改为-Eclipse-快捷键" class="headerlink" title="修改为 Eclipse 快捷键"></a>修改为 Eclipse 快捷键</h3><p>File -&gt; Setting  -&gt;  keymap 可以修改为 Eclipse 的快捷键</p>
<h3 id="代码模版"><a href="#代码模版" class="headerlink" title="代码模版"></a>代码模版</h3><p>File  -&gt; Setting  -&gt; Editor -&gt; Live Template  设置 syso 快捷键和方法模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#方法模板</span><br><span class="line">/**</span><br><span class="line"> * 功能描述：</span><br><span class="line"> * @param:$param$</span><br><span class="line"> * @return:$return$</span><br><span class="line"> * @auther:$user$</span><br><span class="line"> * @data:$date$$time$</span><br><span class="line"> **/</span><br></pre></td></tr></table></figure>

<p>File-&gt; Editor -&gt; File and Code Templates 修改类模板 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* @Auther:$&#123;USER&#125;</span><br><span class="line">* @Date:$&#123;DATE&#125;</span><br><span class="line">* @Description:$&#123;PACKAGE_NAME&#125;</span><br><span class="line">* @Version:1.0</span><br><span class="line">**/</span><br></pre></td></tr></table></figure>

<h1 id="创建-Maven-项目"><a href="#创建-Maven-项目" class="headerlink" title="创建 Maven 项目"></a>创建 Maven 项目</h1><h3 id="普通项目"><a href="#普通项目" class="headerlink" title="普通项目"></a>普通项目</h3><p> 从 idea 内部查找插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-DarchetypeCatalog=internal</span><br></pre></td></tr></table></figure>

<h3 id="指定目录的标记"><a href="#指定目录的标记" class="headerlink" title="指定目录的标记"></a>指定目录的标记</h3><p>将不同功能的文件夹标记为不同类型的标记（Sources、Tests、Resource、TestResource、Excluded）</p>
<p>项目右击鼠标选择 Project structure -&gt; Modules </p>
<h3 id="修改-pom-xml"><a href="#修改-pom-xml" class="headerlink" title="修改 pom.xml"></a>修改 pom.xml</h3><p>在Servlet api 的坐标中由于 tomcat 中已经有 servlet api，所以在 maven 的web项目中 serlvetl api 只需作用于当前的项目即可，所以需要添加作用域 <scope>provided</scope></p>
<h4 id="重写方法"><a href="#重写方法" class="headerlink" title="重写方法"></a>重写方法</h4><p>菜单栏  Code -&gt;overrided</p>
<h3 id="启动-tomcat-可视化"><a href="#启动-tomcat-可视化" class="headerlink" title="启动 tomcat  可视化"></a>启动 tomcat  可视化</h3><p>右侧 Maven Project 栏 中找到 <code>tomcat7:run</code>  双击启动</p>
<h1 id="创建聚合工程"><a href="#创建聚合工程" class="headerlink" title="创建聚合工程"></a>创建聚合工程</h1><blockquote>
<p>Site 表示聚合工程</p>
<p>Quick 表示 jar 工程</p>
<p>Webapp 表示 war 工程</p>
</blockquote>
<h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><p>—–manager                      pom</p>
<p>​      ———–manager-pojo                 jar</p>
<p>​      ————manager-mapper         jar</p>
<p>​      ————-manager-service          jar </p>
<p>​      ————-manger-controller     war </p>
<h3 id="jar-依赖"><a href="#jar-依赖" class="headerlink" title="jar 依赖"></a>jar 依赖</h3><table>
<thead>
<tr>
<th>Maven坐标</th>
<th>依赖</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>spring-contexts</td>
<td>service</td>
<td>spring 上下文</td>
</tr>
<tr>
<td>spring-beans</td>
<td>service</td>
<td>bean 工厂</td>
</tr>
<tr>
<td>spring-jdbc</td>
<td>service</td>
<td>spring 与 jdbc 整合</td>
</tr>
<tr>
<td>spring-aspects</td>
<td>service</td>
<td>aspectJ  框架整合</td>
</tr>
<tr>
<td>spring-webmvc</td>
<td>controller</td>
<td>SpringMVC</td>
</tr>
<tr>
<td>mybatis</td>
<td>mapper</td>
<td>mybatis 框架</td>
</tr>
<tr>
<td>mybaits-spring</td>
<td>mapper</td>
<td>spring 与 mybatis 框架的整合</td>
</tr>
<tr>
<td>mysql-connector-java</td>
<td>mapper</td>
<td>mysql驱动</td>
</tr>
<tr>
<td>druid</td>
<td>mapper</td>
<td>阿里巴巴 druid 数据库连接池</td>
</tr>
<tr>
<td>jstl</td>
<td>controller</td>
<td>提供 jstl 标签库</td>
</tr>
<tr>
<td>jsp</td>
<td>controller</td>
<td>注意：作用域选择 provided</td>
</tr>
<tr>
<td>serlvet-api</td>
<td>controller</td>
<td>注意：作用域选择 provided</td>
</tr>
</tbody></table>
<p>父项目中 pom.xml 文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.szxy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>manager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>manager-pojo<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>manager-mapper<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>manager-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>manager-web<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">junit-version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-version</span>&gt;</span>4.3.10.RELEASE<span class="tag">&lt;/<span class="name">spring-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-version</span>&gt;</span>3.2.8<span class="tag">&lt;/<span class="name">mybatis-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-spring-version</span>&gt;</span>1.2.2<span class="tag">&lt;/<span class="name">mybatis-spring-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql-connector-version</span>&gt;</span>5.1.32<span class="tag">&lt;/<span class="name">mysql-connector-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">druip-version</span>&gt;</span>1.0.9<span class="tag">&lt;/<span class="name">druip-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jstl-version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">jstl-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jsp-version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">jsp-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">servlet-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tomcat-plugin-version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">tomcat-plugin-version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--junit 测试--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--spring 相关--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybaits 及 mybatis-spring 整合--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql-connector-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druip-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jstl &amp;&amp; jsp--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jstl-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jsp-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--servlet-api--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;servlet-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--资源拷贝插件--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/**.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/**.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/**.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;tomcat-plugin-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">port</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="使用-tomcat-插件"><a href="#使用-tomcat-插件" class="headerlink" title="使用 tomcat 插件"></a>使用 tomcat 插件</h3><ul>
<li><p>在子项目中使用 tomcat 插件要求所有聚合工程必须安装</p>
</li>
<li><p>在父项目中使用 tomcat 插件不要求所有工程必须要安装</p>
<p>即在父项目不需要声明 tomcat 插件，而是使用 tomcat 插件即可</p>
<p>通过父项目中 tomcat  插件，使用 tomcat7:run 直接运行</p>
</li>
</ul>
<h3 id="项目整合的配置文件"><a href="#项目整合的配置文件" class="headerlink" title="项目整合的配置文件"></a>项目整合的配置文件</h3><h4 id="applicationContext-Dao-xml"><a href="#applicationContext-Dao-xml" class="headerlink" title="applicationContext-Dao.xml"></a>applicationContext-Dao.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置解析properties文件的工具类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置数据源 dataSource 阿里数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minIdle"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 创建mybatis的上下文对象  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:sqlMapperClient.xml<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 扫描mybatis的接口与映射配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"cn.szxy.mapper"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="applicationContext-tx-xml"><a href="#applicationContext-tx-xml" class="headerlink" title="applicationContext-tx.xml"></a>applicationContext-tx.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop/spring-aop-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置事物管理器的切面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionMananger"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置事物传播行为 ：其实就是那些方法应该受什么样的事物控制--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"advice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionMananger"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"add*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"modify*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"dorp*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"del*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 那些类下的方法需要参与到当前的事物管理中 。配置切点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"advice"</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">pointcut</span>=<span class="string">"execution(* cn.szxy.service.*.*(..))"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop/spring-aop-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置事物管理器的切面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionMananger"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置事物传播行为 ：其实就是那些方法应该受什么样的事物控制--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"advice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionMananger"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"add*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"modify*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"dorp*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"del*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 那些类下的方法需要参与到当前的事物管理中 。配置切点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"advice"</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">pointcut</span>=<span class="string">"execution(* cn.szxy.service.*.*(..))"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="applicationContext-service-xml"><a href="#applicationContext-service-xml" class="headerlink" title="applicationContext-service.xml"></a>applicationContext-service.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">	   http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd "</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 扫描bean对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.szxy.service"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="springmvc-xml"><a href="#springmvc-xml" class="headerlink" title="springmvc.xml"></a>springmvc.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd "</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 包的扫描器主要是扫描@controller --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.szxy.controller"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 注册两个新对象 主要是为了来处理 springmvc中的其他anntation 如：@requestmapping --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 视图解析器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span>/&gt;</span><span class="comment">&lt;!-- jsp所在的前缀 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置静态资源映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/css/"</span> <span class="attr">mapping</span>=<span class="string">"/css/**"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/js/"</span> <span class="attr">mapping</span>=<span class="string">"/js/**"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="sqlMapperClient-xml"><a href="#sqlMapperClient-xml" class="headerlink" title="sqlMapperClient.xml"></a>sqlMapperClient.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置分页 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="userMapper-xml-模板"><a href="#userMapper-xml-模板" class="headerlink" title="userMapper.xml 模板"></a>userMapper.xml 模板</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"cn.szxy.mapper.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"cn.szxy.pojo.Users"</span>&gt;</span></span><br><span class="line">        insert into tbl_user values(default,#&#123;username&#125;,#&#123;userage&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>ssm-01-jdbc<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置 spring 监听器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置 spring 配置文件的名称及位置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext-*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置编码过滤器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 必须设置为 true， 否则设置 utf-8 编码无效 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- springmvc 配置 中央调度器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 springmvc 配置文件名称及位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="项目打包"><a href="#项目打包" class="headerlink" title="项目打包"></a>项目打包</h1><h3 id="Maven-项目打包"><a href="#Maven-项目打包" class="headerlink" title="Maven 项目打包"></a>Maven 项目打包</h3><p>依赖于 Maven的插件中 LifeCycle 中package命令（IDEA主界面右上角部分有 Maven Projects，里面有Maven 可视化命令）最后 Maven 项目打包完成的部分提示信息，出现以下 Build Suuccess 字样证明该 Maven 项目打包完成，包的位置在 Building war: 后面的绝对路径加打包的名称</p>
<p>eg. Building war: E:\workspacesIDEA\manager\manager-web\target\manager-web-1.0-SNAPSHOT.war</p>
<p>注意：执行打包命名时，会先执行 <code>test</code> 测试命令，用于测试代码是否有问题。然后再执行 Package 命令打包。若代码中出现意外的情况，如  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private UserMapper userMapper;</span><br></pre></td></tr></table></figure>

<p>接口 UserMapper 是可以导入，但是后面的变量 userMapper 下面有红色波浪线，表示 Could not autowire. No beans of ‘UserMapper’ type found。其实编译、运行是可以通过的。</p>
<p>不过执行 package 命令却会报错，解决方法去除 Maven 目录中 src/test 中 IDEA 自己生成的测试类即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Packaging webapp</span><br><span class="line">[INFO] Assembling webapp [manager-web] in [E:\workspacesIDEA\manager\manager-web\target\manager-web-1.0-SNAPSHOT]</span><br><span class="line">[INFO] Processing war project</span><br><span class="line">[INFO] Copying webapp resources [E:\workspacesIDEA\manager\manager-web\src\main\webapp]</span><br><span class="line">[INFO] Webapp assembled in [746 msecs]</span><br><span class="line">[INFO] Building war: E:\workspacesIDEA\manager\manager-web\target\manager-web-1.0-SNAPSHOT.war</span><br><span class="line">[INFO] WEB-INF\web.xml already added, skipping</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Reactor Summary:</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] manager 1.0-SNAPSHOT ............................... SUCCESS [  0.007 s]</span><br><span class="line">[INFO] manager-pojo ....................................... SUCCESS [  3.826 s]</span><br><span class="line">[INFO] manager-mapper ..................................... SUCCESS [  0.360 s]</span><br><span class="line">[INFO] manager-service .................................... SUCCESS [  0.527 s]</span><br><span class="line">[INFO] manager-web 1.0-SNAPSHOT ........................... SUCCESS [  2.900 s]</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p><img src="http://www.zwer.xyz/picGo/20190528162724.png" alt></p>
<h3 id="非Maven-项目打包"><a href="#非Maven-项目打包" class="headerlink" title="非Maven 项目打包"></a>非Maven 项目打包</h3><p><strong>step1:</strong>右击项目选择 Project Structure -&gt; Artifacts -&gt; 单击右侧 + 加号  -&gt; jar -&gt; Empty </p>
<p>在右侧为当前 jar 包选择 name 和 Output Directiory ，再在 Available Elements 选择项目</p>
<p><strong>step2:</strong>选择菜单栏 Build -&gt; build Artifacts -&gt; 选择项目 —&gt;action -&gt; build 即可生成 jar 包</p>
<p><img src="http://www.zwer.xyz/picGo/20190528162216.png" alt></p>
<p><img src="http://www.zwer.xyz/picGo/20190528162407.png" alt></p>
<h1 id="SVN-管理"><a href="#SVN-管理" class="headerlink" title="SVN 管理"></a>SVN 管理</h1><h3 id="脱离-SVN-管理"><a href="#脱离-SVN-管理" class="headerlink" title="脱离 SVN 管理"></a>脱离 SVN 管理</h3><p><strong>step1：</strong>删除项目根目录下隐藏文件 .svn</p>
<p><strong>step2：</strong>在 idea 目录下编辑  vcs.xml 文件</p>
<h1 id="使用Git-管理项目"><a href="#使用Git-管理项目" class="headerlink" title="使用Git 管理项目"></a>使用Git 管理项目</h1><h3 id="使用本地-Git-仓库管理代码"><a href="#使用本地-Git-仓库管理代码" class="headerlink" title="使用本地 Git 仓库管理代码"></a>使用本地 Git 仓库管理代码</h3><p>先安装 Git.exe 软件</p>
<p>选择菜单栏中 VCS -&gt;  Import  into  Version Controll -&gt; Create Git Repository  单击</p>
<p>若创建成功则在菜单栏下出现 Git 字样</p>
<h3 id="使用远程仓库管理代码"><a href="#使用远程仓库管理代码" class="headerlink" title="使用远程仓库管理代码"></a>使用远程仓库管理代码</h3><p>右击选择项目 Git - &gt; Repository —&gt; Push  发布项目</p>
<h1 id="IDEA-中-Debug-的使用"><a href="#IDEA-中-Debug-的使用" class="headerlink" title="IDEA 中 Debug 的使用"></a>IDEA 中 Debug 的使用</h1><p> 以 mapper 项目为例，先在 mapper 项目中代码的左侧标记断点（红色）</p>
<p>然后选择 <code>tomcat7:run</code>右击选择以 debug 方式运行</p>
<p><img src="http://www.zwer.xyz/picGo/20190528171248.png" alt></p>
<p><img src="http://www.zwer.xyz/picGo/20190528170738.png" alt></p>
<h1 id="IDEA-中的-RESTful-Client-工具使用"><a href="#IDEA-中的-RESTful-Client-工具使用" class="headerlink" title="IDEA 中的 RESTful Client 工具使用"></a>IDEA 中的 RESTful Client 工具使用</h1><blockquote>
<p>模拟客户端的请求（如：get、post、delete、put）</p>
</blockquote>
<blockquote>
<p>选择 Tools -&gt; HTTP Client  -&gt; Test RESTful Client Web   Service </p>
</blockquote>
<p><img src="http://www.zwer.xyz/picGo/20190528180402.png" alt></p>
<p><img src="http://www.zwer.xyz/picGo/20190528180449.png" alt></p>
<h4 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  doPost 方法</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@RequestMapping</span>(value=<span class="string">"/doPost"</span>,method=RequestMethod.POST)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">doPost</span><span class="params">(Users user)</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"ok...."</span>+user);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"ok"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  doPut 方法，用于更新某些信息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@RequestMapping</span>(value=<span class="string">"/doPut/&#123;id&#125;"</span>,method=RequestMethod.PUT)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">doPut</span><span class="params">(@PathVariable String id)</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"ok..... put: "</span>+id);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"ok"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  doDelete 方法，用于删除某些信息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@RequestMapping</span>(value=<span class="string">"/doDelete/&#123;id&#125;"</span>,method=RequestMethod.DELETE)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">doDelete</span><span class="params">(@PathVariable String id)</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"ok..... delete:"</span>+id);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"ok"</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h1 id="IDEA-中的-Linux（SSH）"><a href="#IDEA-中的-Linux（SSH）" class="headerlink" title="IDEA 中的 Linux（SSH）"></a>IDEA 中的 Linux（SSH）</h1><h3 id="设置-Linux-链接地址"><a href="#设置-Linux-链接地址" class="headerlink" title="设置 Linux 链接地址"></a>设置 Linux 链接地址</h3><p>选择菜单栏 File -&gt; setting -&gt; Build,Execution,Deployment -&gt; Deployment</p>
<p><img src="http://www.zwer.xyz/picGo/20190528182000.png" alt></p>
<h3 id="使用-SSH-工具"><a href="#使用-SSH-工具" class="headerlink" title="使用 SSH 工具"></a>使用 SSH 工具</h3><p>选择菜单栏 Tools -&gt; Start SSH session ….</p>
<p><img src="http://www.zwer.xyz/picGo/20190528182139.png" alt></p>
<p><img src="http://www.zwer.xyz/picGo/20190528182249.png" alt></p>
<h3 id="使用-FTP-工具上传项目文件"><a href="#使用-FTP-工具上传项目文件" class="headerlink" title="使用 FTP 工具上传项目文件"></a>使用 FTP 工具上传项目文件</h3><p><img src="http://www.zwer.xyz/picGo/20190528182502.png" alt></p>
<p><img src="http://www.zwer.xyz/picGo/20190528190050.png" alt></p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/27/markdown/20190528 IDEAJ 的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/27/markdown/20190528 IDEAJ 的使用/" class="post-title-link" itemprop="url">20190527 IDEA 的使用</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-27 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-27T00:00:00+08:00">2019-05-27</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-30 16:54:43" itemprop="dateModified" datetime="2019-05-30T16:54:43+08:00">2019-05-30</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/工具/" itemprop="url" rel="index"><span itemprop="name">工具</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="IDEA-版本"><a href="#IDEA-版本" class="headerlink" title="IDEA 版本"></a>IDEA 版本</h1><p>IntelliJ IDEA 2018.2.4 (Ultimate Edition)<br>Build #IU-182.4505.22, built on September 18, 2018<br>Licensed to Nss Im<br>Subscription is active until November 7, 2019<br>JRE: 1.8.0_152-release-1248-b8 amd64<br>JVM: OpenJDK 64-Bit Server VM by JetBrains s.r.o<br>Windows 10 10.0</p>
<h1 id="IDEA-配置"><a href="#IDEA-配置" class="headerlink" title="IDEA 配置"></a>IDEA 配置</h1><h3 id="配置字体和字号及主题"><a href="#配置字体和字号及主题" class="headerlink" title="配置字体和字号及主题"></a>配置字体和字号及主题</h3><p>选择  setting  -&gt; Editor-&gt; Color Scheme -&gt; Color Scheme Font   修改字体和字号</p>
<h3 id="配置-Maven-的-setting-文件"><a href="#配置-Maven-的-setting-文件" class="headerlink" title="配置 Maven 的 setting 文件"></a>配置 Maven 的 setting 文件</h3><p>过滤 Idea 中项目配置文件</p>
<p>Editor —&gt; File type 添加过滤文件 .ldea;*.iml，这样项目目录就不会出现 .Idea 文件和以  .iml 结尾的文件，但是上述文件在文件系统中仍然能找到，只不过被过滤了，不在 idea 项目目录中显示而已</p>
<h3 id="移除形参名提示"><a href="#移除形参名提示" class="headerlink" title="移除形参名提示"></a>移除形参名提示</h3><p>Editor -&gt; appearance -&gt; show parameter name hints 取消勾选即可</p>
<h2 id="IDEA-创建项目"><a href="#IDEA-创建项目" class="headerlink" title="IDEA 创建项目"></a>IDEA 创建项目</h2><p>菜单栏中 File -&gt; new -&gt; 点击 Projects 或者 Module 创建项目</p>
<p>创建 Project 与Module 的区别</p>
<ol>
<li>Project 项目，一个窗口只能创建一个 Project 项目</li>
<li>Module 模块，一个窗口中可以创建多个 Module 模块</li>
</ol>
<h1 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h1><blockquote>
<p>DEA 中的常用的快捷键</p>
</blockquote>
<table>
<thead>
<tr>
<th>IDEA 快捷键</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>Ctrl+N</td>
<td>搜索类、接口</td>
</tr>
<tr>
<td>Ctrl+Shirt+N</td>
<td>搜索文件</td>
</tr>
<tr>
<td>Ctrl+D</td>
<td>复制行和粘贴光标所在行</td>
</tr>
<tr>
<td>Ctrl+ y</td>
<td>删除鼠标所在行</td>
</tr>
<tr>
<td>Alt+enter</td>
<td>导包，创建局部变量</td>
</tr>
<tr>
<td>Shirtf + F6</td>
<td>点击类名，重命名</td>
</tr>
<tr>
<td>Ctrl +/</td>
<td>单行注释</td>
</tr>
<tr>
<td>Ctrl+Shirt+/</td>
<td>多行注释</td>
</tr>
<tr>
<td>Trycatch 语句块</td>
<td>Ctrl+Alt+T</td>
</tr>
<tr>
<td>生成 setter和getter 方法</td>
<td>Alt+Insert</td>
</tr>
<tr>
<td>Ctrl+Q</td>
<td>查看代码提示及内容</td>
</tr>
<tr>
<td>Ctrl+B</td>
<td>查看类的声明</td>
</tr>
<tr>
<td>Ctrl+Alt+backspace</td>
<td>代码提示</td>
</tr>
<tr>
<td>Ctrl+Shirt+up or down</td>
<td>移动当前行</td>
</tr>
<tr>
<td>Ctrl+H</td>
<td>查看类结构</td>
</tr>
</tbody></table>
<h3 id="修改为-Eclipse-快捷键"><a href="#修改为-Eclipse-快捷键" class="headerlink" title="修改为 Eclipse 快捷键"></a>修改为 Eclipse 快捷键</h3><p>File -&gt; Setting  -&gt;  keymap 可以修改为 Eclipse 的快捷键</p>
<h3 id="代码模版"><a href="#代码模版" class="headerlink" title="代码模版"></a>代码模版</h3><p>File  -&gt; Setting  -&gt; Editor -&gt; Live Template  设置 syso 快捷键和方法模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#方法模板</span><br><span class="line">/**</span><br><span class="line"> * 功能描述：</span><br><span class="line"> * @param:$param$</span><br><span class="line"> * @return:$return$</span><br><span class="line"> * @auther:$user$</span><br><span class="line"> * @data:$date$$time$</span><br><span class="line"> **/</span><br></pre></td></tr></table></figure>

<p>File-&gt; Editor -&gt; File and Code Templates 修改类模板 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* @Auther:$&#123;USER&#125;</span><br><span class="line">* @Date:$&#123;DATE&#125;</span><br><span class="line">* @Description:$&#123;PACKAGE_NAME&#125;</span><br><span class="line">* @Version:1.0</span><br><span class="line">**/</span><br></pre></td></tr></table></figure>

<h1 id="创建-Maven-项目"><a href="#创建-Maven-项目" class="headerlink" title="创建 Maven 项目"></a>创建 Maven 项目</h1><h3 id="普通项目"><a href="#普通项目" class="headerlink" title="普通项目"></a>普通项目</h3><p> 从 idea 内部查找插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-DarchetypeCatalog=internal</span><br></pre></td></tr></table></figure>

<h3 id="指定目录的标记"><a href="#指定目录的标记" class="headerlink" title="指定目录的标记"></a>指定目录的标记</h3><p>将不同功能的文件夹标记为不同类型的标记（Sources、Tests、Resource、TestResource、Excluded）</p>
<p>项目右击鼠标选择 Project structure -&gt; Modules </p>
<h3 id="修改-pom-xml"><a href="#修改-pom-xml" class="headerlink" title="修改 pom.xml"></a>修改 pom.xml</h3><p>在Servlet api 的坐标中由于 tomcat 中已经有 servlet api，所以在 maven 的web项目中 serlvetl api 只需作用于当前的项目即可，所以需要添加作用域 <scope>provided</scope></p>
<h4 id="重写方法"><a href="#重写方法" class="headerlink" title="重写方法"></a>重写方法</h4><p>菜单栏  Code -&gt;overrided</p>
<h3 id="启动-tomcat-可视化"><a href="#启动-tomcat-可视化" class="headerlink" title="启动 tomcat  可视化"></a>启动 tomcat  可视化</h3><p>右侧 Maven Project 栏 中找到 <code>tomcat7:run</code>  双击启动</p>
<h1 id="创建聚合工程"><a href="#创建聚合工程" class="headerlink" title="创建聚合工程"></a>创建聚合工程</h1><blockquote>
<p>Site 表示聚合工程</p>
<p>Quick 表示 jar 工程</p>
<p>Webapp 表示 war 工程</p>
</blockquote>
<h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><p>—–manager                      pom</p>
<p>​      ———–manager-pojo                 jar</p>
<p>​      ————manager-mapper         jar</p>
<p>​      ————-manager-service          jar </p>
<p>​      ————-manger-controller     war </p>
<h3 id="jar-依赖"><a href="#jar-依赖" class="headerlink" title="jar 依赖"></a>jar 依赖</h3><table>
<thead>
<tr>
<th>Maven坐标</th>
<th>依赖</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>spring-contexts</td>
<td>service</td>
<td>spring 上下文</td>
</tr>
<tr>
<td>spring-beans</td>
<td>service</td>
<td>bean 工厂</td>
</tr>
<tr>
<td>spring-jdbc</td>
<td>service</td>
<td>spring 与 jdbc 整合</td>
</tr>
<tr>
<td>spring-aspects</td>
<td>service</td>
<td>aspectJ  框架整合</td>
</tr>
<tr>
<td>spring-webmvc</td>
<td>controller</td>
<td>SpringMVC</td>
</tr>
<tr>
<td>mybatis</td>
<td>mapper</td>
<td>mybatis 框架</td>
</tr>
<tr>
<td>mybaits-spring</td>
<td>mapper</td>
<td>spring 与 mybatis 框架的整合</td>
</tr>
<tr>
<td>mysql-connector-java</td>
<td>mapper</td>
<td>mysql驱动</td>
</tr>
<tr>
<td>druid</td>
<td>mapper</td>
<td>阿里巴巴 druid 数据库连接池</td>
</tr>
<tr>
<td>jstl</td>
<td>controller</td>
<td>提供 jstl 标签库</td>
</tr>
<tr>
<td>jsp</td>
<td>controller</td>
<td>注意：作用域选择 provided</td>
</tr>
<tr>
<td>serlvet-api</td>
<td>controller</td>
<td>注意：作用域选择 provided</td>
</tr>
</tbody></table>
<p>父项目中 pom.xml 文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.szxy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>manager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>manager-pojo<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>manager-mapper<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>manager-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>manager-web<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">junit-version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-version</span>&gt;</span>4.3.10.RELEASE<span class="tag">&lt;/<span class="name">spring-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-version</span>&gt;</span>3.2.8<span class="tag">&lt;/<span class="name">mybatis-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-spring-version</span>&gt;</span>1.2.2<span class="tag">&lt;/<span class="name">mybatis-spring-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql-connector-version</span>&gt;</span>5.1.32<span class="tag">&lt;/<span class="name">mysql-connector-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">druip-version</span>&gt;</span>1.0.9<span class="tag">&lt;/<span class="name">druip-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jstl-version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">jstl-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jsp-version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">jsp-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">servlet-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tomcat-plugin-version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">tomcat-plugin-version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--junit 测试--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--spring 相关--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybaits 及 mybatis-spring 整合--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql-connector-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druip-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jstl &amp;&amp; jsp--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jstl-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jsp-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--servlet-api--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;servlet-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--资源拷贝插件--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/**.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/**.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/**.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;tomcat-plugin-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">port</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="使用-tomcat-插件"><a href="#使用-tomcat-插件" class="headerlink" title="使用 tomcat 插件"></a>使用 tomcat 插件</h3><ul>
<li><p>在子项目中使用 tomcat 插件要求所有聚合工程必须安装</p>
</li>
<li><p>在父项目中使用 tomcat 插件不要求所有工程必须要安装</p>
<p>即在父项目不需要声明 tomcat 插件，而是使用 tomcat 插件即可</p>
<p>通过父项目中 tomcat  插件，使用 tomcat7:run 直接运行</p>
</li>
</ul>
<h3 id="项目整合的配置文件"><a href="#项目整合的配置文件" class="headerlink" title="项目整合的配置文件"></a>项目整合的配置文件</h3><h4 id="applicationContext-Dao-xml"><a href="#applicationContext-Dao-xml" class="headerlink" title="applicationContext-Dao.xml"></a>applicationContext-Dao.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置解析properties文件的工具类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置数据源 dataSource 阿里数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minIdle"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 创建mybatis的上下文对象  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:sqlMapperClient.xml<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 扫描mybatis的接口与映射配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"cn.szxy.mapper"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="applicationContext-tx-xml"><a href="#applicationContext-tx-xml" class="headerlink" title="applicationContext-tx.xml"></a>applicationContext-tx.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop/spring-aop-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置事物管理器的切面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionMananger"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置事物传播行为 ：其实就是那些方法应该受什么样的事物控制--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"advice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionMananger"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"add*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"modify*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"dorp*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"del*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 那些类下的方法需要参与到当前的事物管理中 。配置切点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"advice"</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">pointcut</span>=<span class="string">"execution(* cn.szxy.service.*.*(..))"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop/spring-aop-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置事物管理器的切面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionMananger"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置事物传播行为 ：其实就是那些方法应该受什么样的事物控制--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"advice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionMananger"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"add*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"modify*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"dorp*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"del*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 那些类下的方法需要参与到当前的事物管理中 。配置切点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"advice"</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">pointcut</span>=<span class="string">"execution(* cn.szxy.service.*.*(..))"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="applicationContext-service-xml"><a href="#applicationContext-service-xml" class="headerlink" title="applicationContext-service.xml"></a>applicationContext-service.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">	   http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd "</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 扫描bean对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.szxy.service"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="springmvc-xml"><a href="#springmvc-xml" class="headerlink" title="springmvc.xml"></a>springmvc.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd "</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 包的扫描器主要是扫描@controller --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.szxy.controller"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 注册两个新对象 主要是为了来处理 springmvc中的其他anntation 如：@requestmapping --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 视图解析器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span>/&gt;</span><span class="comment">&lt;!-- jsp所在的前缀 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置静态资源映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/css/"</span> <span class="attr">mapping</span>=<span class="string">"/css/**"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/js/"</span> <span class="attr">mapping</span>=<span class="string">"/js/**"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="sqlMapperClient-xml"><a href="#sqlMapperClient-xml" class="headerlink" title="sqlMapperClient.xml"></a>sqlMapperClient.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置分页 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="userMapper-xml-模板"><a href="#userMapper-xml-模板" class="headerlink" title="userMapper.xml 模板"></a>userMapper.xml 模板</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"cn.szxy.mapper.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"cn.szxy.pojo.Users"</span>&gt;</span></span><br><span class="line">        insert into tbl_user values(default,#&#123;username&#125;,#&#123;userage&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>ssm-01-jdbc<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置 spring 监听器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置 spring 配置文件的名称及位置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext-*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置编码过滤器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 必须设置为 true， 否则设置 utf-8 编码无效 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- springmvc 配置 中央调度器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 springmvc 配置文件名称及位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="项目打包"><a href="#项目打包" class="headerlink" title="项目打包"></a>项目打包</h1><h3 id="Maven-项目打包"><a href="#Maven-项目打包" class="headerlink" title="Maven 项目打包"></a>Maven 项目打包</h3><p>依赖于 Maven的插件中 LifeCycle 中package命令（IDEA主界面右上角部分有 Maven Projects，里面有Maven 可视化命令）最后 Maven 项目打包完成的部分提示信息，出现以下 Build Suuccess 字样证明该 Maven 项目打包完成，包的位置在 Building war: 后面的绝对路径加打包的名称</p>
<p>eg. Building war: E:\workspacesIDEA\manager\manager-web\target\manager-web-1.0-SNAPSHOT.war</p>
<p>注意：执行打包命名时，会先执行 <code>test</code> 测试命令，用于测试代码是否有问题。然后再执行 Package 命令打包。若代码中出现意外的情况，如  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private UserMapper userMapper;</span><br></pre></td></tr></table></figure>

<p>接口 UserMapper 是可以导入，但是后面的变量 userMapper 下面有红色波浪线，表示 Could not autowire. No beans of ‘UserMapper’ type found。其实编译、运行是可以通过的。</p>
<p>不过执行 package 命令却会报错，解决方法去除 Maven 目录中 src/test 中 IDEA 自己生成的测试类即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Packaging webapp</span><br><span class="line">[INFO] Assembling webapp [manager-web] in [E:\workspacesIDEA\manager\manager-web\target\manager-web-1.0-SNAPSHOT]</span><br><span class="line">[INFO] Processing war project</span><br><span class="line">[INFO] Copying webapp resources [E:\workspacesIDEA\manager\manager-web\src\main\webapp]</span><br><span class="line">[INFO] Webapp assembled in [746 msecs]</span><br><span class="line">[INFO] Building war: E:\workspacesIDEA\manager\manager-web\target\manager-web-1.0-SNAPSHOT.war</span><br><span class="line">[INFO] WEB-INF\web.xml already added, skipping</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Reactor Summary:</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] manager 1.0-SNAPSHOT ............................... SUCCESS [  0.007 s]</span><br><span class="line">[INFO] manager-pojo ....................................... SUCCESS [  3.826 s]</span><br><span class="line">[INFO] manager-mapper ..................................... SUCCESS [  0.360 s]</span><br><span class="line">[INFO] manager-service .................................... SUCCESS [  0.527 s]</span><br><span class="line">[INFO] manager-web 1.0-SNAPSHOT ........................... SUCCESS [  2.900 s]</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p><img src="http://www.zwer.xyz/picGo/20190528162724.png" alt></p>
<h3 id="非Maven-项目打包"><a href="#非Maven-项目打包" class="headerlink" title="非Maven 项目打包"></a>非Maven 项目打包</h3><p><strong>step1:</strong>右击项目选择 Project Structure -&gt; Artifacts -&gt; 单击右侧 + 加号  -&gt; jar -&gt; Empty </p>
<p>在右侧为当前 jar 包选择 name 和 Output Directiory ，再在 Available Elements 选择项目</p>
<p><strong>step2:</strong>选择菜单栏 Build -&gt; build Artifacts -&gt; 选择项目 —&gt;action -&gt; build 即可生成 jar 包</p>
<p><img src="http://www.zwer.xyz/picGo/20190528162216.png" alt></p>
<p><img src="http://www.zwer.xyz/picGo/20190528162407.png" alt></p>
<h1 id="SVN-管理"><a href="#SVN-管理" class="headerlink" title="SVN 管理"></a>SVN 管理</h1><h3 id="脱离-SVN-管理"><a href="#脱离-SVN-管理" class="headerlink" title="脱离 SVN 管理"></a>脱离 SVN 管理</h3><p><strong>step1：</strong>删除项目根目录下隐藏文件 .svn</p>
<p><strong>step2：</strong>在 idea 目录下编辑  vcs.xml 文件</p>
<h1 id="使用Git-管理项目"><a href="#使用Git-管理项目" class="headerlink" title="使用Git 管理项目"></a>使用Git 管理项目</h1><h3 id="使用本地-Git-仓库管理代码"><a href="#使用本地-Git-仓库管理代码" class="headerlink" title="使用本地 Git 仓库管理代码"></a>使用本地 Git 仓库管理代码</h3><p>先安装 Git.exe 软件</p>
<p>选择菜单栏中 VCS -&gt;  Import  into  Version Controll -&gt; Create Git Repository  单击</p>
<p>若创建成功则在菜单栏下出现 Git 字样</p>
<h3 id="使用远程仓库管理代码"><a href="#使用远程仓库管理代码" class="headerlink" title="使用远程仓库管理代码"></a>使用远程仓库管理代码</h3><p>右击选择项目 Git - &gt; Repository —&gt; Push  发布项目</p>
<h1 id="IDEA-中-Debug-的使用"><a href="#IDEA-中-Debug-的使用" class="headerlink" title="IDEA 中 Debug 的使用"></a>IDEA 中 Debug 的使用</h1><p> 以 mapper 项目为例，先在 mapper 项目中代码的左侧标记断点（红色）</p>
<p>然后选择 <code>tomcat7:run</code>右击选择以 debug 方式运行</p>
<p><img src="http://www.zwer.xyz/picGo/20190528171248.png" alt></p>
<p><img src="http://www.zwer.xyz/picGo/20190528170738.png" alt></p>
<h1 id="IDEA-中的-RESTful-Client-工具使用"><a href="#IDEA-中的-RESTful-Client-工具使用" class="headerlink" title="IDEA 中的 RESTful Client 工具使用"></a>IDEA 中的 RESTful Client 工具使用</h1><blockquote>
<p>模拟客户端的请求（如：get、post、delete、put）</p>
</blockquote>
<blockquote>
<p>选择 Tools -&gt; HTTP Client  -&gt; Test RESTful Client Web   Service </p>
</blockquote>
<p><img src="http://www.zwer.xyz/picGo/20190528180402.png" alt></p>
<p><img src="http://www.zwer.xyz/picGo/20190528180449.png" alt></p>
<h4 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  doPost 方法</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@RequestMapping</span>(value=<span class="string">"/doPost"</span>,method=RequestMethod.POST)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">doPost</span><span class="params">(Users user)</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"ok...."</span>+user);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"ok"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  doPut 方法，用于更新某些信息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@RequestMapping</span>(value=<span class="string">"/doPut/&#123;id&#125;"</span>,method=RequestMethod.PUT)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">doPut</span><span class="params">(@PathVariable String id)</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"ok..... put: "</span>+id);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"ok"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  doDelete 方法，用于删除某些信息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@RequestMapping</span>(value=<span class="string">"/doDelete/&#123;id&#125;"</span>,method=RequestMethod.DELETE)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">doDelete</span><span class="params">(@PathVariable String id)</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"ok..... delete:"</span>+id);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"ok"</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h1 id="IDEA-中的-Linux（SSH）"><a href="#IDEA-中的-Linux（SSH）" class="headerlink" title="IDEA 中的 Linux（SSH）"></a>IDEA 中的 Linux（SSH）</h1><h3 id="设置-Linux-链接地址"><a href="#设置-Linux-链接地址" class="headerlink" title="设置 Linux 链接地址"></a>设置 Linux 链接地址</h3><p>选择菜单栏 File -&gt; setting -&gt; Build,Execution,Deployment -&gt; Deployment</p>
<p><img src="http://www.zwer.xyz/picGo/20190528182000.png" alt></p>
<h3 id="使用-SSH-工具"><a href="#使用-SSH-工具" class="headerlink" title="使用 SSH 工具"></a>使用 SSH 工具</h3><p>选择菜单栏 Tools -&gt; Start SSH session ….</p>
<p><img src="http://www.zwer.xyz/picGo/20190528182139.png" alt></p>
<p><img src="http://www.zwer.xyz/picGo/20190528182249.png" alt></p>
<h3 id="使用-FTP-工具上传项目文件"><a href="#使用-FTP-工具上传项目文件" class="headerlink" title="使用 FTP 工具上传项目文件"></a>使用 FTP 工具上传项目文件</h3><p><img src="http://www.zwer.xyz/picGo/20190528182502.png" alt></p>
<p><img src="http://www.zwer.xyz/picGo/20190528190050.png" alt></p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/26/20190526 Redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/26/20190526 Redis/" class="post-title-link" itemprop="url">20190526 Redis</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-26 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-26T00:00:00+08:00">2019-05-26</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-06-02 12:42:42" itemprop="dateModified" datetime="2019-06-02T12:42:42+08:00">2019-06-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Redis"><a href="#1-Redis" class="headerlink" title="1 Redis"></a>1 Redis</h1><blockquote>
<p>Remote Dictionary Server（Redis）是一个开源的使用 ANSI C 语言编写，支持网络、可基于内存也可持久化的日志性、key-value 数据库，并提供多种语言的API 。</p>
<p>Redis 被称为数据结构服务器，主要功能是对查询信息进行内存缓存</p>
<p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message broker. It supports data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes with radius queries and streams. Redis has built-in replication, Lua scripting, LRU eviction, transactions and different levels of on-disk persistence, and provides high availability via Redis Sentinel and automatic partitioning with Redis Cluster.</p>
</blockquote>
<h1 id="2-安装-Redis-单机版"><a href="#2-安装-Redis-单机版" class="headerlink" title="2 安装 Redis 单机版"></a>2 安装 Redis 单机版</h1><blockquote>
<p>安装 Redis 3.0.0  </p>
<p>3.0 版本表示支持集群安装</p>
<p>版本号中副版本号奇数表示测试版，偶数表示稳定版，在生产环境中使用</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">安装 gcc</span></span><br><span class="line">gcc install gcc-c++</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">安装 redis 软件</span></span><br><span class="line">tar -zxf redis</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">进入 <span class="built_in">cd</span> redis 根据目录</span></span><br><span class="line"><span class="meta">#</span><span class="bash">编译</span></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">安装 redis 软件，并指定安装位置</span></span><br><span class="line"><span class="meta">#</span><span class="bash">注意 PREFIX 必须是大写</span></span><br><span class="line">make instal PREFIX=/usr/local/redis</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">进入 <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/redis/bin</span></span><br><span class="line"><span class="meta">#</span><span class="bash">前置启动</span></span><br><span class="line">./redis-server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">在 redis 解压包中奖 redis.conf 拷贝到 /usr/<span class="built_in">local</span>/redis目录下</span></span><br><span class="line"><span class="meta">#</span><span class="bash">编辑 redis.conf 文件，将文件的中 daemonisze no 改为 yes 即可</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">后端启动</span></span><br><span class="line">./redis-server redis.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看 redis 进程状态</span></span><br><span class="line">ps aux | grep redis</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">测试 redis</span></span><br><span class="line"><span class="meta">#</span><span class="bash">进入 /usr/<span class="built_in">local</span>/redis/bin</span></span><br><span class="line"><span class="meta">#</span><span class="bash">启动 redis 客户端</span></span><br><span class="line">./redis-cli</span><br><span class="line">输入 ping ---&gt; 返回 pong</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">前提使用 redis 后置启动</span></span><br><span class="line"><span class="meta">#</span><span class="bash">关闭 redis </span></span><br><span class="line"><span class="meta">#</span><span class="bash">进入 /usr/<span class="built_in">local</span>/redis/bin</span></span><br><span class="line">./redis-cli  shutdown</span><br></pre></td></tr></table></figure>

<p>前置启动，redis 启动后不能再输入其他命令，除了 Ctrl+C  停止 redis 服务</p>
<p><img src="http://www.zwer.xyz/picGo/20190526112645.png" alt></p>
<p>后置启动</p>
<p><img src="http://www.zwer.xyz/picGo/20190526113252.png" alt></p>
<h1 id="3-Redis-的数据类型"><a href="#3-Redis-的数据类型" class="headerlink" title="3 Redis 的数据类型"></a>3 Redis 的数据类型</h1><h2 id="3-1-String-类型"><a href="#3-1-String-类型" class="headerlink" title="3.1 String 类型"></a>3.1 String 类型</h2><blockquote>
<p>默认是字符序列</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">设置单个键值对</span></span><br><span class="line">set key value</span><br><span class="line"><span class="meta">#</span><span class="bash">设置多个键值对</span></span><br><span class="line">mset key1 value1 key2 value2 ...</span><br><span class="line"><span class="meta">#</span><span class="bash">获取单个键的值</span></span><br><span class="line">get key</span><br><span class="line"><span class="meta">#</span><span class="bash">获取多个键的值 </span></span><br><span class="line">mset key1 key2 key3</span><br><span class="line"><span class="meta">#</span><span class="bash">删除单个键值对</span></span><br><span class="line">del key</span><br><span class="line"><span class="meta">#</span><span class="bash">删除多个键值对</span></span><br><span class="line">flushdb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">设置字符串值的递增，每次递增为1</span></span><br><span class="line">incr key</span><br><span class="line"><span class="meta">#</span><span class="bash">设置字符串值的地址，每次递增为 num</span></span><br><span class="line">incrby key num</span><br></pre></td></tr></table></figure>

<h2 id="3-2-Hash-类型"><a href="#3-2-Hash-类型" class="headerlink" title="3.2 Hash 类型"></a>3.2 Hash 类型</h2><blockquote>
<p>hash 是键值对的集合</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">A[key] --&gt; B[field]</span><br><span class="line">A --&gt; C[filed2]</span><br><span class="line">B --&gt; value1</span><br><span class="line">C --&gt; value2</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">设置单个</span></span><br><span class="line">hset key field value</span><br><span class="line"><span class="meta">#</span><span class="bash">设置多个</span></span><br><span class="line">hmset key field value field2 value2</span><br><span class="line"><span class="meta">#</span><span class="bash">获取单个</span></span><br><span class="line">hget key field</span><br><span class="line"><span class="meta">#</span><span class="bash">获取多个</span></span><br><span class="line">hmget key field filed2 value2</span><br><span class="line"><span class="meta">#</span><span class="bash">获取全部</span></span><br><span class="line">hgetall key</span><br><span class="line"><span class="meta">#</span><span class="bash">只全部获取值</span></span><br><span class="line">hvals key</span><br><span class="line"><span class="meta">#</span><span class="bash">删除</span></span><br><span class="line">hdel key </span><br><span class="line"><span class="meta">#</span><span class="bash">存在，存在返回 1，否则返回 0</span></span><br><span class="line">hexists  key  field</span><br><span class="line"><span class="meta">#</span><span class="bash">元素的个数</span></span><br><span class="line">hlen key</span><br></pre></td></tr></table></figure>

<h2 id="3-3-List-类型"><a href="#3-3-List-类型" class="headerlink" title="3.3 List 类型"></a>3.3 List 类型</h2><blockquote>
<p>List 类型是双链表</p>
</blockquote>
<p><img src="http://www.zwer.xyz/picGo/20190531172337.png" alt></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">在最左边添加</span></span><br><span class="line">lpush name value   </span><br><span class="line"><span class="meta">#</span><span class="bash">在最右边添加</span></span><br><span class="line">rpush name value</span><br><span class="line"><span class="meta">#</span><span class="bash">从最左边弹出</span></span><br><span class="line">lpop name</span><br><span class="line"><span class="meta">#</span><span class="bash">从最右边弹出</span></span><br><span class="line">rpop name </span><br><span class="line"><span class="meta">#</span><span class="bash">列出指定范围内的值</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Index 可以为负数， -1 表示倒数第一个</span></span><br><span class="line"><span class="meta">#</span><span class="bash">但是 lrange 都是从左到右额顺序查找</span></span><br><span class="line">lrange name startIndex endIndex</span><br><span class="line"><span class="meta">#</span><span class="bash">查找指定位置上的值</span></span><br><span class="line">lindex name index</span><br><span class="line"><span class="meta">#</span><span class="bash">修改指定位置上的值</span></span><br><span class="line">lset name index value </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; lpush tt 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; lpush tt 2</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; lpush tt 3</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; rpush tt  A</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; rpush tt B</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; rpush tt C</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; lrange tt  0 4</span><br><span class="line">1) "3"</span><br><span class="line">2) "2"</span><br><span class="line">3) "1"</span><br><span class="line">4) "A"</span><br><span class="line">5) "B"</span><br><span class="line">127.0.0.1:6379&gt; lpop tt</span><br><span class="line">"3"</span><br><span class="line">127.0.0.1:6379&gt; lpop tt</span><br><span class="line">"2"</span><br><span class="line">127.0.0.1:6379&gt; rpop tt</span><br><span class="line">"C"</span><br><span class="line">127.0.0.1:6379&gt; lrange tt 0 4</span><br><span class="line">1) "1"</span><br><span class="line">2) "A"</span><br><span class="line">3) "B"</span><br><span class="line">127.0.0.1:6379&gt; lindex tt 2</span><br><span class="line">"B"</span><br><span class="line">127.0.0.1:6379&gt; lset tt 2 b</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lindex tt 2</span><br><span class="line">"b"</span><br><span class="line">127.0.0.1:6379&gt; lindex tt -1</span><br><span class="line">"b"</span><br><span class="line">127.0.0.1:6379&gt; lrange tt 1 -1</span><br><span class="line">1) "A"</span><br><span class="line">2) "b"</span><br></pre></td></tr></table></figure>

<h2 id="3-4-Set-类型"><a href="#3-4-Set-类型" class="headerlink" title="3.4  Set 类型"></a>3.4  Set 类型</h2><blockquote>
<p>字符串的无序集合</p>
<p>一个 key 对应多个 value ，并且 value 值的排序是无序的</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">添加</span></span><br><span class="line">sadd key value</span><br><span class="line"><span class="meta">#</span><span class="bash">返回 key 对应 value 元素的个数</span></span><br><span class="line">scard key</span><br><span class="line"><span class="meta">#</span><span class="bash">列出 key 中所有的 value 值</span></span><br><span class="line">smemebers key</span><br><span class="line"><span class="meta">#</span><span class="bash">判断 key 中 value 是否存在</span></span><br><span class="line">sismember key value</span><br><span class="line"><span class="meta">#</span><span class="bash">移除指定的 key 中 value </span></span><br><span class="line">srem key vlaue</span><br></pre></td></tr></table></figure>

<h2 id="3-5-SortedzSet-类型"><a href="#3-5-SortedzSet-类型" class="headerlink" title="3.5 SortedzSet 类型"></a>3.5 SortedzSet 类型</h2><blockquote>
<p>字符串的有序集合</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">添加 key 中值</span></span><br><span class="line">zadd key index value</span><br><span class="line"><span class="meta">#</span><span class="bash">列出 key 中指定范围的 value </span></span><br><span class="line">zrange startIndex endIndex [withscores]</span><br><span class="line"><span class="meta">#</span><span class="bash">删除指定范围内的 value </span></span><br><span class="line">zremrangebyscore key startIndex endIndex</span><br></pre></td></tr></table></figure>

<h2 id="3-6-Redis-中其他命令"><a href="#3-6-Redis-中其他命令" class="headerlink" title="3.6 Redis 中其他命令"></a>3.6 Redis 中其他命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ping 测试 redis 是否连接，如果连接，则返回 pong</span><br><span class="line">echo value 测试 redis 是否连接，如果连接，则返回 value</span><br><span class="line">keys * 返回当前 redis 库所有 key</span><br><span class="line">exists key 判断字符串是否存在</span><br><span class="line">expire key time(s) 设置一个 key 的过期时间 单位秒。时间到达后，会删除key及value</span><br><span class="line">ttl key 查询离失效的剩余时间，以秒为单位。未设置失效时间，返回 -1</span><br><span class="line">persist key  移动给定 key 的过期时间</span><br><span class="line">select dbindex  选择数据库（0-15）</span><br><span class="line">move key  dbIndex 将当前数据库中移动到其他库</span><br><span class="line">dbsize 返回当前数据库中 key 的数目</span><br><span class="line">info 获取服务器的信息和统set per</span><br><span class="line">flushdb 删除当前库中所有 key</span><br><span class="line">flushall 删除所有库中的 key </span><br><span class="line">quit 退出连接</span><br></pre></td></tr></table></figure>

<h1 id="4-Redis-的配置以及持久化方案"><a href="#4-Redis-的配置以及持久化方案" class="headerlink" title="4 Redis 的配置以及持久化方案"></a>4 Redis 的配置以及持久化方案</h1><h2 id="4-1-redis-conf-文件"><a href="#4-1-redis-conf-文件" class="headerlink" title="4.1 redis.conf 文件"></a>4.1 redis.conf 文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br></pre></td><td class="code"><pre><span class="line"># Redis configuration file example</span><br><span class="line"></span><br><span class="line"># Note on units: when memory size is needed, it is possible to specify</span><br><span class="line"># it in the usual form of 1k 5GB 4M and so forth:</span><br><span class="line">#</span><br><span class="line"># 1k =&gt; 1000 bytes</span><br><span class="line"># 1kb =&gt; 1024 bytes</span><br><span class="line"># 1m =&gt; 1000000 bytes</span><br><span class="line"># 1mb =&gt; 1024*1024 bytes</span><br><span class="line"># 1g =&gt; 1000000000 bytes</span><br><span class="line"># 1gb =&gt; 1024*1024*1024 bytes</span><br><span class="line">#</span><br><span class="line"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span><br><span class="line"></span><br><span class="line">################################## INCLUDES ###################################</span><br><span class="line"></span><br><span class="line"># Include one or more other config files here.  This is useful if you</span><br><span class="line"># have a standard template that goes to all Redis servers but also need</span><br><span class="line"># to customize a few per-server settings.  Include files can include</span><br><span class="line"># other files, so use this wisely.</span><br><span class="line">#</span><br><span class="line"># Notice option &quot;include&quot; won&apos;t be rewritten by command &quot;CONFIG REWRITE&quot;</span><br><span class="line"># from admin or Redis Sentinel. Since Redis always uses the last processed</span><br><span class="line"># line as value of a configuration directive, you&apos;d better put includes</span><br><span class="line"># at the beginning of this file to avoid overwriting config change at runtime.</span><br><span class="line">#</span><br><span class="line"># If instead you are interested in using includes to override configuration</span><br><span class="line"># options, it is better to use include as the last line.</span><br><span class="line">#</span><br><span class="line"># include /path/to/local.conf</span><br><span class="line"># include /path/to/other.conf</span><br><span class="line"></span><br><span class="line">################################ GENERAL  #####################################</span><br><span class="line"></span><br><span class="line"># By default Redis does not run as a daemon. Use &apos;yes&apos; if you need it.</span><br><span class="line"># Note that Redis will write a pid file in /var/run/redis.pid when daemonized.</span><br><span class="line">#开启 redis 后置启动</span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line"># When running daemonized, Redis writes a pid file in /var/run/redis.pid by</span><br><span class="line"># default. You can specify a custom pid file location here.</span><br><span class="line">pidfile /var/run/redis.pid</span><br><span class="line"></span><br><span class="line"># Accept connections on the specified port, default is 6379.</span><br><span class="line"># If port 0 is specified Redis will not listen on a TCP socket.</span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line"># TCP listen() backlog.</span><br><span class="line">#</span><br><span class="line"># In high requests-per-second environments you need an high backlog in order</span><br><span class="line"># to avoid slow clients connections issues. Note that the Linux kernel</span><br><span class="line"># will silently truncate it to the value of /proc/sys/net/core/somaxconn so</span><br><span class="line"># make sure to raise both the value of somaxconn and tcp_max_syn_backlog</span><br><span class="line"># in order to get the desired effect.</span><br><span class="line">tcp-backlog 511</span><br><span class="line"></span><br><span class="line"># By default Redis listens for connections from all the network interfaces</span><br><span class="line"># available on the server. It is possible to listen to just one or multiple</span><br><span class="line"># interfaces using the &quot;bind&quot; configuration directive, followed by one or</span><br><span class="line"># more IP addresses.</span><br><span class="line">#</span><br><span class="line"># Examples:</span><br><span class="line">#</span><br><span class="line"># bind 192.168.1.100 10.0.0.1</span><br><span class="line"># bind 127.0.0.1</span><br><span class="line"></span><br><span class="line"># Specify the path for the Unix socket that will be used to listen for</span><br><span class="line"># incoming connections. There is no default, so Redis will not listen</span><br><span class="line"># on a unix socket when not specified.</span><br><span class="line">#</span><br><span class="line"># unixsocket /tmp/redis.sock</span><br><span class="line"># unixsocketperm 700</span><br><span class="line"></span><br><span class="line"># Close the connection after a client is idle for N seconds (0 to disable)</span><br><span class="line">timeout 0</span><br><span class="line"></span><br><span class="line"># TCP keepalive.</span><br><span class="line">#</span><br><span class="line"># If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence</span><br><span class="line"># of communication. This is useful for two reasons:</span><br><span class="line">#</span><br><span class="line"># 1) Detect dead peers.</span><br><span class="line"># 2) Take the connection alive from the point of view of network</span><br><span class="line">#    equipment in the middle.</span><br><span class="line">#</span><br><span class="line"># On Linux, the specified value (in seconds) is the period used to send ACKs.</span><br><span class="line"># Note that to close the connection the double of the time is needed.</span><br><span class="line"># On other kernels the period depends on the kernel configuration.</span><br><span class="line">#</span><br><span class="line"># A reasonable value for this option is 60 seconds.</span><br><span class="line">tcp-keepalive 0</span><br><span class="line"></span><br><span class="line"># Specify the server verbosity level.</span><br><span class="line"># This can be one of:</span><br><span class="line"># debug (a lot of information, useful for development/testing)</span><br><span class="line"># verbose (many rarely useful info, but not a mess like the debug level)</span><br><span class="line"># notice (moderately verbose, what you want in production probably)</span><br><span class="line"># warning (only very important / critical messages are logged)</span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line"># Specify the log file name. Also the empty string can be used to force</span><br><span class="line"># Redis to log on the standard output. Note that if you use standard</span><br><span class="line"># output for logging but daemonize, logs will be sent to /dev/null</span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"></span><br><span class="line"># To enable logging to the system logger, just set &apos;syslog-enabled&apos; to yes,</span><br><span class="line"># and optionally update the other syslog parameters to suit your needs.</span><br><span class="line"># syslog-enabled no</span><br><span class="line"></span><br><span class="line"># Specify the syslog identity.</span><br><span class="line"># syslog-ident redis</span><br><span class="line"></span><br><span class="line"># Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7.</span><br><span class="line"># syslog-facility local0</span><br><span class="line"></span><br><span class="line"># Set the number of databases. The default database is DB 0, you can select</span><br><span class="line"># a different one on a per-connection basis using SELECT &lt;dbid&gt; where</span><br><span class="line"># dbid is a number between 0 and &apos;databases&apos;-1</span><br><span class="line">#默认数据库的个数</span><br><span class="line">databases 16</span><br><span class="line"></span><br><span class="line">################################ SNAPSHOTTING  ################################</span><br><span class="line">#</span><br><span class="line"># Save the DB on disk:</span><br><span class="line">#</span><br><span class="line">#   save &lt;seconds&gt; &lt;changes&gt;</span><br><span class="line">#</span><br><span class="line">#   Will save the DB if both the given number of seconds and the given</span><br><span class="line">#   number of write operations against the DB occurred.</span><br><span class="line">#</span><br><span class="line">#   In the example below the behaviour will be to save:</span><br><span class="line">#   after 900 sec (15 min) if at least 1 key changed</span><br><span class="line">#   after 300 sec (5 min) if at least 10 keys changed</span><br><span class="line">#   after 60 sec if at least 10000 keys changed</span><br><span class="line">#</span><br><span class="line">#   Note: you can disable saving completely by commenting out all &quot;save&quot; lines.</span><br><span class="line">#</span><br><span class="line">#   It is also possible to remove all the previously configured save</span><br><span class="line">#   points by adding a save directive with a single empty string argument</span><br><span class="line">#   like in the following example:</span><br><span class="line">#</span><br><span class="line">#   save &quot;&quot;</span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line"># By default Redis will stop accepting writes if RDB snapshots are enabled</span><br><span class="line"># (at least one save point) and the latest background save failed.</span><br><span class="line"># This will make the user aware (in a hard way) that data is not persisting</span><br><span class="line"># on disk properly, otherwise chances are that no one will notice and some</span><br><span class="line"># disaster will happen.</span><br><span class="line">#</span><br><span class="line"># If the background saving process will start working again Redis will</span><br><span class="line"># automatically allow writes again.</span><br><span class="line">#</span><br><span class="line"># However if you have setup your proper monitoring of the Redis server</span><br><span class="line"># and persistence, you may want to disable this feature so that Redis will</span><br><span class="line"># continue to work as usual even if there are problems with disk,</span><br><span class="line"># permissions, and so forth.</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"></span><br><span class="line"># Compress string objects using LZF when dump .rdb databases?</span><br><span class="line"># For default that&apos;s set to &apos;yes&apos; as it&apos;s almost always a win.</span><br><span class="line"># If you want to save some CPU in the saving child set it to &apos;no&apos; but</span><br><span class="line"># the dataset will likely be bigger if you have compressible values or keys.</span><br><span class="line">rdbcompression yes</span><br><span class="line"></span><br><span class="line"># Since version 5 of RDB a CRC64 checksum is placed at the end of the file.</span><br><span class="line"># This makes the format more resistant to corruption but there is a performance</span><br><span class="line"># hit to pay (around 10%) when saving and loading RDB files, so you can disable it</span><br><span class="line"># for maximum performances.</span><br><span class="line">#</span><br><span class="line"># RDB files created with checksum disabled have a checksum of zero that will</span><br><span class="line"># tell the loading code to skip the check.</span><br><span class="line">rdbchecksum yes</span><br><span class="line"></span><br><span class="line"># The filename where to dump the DB</span><br><span class="line"># RDB 方式数据持久化到磁盘保存的文件名 dump.rdb</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line"># The working directory.</span><br><span class="line">#</span><br><span class="line"># The DB will be written inside this directory, with the filename specified</span><br><span class="line"># above using the &apos;dbfilename&apos; configuration directive.</span><br><span class="line">#</span><br><span class="line"># The Append Only File will also be created inside this directory.</span><br><span class="line">#</span><br><span class="line"># Note that you must specify a directory here, not a file name.</span><br><span class="line">dir ./</span><br><span class="line"></span><br><span class="line">################################# REPLICATION #################################</span><br><span class="line"></span><br><span class="line"># Master-Slave replication. Use slaveof to make a Redis instance a copy of</span><br><span class="line"># another Redis server. A few things to understand ASAP about Redis replication.</span><br><span class="line">#</span><br><span class="line"># 1) Redis replication is asynchronous, but you can configure a master to</span><br><span class="line">#    stop accepting writes if it appears to be not connected with at least</span><br><span class="line">#    a given number of slaves.</span><br><span class="line"># 2) Redis slaves are able to perform a partial resynchronization with the</span><br><span class="line">#    master if the replication link is lost for a relatively small amount of</span><br><span class="line">#    time. You may want to configure the replication backlog size (see the next</span><br><span class="line">#    sections of this file) with a sensible value depending on your needs.</span><br><span class="line"># 3) Replication is automatic and does not need user intervention. After a</span><br><span class="line">#    network partition slaves automatically try to reconnect to masters</span><br><span class="line">#    and resynchronize with them.</span><br><span class="line">#</span><br><span class="line"># slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line"></span><br><span class="line"># If the master is password protected (using the &quot;requirepass&quot; configuration</span><br><span class="line"># directive below) it is possible to tell the slave to authenticate before</span><br><span class="line"># starting the replication synchronization process, otherwise the master will</span><br><span class="line"># refuse the slave request.</span><br><span class="line">#</span><br><span class="line"># masterauth &lt;master-password&gt;</span><br><span class="line"></span><br><span class="line"># When a slave loses its connection with the master, or when the replication</span><br><span class="line"># is still in progress, the slave can act in two different ways:</span><br><span class="line">#</span><br><span class="line"># 1) if slave-serve-stale-data is set to &apos;yes&apos; (the default) the slave will</span><br><span class="line">#    still reply to client requests, possibly with out of date data, or the</span><br><span class="line">#    data set may just be empty if this is the first synchronization.</span><br><span class="line">#</span><br><span class="line"># 2) if slave-serve-stale-data is set to &apos;no&apos; the slave will reply with</span><br><span class="line">#    an error &quot;SYNC with master in progress&quot; to all the kind of commands</span><br><span class="line">#    but to INFO and SLAVEOF.</span><br><span class="line">#</span><br><span class="line">slave-serve-stale-data yes</span><br><span class="line"></span><br><span class="line"># You can configure a slave instance to accept writes or not. Writing against</span><br><span class="line"># a slave instance may be useful to store some ephemeral data (because data</span><br><span class="line"># written on a slave will be easily deleted after resync with the master) but</span><br><span class="line"># may also cause problems if clients are writing to it because of a</span><br><span class="line"># misconfiguration.</span><br><span class="line">#</span><br><span class="line"># Since Redis 2.6 by default slaves are read-only.</span><br><span class="line">#</span><br><span class="line"># Note: read only slaves are not designed to be exposed to untrusted clients</span><br><span class="line"># on the internet. It&apos;s just a protection layer against misuse of the instance.</span><br><span class="line"># Still a read only slave exports by default all the administrative commands</span><br><span class="line"># such as CONFIG, DEBUG, and so forth. To a limited extent you can improve</span><br><span class="line"># security of read only slaves using &apos;rename-command&apos; to shadow all the</span><br><span class="line"># administrative / dangerous commands.</span><br><span class="line">slave-read-only yes</span><br><span class="line"></span><br><span class="line"># Replication SYNC strategy: disk or socket.</span><br><span class="line">#</span><br><span class="line"># -------------------------------------------------------</span><br><span class="line"># WARNING: DISKLESS REPLICATION IS EXPERIMENTAL CURRENTLY</span><br><span class="line"># -------------------------------------------------------</span><br><span class="line">#</span><br><span class="line"># New slaves and reconnecting slaves that are not able to continue the replication</span><br><span class="line"># process just receiving differences, need to do what is called a &quot;full</span><br><span class="line"># synchronization&quot;. An RDB file is transmitted from the master to the slaves.</span><br><span class="line"># The transmission can happen in two different ways:</span><br><span class="line">#</span><br><span class="line"># 1) Disk-backed: The Redis master creates a new process that writes the RDB</span><br><span class="line">#                 file on disk. Later the file is transferred by the parent</span><br><span class="line">#                 process to the slaves incrementally.</span><br><span class="line"># 2) Diskless: The Redis master creates a new process that directly writes the</span><br><span class="line">#              RDB file to slave sockets, without touching the disk at all.</span><br><span class="line">#</span><br><span class="line"># With disk-backed replication, while the RDB file is generated, more slaves</span><br><span class="line"># can be queued and served with the RDB file as soon as the current child producing</span><br><span class="line"># the RDB file finishes its work. With diskless replication instead once</span><br><span class="line"># the transfer starts, new slaves arriving will be queued and a new transfer</span><br><span class="line"># will start when the current one terminates.</span><br><span class="line">#</span><br><span class="line"># When diskless replication is used, the master waits a configurable amount of</span><br><span class="line"># time (in seconds) before starting the transfer in the hope that multiple slaves</span><br><span class="line"># will arrive and the transfer can be parallelized.</span><br><span class="line">#</span><br><span class="line"># With slow disks and fast (large bandwidth) networks, diskless replication</span><br><span class="line"># works better.</span><br><span class="line">repl-diskless-sync no</span><br><span class="line"></span><br><span class="line"># When diskless replication is enabled, it is possible to configure the delay</span><br><span class="line"># the server waits in order to spawn the child that transfers the RDB via socket</span><br><span class="line"># to the slaves.</span><br><span class="line">#</span><br><span class="line"># This is important since once the transfer starts, it is not possible to serve</span><br><span class="line"># new slaves arriving, that will be queued for the next RDB transfer, so the server</span><br><span class="line"># waits a delay in order to let more slaves arrive.</span><br><span class="line">#</span><br><span class="line"># The delay is specified in seconds, and by default is 5 seconds. To disable</span><br><span class="line"># it entirely just set it to 0 seconds and the transfer will start ASAP.</span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line"></span><br><span class="line"># Slaves send PINGs to server in a predefined interval. It&apos;s possible to change</span><br><span class="line"># this interval with the repl_ping_slave_period option. The default value is 10</span><br><span class="line"># seconds.</span><br><span class="line">#</span><br><span class="line"># repl-ping-slave-period 10</span><br><span class="line"></span><br><span class="line"># The following option sets the replication timeout for:</span><br><span class="line">#</span><br><span class="line"># 1) Bulk transfer I/O during SYNC, from the point of view of slave.</span><br><span class="line"># 2) Master timeout from the point of view of slaves (data, pings).</span><br><span class="line"># 3) Slave timeout from the point of view of masters (REPLCONF ACK pings).</span><br><span class="line">#</span><br><span class="line"># It is important to make sure that this value is greater than the value</span><br><span class="line"># specified for repl-ping-slave-period otherwise a timeout will be detected</span><br><span class="line"># every time there is low traffic between the master and the slave.</span><br><span class="line">#</span><br><span class="line"># repl-timeout 60</span><br><span class="line"></span><br><span class="line"># Disable TCP_NODELAY on the slave socket after SYNC?</span><br><span class="line">#</span><br><span class="line"># If you select &quot;yes&quot; Redis will use a smaller number of TCP packets and</span><br><span class="line"># less bandwidth to send data to slaves. But this can add a delay for</span><br><span class="line"># the data to appear on the slave side, up to 40 milliseconds with</span><br><span class="line"># Linux kernels using a default configuration.</span><br><span class="line">#</span><br><span class="line"># If you select &quot;no&quot; the delay for data to appear on the slave side will</span><br><span class="line"># be reduced but more bandwidth will be used for replication.</span><br><span class="line">#</span><br><span class="line"># By default we optimize for low latency, but in very high traffic conditions</span><br><span class="line"># or when the master and slaves are many hops away, turning this to &quot;yes&quot; may</span><br><span class="line"># be a good idea.</span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line"></span><br><span class="line"># Set the replication backlog size. The backlog is a buffer that accumulates</span><br><span class="line"># slave data when slaves are disconnected for some time, so that when a slave</span><br><span class="line"># wants to reconnect again, often a full resync is not needed, but a partial</span><br><span class="line"># resync is enough, just passing the portion of data the slave missed while</span><br><span class="line"># disconnected.</span><br><span class="line">#</span><br><span class="line"># The bigger the replication backlog, the longer the time the slave can be</span><br><span class="line"># disconnected and later be able to perform a partial resynchronization.</span><br><span class="line">#</span><br><span class="line"># The backlog is only allocated once there is at least a slave connected.</span><br><span class="line">#</span><br><span class="line"># repl-backlog-size 1mb</span><br><span class="line"></span><br><span class="line"># After a master has no longer connected slaves for some time, the backlog</span><br><span class="line"># will be freed. The following option configures the amount of seconds that</span><br><span class="line"># need to elapse, starting from the time the last slave disconnected, for</span><br><span class="line"># the backlog buffer to be freed.</span><br><span class="line">#</span><br><span class="line"># A value of 0 means to never release the backlog.</span><br><span class="line">#</span><br><span class="line"># repl-backlog-ttl 3600</span><br><span class="line"></span><br><span class="line"># The slave priority is an integer number published by Redis in the INFO output.</span><br><span class="line"># It is used by Redis Sentinel in order to select a slave to promote into a</span><br><span class="line"># master if the master is no longer working correctly.</span><br><span class="line">#</span><br><span class="line"># A slave with a low priority number is considered better for promotion, so</span><br><span class="line"># for instance if there are three slaves with priority 10, 100, 25 Sentinel will</span><br><span class="line"># pick the one with priority 10, that is the lowest.</span><br><span class="line">#</span><br><span class="line"># However a special priority of 0 marks the slave as not able to perform the</span><br><span class="line"># role of master, so a slave with priority of 0 will never be selected by</span><br><span class="line"># Redis Sentinel for promotion.</span><br><span class="line">#</span><br><span class="line"># By default the priority is 100.</span><br><span class="line">slave-priority 100</span><br><span class="line"></span><br><span class="line"># It is possible for a master to stop accepting writes if there are less than</span><br><span class="line"># N slaves connected, having a lag less or equal than M seconds.</span><br><span class="line">#</span><br><span class="line"># The N slaves need to be in &quot;online&quot; state.</span><br><span class="line">#</span><br><span class="line"># The lag in seconds, that must be &lt;= the specified value, is calculated from</span><br><span class="line"># the last ping received from the slave, that is usually sent every second.</span><br><span class="line">#</span><br><span class="line"># This option does not GUARANTEE that N replicas will accept the write, but</span><br><span class="line"># will limit the window of exposure for lost writes in case not enough slaves</span><br><span class="line"># are available, to the specified number of seconds.</span><br><span class="line">#</span><br><span class="line"># For example to require at least 3 slaves with a lag &lt;= 10 seconds use:</span><br><span class="line">#</span><br><span class="line"># min-slaves-to-write 3</span><br><span class="line"># min-slaves-max-lag 10</span><br><span class="line">#</span><br><span class="line"># Setting one or the other to 0 disables the feature.</span><br><span class="line">#</span><br><span class="line"># By default min-slaves-to-write is set to 0 (feature disabled) and</span><br><span class="line"># min-slaves-max-lag is set to 10.</span><br><span class="line"></span><br><span class="line">################################## SECURITY ###################################</span><br><span class="line"></span><br><span class="line"># Require clients to issue AUTH &lt;PASSWORD&gt; before processing any other</span><br><span class="line"># commands.  This might be useful in environments in which you do not trust</span><br><span class="line"># others with access to the host running redis-server.</span><br><span class="line">#</span><br><span class="line"># This should stay commented out for backward compatibility and because most</span><br><span class="line"># people do not need auth (e.g. they run their own servers).</span><br><span class="line">#</span><br><span class="line"># Warning: since Redis is pretty fast an outside user can try up to</span><br><span class="line"># 150k passwords per second against a good box. This means that you should</span><br><span class="line"># use a very strong password otherwise it will be very easy to break.</span><br><span class="line">#</span><br><span class="line"># requirepass foobared</span><br><span class="line"></span><br><span class="line"># Command renaming.</span><br><span class="line">#</span><br><span class="line"># It is possible to change the name of dangerous commands in a shared</span><br><span class="line"># environment. For instance the CONFIG command may be renamed into something</span><br><span class="line"># hard to guess so that it will still be available for internal-use tools</span><br><span class="line"># but not available for general clients.</span><br><span class="line">#</span><br><span class="line"># Example:</span><br><span class="line">#</span><br><span class="line"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span><br><span class="line">#</span><br><span class="line"># It is also possible to completely kill a command by renaming it into</span><br><span class="line"># an empty string:</span><br><span class="line">#</span><br><span class="line"># rename-command CONFIG &quot;&quot;</span><br><span class="line">#</span><br><span class="line"># Please note that changing the name of commands that are logged into the</span><br><span class="line"># AOF file or transmitted to slaves may cause problems.</span><br><span class="line"></span><br><span class="line">################################### LIMITS ####################################</span><br><span class="line"></span><br><span class="line"># Set the max number of connected clients at the same time. By default</span><br><span class="line"># this limit is set to 10000 clients, however if the Redis server is not</span><br><span class="line"># able to configure the process file limit to allow for the specified limit</span><br><span class="line"># the max number of allowed clients is set to the current file limit</span><br><span class="line"># minus 32 (as Redis reserves a few file descriptors for internal uses).</span><br><span class="line">#</span><br><span class="line"># Once the limit is reached Redis will close all the new connections sending</span><br><span class="line"># an error &apos;max number of clients reached&apos;.</span><br><span class="line">#</span><br><span class="line"># maxclients 10000</span><br><span class="line"></span><br><span class="line"># Don&apos;t use more memory than the specified amount of bytes.</span><br><span class="line"># When the memory limit is reached Redis will try to remove keys</span><br><span class="line"># according to the eviction policy selected (see maxmemory-policy).</span><br><span class="line">#</span><br><span class="line"># If Redis can&apos;t remove keys according to the policy, or if the policy is</span><br><span class="line"># set to &apos;noeviction&apos;, Redis will start to reply with errors to commands</span><br><span class="line"># that would use more memory, like SET, LPUSH, and so on, and will continue</span><br><span class="line"># to reply to read-only commands like GET.</span><br><span class="line">#</span><br><span class="line"># This option is usually useful when using Redis as an LRU cache, or to set</span><br><span class="line"># a hard memory limit for an instance (using the &apos;noeviction&apos; policy).</span><br><span class="line">#</span><br><span class="line"># WARNING: If you have slaves attached to an instance with maxmemory on,</span><br><span class="line"># the size of the output buffers needed to feed the slaves are subtracted</span><br><span class="line"># from the used memory count, so that network problems / resyncs will</span><br><span class="line"># not trigger a loop where keys are evicted, and in turn the output</span><br><span class="line"># buffer of slaves is full with DELs of keys evicted triggering the deletion</span><br><span class="line"># of more keys, and so forth until the database is completely emptied.</span><br><span class="line">#</span><br><span class="line"># In short... if you have slaves attached it is suggested that you set a lower</span><br><span class="line"># limit for maxmemory so that there is some free RAM on the system for slave</span><br><span class="line"># output buffers (but this is not needed if the policy is &apos;noeviction&apos;).</span><br><span class="line">#</span><br><span class="line"># maxmemory &lt;bytes&gt;</span><br><span class="line"></span><br><span class="line"># MAXMEMORY POLICY: how Redis will select what to remove when maxmemory</span><br><span class="line"># is reached. You can select among five behaviors:</span><br><span class="line">#</span><br><span class="line"># volatile-lru -&gt; remove the key with an expire set using an LRU algorithm</span><br><span class="line"># allkeys-lru -&gt; remove any key according to the LRU algorithm</span><br><span class="line"># volatile-random -&gt; remove a random key with an expire set</span><br><span class="line"># allkeys-random -&gt; remove a random key, any key</span><br><span class="line"># volatile-ttl -&gt; remove the key with the nearest expire time (minor TTL)</span><br><span class="line"># noeviction -&gt; don&apos;t expire at all, just return an error on write operations</span><br><span class="line">#</span><br><span class="line"># Note: with any of the above policies, Redis will return an error on write</span><br><span class="line">#       operations, when there are no suitable keys for eviction.</span><br><span class="line">#</span><br><span class="line">#       At the date of writing these commands are: set setnx setex append</span><br><span class="line">#       incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span><br><span class="line">#       sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span><br><span class="line">#       zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span><br><span class="line">#       getset mset msetnx exec sort</span><br><span class="line">#</span><br><span class="line"># The default is:</span><br><span class="line">#</span><br><span class="line"># maxmemory-policy noeviction</span><br><span class="line"></span><br><span class="line"># LRU and minimal TTL algorithms are not precise algorithms but approximated</span><br><span class="line"># algorithms (in order to save memory), so you can tune it for speed or</span><br><span class="line"># accuracy. For default Redis will check five keys and pick the one that was</span><br><span class="line"># used less recently, you can change the sample size using the following</span><br><span class="line"># configuration directive.</span><br><span class="line">#</span><br><span class="line"># The default of 5 produces good enough results. 10 Approximates very closely</span><br><span class="line"># true LRU but costs a bit more CPU. 3 is very fast but not very accurate.</span><br><span class="line">#</span><br><span class="line"># maxmemory-samples 5</span><br><span class="line"></span><br><span class="line">############################## APPEND ONLY MODE ###############################</span><br><span class="line"></span><br><span class="line"># By default Redis asynchronously dumps the dataset on disk. This mode is</span><br><span class="line"># good enough in many applications, but an issue with the Redis process or</span><br><span class="line"># a power outage may result into a few minutes of writes lost (depending on</span><br><span class="line"># the configured save points).</span><br><span class="line">#</span><br><span class="line"># The Append Only File is an alternative persistence mode that provides</span><br><span class="line"># much better durability. For instance using the default data fsync policy</span><br><span class="line"># (see later in the config file) Redis can lose just one second of writes in a</span><br><span class="line"># dramatic event like a server power outage, or a single write if something</span><br><span class="line"># wrong with the Redis process itself happens, but the operating system is</span><br><span class="line"># still running correctly.</span><br><span class="line">#</span><br><span class="line"># AOF and RDB persistence can be enabled at the same time without problems.</span><br><span class="line"># If the AOF is enabled on startup Redis will load the AOF, that is the file</span><br><span class="line"># with the better durability guarantees.</span><br><span class="line">#</span><br><span class="line"># Please check http://redis.io/topics/persistence for more information.</span><br><span class="line"></span><br><span class="line">appendonly no</span><br><span class="line"></span><br><span class="line"># The name of the append only file (default: &quot;appendonly.aof&quot;)</span><br><span class="line"></span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"></span><br><span class="line"># The fsync() call tells the Operating System to actually write data on disk</span><br><span class="line"># instead of waiting for more data in the output buffer. Some OS will really flush</span><br><span class="line"># data on disk, some other OS will just try to do it ASAP.</span><br><span class="line">#</span><br><span class="line"># Redis supports three different modes:</span><br><span class="line">#</span><br><span class="line"># no: don&apos;t fsync, just let the OS flush the data when it wants. Faster.</span><br><span class="line"># always: fsync after every write to the append only log. Slow, Safest.</span><br><span class="line"># everysec: fsync only one time every second. Compromise.</span><br><span class="line">#</span><br><span class="line"># The default is &quot;everysec&quot;, as that&apos;s usually the right compromise between</span><br><span class="line"># speed and data safety. It&apos;s up to you to understand if you can relax this to</span><br><span class="line"># &quot;no&quot; that will let the operating system flush the output buffer when</span><br><span class="line"># it wants, for better performances (but if you can live with the idea of</span><br><span class="line"># some data loss consider the default persistence mode that&apos;s snapshotting),</span><br><span class="line"># or on the contrary, use &quot;always&quot; that&apos;s very slow but a bit safer than</span><br><span class="line"># everysec.</span><br><span class="line">#</span><br><span class="line"># More details please check the following article:</span><br><span class="line"># http://antirez.com/post/redis-persistence-demystified.html</span><br><span class="line">#</span><br><span class="line"># If unsure, use &quot;everysec&quot;.</span><br><span class="line"></span><br><span class="line"># appendfsync always</span><br><span class="line">appendfsync everysec</span><br><span class="line"># appendfsync no</span><br><span class="line"></span><br><span class="line"># When the AOF fsync policy is set to always or everysec, and a background</span><br><span class="line"># saving process (a background save or AOF log background rewriting) is</span><br><span class="line"># performing a lot of I/O against the disk, in some Linux configurations</span><br><span class="line"># Redis may block too long on the fsync() call. Note that there is no fix for</span><br><span class="line"># this currently, as even performing fsync in a different thread will block</span><br><span class="line"># our synchronous write(2) call.</span><br><span class="line">#</span><br><span class="line"># In order to mitigate this problem it&apos;s possible to use the following option</span><br><span class="line"># that will prevent fsync() from being called in the main process while a</span><br><span class="line"># BGSAVE or BGREWRITEAOF is in progress.</span><br><span class="line">#</span><br><span class="line"># This means that while another child is saving, the durability of Redis is</span><br><span class="line"># the same as &quot;appendfsync none&quot;. In practical terms, this means that it is</span><br><span class="line"># possible to lose up to 30 seconds of log in the worst scenario (with the</span><br><span class="line"># default Linux settings).</span><br><span class="line">#</span><br><span class="line"># If you have latency problems turn this to &quot;yes&quot;. Otherwise leave it as</span><br><span class="line"># &quot;no&quot; that is the safest pick from the point of view of durability.</span><br><span class="line"></span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"></span><br><span class="line"># Automatic rewrite of the append only file.</span><br><span class="line"># Redis is able to automatically rewrite the log file implicitly calling</span><br><span class="line"># BGREWRITEAOF when the AOF log size grows by the specified percentage.</span><br><span class="line">#</span><br><span class="line"># This is how it works: Redis remembers the size of the AOF file after the</span><br><span class="line"># latest rewrite (if no rewrite has happened since the restart, the size of</span><br><span class="line"># the AOF at startup is used).</span><br><span class="line">#</span><br><span class="line"># This base size is compared to the current size. If the current size is</span><br><span class="line"># bigger than the specified percentage, the rewrite is triggered. Also</span><br><span class="line"># you need to specify a minimal size for the AOF file to be rewritten, this</span><br><span class="line"># is useful to avoid rewriting the AOF file even if the percentage increase</span><br><span class="line"># is reached but it is still pretty small.</span><br><span class="line">#</span><br><span class="line"># Specify a percentage of zero in order to disable the automatic AOF</span><br><span class="line"># rewrite feature.</span><br><span class="line"></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"></span><br><span class="line"># An AOF file may be found to be truncated at the end during the Redis</span><br><span class="line"># startup process, when the AOF data gets loaded back into memory.</span><br><span class="line"># This may happen when the system where Redis is running</span><br><span class="line"># crashes, especially when an ext4 filesystem is mounted without the</span><br><span class="line"># data=ordered option (however this can&apos;t happen when Redis itself</span><br><span class="line"># crashes or aborts but the operating system still works correctly).</span><br><span class="line">#</span><br><span class="line"># Redis can either exit with an error when this happens, or load as much</span><br><span class="line"># data as possible (the default now) and start if the AOF file is found</span><br><span class="line"># to be truncated at the end. The following option controls this behavior.</span><br><span class="line">#</span><br><span class="line"># If aof-load-truncated is set to yes, a truncated AOF file is loaded and</span><br><span class="line"># the Redis server starts emitting a log to inform the user of the event.</span><br><span class="line"># Otherwise if the option is set to no, the server aborts with an error</span><br><span class="line"># and refuses to start. When the option is set to no, the user requires</span><br><span class="line"># to fix the AOF file using the &quot;redis-check-aof&quot; utility before to restart</span><br><span class="line"># the server.</span><br><span class="line">#</span><br><span class="line"># Note that if the AOF file will be found to be corrupted in the middle</span><br><span class="line"># the server will still exit with an error. This option only applies when</span><br><span class="line"># Redis will try to read more data from the AOF file but not enough bytes</span><br><span class="line"># will be found.</span><br><span class="line">aof-load-truncated yes</span><br><span class="line"></span><br><span class="line">################################ LUA SCRIPTING  ###############################</span><br><span class="line"></span><br><span class="line"># Max execution time of a Lua script in milliseconds.</span><br><span class="line">#</span><br><span class="line"># If the maximum execution time is reached Redis will log that a script is</span><br><span class="line"># still in execution after the maximum allowed time and will start to</span><br><span class="line"># reply to queries with an error.</span><br><span class="line">#</span><br><span class="line"># When a long running script exceeds the maximum execution time only the</span><br><span class="line"># SCRIPT KILL and SHUTDOWN NOSAVE commands are available. The first can be</span><br><span class="line"># used to stop a script that did not yet called write commands. The second</span><br><span class="line"># is the only way to shut down the server in the case a write command was</span><br><span class="line"># already issued by the script but the user doesn&apos;t want to wait for the natural</span><br><span class="line"># termination of the script.</span><br><span class="line">#</span><br><span class="line"># Set it to 0 or a negative value for unlimited execution without warnings.</span><br><span class="line">lua-time-limit 5000</span><br><span class="line"></span><br><span class="line">################################ REDIS CLUSTER  ###############################</span><br><span class="line">#</span><br><span class="line"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line"># WARNING EXPERIMENTAL: Redis Cluster is considered to be stable code, however</span><br><span class="line"># in order to mark it as &quot;mature&quot; we need to wait for a non trivial percentage</span><br><span class="line"># of users to deploy it in production.</span><br><span class="line"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line">#</span><br><span class="line"># Normal Redis instances can&apos;t be part of a Redis Cluster; only nodes that are</span><br><span class="line"># started as cluster nodes can. In order to start a Redis instance as a</span><br><span class="line"># cluster node enable the cluster support uncommenting the following:</span><br><span class="line">#</span><br><span class="line"># cluster-enabled yes</span><br><span class="line"></span><br><span class="line"># Every cluster node has a cluster configuration file. This file is not</span><br><span class="line"># intended to be edited by hand. It is created and updated by Redis nodes.</span><br><span class="line"># Every Redis Cluster node requires a different cluster configuration file.</span><br><span class="line"># Make sure that instances running in the same system do not have</span><br><span class="line"># overlapping cluster configuration file names.</span><br><span class="line">#</span><br><span class="line"># cluster-config-file nodes-6379.conf</span><br><span class="line"></span><br><span class="line"># Cluster node timeout is the amount of milliseconds a node must be unreachable</span><br><span class="line"># for it to be considered in failure state.</span><br><span class="line"># Most other internal time limits are multiple of the node timeout.</span><br><span class="line">#</span><br><span class="line"># cluster-node-timeout 15000</span><br><span class="line"></span><br><span class="line"># A slave of a failing master will avoid to start a failover if its data</span><br><span class="line"># looks too old.</span><br><span class="line">#</span><br><span class="line"># There is no simple way for a slave to actually have a exact measure of</span><br><span class="line"># its &quot;data age&quot;, so the following two checks are performed:</span><br><span class="line">#</span><br><span class="line"># 1) If there are multiple slaves able to failover, they exchange messages</span><br><span class="line">#    in order to try to give an advantage to the slave with the best</span><br><span class="line">#    replication offset (more data from the master processed).</span><br><span class="line">#    Slaves will try to get their rank by offset, and apply to the start</span><br><span class="line">#    of the failover a delay proportional to their rank.</span><br><span class="line">#</span><br><span class="line"># 2) Every single slave computes the time of the last interaction with</span><br><span class="line">#    its master. This can be the last ping or command received (if the master</span><br><span class="line">#    is still in the &quot;connected&quot; state), or the time that elapsed since the</span><br><span class="line">#    disconnection with the master (if the replication link is currently down).</span><br><span class="line">#    If the last interaction is too old, the slave will not try to failover</span><br><span class="line">#    at all.</span><br><span class="line">#</span><br><span class="line"># The point &quot;2&quot; can be tuned by user. Specifically a slave will not perform</span><br><span class="line"># the failover if, since the last interaction with the master, the time</span><br><span class="line"># elapsed is greater than:</span><br><span class="line">#</span><br><span class="line">#   (node-timeout * slave-validity-factor) + repl-ping-slave-period</span><br><span class="line">#</span><br><span class="line"># So for example if node-timeout is 30 seconds, and the slave-validity-factor</span><br><span class="line"># is 10, and assuming a default repl-ping-slave-period of 10 seconds, the</span><br><span class="line"># slave will not try to failover if it was not able to talk with the master</span><br><span class="line"># for longer than 310 seconds.</span><br><span class="line">#</span><br><span class="line"># A large slave-validity-factor may allow slaves with too old data to failover</span><br><span class="line"># a master, while a too small value may prevent the cluster from being able to</span><br><span class="line"># elect a slave at all.</span><br><span class="line">#</span><br><span class="line"># For maximum availability, it is possible to set the slave-validity-factor</span><br><span class="line"># to a value of 0, which means, that slaves will always try to failover the</span><br><span class="line"># master regardless of the last time they interacted with the master.</span><br><span class="line"># (However they&apos;ll always try to apply a delay proportional to their</span><br><span class="line"># offset rank).</span><br><span class="line">#</span><br><span class="line"># Zero is the only value able to guarantee that when all the partitions heal</span><br><span class="line"># the cluster will always be able to continue.</span><br><span class="line">#</span><br><span class="line"># cluster-slave-validity-factor 10</span><br><span class="line"></span><br><span class="line"># Cluster slaves are able to migrate to orphaned masters, that are masters</span><br><span class="line"># that are left without working slaves. This improves the cluster ability</span><br><span class="line"># to resist to failures as otherwise an orphaned master can&apos;t be failed over</span><br><span class="line"># in case of failure if it has no working slaves.</span><br><span class="line">#</span><br><span class="line"># Slaves migrate to orphaned masters only if there are still at least a</span><br><span class="line"># given number of other working slaves for their old master. This number</span><br><span class="line"># is the &quot;migration barrier&quot;. A migration barrier of 1 means that a slave</span><br><span class="line"># will migrate only if there is at least 1 other working slave for its master</span><br><span class="line"># and so forth. It usually reflects the number of slaves you want for every</span><br><span class="line"># master in your cluster.</span><br><span class="line">#</span><br><span class="line"># Default is 1 (slaves migrate only if their masters remain with at least</span><br><span class="line"># one slave). To disable migration just set it to a very large value.</span><br><span class="line"># A value of 0 can be set but is useful only for debugging and dangerous</span><br><span class="line"># in production.</span><br><span class="line">#</span><br><span class="line"># cluster-migration-barrier 1</span><br><span class="line"></span><br><span class="line"># By default Redis Cluster nodes stop accepting queries if they detect there</span><br><span class="line"># is at least an hash slot uncovered (no available node is serving it).</span><br><span class="line"># This way if the cluster is partially down (for example a range of hash slots</span><br><span class="line"># are no longer covered) all the cluster becomes, eventually, unavailable.</span><br><span class="line"># It automatically returns available as soon as all the slots are covered again.</span><br><span class="line">#</span><br><span class="line"># However sometimes you want the subset of the cluster which is working,</span><br><span class="line"># to continue to accept queries for the part of the key space that is still</span><br><span class="line"># covered. In order to do so, just set the cluster-require-full-coverage</span><br><span class="line"># option to no.</span><br><span class="line">#</span><br><span class="line"># cluster-require-full-coverage yes</span><br><span class="line"></span><br><span class="line"># In order to setup your cluster make sure to read the documentation</span><br><span class="line"># available at http://redis.io web site.</span><br><span class="line"></span><br><span class="line">################################## SLOW LOG ###################################</span><br><span class="line"></span><br><span class="line"># The Redis Slow Log is a system to log queries that exceeded a specified</span><br><span class="line"># execution time. The execution time does not include the I/O operations</span><br><span class="line"># like talking with the client, sending the reply and so forth,</span><br><span class="line"># but just the time needed to actually execute the command (this is the only</span><br><span class="line"># stage of command execution where the thread is blocked and can not serve</span><br><span class="line"># other requests in the meantime).</span><br><span class="line">#</span><br><span class="line"># You can configure the slow log with two parameters: one tells Redis</span><br><span class="line"># what is the execution time, in microseconds, to exceed in order for the</span><br><span class="line"># command to get logged, and the other parameter is the length of the</span><br><span class="line"># slow log. When a new command is logged the oldest one is removed from the</span><br><span class="line"># queue of logged commands.</span><br><span class="line"></span><br><span class="line"># The following time is expressed in microseconds, so 1000000 is equivalent</span><br><span class="line"># to one second. Note that a negative number disables the slow log, while</span><br><span class="line"># a value of zero forces the logging of every command.</span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line"></span><br><span class="line"># There is no limit to this length. Just be aware that it will consume memory.</span><br><span class="line"># You can reclaim memory used by the slow log with SLOWLOG RESET.</span><br><span class="line">slowlog-max-len 128</span><br><span class="line"></span><br><span class="line">################################ LATENCY MONITOR ##############################</span><br><span class="line"></span><br><span class="line"># The Redis latency monitoring subsystem samples different operations</span><br><span class="line"># at runtime in order to collect data related to possible sources of</span><br><span class="line"># latency of a Redis instance.</span><br><span class="line">#</span><br><span class="line"># Via the LATENCY command this information is available to the user that can</span><br><span class="line"># print graphs and obtain reports.</span><br><span class="line">#</span><br><span class="line"># The system only logs operations that were performed in a time equal or</span><br><span class="line"># greater than the amount of milliseconds specified via the</span><br><span class="line"># latency-monitor-threshold configuration directive. When its value is set</span><br><span class="line"># to zero, the latency monitor is turned off.</span><br><span class="line">#</span><br><span class="line"># By default latency monitoring is disabled since it is mostly not needed</span><br><span class="line"># if you don&apos;t have latency issues, and collecting data has a performance</span><br><span class="line"># impact, that while very small, can be measured under big load. Latency</span><br><span class="line"># monitoring can easily be enabled at runtime using the command</span><br><span class="line"># &quot;CONFIG SET latency-monitor-threshold &lt;milliseconds&gt;&quot; if needed.</span><br><span class="line">latency-monitor-threshold 0</span><br><span class="line"></span><br><span class="line">############################# EVENT NOTIFICATION ##############################</span><br><span class="line"></span><br><span class="line"># Redis can notify Pub/Sub clients about events happening in the key space.</span><br><span class="line"># This feature is documented at http://redis.io/topics/notifications</span><br><span class="line">#</span><br><span class="line"># For instance if keyspace events notification is enabled, and a client</span><br><span class="line"># performs a DEL operation on key &quot;foo&quot; stored in the Database 0, two</span><br><span class="line"># messages will be published via Pub/Sub:</span><br><span class="line">#</span><br><span class="line"># PUBLISH __keyspace@0__:foo del</span><br><span class="line"># PUBLISH __keyevent@0__:del foo</span><br><span class="line">#</span><br><span class="line"># It is possible to select the events that Redis will notify among a set</span><br><span class="line"># of classes. Every class is identified by a single character:</span><br><span class="line">#</span><br><span class="line">#  K     Keyspace events, published with __keyspace@&lt;db&gt;__ prefix.</span><br><span class="line">#  E     Keyevent events, published with __keyevent@&lt;db&gt;__ prefix.</span><br><span class="line">#  g     Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ...</span><br><span class="line">#  $     String commands</span><br><span class="line">#  l     List commands</span><br><span class="line">#  s     Set commands</span><br><span class="line">#  h     Hash commands</span><br><span class="line">#  z     Sorted set commands</span><br><span class="line">#  x     Expired events (events generated every time a key expires)</span><br><span class="line">#  e     Evicted events (events generated when a key is evicted for maxmemory)</span><br><span class="line">#  A     Alias for g$lshzxe, so that the &quot;AKE&quot; string means all the events.</span><br><span class="line">#</span><br><span class="line">#  The &quot;notify-keyspace-events&quot; takes as argument a string that is composed</span><br><span class="line">#  of zero or multiple characters. The empty string means that notifications</span><br><span class="line">#  are disabled.</span><br><span class="line">#</span><br><span class="line">#  Example: to enable list and generic events, from the point of view of the</span><br><span class="line">#           event name, use:</span><br><span class="line">#</span><br><span class="line">#  notify-keyspace-events Elg</span><br><span class="line">#</span><br><span class="line">#  Example 2: to get the stream of the expired keys subscribing to channel</span><br><span class="line">#             name __keyevent@0__:expired use:</span><br><span class="line">#</span><br><span class="line">#  notify-keyspace-events Ex</span><br><span class="line">#</span><br><span class="line">#  By default all notifications are disabled because most users don&apos;t need</span><br><span class="line">#  this feature and the feature has some overhead. Note that if you don&apos;t</span><br><span class="line">#  specify at least one of K or E, no events will be delivered.</span><br><span class="line">notify-keyspace-events &quot;&quot;</span><br><span class="line"></span><br><span class="line">############################### ADVANCED CONFIG ###############################</span><br><span class="line"></span><br><span class="line"># Hashes are encoded using a memory efficient data structure when they have a</span><br><span class="line"># small number of entries, and the biggest entry does not exceed a given</span><br><span class="line"># threshold. These thresholds can be configured using the following directives.</span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line"># Similarly to hashes, small lists are also encoded in a special way in order</span><br><span class="line"># to save a lot of space. The special representation is only used when</span><br><span class="line"># you are under the following limits:</span><br><span class="line">list-max-ziplist-entries 512</span><br><span class="line">list-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line"># Sets have a special encoding in just one case: when a set is composed</span><br><span class="line"># of just strings that happen to be integers in radix 10 in the range</span><br><span class="line"># of 64 bit signed integers.</span><br><span class="line"># The following configuration setting sets the limit in the size of the</span><br><span class="line"># set in order to use this special memory saving encoding.</span><br><span class="line">set-max-intset-entries 512</span><br><span class="line"></span><br><span class="line"># Similarly to hashes and lists, sorted sets are also specially encoded in</span><br><span class="line"># order to save a lot of space. This encoding is only used when the length and</span><br><span class="line"># elements of a sorted set are below the following limits:</span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line"># HyperLogLog sparse representation bytes limit. The limit includes the</span><br><span class="line"># 16 bytes header. When an HyperLogLog using the sparse representation crosses</span><br><span class="line"># this limit, it is converted into the dense representation.</span><br><span class="line">#</span><br><span class="line"># A value greater than 16000 is totally useless, since at that point the</span><br><span class="line"># dense representation is more memory efficient.</span><br><span class="line">#</span><br><span class="line"># The suggested value is ~ 3000 in order to have the benefits of</span><br><span class="line"># the space efficient encoding without slowing down too much PFADD,</span><br><span class="line"># which is O(N) with the sparse encoding. The value can be raised to</span><br><span class="line"># ~ 10000 when CPU is not a concern, but space is, and the data set is</span><br><span class="line"># composed of many HyperLogLogs with cardinality in the 0 - 15000 range.</span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line"></span><br><span class="line"># Active rehashing uses 1 millisecond every 100 milliseconds of CPU time in</span><br><span class="line"># order to help rehashing the main Redis hash table (the one mapping top-level</span><br><span class="line"># keys to values). The hash table implementation Redis uses (see dict.c)</span><br><span class="line"># performs a lazy rehashing: the more operation you run into a hash table</span><br><span class="line"># that is rehashing, the more rehashing &quot;steps&quot; are performed, so if the</span><br><span class="line"># server is idle the rehashing is never complete and some more memory is used</span><br><span class="line"># by the hash table.</span><br><span class="line">#</span><br><span class="line"># The default is to use this millisecond 10 times every second in order to</span><br><span class="line"># actively rehash the main dictionaries, freeing memory when possible.</span><br><span class="line">#</span><br><span class="line"># If unsure:</span><br><span class="line"># use &quot;activerehashing no&quot; if you have hard latency requirements and it is</span><br><span class="line"># not a good thing in your environment that Redis can reply from time to time</span><br><span class="line"># to queries with 2 milliseconds delay.</span><br><span class="line">#</span><br><span class="line"># use &quot;activerehashing yes&quot; if you don&apos;t have such hard requirements but</span><br><span class="line"># want to free memory asap when possible.</span><br><span class="line">activerehashing yes</span><br><span class="line"></span><br><span class="line"># The client output buffer limits can be used to force disconnection of clients</span><br><span class="line"># that are not reading data from the server fast enough for some reason (a</span><br><span class="line"># common reason is that a Pub/Sub client can&apos;t consume messages as fast as the</span><br><span class="line"># publisher can produce them).</span><br><span class="line">#</span><br><span class="line"># The limit can be set differently for the three different classes of clients:</span><br><span class="line">#</span><br><span class="line"># normal -&gt; normal clients including MONITOR clients</span><br><span class="line"># slave  -&gt; slave clients</span><br><span class="line"># pubsub -&gt; clients subscribed to at least one pubsub channel or pattern</span><br><span class="line">#</span><br><span class="line"># The syntax of every client-output-buffer-limit directive is the following:</span><br><span class="line">#</span><br><span class="line"># client-output-buffer-limit &lt;class&gt; &lt;hard limit&gt; &lt;soft limit&gt; &lt;soft seconds&gt;</span><br><span class="line">#</span><br><span class="line"># A client is immediately disconnected once the hard limit is reached, or if</span><br><span class="line"># the soft limit is reached and remains reached for the specified number of</span><br><span class="line"># seconds (continuously).</span><br><span class="line"># So for instance if the hard limit is 32 megabytes and the soft limit is</span><br><span class="line"># 16 megabytes / 10 seconds, the client will get disconnected immediately</span><br><span class="line"># if the size of the output buffers reach 32 megabytes, but will also get</span><br><span class="line"># disconnected if the client reaches 16 megabytes and continuously overcomes</span><br><span class="line"># the limit for 10 seconds.</span><br><span class="line">#</span><br><span class="line"># By default normal clients are not limited because they don&apos;t receive data</span><br><span class="line"># without asking (in a push way), but just after a request, so only</span><br><span class="line"># asynchronous clients may create a scenario where data is requested faster</span><br><span class="line"># than it can read.</span><br><span class="line">#</span><br><span class="line"># Instead there is a default limit for pubsub and slave clients, since</span><br><span class="line"># subscribers and slaves receive data in a push fashion.</span><br><span class="line">#</span><br><span class="line"># Both the hard or the soft limit can be disabled by setting them to zero.</span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit slave 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line"></span><br><span class="line"># Redis calls an internal function to perform many background tasks, like</span><br><span class="line"># closing connections of clients in timeout, purging expired keys that are</span><br><span class="line"># never requested, and so forth.</span><br><span class="line">#</span><br><span class="line"># Not all tasks are performed with the same frequency, but Redis checks for</span><br><span class="line"># tasks to perform according to the specified &quot;hz&quot; value.</span><br><span class="line">#</span><br><span class="line"># By default &quot;hz&quot; is set to 10. Raising the value will use more CPU when</span><br><span class="line"># Redis is idle, but at the same time will make Redis more responsive when</span><br><span class="line"># there are many keys expiring at the same time, and timeouts may be</span><br><span class="line"># handled with more precision.</span><br><span class="line">#</span><br><span class="line"># The range is between 1 and 500, however a value over 100 is usually not</span><br><span class="line"># a good idea. Most users should use the default of 10 and raise this up to</span><br><span class="line"># 100 only in environments where very low latency is required.</span><br><span class="line">hz 10</span><br><span class="line"></span><br><span class="line"># When a child rewrites the AOF file, if the following option is enabled</span><br><span class="line"># the file will be fsync-ed every 32 MB of data generated. This is useful</span><br><span class="line"># in order to commit the file to the disk more incrementally and avoid</span><br><span class="line"># big latency spikes.</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br></pre></td></tr></table></figure>

<h2 id="4-2-Redis的数据持久化"><a href="#4-2-Redis的数据持久化" class="headerlink" title="4.2 Redis的数据持久化"></a>4.2 Redis的数据持久化</h2><h3 id="4-1-RDB-方式"><a href="#4-1-RDB-方式" class="headerlink" title="4.1 RDB 方式"></a>4.1 RDB 方式</h3><p>将内存中的数据持久化到磁盘中保存</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>save</td>
<td>将数据保存到磁盘中，但会阻塞 redis 进程，不能再执行其他操作</td>
</tr>
<tr>
<td>bgsave</td>
<td>将数据保存到磁盘中，会创建一个新的子进程，但是不能在执行 bgsave 命令再执行备份命令（save或 bgsave）</td>
</tr>
</tbody></table>
<p>注意：保存到磁盘中的位置取决于当前进入 redis 客户端的位置。</p>
<h3 id="4-2-AOF-方式"><a href="#4-2-AOF-方式" class="headerlink" title="4.2 AOF 方式"></a>4.2 AOF 方式</h3><p>通过保存 redis 服务器所执<strong>行的写命令来记录数据库状态的文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#开启 AOF 方法</span><br><span class="line">appendonly yes </span><br><span class="line">#默认推荐每秒刷新</span><br><span class="line">appendfsync everysec</span><br></pre></td></tr></table></figure>

<h1 id="5-Redis-集群"><a href="#5-Redis-集群" class="headerlink" title="5 Redis 集群"></a>5 Redis 集群</h1><h2 id="5-1-理论"><a href="#5-1-理论" class="headerlink" title="5.1 理论"></a>5.1 理论</h2><h2 id="5-2-搭建"><a href="#5-2-搭建" class="headerlink" title="5.2 搭建"></a>5.2 搭建</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">安装 ruby 环境</span></span><br><span class="line">yum install ruby</span><br><span class="line"><span class="meta">#</span><span class="bash">安装 ruby 的包管理器</span></span><br><span class="line">yum install rubygems</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 ruby 包</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ruby 包的位置在 redis 的安装目录下的 src 目录下 redis-trib.rb</span></span><br><span class="line">gem install redis3.0.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入 /usr/<span class="built_in">local</span></span></span><br><span class="line">mkdir redis-cluster</span><br><span class="line"><span class="meta">#</span><span class="bash">复制 1个 安装好的 redis 软件</span></span><br><span class="line"><span class="meta">#</span><span class="bash">修改 redis.conf 配置文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash">复制 其余 5个 redis 软件</span></span><br><span class="line"><span class="meta">#</span><span class="bash">将 ruby 脚本 redis-trib.rb</span></span><br><span class="line"><span class="meta">#</span><span class="bash">创建集群</span></span><br><span class="line">./redis-trib.rb create --replicas 1  192.168.170.4:7001 192.168.170.4:7002 192.168.170.4:7003 192.168.170.4:7004 192.168.170.4:7005 192.168.170.4:7006 	</span><br><span class="line"><span class="meta">#</span><span class="bash">创建开启 redis 集群</span></span><br><span class="line"><span class="meta">#</span><span class="bash">创建关闭 redis 集群</span></span><br></pre></td></tr></table></figure>

<h1 id="6-使用-JedisAPI-操作-Redis"><a href="#6-使用-JedisAPI-操作-Redis" class="headerlink" title="6  使用 JedisAPI 操作 Redis"></a>6  使用 JedisAPI 操作 Redis</h1><p>Jedis 继承了 redis 的一些命令操作，封装了对 redis 命令的 Java 客户端</p>
<h2 id="1-用-Jedis-操作-Redis-单机版"><a href="#1-用-Jedis-操作-Redis-单机版" class="headerlink" title="1 用 Jedis 操作 Redis 单机版"></a>1 用 Jedis 操作 Redis 单机版</h2><p>使用 maven 创建 jar 项目</p>
<p>调用 jedis 的 API完成对 Redis 的操作。</p>
<p>在 Jedis 中方法的命名与操作 Redis 的命令相同</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testJedisDemo</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个 Jedis 对象</span></span><br><span class="line">    Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"192.168.170.4"</span>,<span class="number">6379</span>);</span><br><span class="line">    <span class="comment">//调用 Jedis API 对象，注意  Jedis 对象的方法与 redis 客户端中的方法名相同</span></span><br><span class="line">    String result = jedis.set(<span class="string">"key"</span>,<span class="string">"Hello World"</span>);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">    String str = jedis.get(<span class="string">"key"</span>);</span><br><span class="line">    System.out.println(str);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"--------"</span>);</span><br><span class="line">    Long res = jedis.hset(<span class="string">"user"</span>, <span class="string">"name"</span>, <span class="string">"wrx"</span>);</span><br><span class="line">    System.out.println(res);</span><br><span class="line">    String h = jedis.hget(<span class="string">"user"</span>, <span class="string">"name"</span>);</span><br><span class="line">    System.out.println(h);</span><br><span class="line">    <span class="comment">//关闭 jedis 连接</span></span><br><span class="line">    jedis.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-使用-Jedis-连接池-Pool"><a href="#2-使用-Jedis-连接池-Pool" class="headerlink" title="2 使用 Jedis 连接池 Pool"></a>2 使用 Jedis 连接池 Pool</h2><blockquote>
<p>类似于数据连接池</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testJedisPool</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//创建 Jedis 连接池</span></span><br><span class="line">    JedisPool pool = <span class="keyword">new</span> JedisPool(<span class="string">"192.168.170.4"</span>, <span class="number">6379</span>);</span><br><span class="line">    <span class="comment">//获取 Jedis 连接对象</span></span><br><span class="line">    Jedis jedis = pool.getResource();</span><br><span class="line">    <span class="comment">//获取 hash </span></span><br><span class="line">    String name = jedis.hget(<span class="string">"user"</span>,<span class="string">"name"</span>);</span><br><span class="line">    System.out.println(name);</span><br><span class="line">    <span class="comment">//关闭 jedis 连接</span></span><br><span class="line">    jedis.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3用-Jedis-操作-Redis-集群"><a href="#3用-Jedis-操作-Redis-集群" class="headerlink" title="3用 Jedis 操作 Redis 集群"></a>3用 Jedis 操作 Redis 集群</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testJediscluster</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Set&lt;HostAndPort&gt; nodes = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">		nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.170.4"</span>, <span class="number">7001</span>));</span><br><span class="line">		nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.170.4"</span>, <span class="number">7002</span>));</span><br><span class="line">		nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.170.4"</span>, <span class="number">7003</span>));</span><br><span class="line">		nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.170.4"</span>, <span class="number">7004</span>));</span><br><span class="line">		nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.170.4"</span>, <span class="number">7005</span>));</span><br><span class="line">		nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.170.4"</span>, <span class="number">7006</span>));</span><br><span class="line">		<span class="comment">//连接 redis 集群</span></span><br><span class="line">		JedisCluster cluster = <span class="keyword">new</span> JedisCluster(nodes);</span><br><span class="line">		<span class="comment">//操作 redis 集群</span></span><br><span class="line">		cluster.set(<span class="string">"user"</span>, <span class="string">"name11"</span>);</span><br><span class="line">		String user = cluster.get(<span class="string">"user"</span>);</span><br><span class="line">		System.out.println(user);</span><br><span class="line">		<span class="comment">//关闭 redis 集群连接</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			cluster.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h1 id="7-spring-整合-Jedis-单机版"><a href="#7-spring-整合-Jedis-单机版" class="headerlink" title="7  spring 整合 Jedis 单机版"></a>7  spring 整合 Jedis 单机版</h1><p>创建 Maven 中 jar 项目，修改 pom.xml 文件，添加 jedis 和 spring 依赖</p>
<h2 id="7-1-dao-接口"><a href="#7-1-dao-接口" class="headerlink" title="7.1  dao 接口"></a>7.1  dao 接口</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package com.szxy.dao;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public interface JedisDao &#123;</span><br><span class="line">	</span><br><span class="line">	public <span class="built_in">String</span> <span class="keyword">set</span>(String key,String value);</span><br><span class="line">	public String <span class="keyword">get</span>(String key);</span><br><span class="line">	public long hset(String hkey,String key,String value);</span><br><span class="line">	public String hget(String hkey,String key);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-2-impl-实现类"><a href="#7-2-impl-实现类" class="headerlink" title="7.2  impl 实现类"></a>7.2  impl 实现类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.JedisDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisDaoImplSigle</span> <span class="keyword">implements</span> <span class="title">JedisDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.set(key, value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.get(key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">hset</span><span class="params">(String hkey, String key, String value)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.hset(hkey, key, value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String hkey, String key)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.hget(hkey, key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-3-applicationContext-jredis-xml"><a href="#7-3-applicationContext-jredis-xml" class="headerlink" title="7.3 applicationContext-jredis.xml"></a>7.3 applicationContext-jredis.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 开启组件扫描 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy"</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- jedisPool的配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"poolconfig"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPoolConfig"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 最大连接数 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxTotal"</span> <span class="attr">value</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 最大空闲连接数 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 每次释放连接的最大数目 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"numTestsPerEvictionRun"</span> <span class="attr">value</span>=<span class="string">"1024"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 释放连接的扫描间隔（毫秒） --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeBetweenEvictionRunsMillis"</span> <span class="attr">value</span>=<span class="string">"30000"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 连接最小空闲时间 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minEvictableIdleTimeMillis"</span> <span class="attr">value</span>=<span class="string">"1800000"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 连接空闲多久后释放, 当空闲时间&gt;该值 且 空闲连接&gt;最大空闲连接数 时直接释放 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"softMinEvictableIdleTimeMillis"</span> <span class="attr">value</span>=<span class="string">"10000"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 获取连接时的最大等待毫秒数,小于零:阻塞不确定的时间,默认-1 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWaitMillis"</span> <span class="attr">value</span>=<span class="string">"1500"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 在获取连接的时候检查有效性, 默认false --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 在空闲时检查有效性, 默认false --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testWhileIdle"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 连接耗尽时是否阻塞, false报异常,ture阻塞直到超时, 默认true --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"blockWhenExhausted"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisPool"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPool"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 构造注入 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"host"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>192.168.170.4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"port"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>6379<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"poolConfig"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"poolconfig"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"JedisDaoImplSigle"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.JedisDaoImplSigle"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="7-4-测试"><a href="#7-4-测试" class="headerlink" title="7.4 测试"></a>7.4 测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.JedisDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisDaoImplSigle</span> <span class="keyword">implements</span> <span class="title">JedisDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.set(key, value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.get(key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">hset</span><span class="params">(String hkey, String key, String value)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.hset(hkey, key, value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String hkey, String key)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.hget(hkey, key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="8-spring-整合-redis-集群版"><a href="#8-spring-整合-redis-集群版" class="headerlink" title="8 spring 整合 redis 集群版"></a>8 spring 整合 redis 集群版</h1><h2 id="8-1-impl-实现类"><a href="#8-1-impl-实现类" class="headerlink" title="8.1  impl 实现类"></a>8.1  impl 实现类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.JedisDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.HostAndPort;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisCluster;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> * 集群版 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisDaoImplCluter</span> <span class="keyword">implements</span> <span class="title">JedisDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> JedisCluster jedisCluster;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//new JedisCluster(nodes, poolConfig)</span></span><br><span class="line">		<span class="comment">//HostAndPort hostAndPort = new HostAndPort(host, port);</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.jedisCluster.set(key, value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.jedisCluster.get(key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">hset</span><span class="params">(String hkey, String key, String value)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.jedisCluster.hset(hkey, key, value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String hkey, String key)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.jedisCluster.hget(hkey, key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-2-applicationContext-jedis-cluster-xml"><a href="#8-2-applicationContext-jedis-cluster-xml" class="headerlink" title="8.2  applicationContext-jedis-cluster.xml"></a>8.2  applicationContext-jedis-cluster.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 开启组件扫描 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy"</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- jedisPool的配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"poolconfig"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPoolConfig"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 最大连接数 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxTotal"</span> <span class="attr">value</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 最大空闲连接数 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 每次释放连接的最大数目 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"numTestsPerEvictionRun"</span> <span class="attr">value</span>=<span class="string">"1024"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 释放连接的扫描间隔（毫秒） --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeBetweenEvictionRunsMillis"</span> <span class="attr">value</span>=<span class="string">"30000"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 连接最小空闲时间 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minEvictableIdleTimeMillis"</span> <span class="attr">value</span>=<span class="string">"1800000"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 连接空闲多久后释放, 当空闲时间&gt;该值 且 空闲连接&gt;最大空闲连接数 时直接释放 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"softMinEvictableIdleTimeMillis"</span> <span class="attr">value</span>=<span class="string">"10000"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 获取连接时的最大等待毫秒数,小于零:阻塞不确定的时间,默认-1 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWaitMillis"</span> <span class="attr">value</span>=<span class="string">"1500"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 在获取连接的时候检查有效性, 默认false --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 在空闲时检查有效性, 默认false --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testWhileIdle"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 连接耗尽时是否阻塞, false报异常,ture阻塞直到超时, 默认true --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"blockWhenExhausted"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- Jedis 操作 redis 集群 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisCluster"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisCluster"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"nodes"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.HostAndPort"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"host"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">value</span>&gt;</span>192.168.170.4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"port"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">value</span>&gt;</span>7001<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.HostAndPort"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"host"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">value</span>&gt;</span>192.168.170.4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"port"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">value</span>&gt;</span>7002<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.HostAndPort"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"host"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">value</span>&gt;</span>192.168.170.4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"port"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">value</span>&gt;</span>7003<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.HostAndPort"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"host"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">value</span>&gt;</span>192.168.170.4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"port"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">value</span>&gt;</span>7004<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.HostAndPort"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"host"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">value</span>&gt;</span>192.168.170.4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"port"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">value</span>&gt;</span>7005<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.HostAndPort"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"host"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">value</span>&gt;</span>192.168.170.4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"port"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">value</span>&gt;</span>7006<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"poolConfig"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"poolconfig"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 集群版 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisDaoImplCluter"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.JedisDaoImplCluter"</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="8-3-测试"><a href="#8-3-测试" class="headerlink" title="8.3  测试"></a>8.3  测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.JedisDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJedis</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		TestJedis.testJedisCluster();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testJedisCluster</span><span class="params">()</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		ClassPathXmlApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext-jedis-cluster.xml"</span>);</span><br><span class="line">		JedisDao dao = ac.getBean(<span class="string">"jedisDaoImplCluter"</span>,JedisDao.class);</span><br><span class="line">		String result = dao.set(<span class="string">"szxy"</span>, <span class="string">"Hello World"</span>);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">		String hello = dao.get(<span class="string">"szxy"</span>);</span><br><span class="line">		System.out.println(hello);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="9-Redis-Desktop-Manager-的使用"><a href="#9-Redis-Desktop-Manager-的使用" class="headerlink" title="9  Redis Desktop Manager 的使用"></a>9  Redis Desktop Manager 的使用</h1><p>创建与 Redis 的连接</p>
<p>本机无法打开，闪退。。。</p>
<h1 id="10-Redis-实战项目"><a href="#10-Redis-实战项目" class="headerlink" title="10  Redis 实战项目"></a>10  Redis 实战项目</h1><h2 id="1-需求"><a href="#1-需求" class="headerlink" title="1 需求"></a>1 需求</h2><p>实现用户添加功能</p>
<p>实现用户查询功能，并使用 Redis 作为查询缓存</p>
<p>实现用户更新更新，同步缓存</p>
<h2 id="2-技术选型"><a href="#2-技术选型" class="headerlink" title="2 技术选型"></a>2 技术选型</h2><p>Spring+SpringMVC+Mybatis+Maven+Redis</p>
<h2 id="3-项目搭建"><a href="#3-项目搭建" class="headerlink" title="3 项目搭建"></a>3 项目搭建</h2><h3 id="JedisDao"><a href="#JedisDao" class="headerlink" title="JedisDao"></a>JedisDao</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.jedisdao;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">JedisDao</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置 String 类型的 key 和 value</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key,String value)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取 String 类型的 key 对应的 value</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置 hash 类型的 hkey 中 key 和value</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> hkey</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">hset</span><span class="params">(String hkey,String key,String value)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取 hash 类型的hkey 中 key 对应的 value</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> hkey</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String hkey,String key)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置 key 的失效时间</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key 指定的 key </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> sec 失效时间，以秒为单位</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">expire</span><span class="params">(String key,<span class="keyword">int</span> sec)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 删除 key </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">del</span><span class="params">(String key)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JedisDaoImplSingle"><a href="#JedisDaoImplSingle" class="headerlink" title="JedisDaoImplSingle"></a>JedisDaoImplSingle</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.jedisdao.iml;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.jedisdao.JedisDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jedis 操作 redis 单机版</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisDaoImplSingle</span> <span class="keyword">implements</span> <span class="title">JedisDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.set(key, value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.get(key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">hset</span><span class="params">(String hkey, String key, String value)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.hset(hkey, key, value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String hkey, String key)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.hget(hkey, key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">expire</span><span class="params">(String key, <span class="keyword">int</span> sec)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.expire(key, sec);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">del</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">this</span>.jedisPool.getResource();</span><br><span class="line">		<span class="keyword">return</span> jedis.del(key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JedisDaoImplCluter"><a href="#JedisDaoImplCluter" class="headerlink" title="JedisDaoImplCluter"></a>JedisDaoImplCluter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.jedisdao.iml;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.jedisdao.JedisDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.HostAndPort;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisCluster;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> * 集群版 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisDaoImplCluter</span> <span class="keyword">implements</span> <span class="title">JedisDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> JedisCluster jedisCluster;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//new JedisCluster(nodes, poolConfig)</span></span><br><span class="line">		<span class="comment">//HostAndPort hostAndPort = new HostAndPort(host, port);</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.jedisCluster.set(key, value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.jedisCluster.get(key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">hset</span><span class="params">(String hkey, String key, String value)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.jedisCluster.hset(hkey, key, value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String hkey, String key)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.jedisCluster.hget(hkey, key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">expire</span><span class="params">(String key, <span class="keyword">int</span> sec)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.jedisCluster.expire(key, sec);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">del</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.jedisCluster.del(key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="applicationContext-Jedis-xml"><a href="#applicationContext-Jedis-xml" class="headerlink" title="applicationContext-Jedis.xml"></a>applicationContext-Jedis.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 开启组件扫描 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy"</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- jedisPool的配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"poolconfig"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPoolConfig"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 最大连接数 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxTotal"</span> <span class="attr">value</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 最大空闲连接数 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 每次释放连接的最大数目 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"numTestsPerEvictionRun"</span> <span class="attr">value</span>=<span class="string">"1024"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 释放连接的扫描间隔（毫秒） --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeBetweenEvictionRunsMillis"</span> <span class="attr">value</span>=<span class="string">"30000"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 连接最小空闲时间 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minEvictableIdleTimeMillis"</span> <span class="attr">value</span>=<span class="string">"1800000"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 连接空闲多久后释放, 当空闲时间&gt;该值 且 空闲连接&gt;最大空闲连接数 时直接释放 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"softMinEvictableIdleTimeMillis"</span> <span class="attr">value</span>=<span class="string">"10000"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 获取连接时的最大等待毫秒数,小于零:阻塞不确定的时间,默认-1 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWaitMillis"</span> <span class="attr">value</span>=<span class="string">"1500"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 在获取连接的时候检查有效性, 默认false --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 在空闲时检查有效性, 默认false --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testWhileIdle"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 连接耗尽时是否阻塞, false报异常,ture阻塞直到超时, 默认true --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"blockWhenExhausted"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisPool"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPool"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 构造注入 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"host"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>192.168.170.4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"port"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>6379<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"poolConfig"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"poolconfig"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisDaoImplSingle"</span> <span class="attr">class</span>=<span class="string">"com.szxy.jedisdao.iml.JedisDaoImplSingle"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="用户查询缓存"><a href="#用户查询缓存" class="headerlink" title="用户查询缓存"></a>用户查询缓存</h3><p>先查询 redis 缓存中是否存在用户数据，若缓存命中，redis 缓存中有用户数据，返回直接返回用户数据，否则查询数据库，将查询到用户数据放入 redis 缓存中，并返回用户数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Users <span class="title">findUserById</span><span class="params">(Integer userid)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">//查询 redis </span></span><br><span class="line">        String json = <span class="keyword">this</span>.jedisDaoImplSingle.get(REDIS_USERS_PREFIX+<span class="string">":"</span>+userid);</span><br><span class="line">        <span class="comment">//缓存命中</span></span><br><span class="line">        <span class="keyword">if</span>(json != <span class="keyword">null</span> &amp;&amp; !json.equals(<span class="string">""</span>))&#123;</span><br><span class="line">            Users user = JsonUtils.jsonToPojo(json, Users.class);</span><br><span class="line">            System.out.println(<span class="string">"使用 redis 缓存。。。"</span>);</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(Excepation e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"查询数据库。。。"</span>);</span><br><span class="line">    <span class="comment">//查询数据库</span></span><br><span class="line">    Users user = <span class="keyword">this</span>.usersMapper.selectUserById(userid);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        String json = JsonUtils.objectToJson(user);</span><br><span class="line">        <span class="comment">//添加到 redis 缓存中</span></span><br><span class="line">        <span class="keyword">this</span>.jedisDaoImplSingle.set(REDIS_USERS_PREFIX+<span class="string">":"</span>+userid,json);</span><br><span class="line">        <span class="comment">//设置 key 失效时间</span></span><br><span class="line">        <span class="keyword">this</span>.jedisDaoImplSingle.expire(REDIS_USERS_PREFIX+<span class="string">":"</span>+userid, <span class="number">20</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="用户更新，同步-redis"><a href="#用户更新，同步-redis" class="headerlink" title="用户更新，同步 redis"></a>用户更新，同步 redis</h3><p>当前用户数据发生变更时，同步 redis  即将 redis 缓存中对应的用户数据删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(Users user)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//更新用户信息</span></span><br><span class="line">    <span class="keyword">this</span>.usersMapper.updUser(user);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//同步 redis</span></span><br><span class="line">        <span class="keyword">this</span>.jedisDaoImplSingle.del(REDIS_USERS_PREFIX+<span class="string">":"</span>+user.getUserid());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><ol>
<li><p>使用 redis 缓存，需要加 trycatch语句，提高程序的健壮性，防止 redis 操作出错，影响正常的业务逻辑代码执行。</p>
</li>
<li><p><code>&lt;context:property-placeholder location=&quot;classpath:*.properties&quot;/&gt;</code></p>
<p>这个标签在不使用属性ignore-unresolvable=”true” 的情况下，只会加载当前位置的 properties 的文件，其他位置的 <code>context:property-placeholder</code> 标签会被忽略</p>
</li>
</ol>
<h1 id="Bug"><a href="#Bug" class="headerlink" title="Bug"></a>Bug</h1><p>​    </p>
<p><a href="https://blog.csdn.net/javaloveiphone/article/details/58146790" target="_blank" rel="noopener">Spring中报”Could not resolve placeholder”的解决方案</a></p>
<p>在同一个 spring 项目中 ， properties 的文件，只会在一个位置加载，若其余还有，则会忽略</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/25/20190525 Nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/25/20190525 Nginx/" class="post-title-link" itemprop="url">20190525 Nginx</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-25 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-25T00:00:00+08:00">2019-05-25</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-26 12:39:36" itemprop="dateModified" datetime="2019-05-26T12:39:36+08:00">2019-05-26</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Nginx"><a href="#1-Nginx" class="headerlink" title="1 Nginx"></a>1 Nginx</h1><blockquote>
<p>Nginx(发音同 engine x) 是一个高性能的 HTTP 和 反向代理服务及邮件服务器</p>
</blockquote>
<h1 id="2-Nginx-作用"><a href="#2-Nginx-作用" class="headerlink" title="2 Nginx 作用"></a>2 Nginx 作用</h1><ul>
<li>http 协议代理</li>
<li>搭建虚拟主机</li>
<li>服务的反向代理</li>
<li>在反向代理中配置集群的负载均衡</li>
</ul>
<h1 id="3-Nginx-代理"><a href="#3-Nginx-代理" class="headerlink" title="3 Nginx 代理"></a>3 Nginx 代理</h1><h2 id="3-1-正向代理（Forward-Proxy）"><a href="#3-1-正向代理（Forward-Proxy）" class="headerlink" title="3.1 正向代理（Forward Proxy）"></a>3.1 正向代理（Forward Proxy）</h2><p>从客户端的角色</p>
<p><img src="https://pic4.zhimg.com/80/v2-07ededff1d415c1fa2db3fd89378eda0_hd.jpg" alt></p>
<h2 id="3-2-反向代理（Reserve-Proxy）"><a href="#3-2-反向代理（Reserve-Proxy）" class="headerlink" title="3.2 反向代理（Reserve Proxy）"></a>3.2 反向代理（Reserve Proxy）</h2><p>从服务端角度</p>
<p><img src="https://pic4.zhimg.com/80/v2-816f7595d80b7ef36bf958764a873cba_hd.jpg" alt></p>
<h2 id="3-3-两者区别"><a href="#3-3-两者区别" class="headerlink" title="3.3 两者区别"></a>3.3 两者区别</h2><p><strong>位置不同</strong></p>
<p>正向代理，架设在客户机和目标主机之间；</p>
<p>反向代理，架设在服务器端；</p>
<p><strong>代理对象不同</strong></p>
<p>正向代理，代理客户端，服务器不知道实际发起请求的客户端</p>
<p>反向代理，代理服务端，客户端不知道实际提供服务的服务端</p>
<p><img src="http://www.zwer.xyz/picGo/20190525153033.png" alt></p>
<h1 id="4-安装-Nginx"><a href="#4-安装-Nginx" class="headerlink" title="4  安装 Nginx"></a>4  安装 Nginx</h1><h3 id="4-1-准备工作"><a href="#4-1-准备工作" class="headerlink" title="4.1 准备工作"></a>4.1 准备工作</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc-c++</span><br><span class="line"></span><br><span class="line">yum install -y pcre pcre-devel</span><br><span class="line"></span><br><span class="line">yum install -y zlib-devel</span><br><span class="line"></span><br><span class="line">yum install -y openssl-devel</span><br></pre></td></tr></table></figure>

<h3 id="4-2-安装-nginx"><a href="#4-2-安装-nginx" class="headerlink" title="4.2  安装 nginx"></a>4.2  安装 nginx</h3><p><strong>step1:</strong>上传 nginx 压缩文件并解压</p>
<p><strong>step2:</strong>在 var 目录下创建临时文件目录为 temp 目录及子目录 nginx</p>
<p><strong>step3:</strong>配置安装参数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">./configure \ </span><br><span class="line">--prefix=/usr/local/nginx \ </span><br><span class="line">--pid-path=/var/run/nginx/nginx.pid \ </span><br><span class="line">--lock-path=/var/lock/nginx.lock \ </span><br><span class="line">--error-log-path=/var/log/nginx/error.log \ </span><br><span class="line">--http-log-path=/var/log/nginx/access.log \ </span><br><span class="line">--with-http_gzip_static_module \ </span><br><span class="line">--http-client-body-temp-path=/var/temp/nginx/client \ </span><br><span class="line">--http-proxy-temp-path=/var/temp/nginx/proxy \ </span><br><span class="line">--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \ </span><br><span class="line">--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \ </span><br><span class="line">--http-scgi-temp-path=/var/temp/nginx/scgi </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr/local/nginx --pid-path=/var/run/nginx/nginx.pid --lock-path=/var/lock/nginx.lock --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --with-http_gzip_static_module --http-client-body-temp-path=/var/temp/nginx/client --http-proxy-temp-path=/var/temp/nginx/proxy --http-fastcgi-temp-path=/var/temp/nginx/fastcgi --http-uwsgi-temp-path=/var/temp/nginx/uwsgi --http-scgi-temp-path=/var/temp/nginx/scgi </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>注意：</span><br><span class="line"><span class="meta">#</span>上边将临时文件目录指定为/var/temp/nginx，需要在/var 下创建 temp 及 nginx目录 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>执行上面 configure 命令后的</span><br><span class="line">Configuration summary</span><br><span class="line">  + using system PCRE library</span><br><span class="line">  + OpenSSL library is not used</span><br><span class="line">  + md5: using system crypto library</span><br><span class="line">  + sha1: using system crypto library</span><br><span class="line">  + using system zlib library</span><br><span class="line"></span><br><span class="line">  nginx path prefix: "/usr/local/nginx"</span><br><span class="line">  nginx binary file: "/usr/local/nginx/sbin/nginx"</span><br><span class="line">  nginx configuration prefix: "/usr/local/nginx/conf"</span><br><span class="line">  nginx configuration file: "/usr/local/nginx/conf/nginx.conf"</span><br><span class="line">  nginx pid file: "/var/run/nginx/nginx.pid"</span><br><span class="line">  nginx error log file: "/var/log/nginx/error.log"</span><br><span class="line">  nginx http access log file: "/var/log/nginx/access.log"</span><br><span class="line">  nginx http client request body temporary files: "/var/temp/nginx/client"</span><br><span class="line">  nginx http proxy temporary files: "/var/temp/nginx/proxy"</span><br><span class="line">  nginx http fastcgi temporary files: "/var/temp/nginx/fastcgi"</span><br><span class="line">  nginx http uwsgi temporary files: "/var/temp/nginx/uwsgi"</span><br><span class="line">  nginx http scgi temporary files: "/var/temp/nginx/scgi"</span><br></pre></td></tr></table></figure>

<p><strong>step4:</strong> 编译 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>

<p><strong>step5：</strong>安装 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure>

<h1 id="5-操作-Nginx"><a href="#5-操作-Nginx" class="headerlink" title="5 操作 Nginx"></a>5 操作 Nginx</h1><blockquote>
<p>Nginx 监听的端口是 80 </p>
</blockquote>
<h2 id="5-1-启动-nginx"><a href="#5-1-启动-nginx" class="headerlink" title="5.1  启动 nginx"></a>5.1  启动 nginx</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx</span><br><span class="line"><span class="meta">#</span>启动 Nginx</span><br><span class="line">./nginx</span><br><span class="line"><span class="meta">#</span>以指定的配置 nginx 文件启动</span><br><span class="line">./nginx -c /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>

<h2 id="5-2-停止-nginx"><a href="#5-2-停止-nginx" class="headerlink" title="5.2 停止 nginx"></a>5.2 停止 nginx</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>方式一强制停止，直接 kill</span><br><span class="line">./nginx -s stop</span><br><span class="line"><span class="meta">#</span>完整停止</span><br><span class="line">./nginx -s quit</span><br></pre></td></tr></table></figure>

<h2 id="5-3-重启-nginx"><a href="#5-3-重启-nginx" class="headerlink" title="5.3 重启 nginx"></a>5.3 重启 nginx</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>先停止，再启动</span><br><span class="line">./nginx -s quit</span><br><span class="line">./nginx 	</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>重新加载配置文件</span><br><span class="line">./nginx -s reload</span><br></pre></td></tr></table></figure>

<h1 id="6-虚拟主机"><a href="#6-虚拟主机" class="headerlink" title="6  虚拟主机"></a>6  虚拟主机</h1><p><strong>虚拟主机</strong>（英语：virtual hosting）或称 <strong>共享主机</strong>（shared web hosting），又称<strong>虚拟服务器</strong>，是一种在单一主机或主机群上，实现多网域服务的方法，可以运行多个<a href="https://baike.baidu.com/item/网站" target="_blank" rel="noopener">网站</a>或服务的技术。虚拟主机之间完全独立，并可由用户自行管理，虚拟并非指不存在，而是指空间是由实体的服务器延伸而来，其<a href="https://baike.baidu.com/item/硬件" target="_blank" rel="noopener">硬件</a>系统可以是基于服务器群，或者单个服务器。</p>
<p>其技术是<a href="https://baike.baidu.com/item/互联网" target="_blank" rel="noopener">互联网</a><a href="https://baike.baidu.com/item/服务器" target="_blank" rel="noopener">服务器</a>采用的节省服务器<a href="https://baike.baidu.com/item/硬件" target="_blank" rel="noopener">硬件</a>成本的技术，虚拟主机技术主要应用于HTTP，FTP，EMAIL等多项服务，将一台服务器的某项或者全部服务内容<a href="https://baike.baidu.com/item/逻辑" target="_blank" rel="noopener">逻辑</a>划分为多个服务单位，对外表现为多个服务器，从而充分利用服务器硬件资源。如果划分是系统级别的，则称为虚拟服务器。</p>
<h2 id="6-1-Linux-绑定多个IP-地址"><a href="#6-1-Linux-绑定多个IP-地址" class="headerlink" title="6.1  Linux 绑定多个IP 地址"></a>6.1  Linux 绑定多个IP 地址</h2><p><img src="http://www.zwer.xyz/picGo/20190525202102.png" alt></p>
<p>进入到 cd /etc/sysconfig/network-script 目录下，查看 ifcfg_Auto_eth0</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">IPADDR=192.168.170.4</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.170.2</span><br><span class="line">IPADDR2=192.168.170.150</span><br><span class="line">PREFIX2=24</span><br><span class="line">GATEWAY2=192.168.170.2</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=yes</span><br><span class="line">IPV6INIT=no</span><br><span class="line">NAME="Auto eth0"</span><br><span class="line">UUID=a24a2fc6-be63-42f0-83c2-06144b5dad86</span><br><span class="line">ONBOOT=yes</span><br><span class="line">HWADDR=00:0C:29:61:49:5F</span><br><span class="line">LAST_CONNECT=1558785505</span><br></pre></td></tr></table></figure>

<h2 id="6-2-基于IP-的虚拟主机配置"><a href="#6-2-基于IP-的虚拟主机配置" class="headerlink" title="6.2  基于IP 的虚拟主机配置"></a>6.2  基于IP 的虚拟主机配置</h2><blockquote>
<p>进入 cd  /usr/local/nginx/conf 目录下，编辑 nignx.conf 文件</p>
<p>注意：将使用用户改为 root </p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">user  root;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #一个 Server 就是一个虚拟主机</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line"><span class="meta">	#</span>为虚拟机指定 IP 或者域名</span><br><span class="line">        server_name  192.168.170.4;</span><br><span class="line">	</span><br><span class="line"><span class="meta">	#</span>主要配置路由访问信息</span><br><span class="line">        location / &#123;</span><br><span class="line">	    #用于指定访问根目录时，访问虚拟主机的web目录</span><br><span class="line">            root   html;</span><br><span class="line">	    #在不指定访问具体资源，默认的展示资源的列表</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    #一个 Server 就是一个虚拟主机</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line"><span class="meta">	#</span>为虚拟机指定 IP 或者域名</span><br><span class="line">        server_name  192.168.170.150;</span><br><span class="line">	</span><br><span class="line"><span class="meta">	#</span>主要配置路由访问信息</span><br><span class="line">        location / &#123;</span><br><span class="line">	    #用于指定访问根目录时，访问虚拟主机的web目录</span><br><span class="line">            root   html150;</span><br><span class="line">	    #在不指定访问具体资源，默认的展示资源的列表</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html150;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-3-基于端口的虚拟主机配置"><a href="#6-3-基于端口的虚拟主机配置" class="headerlink" title="6.3 基于端口的虚拟主机配置"></a>6.3 基于端口的虚拟主机配置</h2><blockquote>
<p>进入 cd  /usr/local/nginx/conf 目录下，编辑 nignx.conf 文件</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>一个 Server 就是一个虚拟主机</span><br><span class="line">server &#123;</span><br><span class="line">listen       9090;</span><br><span class="line"><span class="meta">#</span>为虚拟机指定 IP 或者域名</span><br><span class="line">server_name  192.168.170.150;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>主要配置路由访问信息</span><br><span class="line">location / &#123;</span><br><span class="line"><span class="meta">#</span>用于指定访问根目录时，访问虚拟主机的web目录</span><br><span class="line">root   html9090;</span><br><span class="line"><span class="meta">#</span>在不指定访问具体资源，默认的展示资源的列表</span><br><span class="line">index  index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">error_page   500 502 503 504  /50x.html;</span><br><span class="line">location = /50x.html &#123;</span><br><span class="line">root   html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>一个 Server 就是一个虚拟主机</span><br><span class="line">server &#123;</span><br><span class="line">listen       8080;</span><br><span class="line"><span class="meta">#</span>为虚拟机指定 IP 或者域名</span><br><span class="line">server_name  192.168.170.150;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>主要配置路由访问信息</span><br><span class="line">location / &#123;</span><br><span class="line"><span class="meta">#</span>用于指定访问根目录时，访问虚拟主机的web目录</span><br><span class="line">root   html8080;</span><br><span class="line"><span class="meta">#</span>在不指定访问具体资源，默认的展示资源的列表</span><br><span class="line">index  index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">error_page   500 502 503 504  /50x.html;</span><br><span class="line">location = /50x.html &#123;</span><br><span class="line">root   html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-4-基于域名的虚拟主机配置"><a href="#6-4-基于域名的虚拟主机配置" class="headerlink" title="6.4 基于域名的虚拟主机配置"></a>6.4 基于域名的虚拟主机配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>一个 Server 就是一个虚拟主机</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line"><span class="meta">	#</span>为虚拟机指定 IP 或者域名</span><br><span class="line">        server_name  www.szxy.cn;</span><br><span class="line">	</span><br><span class="line"><span class="meta">	#</span>主要配置路由访问信息</span><br><span class="line">        location / &#123;</span><br><span class="line">	    #用于指定访问根目录时，访问虚拟主机的web目录</span><br><span class="line">            root   html-szxy;</span><br><span class="line">	    #在不指定访问具体资源，默认的展示资源的列表</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">     #一个 Server 就是一个虚拟主机</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line"><span class="meta">	#</span>为虚拟机指定 IP 或者域名</span><br><span class="line">        server_name   www.xxgcxy.cn;</span><br><span class="line">	</span><br><span class="line"><span class="meta">	#</span>主要配置路由访问信息</span><br><span class="line">        location / &#123;</span><br><span class="line">	    #用于指定访问根目录时，访问虚拟主机的web目录</span><br><span class="line">            root   html-xxgcxy;</span><br><span class="line">	    #在不指定访问具体资源，默认的展示资源的列表</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="7-反向代理"><a href="#7-反向代理" class="headerlink" title="7 反向代理"></a>7 反向代理</h1><h3 id="7-1-tomcat-安装"><a href="#7-1-tomcat-安装" class="headerlink" title="7.1 tomcat 安装"></a>7.1 tomcat 安装</h3><ul>
<li><p>编辑 server.xm ,修改端口</p>
</li>
<li><p>开启 tomcat </p>
</li>
</ul>
<h3 id="7-2-编辑-nginx-conf-配置文件"><a href="#7-2-编辑-nginx-conf-配置文件" class="headerlink" title="7.2 编辑 nginx.conf 配置文件"></a>7.2 编辑 nginx.conf 配置文件</h3><blockquote>
<p>upstream 用于负载均衡和反向代理</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>#反向代理</span><br><span class="line">    upstream tomcat_server1 &#123;</span><br><span class="line">	server 192.168.170.8:8081;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream tomcat_server2 &#123;</span><br><span class="line">	server 192.168.170.8:8082;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line"><span class="meta">	#</span>为虚拟机指定 IP 或者域名</span><br><span class="line">        server_name  www.szxy.cn;</span><br><span class="line">	</span><br><span class="line"><span class="meta">	#</span>主要配置路由访问信息</span><br><span class="line">        location / &#123;</span><br><span class="line">	    #用于指定访问根目录时，访问虚拟主机的web目录</span><br><span class="line">            proxy_pass http://tomcat_server1;</span><br><span class="line">	    #在不指定访问具体资源，默认的展示资源的列表</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     #一个 Server 就是一个虚拟主机</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line"><span class="meta">	#</span>为虚拟机指定 IP 或者域名</span><br><span class="line">        server_name   www.xxgcxy.cn;</span><br><span class="line"><span class="meta">	#</span>主要配置路由访问信息</span><br><span class="line">        location / &#123;</span><br><span class="line">	    #用于指定访问根目录时，访问虚拟主机的web目录</span><br><span class="line">            proxy_pass http://tomcat_server2;</span><br><span class="line">	    #在不指定访问具体资源，默认的展示资源的列表</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-负载均衡"><a href="#7-3-负载均衡" class="headerlink" title="7.3 负载均衡"></a>7.3 负载均衡</h3><blockquote>
<p>Load Balance ，分摊到多个操作单元上进行执行。</p>
</blockquote>
<h3 id="7-4-负载均衡策略"><a href="#7-4-负载均衡策略" class="headerlink" title="7.4  负载均衡策略"></a>7.4  负载均衡策略</h3><blockquote>
<p>down 表示当前的 server 暂时不参与负载</p>
<p>weight 默认为1 weight越大，负载的权重就越大</p>
<p>fail_timeout 次失败后，暂停的时间 默认为10s</p>
<p>max_fail:  允许请求失败的次数默认为1 当超过最大次数时，返回</p>
<p>backup：其他所有的非 backup 及其 down 或者忙的时候，请求backup 机器。所有这台机器压力最轻</p>
</blockquote>
<h5 id="轮询（默认）"><a href="#轮询（默认）" class="headerlink" title="轮询（默认）"></a>轮询（默认）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream backserver&#123;</span><br><span class="line">	server 192.168.170.4;</span><br><span class="line">	server 192.168.170.5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="执行权重"><a href="#执行权重" class="headerlink" title="执行权重"></a>执行权重</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream backserver&#123;</span><br><span class="line">	server 192.168.170.4 wigth=10;</span><br><span class="line">	server 192.168.170.5 wigth=10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="IP绑定-ip-hash"><a href="#IP绑定-ip-hash" class="headerlink" title="IP绑定 ip_hash"></a>IP绑定 ip_hash</h5><p>每个请求按访问的 ip 的hash 结果分配，这样每个访客固定访问一个后端服务器，可以解决 session 的问题</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backserver&#123;</span><br><span class="line">	ip_hash;</span><br><span class="line">	server 192.168.170.40;</span><br><span class="line">	server 192.168.170.5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="8-Http-协议代理"><a href="#8-Http-协议代理" class="headerlink" title="8  Http 协议代理"></a>8  Http 协议代理</h1><p>由于 ftp 服务器是基于 ftp 协议处理的，但是要在外部访问 ftp 服务器中的图片</p>
<p>不行的，因为外部访问是通过 http 协议的，所以 ftp 服务器是无法访问的。</p>
<p>解决方法：使用 Nginx 服务器做 Http 协议代理</p>
<h3 id="8-1-准备"><a href="#8-1-准备" class="headerlink" title="8.1 准备"></a>8.1 准备</h3><p>安装 Nginx 服务器和 VSFTPD 服务器，且两者都必须在同一个机器上运行。</p>
<h3 id="8-2-修改-nginx-conf-文件"><a href="#8-2-修改-nginx-conf-文件" class="headerlink" title="8.2 修改 nginx.conf 文件"></a>8.2 修改 nginx.conf 文件</h3><blockquote>
<p>img.szxy.cn 这个域名是指向  192.168.170.4</p>
<p>通过在 C:\Windows\System32\drivers\etc 目录下，编辑 hosts 文件</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line"><span class="meta">	#</span>为虚拟机指定 IP 或者域名</span><br><span class="line">        server_name  img.szxy.cn;</span><br><span class="line">	</span><br><span class="line"><span class="meta">	#</span>主要配置路由访问信息</span><br><span class="line">        location / &#123;</span><br><span class="line">	    #用于指定访问根目录时，访问虚拟主机的web目录</span><br><span class="line">         #proxy_pass http://tomcat_server1;</span><br><span class="line">	    root	/home/ftpuser;</span><br><span class="line">	    #在不指定访问具体资源，默认的展示资源的列表</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/24/20190524 VSFTPD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/24/20190524 VSFTPD/" class="post-title-link" itemprop="url">20190524 VSFTPD</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-24 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-24T00:00:00+08:00">2019-05-24</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-25 14:50:21" itemprop="dateModified" datetime="2019-05-25T14:50:21+08:00">2019-05-25</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="VSFTD-介绍"><a href="#VSFTD-介绍" class="headerlink" title="VSFTD 介绍"></a>VSFTD 介绍</h3><h4 id="FTP-服务器"><a href="#FTP-服务器" class="headerlink" title="FTP 服务器"></a>FTP 服务器</h4><p>有状态</p>
<p>FTP 是 File Transfer Protocol 的英文简称，中文简称“文传协议”</p>
<h4 id="VSFTPD"><a href="#VSFTPD" class="headerlink" title="VSFTPD"></a>VSFTPD</h4><p>vsftpd 是 “very secure FTP daemon” 的缩写，</p>
<p>是一个完全免费、开放源代码的 ftp 服务器软件，支持其他 FTP 服务器所不支持的特征。</p>
<h3 id="项目中图片服务器"><a href="#项目中图片服务器" class="headerlink" title="项目中图片服务器"></a>项目中图片服务器</h3><h4 id="单体架构"><a href="#单体架构" class="headerlink" title="单体架构"></a>单体架构</h4><p>采用在 WEB-ROOT 目录建立 images 目录，存放图片。</p>
<h4 id="分布式架构"><a href="#分布式架构" class="headerlink" title="分布式架构"></a>分布式架构</h4><p>采用 vsFTPD 图片服务器存放图片。</p>
<h3 id="安装-VSFTPD"><a href="#安装-VSFTPD" class="headerlink" title="安装 VSFTPD"></a>安装 VSFTPD</h3><h4 id="安装-vsftpd-组件"><a href="#安装-vsftpd-组件" class="headerlink" title="安装 vsftpd 组件"></a>安装 vsftpd 组件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install vsftpd </span><br><span class="line"><span class="meta">#</span><span class="bash">安装完成后， /etc/vsftpd/vsftpd.conf 是vsftpd 服务器的配置目录</span></span><br></pre></td></tr></table></figure>

<h4 id="添加一个-Linux-用户"><a href="#添加一个-Linux-用户" class="headerlink" title="添加一个 Linux 用户"></a>添加一个 Linux 用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd ftpuser</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd ftpuser</span><br></pre></td></tr></table></figure>

<h4 id="防火墙开启-21-端口"><a href="#防火墙开启-21-端口" class="headerlink" title="防火墙开启 21 端口"></a>防火墙开启 21 端口</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">使用   vim /etc/sysconfig/iptabls</span></span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 21 -j ACCEPT                            </span><br><span class="line"><span class="meta">#</span><span class="bash">重启 iptables</span></span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure>

<h4 id="修改-selinux"><a href="#修改-selinux" class="headerlink" title="修改 selinux"></a>修改 selinux</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@zwz home]# getsebool -a | grep ftp</span><br><span class="line">allow_ftpd_anon_write --&gt; off</span><br><span class="line">allow_ftpd_full_access --&gt; off</span><br><span class="line">allow_ftpd_use_cifs --&gt; off</span><br><span class="line">allow_ftpd_use_nfs --&gt; off</span><br><span class="line">ftp_home_dir --&gt; off</span><br><span class="line">ftpd_connect_db --&gt; off</span><br><span class="line">ftpd_use_fusefs --&gt; off</span><br><span class="line">ftpd_use_passive_mode --&gt; off</span><br><span class="line">httpd_enable_ftp_server --&gt; off</span><br><span class="line">tftp_anon_write --&gt; off</span><br><span class="line">tftp_use_cifs --&gt; off</span><br><span class="line">tftp_use_nfs --&gt; off</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">设置允许,注意参数 P 大写</span></span><br><span class="line">[root@zwz home]# setsebool -P allow_ftpd_full_access on</span><br><span class="line">[root@zwz home]# setsebool -P ftp_home_dir on</span><br></pre></td></tr></table></figure>

<h4 id="关闭匿名访问"><a href="#关闭匿名访问" class="headerlink" title="关闭匿名访问"></a>关闭匿名访问</h4><p>修改 /etc/vsftpf/vsftpd.conf 文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Allow anonymous FTP? (Beware - allowed by default <span class="keyword">if</span> you comment this out).</span></span><br><span class="line">anonymous_enable=no</span><br><span class="line"></span><br><span class="line">重启 vsftpd 服务</span><br><span class="line">service vsftpd restart</span><br></pre></td></tr></table></figure>

<h4 id="设置开机启动"><a href="#设置开机启动" class="headerlink" title="设置开机启动"></a>设置开机启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig  vsftpd on</span><br></pre></td></tr></table></figure>

<h3 id="图片上传"><a href="#图片上传" class="headerlink" title="图片上传"></a>图片上传</h3><h4 id="使用-XFTP-上传图片"><a href="#使用-XFTP-上传图片" class="headerlink" title="使用 XFTP 上传图片"></a>使用 XFTP 上传图片</h4><h4 id="使用-FTP-协议访问图片服务器"><a href="#使用-FTP-协议访问图片服务器" class="headerlink" title="使用 FTP 协议访问图片服务器"></a>使用 FTP 协议访问图片服务器</h4><h5 id="FTP-协议的-URL-格式"><a href="#FTP-协议的-URL-格式" class="headerlink" title="FTP 协议的 URL 格式"></a>FTP 协议的 URL 格式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ftp://username:userpassword@IP/path/图片名称</span><br><span class="line">#但是在 vsftpd 中，不能自动登录，需要手动登录</span><br></pre></td></tr></table></figure>

<h3 id="FTPClient-工具"><a href="#FTPClient-工具" class="headerlink" title="FTPClient 工具"></a>FTPClient 工具</h3><p>apache 提供的一个开源的基于 Java 语言的 ftp 客户端</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-net/commons-net --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-net<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-net<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ftpClientDemo</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"ftp 服务器..."</span>);</span><br><span class="line">	<span class="comment">//创建 FTPClient </span></span><br><span class="line">	FTPClient ftp = <span class="keyword">new</span> FTPClient();</span><br><span class="line">	<span class="comment">//连接 ftp 服务器的 IP和 port</span></span><br><span class="line">	ftp.connect(<span class="string">"192.168.170.4"</span>, <span class="number">21</span>);</span><br><span class="line">	<span class="comment">//指定登录 ftp 服务器的用户名和密码</span></span><br><span class="line">	ftp.login(<span class="string">"ftpuser"</span>, <span class="string">"123"</span>);</span><br><span class="line">	<span class="comment">//创建输入流</span></span><br><span class="line">	InputStream is = <span class="keyword">new</span> FileInputStream(<span class="string">"d://1.png"</span>);</span><br><span class="line">	<span class="comment">//指定上传目录以绝对路径的形式</span></span><br><span class="line">	ftp.changeWorkingDirectory(<span class="string">"/home/ftpuser/img"</span>);</span><br><span class="line">	<span class="comment">//指定上传以字符流上传，默认会采用字符流上传，图片会有损失</span></span><br><span class="line">	ftp.setFileType(FTPClient.BINARY_FILE_TYPE);</span><br><span class="line">	<span class="comment">//第一个参数表示上传后图片的名称，第二个参数表示要上传图片的资源</span></span><br><span class="line">	ftp.storeFile(<span class="string">"java.png"</span>, is);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//关闭资源</span></span><br><span class="line">	is.close();</span><br><span class="line">	<span class="comment">//关闭 ftp 连接</span></span><br><span class="line">	ftp.logout();</span><br><span class="line">	System.out.println(<span class="string">"ftp 服务器结束...."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="FTPClientUtil-java"><a href="#FTPClientUtil-java" class="headerlink" title="FTPClientUtil.java"></a>FTPClientUtil.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.ego.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTP;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTPClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTPFile;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.net.ftp.FTPReply;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ftp上传下载工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FtpUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * Description: 向FTP服务器上传文件 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> host FTP服务器hostname </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> port FTP服务器端口 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> username FTP登录账号 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> password FTP登录密码 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> basePath FTP服务器基础目录</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> filePath FTP服务器文件存放路径。例如分日期存放：/2015/01/01。文件的路径为basePath+filePath</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> filename 上传到FTP服务器上的文件名 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> input 输入流 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 成功返回true，否则返回false </span></span><br><span class="line"><span class="comment">	 */</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">uploadFile</span><span class="params">(String host, <span class="keyword">int</span> port, String username, String password, String basePath,</span></span></span><br><span class="line"><span class="function"><span class="params">			String filePath, String filename, InputStream input)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line">		FTPClient ftp = <span class="keyword">new</span> FTPClient();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> reply;</span><br><span class="line">			ftp.connect(host, port);<span class="comment">// 连接FTP服务器</span></span><br><span class="line">			<span class="comment">// 如果采用默认端口，可以使用ftp.connect(host)的方式直接连接FTP服务器</span></span><br><span class="line">			ftp.login(username, password);<span class="comment">// 登录</span></span><br><span class="line">			reply = ftp.getReplyCode();</span><br><span class="line">			<span class="keyword">if</span> (!FTPReply.isPositiveCompletion(reply)) &#123;</span><br><span class="line">				ftp.disconnect();</span><br><span class="line">				<span class="keyword">return</span> result;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//切换到上传目录</span></span><br><span class="line">			<span class="keyword">if</span> (!ftp.changeWorkingDirectory(basePath+filePath)) &#123;</span><br><span class="line">				<span class="comment">//如果目录不存在创建目录</span></span><br><span class="line">				String[] dirs = filePath.split(<span class="string">"/"</span>);</span><br><span class="line">				String tempPath = basePath;</span><br><span class="line">				<span class="keyword">for</span> (String dir : dirs) &#123;</span><br><span class="line">					<span class="keyword">if</span> (<span class="keyword">null</span> == dir || <span class="string">""</span>.equals(dir)) <span class="keyword">continue</span>;</span><br><span class="line">					tempPath += <span class="string">"/"</span> + dir;</span><br><span class="line">					<span class="keyword">if</span> (!ftp.changeWorkingDirectory(tempPath)) &#123;</span><br><span class="line">						<span class="keyword">if</span> (!ftp.makeDirectory(tempPath)) &#123;</span><br><span class="line">							<span class="keyword">return</span> result;</span><br><span class="line">						&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">							ftp.changeWorkingDirectory(tempPath);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//设置上传文件的类型为二进制类型</span></span><br><span class="line">			ftp.setFileType(FTP.BINARY_FILE_TYPE);</span><br><span class="line">			<span class="comment">//上传文件</span></span><br><span class="line">			<span class="keyword">if</span> (!ftp.storeFile(filename, input)) &#123;</span><br><span class="line">				<span class="keyword">return</span> result;</span><br><span class="line">			&#125;</span><br><span class="line">			input.close();</span><br><span class="line">			ftp.logout();</span><br><span class="line">			result = <span class="keyword">true</span>;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (ftp.isConnected()) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					ftp.disconnect();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (IOException ioe) &#123;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * Description: 从FTP服务器下载文件 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> host FTP服务器hostname </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> port FTP服务器端口 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> username FTP登录账号 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> password FTP登录密码 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> remotePath FTP服务器上的相对路径 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> fileName 要下载的文件名 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> localPath 下载后保存到本地的路径 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">	 */</span>  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">downloadFile</span><span class="params">(String host, <span class="keyword">int</span> port, String username, String password, String remotePath,</span></span></span><br><span class="line"><span class="function"><span class="params">			String fileName, String localPath)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line">		FTPClient ftp = <span class="keyword">new</span> FTPClient();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> reply;</span><br><span class="line">			ftp.connect(host, port);</span><br><span class="line">			<span class="comment">// 如果采用默认端口，可以使用ftp.connect(host)的方式直接连接FTP服务器</span></span><br><span class="line">			ftp.login(username, password);<span class="comment">// 登录</span></span><br><span class="line">			reply = ftp.getReplyCode();</span><br><span class="line">			<span class="keyword">if</span> (!FTPReply.isPositiveCompletion(reply)) &#123;</span><br><span class="line">				ftp.disconnect();</span><br><span class="line">				<span class="keyword">return</span> result;</span><br><span class="line">			&#125;</span><br><span class="line">			ftp.changeWorkingDirectory(remotePath);<span class="comment">// 转移到FTP服务器目录</span></span><br><span class="line">			FTPFile[] fs = ftp.listFiles();</span><br><span class="line">			<span class="keyword">for</span> (FTPFile ff : fs) &#123;</span><br><span class="line">				<span class="keyword">if</span> (ff.getName().equals(fileName)) &#123;</span><br><span class="line">					File localFile = <span class="keyword">new</span> File(localPath + <span class="string">"/"</span> + ff.getName());</span><br><span class="line"></span><br><span class="line">					OutputStream is = <span class="keyword">new</span> FileOutputStream(localFile);</span><br><span class="line">					ftp.retrieveFile(ff.getName(), is);</span><br><span class="line">					is.close();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			ftp.logout();</span><br><span class="line">			result = <span class="keyword">true</span>;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (ftp.isConnected()) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					ftp.disconnect();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (IOException ioe) &#123;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;  </span><br><span class="line">	        FileInputStream in=<span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">"D:\\1.jpg"</span>));  </span><br><span class="line">	        <span class="keyword">boolean</span> flag = uploadFile(<span class="string">"192.168.10.128"</span>, <span class="number">21</span>, <span class="string">"ftpuser"</span>, <span class="string">"ftpuser"</span>, <span class="string">"/home/ftpuser/www/images"</span>,<span class="string">"/2015/01/21"</span>, <span class="string">"gaigeming.jpg"</span>, in);  </span><br><span class="line">	        System.out.println(flag);  </span><br><span class="line">	    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;  </span><br><span class="line">	        e.printStackTrace();  </span><br><span class="line">	    &#125;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="KindEditor-简介"><a href="#KindEditor-简介" class="headerlink" title="KindEditor  简介"></a>KindEditor  简介</h3><p>KindEditor 是一套开源的 HTML 可视化编辑器</p>
<h4 id="KindEditor-初始化参数"><a href="#KindEditor-初始化参数" class="headerlink" title="KindEditor 初始化参数"></a>KindEditor 初始化参数</h4><ul>
<li><p>uploadJson </p>
<p>指定上传文件的程序</p>
</li>
<li><p>filePostName</p>
<p>指定上传文件的名称</p>
</li>
<li><p>dir </p>
<p>上传文件的类型</p>
</li>
</ul>
<h3 id="基于-KindEditor-实现文件上传"><a href="#基于-KindEditor-实现文件上传" class="headerlink" title="基于 KindEditor 实现文件上传"></a>基于 KindEditor 实现文件上传</h3><h4 id="文件上传页面"><a href="#文件上传页面" class="headerlink" title="文件上传页面"></a>文件上传页面</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> <span class="attr">src</span>=<span class="string">"/js/kindeditor/kindeditor-all.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> <span class="attr">src</span>=<span class="string">"/js/kindeditor/lang/zh-CN.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-2.2.4.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> obj;</span></span><br><span class="line"><span class="javascript">		KindEditor.ready(<span class="function"><span class="keyword">function</span>(<span class="params">K</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">	       obj= K.create(<span class="string">'#text_id'</span>, &#123;</span></span><br><span class="line"><span class="javascript">	                uploadJson : <span class="string">'/upload'</span>,</span></span><br><span class="line"><span class="javascript">	                filePostName:<span class="string">'fileName'</span>,</span></span><br><span class="line"><span class="javascript">	                dir:<span class="string">"image"</span></span></span><br><span class="line">	        &#125;);</span><br><span class="line">	   &#125;);</span><br><span class="line">		</span><br><span class="line"><span class="javascript">		<span class="comment">//给按钮添加点击事件</span></span></span><br><span class="line"><span class="javascript">		$(<span class="string">"#but"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//将KindEditor中的数据同步到textarea中</span></span></span><br><span class="line">			obj.sync();</span><br><span class="line">			</span><br><span class="line"><span class="javascript">			<span class="comment">//通过ajax方式提交表单      serialize()作用：将表单中的数据序列化为key=value&amp;key=value.....</span></span></span><br><span class="line"><span class="javascript">			$.post(<span class="string">"/content/save2"</span>,$(<span class="string">"#myForm"</span>).serialize(),<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="comment">/* eval("var data="+data1);  */</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">if</span>(data.status == <span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="javascript">					alert(<span class="string">"提交成功"</span>);</span></span><br><span class="line"><span class="javascript">				&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">					alert(<span class="string">"提交失败"</span>);</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">	&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>Welcome to SSM<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"myForm"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">rows</span>=<span class="string">"20"</span> <span class="attr">cols</span>=<span class="string">"20"</span> <span class="attr">id</span>=<span class="string">"text_id"</span> <span class="attr">name</span>=<span class="string">"desc"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"OK"</span> <span class="attr">id</span>=<span class="string">"but"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="文件上传-Controller"><a href="#文件上传-Controller" class="headerlink" title="文件上传 Controller"></a>文件上传 Controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.szxy.commons.JsonUtils;</span><br><span class="line"><span class="keyword">import</span> cn.szxy.service.PhotoUploadService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 图片 上传</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhotoUploadController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> PhotoUploadService photoUploadService; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/upload"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">uploadPhoto</span><span class="params">(MultipartFile fileName)</span></span>&#123;</span><br><span class="line">		Map&lt;String,Object&gt; map = photoUploadService.uploadPhoto(fileName);</span><br><span class="line">		<span class="keyword">return</span> JsonUtils.objectToJson(map); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="KindEditor-提交数据"><a href="#KindEditor-提交数据" class="headerlink" title="KindEditor 提交数据"></a>KindEditor 提交数据</h3><p><strong>step1：</strong>使用 ajax 方式提交数据</p>
<p><strong>step2：</strong>使用 KindEditor 的 sync 方法将数据同步到 textarea中</p>
<p><strong>step3：</strong>后台接受数据</p>
<p>注意： 在 Object 类型方法前加上 @ResponseBody 注解表示当前数据以 json格式返回</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.szxy.commons.JsonUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取 KindEdior 中的文本内容</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/content"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KindEditor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//方式一</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/save"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">save</span><span class="params">(String desc)</span></span>&#123;</span><br><span class="line">		System.out.println(desc);</span><br><span class="line">		Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		map.put(<span class="string">"status"</span>,<span class="number">200</span>);</span><br><span class="line">		<span class="keyword">return</span> map;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//方式二</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/save2"</span>,produces=<span class="string">"application/json;charset=utf-8"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">save2</span><span class="params">(String desc)</span></span>&#123;</span><br><span class="line">		System.out.println(desc);</span><br><span class="line">		Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		map.put(<span class="string">"status"</span>,<span class="number">200</span>);</span><br><span class="line">		<span class="keyword">return</span> JsonUtils.objectToJson(map);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/21/20190521 Dubbo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/21/20190521 Dubbo/" class="post-title-link" itemprop="url">20190521 Dubbo</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-21 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-21T00:00:00+08:00">2019-05-21</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-24 17:16:02" itemprop="dateModified" datetime="2019-05-24T17:16:02+08:00">2019-05-24</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Dubbo-介绍"><a href="#Dubbo-介绍" class="headerlink" title="Dubbo 介绍"></a>Dubbo 介绍</h3><p>RPC 框架，依赖于 Spring 框架。</p>
<p><img src="https://dubbo.apache.org/docs/zh-cn/user/sources/images/dubbo-architecture-roadmap.jpg" alt></p>
<h4 id="单体架构"><a href="#单体架构" class="headerlink" title="单体架构"></a>单体架构</h4><p>把系统的所有的功能、模块耦合在一个应用中的架构方式。 </p>
<h4 id="SOA-架构"><a href="#SOA-架构" class="headerlink" title="SOA  架构"></a>SOA  架构</h4><p>service Oriented  Architecture</p>
<p>面向服务的架构（SOA）是一个组件模型，它将应用系统拆分成不同的功能单元（称为服务），通过这些服务之间良好的接口和契约联系起来。</p>
<h5 id="RPC-远程过程调用"><a href="#RPC-远程过程调用" class="headerlink" title="RPC 远程过程调用"></a>RPC 远程过程调用</h5><p>Remote Procedure Call  Protocol</p>
<h4 id="Dubbo-框架图"><a href="#Dubbo-框架图" class="headerlink" title="Dubbo 框架图"></a>Dubbo 框架图</h4><p><img src="https://dubbo.apache.org/docs/zh-cn/user/sources/images/dubbo-architecture.jpg" alt>‘</p>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Container</td>
<td>服务运行容器</td>
</tr>
<tr>
<td>Provider</td>
<td>暴露服务的服务提供方</td>
</tr>
<tr>
<td>Consumer</td>
<td>调用远程服务的服务消费方</td>
</tr>
<tr>
<td>Registry</td>
<td>服务注册与发现的注册中心</td>
</tr>
<tr>
<td>Monitor</td>
<td>统计服务的调用次数和调用时间的监控中心</td>
</tr>
</tbody></table>
<h5 id="调用关系说明"><a href="#调用关系说明" class="headerlink" title="调用关系说明"></a>调用关系说明</h5><ol>
<li>服务容器负责启动，加载，运行服务提供者。</li>
<li>服务提供者在启动时，向注册中心注册自己提供的服务。</li>
<li>服务消费者在启动时，向注册中心订阅自己所需的服务。</li>
<li>注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。</li>
<li>服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</li>
<li>服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</li>
</ol>
<p>Dubbo 架构具有以下几个特点，分别是连通性、健壮性、伸缩性、以及向未来架构的升级性。</p>
<h5 id="Dubbo-执行流程"><a href="#Dubbo-执行流程" class="headerlink" title="Dubbo 执行流程"></a>Dubbo 执行流程</h5><p>首先从container 加载服务器提供者（provider），provider 然后将服务相关信息（接口、方法、IP）发布在注册中心（registry）中，服务消费者 Consumer 会从注册中心（Resitry）订阅（Subscribe）服务，然后服务消费者向服务提供者发出请求，服务提供者返回服务消费者所需的结果，这一过程是同步的。若服务提供者更新服务信息，则注册中心会通知（notify），服务消费者。每过二秒，服务提供者和服务消费者都需向监控器（Monitor）发送信息（调用的次数，超时的时间等等）</p>
<h3 id="Dubbo-支持的协议"><a href="#Dubbo-支持的协议" class="headerlink" title="Dubbo 支持的协议"></a>Dubbo 支持的协议</h3><h4 id="Dubbo-协议（官方协议）"><a href="#Dubbo-协议（官方协议）" class="headerlink" title="Dubbo 协议（官方协议）"></a>Dubbo 协议（官方协议）</h4><p>优点：采用INO复用单一长连接，并使用线程池并发处理请求，减少握手和加大并发效率</p>
<h4 id="RMI-（Remote-Method-Invocation）协议"><a href="#RMI-（Remote-Method-Invocation）协议" class="headerlink" title="RMI （Remote Method Invocation）协议"></a>RMI （Remote Method Invocation）协议</h4><h4 id="Hession-协议"><a href="#Hession-协议" class="headerlink" title="Hession 协议"></a>Hession 协议</h4><p>第三方协议，需要添加 hession.jar 架包</p>
<h3 id="Dubbo-支持的注册中心"><a href="#Dubbo-支持的注册中心" class="headerlink" title="Dubbo 支持的注册中心"></a>Dubbo 支持的注册中心</h3><h4 id="ZooKeeper-注册中心"><a href="#ZooKeeper-注册中心" class="headerlink" title="ZooKeeper 注册中心"></a>ZooKeeper 注册中心</h4><p>支持基于网络的集群方式</p>
<h4 id="Redis-注册中心"><a href="#Redis-注册中心" class="headerlink" title="Redis 注册中心"></a>Redis 注册中心</h4><p>支持基于客户端双写的集群方式，性能高</p>
<h3 id="安装-Zookeeper-注册中心"><a href="#安装-Zookeeper-注册中心" class="headerlink" title="安装 Zookeeper 注册中心"></a>安装 Zookeeper 注册中心</h3><p>参考上一个 Zookeeper</p>
<h3 id="Dubbo-入门项目"><a href="#Dubbo-入门项目" class="headerlink" title="Dubbo 入门项目"></a>Dubbo 入门项目</h3><h4 id="创建-Provider"><a href="#创建-Provider" class="headerlink" title="创建 Provider"></a>创建 Provider</h4><p>创建 Maven 的 jar 工程，并修改 pom.xml ，添加 Dubbo 依赖</p>
<p>服务：项目中对外界所提供的能力</p>
<h5 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:dubbo</span>=<span class="string">"http://code.alibabatech.com/schema/dubbo"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://code.alibabatech.com/schema/dubbo</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://code.alibabatech.com/schema/dubbo/dubbo.xsd"</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">&lt;!-- 注册 服务提供者的名字 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"mypro"</span>/&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- address：注册中心的IP 和端口，注意</span></span><br><span class="line"><span class="comment">			  如果 zookeeper 是一个集群，将 IP 地址和端口 都添加该属性中。</span></span><br><span class="line"><span class="comment">		     protocol：注册中心的类型</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dubbo:registry</span> 	<span class="attr">address</span>=<span class="string">"192.168.170.4:2181,192.168.170.4:2181,192.168.170.4:2181"</span> </span></span><br><span class="line"><span class="tag">       	<span class="attr">protocol</span>=<span class="string">"zookeeper"</span>/&gt;</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">       			注册服务提供的接口及 实现类</span></span><br><span class="line"><span class="comment">        --&gt;</span>	</span><br><span class="line">       <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"cn.szxy.service.ShowMessage"</span>  </span></span><br><span class="line"><span class="tag">                      <span class="attr">ref</span>=<span class="string">"showMessageImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"showMessageImpl"</span> <span class="attr">class</span>=<span class="string">"cn.szxy.service.impl.ShowMessageImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="添加-zkClient-依赖"><a href="#添加-zkClient-依赖" class="headerlink" title="添加 zkClient 依赖"></a>添加 zkClient 依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.ClassNotFoundException: org.I0Itec.zkclient.IZkStateListener</span><br><span class="line">	at java.net.URLClassLoader.findClass(Unknown Source)</span><br><span class="line">	at java.lang.ClassLoader.loadClass(Unknown Source)</span><br><span class="line">	at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source)</span><br><span class="line">	at java.lang.ClassLoader.loadClass(Unknown Source)</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- zkClient 客户端工具 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.101tec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="开启-spring-容器"><a href="#开启-spring-容器" class="headerlink" title="开启 spring 容器"></a>开启 spring 容器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.container.Main;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Start</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		//加载 spring 配置文件</span></span><br><span class="line"><span class="comment">		ClassPathXmlApplicationContext ac = </span></span><br><span class="line"><span class="comment">				new ClassPathXmlApplicationContext("applicationContext-Dubbo.xml");</span></span><br><span class="line"><span class="comment">		//开启 spring 容器</span></span><br><span class="line"><span class="comment">		ac.start();</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//1. 使用 Dubbo 开启 Spring 容器</span></span><br><span class="line">		<span class="comment">//2. 优雅关机</span></span><br><span class="line">        <span class="comment">//加载spring 配置文件的路径是 classpth:META/spring/*.xml</span></span><br><span class="line">		Main.main(args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="查看-zookeeper-客户端"><a href="#查看-zookeeper-客户端" class="headerlink" title="查看 zookeeper 客户端"></a>查看 zookeeper 客户端</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] ls /</span><br><span class="line">[dubbo, zookeeper, test]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] ls /dubbo </span><br><span class="line">[cn.szxy.service.ShowMessage]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] ls /dubbo/cn.szxy.service.ShowMessage</span><br><span class="line">[configurators, providers]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 3] ls /dubbo/cn.szxy.service.ShowMessage/providers</span><br><span class="line"><span class="meta">[dubbo%</span>3A%2F%2F192.168.56.1%3A20880%2Fcn.szxy.service.ShowMessage%3Fanyhost%3Dtrue%26application%3Dmypro%26dubbo%3D2.5.4%26generic%3Dfalse%26interface%3Dcn.szxy.service.ShowMessage%26methods%3DHello%26pid%3D4620%26side%3Dprovider%26timestamp%3D1558485355415]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span># url encode </span><br><span class="line"><span class="meta">[dubbo%</span>3A%2F%2F192.168.56.1%3A20880%2Fcn.szxy.service.ShowMessage%3Fanyhost%3Dtrue%26application%3Dmypro%26dubbo%3D2.5.4%26generic%3Dfalse%26interface%3Dcn.szxy.service.ShowMessage%26methods%3DHello%26pid%3D4620%26side%3Dprovider%26timestamp%3D1558485355415]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> url decode </span><br><span class="line">[dubbo://192.168.56.1:20880/cn.szxy.service.ShowMessage?anyhost=true&amp;application=mypro&amp;dubbo=2.5.4&amp;generic=false&amp;interface=cn.szxy.service.ShowMessage&amp;methods=Hello&amp;pid=4620&amp;side=provider&amp;timestamp=1558485355415]</span><br></pre></td></tr></table></figure>

<h4 id="搭建-Dubbo-Admin-平台"><a href="#搭建-Dubbo-Admin-平台" class="headerlink" title="搭建 Dubbo Admin 平台"></a>搭建 Dubbo Admin 平台</h4><p>Admin 管理平台是 war 项目</p>
<p>使用 unzip 解压 zip 类型的压缩包</p>
<p>将解压后的 ROOT 目录放到 tomcat/webapps 下</p>
<p>修改 ROOT/WEB-INF/dubbo.properties 配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dubbo.registry.address=zookeeper://192.168.170.4:2181</span><br><span class="line">dubbo.admin.root.password=root</span><br><span class="line">dubbo.admin.guest.password=guest</span><br></pre></td></tr></table></figure>

<p>启动 tomcat 服务器</p>
<h4 id="创建-Consumer"><a href="#创建-Consumer" class="headerlink" title="创建 Consumer"></a>创建 Consumer</h4><h5 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.szxy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>01-Dubbo-Customer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		 <span class="comment">&lt;!-- 添加 Provider 接口依赖 --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.szxy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> 			 <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>00-Dubbo-provider<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  				<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  		<span class="comment">&lt;!-- 添加 Dubbo 依赖 --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- zkClient 客户端工具 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.101tec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="applicationContext-xml"><a href="#applicationContext-xml" class="headerlink" title="applicationContext.xml"></a>applicationContext.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:dubbo</span>=<span class="string">"http://code.alibabatech.com/schema/dubbo"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://code.alibabatech.com/schema/dubbo</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://code.alibabatech.com/schema/dubbo/dubbo.xsd"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 扫描组件 --&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.szxy"</span> /&gt;</span>    </span><br><span class="line">    	</span><br><span class="line">    	<span class="comment">&lt;!-- 注册 Consumer 服务应用名 --&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">dubbo:application</span>  <span class="attr">name</span>=<span class="string">"myConsumer"</span> /&gt;</span></span><br><span class="line">	        </span><br><span class="line">	    <span class="comment">&lt;!-- 订阅注册中心 --&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">"zookeeper"</span></span></span><br><span class="line"><span class="tag">	    	<span class="attr">address</span>=<span class="string">"192.168.170.4:2181,192.168.170.4:2182,192.168.170.4:2183"</span>/&gt;</span></span><br><span class="line">	    	</span><br><span class="line">	   	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	   			为该接口生成 proxy 代理对象</span></span><br><span class="line"><span class="comment">	   	 --&gt;</span></span><br><span class="line">	   	 <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"showMessage"</span> <span class="attr">interface</span>=<span class="string">"cn.szxy.service.ShowMessage"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Dubbo-实战开发"><a href="#Dubbo-实战开发" class="headerlink" title="Dubbo 实战开发"></a>Dubbo 实战开发</h3><h4 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h4><p>完成对用户表的 CRUD 操作</p>
<h4 id="项目架构"><a href="#项目架构" class="headerlink" title="项目架构"></a>项目架构</h4><p>SOA 面向服务的架构</p>
<h4 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h4><p>Maven、SpringMVC、Spring、Mybatis、MySQL、Zookeeper、Dubbo</p>
<h4 id="项目结构图"><a href="#项目结构图" class="headerlink" title="项目结构图"></a>项目结构图</h4><table>
<thead>
<tr>
<th>项目名</th>
<th>子项目或聚合项目</th>
<th>子项目</th>
<th>项目类型</th>
</tr>
</thead>
<tbody><tr>
<td>Dubbo-parent</td>
<td></td>
<td></td>
<td>pom</td>
</tr>
<tr>
<td></td>
<td>Dubbo-pojo</td>
<td></td>
<td>jar</td>
</tr>
<tr>
<td></td>
<td>Dubbo-mapper</td>
<td></td>
<td>jar</td>
</tr>
<tr>
<td></td>
<td>Dubbo-provider</td>
<td></td>
<td>pom</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Dubbo-user-interface</td>
<td>jar</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Dubbo-user-service</td>
<td>jar</td>
</tr>
<tr>
<td></td>
<td>Dubbo-consumer</td>
<td></td>
<td>pom</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Dubbo-user-portal</td>
<td>war</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Dubboj-user-service-portal</td>
<td>jar</td>
</tr>
</tbody></table>
<h3 id="案例部署-Assembly"><a href="#案例部署-Assembly" class="headerlink" title="案例部署 Assembly"></a>案例部署 Assembly</h3><p>assembly 打包插件是用于将项目打包成 jar 类型</p>
<h4 id="Assembly-打包"><a href="#Assembly-打包" class="headerlink" title="Assembly 打包"></a>Assembly 打包</h4><p>在 06-Dubbo-user-service 项目的 src 目录下新建 assembly 目录</p>
<p>将 assembly 项目中 bin 目录 和 conf 目录 拷贝到 assembly 目录中</p>
<p><strong>清空</strong> conf 目录下的 dubbo.properties 文件内容</p>
<p>在 assembly 根目录下新建 assembly.xml 文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">assembly</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.3"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.3 http://maven.apache.org/xsd/assembly-1.1.3.xsd"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 该字符会添加到最终tar.gz包的名称后面，作为后缀 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span>&gt;</span>assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 指定打包的格式为tar.gz，该类型压缩包在linux中比较常见 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">formats</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">format</span>&gt;</span>tar.gz<span class="tag">&lt;/<span class="name">format</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">formats</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 在tar.gz压缩包中是否包含根文件夹，该根文件夹名称和tar.gz去掉id后缀一致 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">includeBaseDirectory</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeBaseDirectory</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">fileSets</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 将项目根路径下assembly/bin路径中的内容打包到压缩包中的根目录下的bin目录中 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">fileSet</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 相对项目根路径的相对路径 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">directory</span>&gt;</span>assembly/bin<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>bin<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 设置最终tar.gz中该文件夹下的权限，跟linux权限写法一致 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">fileMode</span>&gt;</span>0755<span class="tag">&lt;/<span class="name">fileMode</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">fileSet</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 将项目根路径下assembly/conf路径中的内容打包到压缩包中的根目录下的conf目录中 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">fileSet</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">directory</span>&gt;</span>assembly/conf<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>conf<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 设置其linux权限 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">fileMode</span>&gt;</span>0644<span class="tag">&lt;/<span class="name">fileMode</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">fileSet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">fileSets</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 将所有依赖的jar包打包到压缩包中的根目录下的lib目录中 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 此lib目录中包含自己开发的项目jar包以及demo_service.jar，还有第三方的jar包 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencySets</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependencySet</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependencySet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencySets</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">assembly</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 pom.xml 添加 assembly 插件 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定项目的打包插件信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 指定打包描述文件的位置：相对项目根目录的路径 --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- assembly打包的描述文件 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">descriptor</span>&gt;</span>assembly/assembly.xml<span class="tag">&lt;/<span class="name">descriptor</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h3><ol>
<li><p>Maven 的项目构建，若修改某个项目下的内容，并且其他项目对该项目存在依赖，此时再运行该整体项目会出现修改的项目内容没有及时的更新。</p>
</li>
<li><p>Spring 使用注解作为依赖注入，常常因为没有没有扫描该包下的文件或者扫描包的位置出现了错误，而发生无法创建 bean 实例的情况。</p>
</li>
<li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.1:compile (default-compile) on project 10-Dubbo-user-portal-service: Compilation failure: Compilation failure: </span><br><span class="line">[ERROR] /E:/workspaces/20190521Dubbo/08-Dubbo-user-consumer/10-Dubbo-user-portal-service/src/main/java/cn/szxy/service/impl/UserServiceImpl.java:[9,29] 找不到符号</span><br><span class="line">[ERROR]   符号:   类 FindAllUserDubboService</span><br><span class="line">[ERROR]   位置: 程序包 cn.szxy.dubbo.service</span><br><span class="line">[ERROR] /E:/workspaces/20190521Dubbo/08-Dubbo-user-consumer/10-Dubbo-user-portal-service/src/main/java/cn/szxy/service/impl/UserServiceImpl.java:[19,17] 找不到符号</span><br><span class="line">[ERROR]   符号:   类 FindAllUserDubboService</span><br><span class="line">[ERROR]   位置: 类 cn.szxy.service.impl.UserServiceImpl</span><br><span class="line">[ERROR] -&gt; [Help 1]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">玄学。。。。。</span><br><span class="line">怎么办呢？  Maven---update</span><br></pre></td></tr></table></figure>
</li>
<li><p>解决mvn clean后打包错：Cannot create resource output directory</p>
<p>由于之前使用 xftp 上传该项目下的 jar 包，但是没有关闭 xftp ，导致资源一直被占用。</p>
</li>
</ol>
<ol start="5">
<li><p>上传 Dubbo 项目，tomcat 启动终止</p>
<p>由于 zookeeper 注册中心没有开启，导致 dubbo 项目项目初始化无法完成。</p>
</li>
<li><p>为 dubbo 多个项目添加新的内容时，eclipse 会出现小红叉在类的方法或项目名上</p>
<p>解决方法，使用 maven -update 更新相关项目信息</p>
</li>
<li><p>使用 maven install 命令打包–报错信息如下</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.1:compile (default-compile) on project 07-Dubbo-user-service: Compilation failure</span><br><span class="line">[ERROR] /E:/workspaces/20190521Dubbo/05-Dubbo-provider/07-Dubbo-user-service/src/main/java/cn/szxy/dubbo/service/impl/FindOneUserDubboServiceImpl.java:[18,34] 找不到符号</span><br><span class="line">[ERROR]   符号:   方法 selectOne(int)</span><br><span class="line">[ERROR]   位置: 类型为cn.szxy.mapper.UserMapper的变量 userMapper</span><br></pre></td></tr></table></figure>

<p>原因项目依赖中  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FindOneUserDubboServiceImpl</span> <span class="keyword">implements</span> <span class="title">FindOneUserDubboService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Users <span class="title">findAllUserDubboService</span><span class="params">(<span class="keyword">int</span> userid)</span> </span>&#123;</span><br><span class="line">		 <span class="keyword">return</span> userMapper.selectOne(userid); <span class="comment">//报错</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li><p>Dubbo-service 启动卡住，由于 Centos 的端口没有开发</p>
<p>解决方法：关闭 Centos 防火墙</p>
</li>
</ol>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/20/20190520 ZooKeeper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/20/20190520 ZooKeeper/" class="post-title-link" itemprop="url">20190520 ZooKeeper</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-20 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-20T00:00:00+08:00">2019-05-20</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-22 08:46:41" itemprop="dateModified" datetime="2019-05-22T08:46:41+08:00">2019-05-22</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="ZooKeeper-简介"><a href="#ZooKeeper-简介" class="headerlink" title="ZooKeeper 简介"></a>ZooKeeper 简介</h3><p>zookeeper 就是动物管理员，它是管理hadoop（大象）、Hive（蜜蜂）、ping（猪）</p>
<p>主要功能： 配置管理、名字服务、分布式锁、集群管理。</p>
<h4 id="配置管理"><a href="#配置管理" class="headerlink" title="配置管理"></a>配置管理</h4><p>将之前分散的配置文件做集中式管理，Zookeeper 使用 Zab 这种一致性协议来提供一致性。</p>
<h4 id="名字服务"><a href="#名字服务" class="headerlink" title="名字服务"></a>名字服务</h4><p>为服务提供统一的入口，方便管理记忆，类似于用DNS服务器管理IP地址与域名之间的映射关系。</p>
<h4 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h4><p>协调多个分布式进程之间的活动。注意：这里的锁与进程中的锁有区别，更加严谨</p>
<h4 id="集群管理"><a href="#集群管理" class="headerlink" title="集群管理"></a>集群管理</h4><p>管理集群中节点的增加、删除、更新以及分配节点。</p>
<h3 id="Zookeeper-存储结构"><a href="#Zookeeper-存储结构" class="headerlink" title="Zookeeper 存储结构"></a>Zookeeper 存储结构</h3><h4 id="ZNode"><a href="#ZNode" class="headerlink" title="ZNode"></a>ZNode</h4><p>底层数据结构是树形结构</p>
<h4 id="Znode-的节点类型"><a href="#Znode-的节点类型" class="headerlink" title="Znode 的节点类型"></a>Znode 的节点类型</h4><p><img src="https://zookeeper.apache.org/doc/current/images/zknamespace.jpg" alt></p>
<h3 id="Zookeeper-安装"><a href="#Zookeeper-安装" class="headerlink" title="Zookeeper 安装"></a>Zookeeper 安装</h3><h4 id="单机版"><a href="#单机版" class="headerlink" title="单机版"></a>单机版</h4><h5 id="解压到-usr-目录下"><a href="#解压到-usr-目录下" class="headerlink" title="解压到  /usr 目录下"></a>解压到  /usr 目录下</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf zookeeper.tar.gz</span><br></pre></td></tr></table></figure>

<h5 id="修改-conf-zoo-samiple-cfg"><a href="#修改-conf-zoo-samiple-cfg" class="headerlink" title="修改 conf/zoo_samiple.cfg"></a>修改 conf/zoo_samiple.cfg</h5><p>复制 zoo_sample.cfg 并重命名为zoo.cfg</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>dataDir=/tmp/zookeeper</span><br><span class="line">dataDir=/usr/zookeeper/data</span><br></pre></td></tr></table></figure>

<h5 id="启动-Zookeeper"><a href="#启动-Zookeeper" class="headerlink" title="启动  Zookeeper"></a>启动  Zookeeper</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>默认加载 conf 目录下的 zoo.cfg 配置文件</span><br><span class="line">./zkServer.sh start</span><br><span class="line"><span class="meta">#</span>指定加载 conf 目录下的 **.cfg 配置文件</span><br><span class="line">./zkServer.sh start **.cfg</span><br></pre></td></tr></table></figure>

<h4 id="集群版"><a href="#集群版" class="headerlink" title="集群版"></a>集群版</h4><h5 id="集群角色"><a href="#集群角色" class="headerlink" title="集群角色"></a>集群角色</h5><p>leader  </p>
<p>fellower</p>
<p><img src="https://zookeeper.apache.org/doc/current/images/zkservice.jpg" alt></p>
<h5 id="集群安装"><a href="#集群安装" class="headerlink" title="集群安装"></a>集群安装</h5><p>创建标识符文件 myid</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>将标识符写入 myid 文件中，若 myid 文件不存在则创建该文件</span><br><span class="line">[root@localhost zookeeperCluster]# echo 1 &gt;&gt; zookeeper01/data/myid</span><br></pre></td></tr></table></figure>

<p>配置 zoo.cfg </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>2881、2882、2883 是投票端口</span><br><span class="line"><span class="meta">#</span>3881、3882、3883 是选举端口</span><br><span class="line">server.1=192.168.170.4:2881:3881</span><br><span class="line">server.2=192.168.170.4:2882:3882</span><br><span class="line">server.3=192.168.170.4:2883:3883</span><br></pre></td></tr></table></figure>

<p>开启集群脚本 startall.sh</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./zookeeper01/bin/zkServer.sh start</span><br><span class="line">./zookeeper02/bin/zkServer.sh start</span><br><span class="line">./zookeeper03/bin/zkServer.sh start</span><br></pre></td></tr></table></figure>

<p>开启集群</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost zookeeperCluster]# ./startall.sh </span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: /usr/zookeeperCluster/zookeeper01/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: /usr/zookeeperCluster/zookeeper02/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: /usr/zookeeperCluster/zookeeper03/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br></pre></td></tr></table></figure>

<p>开启集群成功的状态信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost zookeeperCluster]# ./statusAll.sh </span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: /usr/zookeeperCluster/zookeeper01/bin/../conf/zoo.cfg</span><br><span class="line">Mode: follower</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: /usr/zookeeperCluster/zookeeper02/bin/../conf/zoo.cfg</span><br><span class="line">Mode: leader</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: /usr/zookeeperCluster/zookeeper03/bin/../conf/zoo.cfg</span><br><span class="line">Mode: follower</span><br></pre></td></tr></table></figure>

<h3 id="ZooKeeper-常用命令"><a href="#ZooKeeper-常用命令" class="headerlink" title="ZooKeeper 常用命令"></a>ZooKeeper 常用命令</h3><h4 id="客户端常用命令工具使用"><a href="#客户端常用命令工具使用" class="headerlink" title="客户端常用命令工具使用"></a>客户端常用命令工具使用</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./zkCli.sh            #启动 zookeeper  客户端概念股将</span><br><span class="line">create /path          #持久节点</span><br><span class="line">create -e /path data  #临时节点 </span><br><span class="line">create -s /path  data #顺序持久及数据</span><br></pre></td></tr></table></figure>

<h5 id="simple-API"><a href="#simple-API" class="headerlink" title="simple API"></a>simple API</h5><ul>
<li><em>create</em> : creates a node at a location in the tree</li>
<li><em>delete</em> : deletes a node</li>
<li><em>exists</em> : tests if a node exists at a location</li>
<li><em>get data</em> : reads the data from a node</li>
<li><em>set data</em> : writes data to a node</li>
<li><em>get children</em> : retrieves a list of children of a node</li>
<li><em>sync</em> : waits for data to be propagated</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls /      </span><br><span class="line">get path  #查看节点信息</span><br><span class="line">set  path data[version] </span><br><span class="line">delete  path   #删除节点</span><br><span class="line">rmr path  #删除节点即子节点</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/16/20190516 Linux OS使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/16/20190516 Linux OS使用/" class="post-title-link" itemprop="url">20190516 Linux 使用</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-16 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-16T00:00:00+08:00">2019-05-16</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-19 10:40:27" itemprop="dateModified" datetime="2019-05-19T10:40:27+08:00">2019-05-19</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Linux-介绍"><a href="#1-Linux-介绍" class="headerlink" title="1 Linux 介绍"></a>1 Linux 介绍</h1><p>Linux 基于 Unix，万物皆文件。</p>
<p>内核特点：支持 <strong>多CPU</strong> </p>
<p>应用领域广: 智能设备、后台服务器、云计算、大数据</p>
<h1 id="2-Linux-安装"><a href="#2-Linux-安装" class="headerlink" title="2  Linux 安装"></a>2  Linux 安装</h1><h3 id="2-1-安装虚拟机-VMware"><a href="#2-1-安装虚拟机-VMware" class="headerlink" title="2.1 安装虚拟机 VMware"></a>2.1 安装虚拟机 VMware</h3><p>在 window 环境运行 linux 系统环境的软件</p>
<h3 id="2-2-安装-CentOS"><a href="#2-2-安装-CentOS" class="headerlink" title="2.2 安装 CentOS"></a>2.2 安装 CentOS</h3><p>Centos 6.5 </p>
<h3 id="2-3-安装-Xshell-软件"><a href="#2-3-安装-Xshell-软件" class="headerlink" title="2.3 安装 Xshell 软件"></a>2.3 安装 Xshell 软件</h3><h1 id="3-Linux-常用的命令介绍"><a href="#3-Linux-常用的命令介绍" class="headerlink" title="3  Linux 常用的命令介绍"></a>3  Linux 常用的命令介绍</h1><h2 id="1-pwd"><a href="#1-pwd" class="headerlink" title="1 pwd"></a>1 pwd</h2><p>print working directory - 输出当前工作目录</p>
<h3 id="2"><a href="#2" class="headerlink" title="2   /"></a>2   /</h3><p>根目录 .unix 和 Linux 中，没有盘符 一个硬盘，一个根。</p>
<h3 id="3-bin"><a href="#3-bin" class="headerlink" title="3  /bin"></a>3  /bin</h3><p>系统的常用命令目录。</p>
<h3 id="4-etc"><a href="#4-etc" class="headerlink" title="4  /etc"></a>4  /etc</h3><p>发布目录，相当于 windows 系统中 windows 目录，保存系统的所有核心内容。</p>
<p>要求控制权权限高，建议不要随便读写。</p>
<h3 id="5-usr"><a href="#5-usr" class="headerlink" title="5  /usr"></a>5  /usr</h3><p>用户目录，常用与安装系统所有用户共用的软件资源</p>
<h3 id="6-root"><a href="#6-root" class="headerlink" title="6 /root"></a>6 /root</h3><p>root 根用户的用户目录，称为用户主目录</p>
<h3 id="7-home"><a href="#7-home" class="headerlink" title="7  /home"></a>7  /home</h3><p>保存其他用户主目录的目录</p>
<h3 id="8-var"><a href="#8-var" class="headerlink" title="8  /var"></a>8  /var</h3><p>系统运行过程的数据目录</p>
<h2 id="2-cd"><a href="#2-cd" class="headerlink" title="2 cd"></a>2 cd</h2><p>切换目录</p>
<p>. 表示当前目录</p>
<p>.. 表示返回上级目录</p>
<h3 id="2-1-切换固定位置"><a href="#2-1-切换固定位置" class="headerlink" title="2.1  切换固定位置"></a>2.1  切换固定位置</h3><p>cd /aa/bb/xx</p>
<h3 id="2-2-切换相对位置"><a href="#2-2-切换相对位置" class="headerlink" title="2.2  切换相对位置"></a>2.2  切换相对位置</h3><p>cd aa/bb/xx</p>
<h3 id="2-3-进入主目录"><a href="#2-3-进入主目录" class="headerlink" title="2.3 进入主目录"></a>2.3 进入主目录</h3><p>cd ~ 进入用户目录</p>
<p>cd  默认不给定参数，也直接进入用户根目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 Desktop]# cd </span><br><span class="line">[root@node6 ~]# ls</span><br><span class="line">anaconda-ks.cfg  Documents  install.log.syslog  Pictures  Templates</span><br><span class="line">Desktop          Downloads  Music               Public    Videos</span><br></pre></td></tr></table></figure>

<h2 id="3-ls"><a href="#3-ls" class="headerlink" title="3 ls"></a>3 ls</h2><p>list  - 列表当前目录</p>
<h3 id="3-1-查看目录内容"><a href="#3-1-查看目录内容" class="headerlink" title="3.1  查看目录内容"></a>3.1  查看目录内容</h3><p>list （相对路径/绝对路径）</p>
<h3 id="3-2-查看全部内容"><a href="#3-2-查看全部内容" class="headerlink" title="3.2  查看全部内容"></a>3.2  查看全部内容</h3><p><code>list -a</code> 【目录】</p>
<p>list all - 查看所有，包括隐藏文件 .lunux 中的隐藏文件都是以‘.’ 开头的文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 /]# ls -a</span><br><span class="line">.   .autofsck  boot  etc   html  lib64       media  mout    opt   root  selinux  sys  usr</span><br><span class="line">..  bin        dev   home  lib   lost+found  mnt    myJava  proc  sbin  srv      tmp  var</span><br></pre></td></tr></table></figure>

<h3 id="3-3-列表查看目录内容"><a href="#3-3-列表查看目录内容" class="headerlink" title="3.3 列表查看目录内容"></a>3.3 列表查看目录内容</h3><p><code>ls -l</code>[目录]</p>
<p>简化命令 <code>ll</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 /]# ls -l</span><br><span class="line">total 110</span><br><span class="line">dr-xr-xr-x.   2 root root  4096 Feb  1  2018 bin</span><br><span class="line">dr-xr-xr-x.   5 root root  1024 Jan 21  2018 boot</span><br><span class="line">drwxr-xr-x.  18 root root  3780 Mar 21 08:20 dev</span><br><span class="line">drwxr-xr-x. 103 root root 12288 May 16 17:07 etc</span><br><span class="line">drwxr-xr-x.   6 root root  4096 Jan 23  2018 home</span><br><span class="line">-rw-r--r--.   1 root root     9 Mar 19 22:00 html</span><br><span class="line">dr-xr-xr-x.  10 root root  4096 Jan 21  2018 lib</span><br><span class="line">dr-xr-xr-x.   9 root root 12288 Feb  1  2018 lib64</span><br><span class="line">drwx------.   2 root root 16384 Jan 21  2018 lost+found</span><br><span class="line">drwxr-xr-x.   3 root root  4096 Mar 21 21:42 media</span><br><span class="line">drwxr-xr-x.   2 root root  4096 Jan 21  2018 mnt</span><br><span class="line">-rw-r--r--.   1 root root  1110 Mar 24  2018 mout</span><br><span class="line">drwxr-xr-x.   2 root root  4096 Mar 19 22:46 myJava</span><br><span class="line">drwxr-xr-x.   3 root root  4096 Jan 21  2018 opt</span><br><span class="line">dr-xr-xr-x. 151 root root     0 Mar 21 08:20 proc</span><br><span class="line">dr-xr-x---.  27 root root  4096 Mar 21 22:48 root</span><br><span class="line">dr-xr-xr-x.   2 root root 12288 Feb  1  2018 sbin</span><br><span class="line">drwxr-xr-x.   7 root root     0 Mar 21 08:20 selinux</span><br><span class="line">drwxr-xr-x.   2 root root  4096 Sep 23  2011 srv</span><br><span class="line">drwxr-xr-x.  13 root root     0 Mar 21 08:20 sys</span><br><span class="line">drwxrwxrwt.  30 root root  4096 May 16 17:30 tmp</span><br><span class="line">drwxr-xr-x.  18 root root  4096 Mar 21 22:51 usr</span><br><span class="line">drwxr-xr-x.  21 root root  4096 Jan 21  2018 var</span><br></pre></td></tr></table></figure>

<p>其中以 d 开头是目录，<code>-</code> 以开头表示文件。</p>
<p>r 表示读权限，w表示写权限，x 表示执行权限</p>
<p><img src="http://www.zwer.xyz/picGo/20190517084040.png" alt></p>
<h3 id="3-4-容量"><a href="#3-4-容量" class="headerlink" title="3.4 容量"></a>3.4 容量</h3><p>单位是字节，所有的目录固定容量为 4096</p>
<h3 id="3-5-权限"><a href="#3-5-权限" class="headerlink" title="3.5 权限"></a>3.5 权限</h3><p>分为不同的角色:文件的所有者，就是创建文件的用户，所在组和所有者同一个组的其他用户<code>.</code>其他用户，和所有者不在一个组的用户。</p>
<p>rwx  -read write  execut</p>
<p>‘-’  代表没有对应的权限</p>
<h2 id="4-clear"><a href="#4-clear" class="headerlink" title="4 clear"></a>4 clear</h2><p>clear 清屏 和 clear screen</p>
<h2 id="5-touch"><a href="#5-touch" class="headerlink" title="5  touch"></a>5  touch</h2><p>创建空白文件</p>
<p>在linux 系统中，文件不需要强制后后缀名</p>
<h3 id="5-1-使用方式"><a href="#5-1-使用方式" class="headerlink" title="5.1  使用方式"></a>5.1  使用方式</h3><p>touch 文件名 ，在当前目录创建文件</p>
<p>touch 目录/文件名， </p>
<h2 id="6-cat"><a href="#6-cat" class="headerlink" title="6  cat"></a>6  cat</h2><p>显示文件全部内容</p>
<h2 id="7-more"><a href="#7-more" class="headerlink" title="7 more"></a>7 more</h2><p>分屏显示文件内容， 显示后，使用空格显示下一页，使用回车显示下一行，ctr+c 退出。</p>
<h2 id="8-head"><a href="#8-head" class="headerlink" title="8 head"></a>8 head</h2><p>显示文件的前多少行，默认显示文件前十行内容。</p>
<p><code>head -number filelname</code></p>
<p>显示文件的前 number 行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 ~]# head anaconda-ks.cfg </span><br><span class="line"><span class="meta">#</span> Kickstart file automatically generated by anaconda.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>version=DEVEL</span><br><span class="line">install</span><br><span class="line">cdrom</span><br><span class="line">lang en_US.UTF-8</span><br><span class="line">keyboard us</span><br><span class="line">network --onboot yes --device eth0 --bootproto dhcp</span><br><span class="line">rootpw  --iscrypted $1$9/wjzRav$R3Rd/nR8RSWqqjRSLxpdL0</span><br><span class="line"><span class="meta">#</span> Reboot after installation</span><br></pre></td></tr></table></figure>

<h2 id="9-tail"><a href="#9-tail" class="headerlink" title="9 tail"></a>9 tail</h2><p>显示文件的末尾多少行，默认显示文件后十行内容</p>
<p><code>tail number filename</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 ~]# tail anaconda-ks.cfg </span><br><span class="line"> if [ -x /usr/sbin/getenforce ]; then /usr/sbin/setenforce \$oldenforce || true; fi</span><br><span class="line">if [ -x /bin/systemd ]; then systemctl restart prefdm.service; else telinit 5; fi</span><br><span class="line">EOF</span><br><span class="line">chmod 755 /etc/rc.d/rc.local</span><br><span class="line">if [ -x /bin/systemd ]; then systemctl enable rc-local.service; fi</span><br><span class="line">/usr/sbin/adduser zwz</span><br><span class="line">/usr/sbin/usermod -p '$1$9/wjzRav$R3Rd/nR8RSWqqjRSLxpdL0' zwz</span><br><span class="line">/usr/bin/chfn -f "zwz" zwz</span><br><span class="line">/bin/echo done</span><br><span class="line"><span class="meta">%</span>end</span><br></pre></td></tr></table></figure>

<h2 id="10-mkdir"><a href="#10-mkdir" class="headerlink" title="10  mkdir"></a>10  mkdir</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make directory -创建目录</span><br></pre></td></tr></table></figure>

<h3 id="10-1-创建一个相对目录"><a href="#10-1-创建一个相对目录" class="headerlink" title="10.1 创建一个相对目录"></a>10.1 创建一个相对目录</h3><p>即在当前目录下创建一个文件夹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir directory</span><br></pre></td></tr></table></figure>

<h3 id="10-2-创建一个绝对目录创建文件"><a href="#10-2-创建一个绝对目录创建文件" class="headerlink" title="10.2  创建一个绝对目录创建文件"></a>10.2  创建一个绝对目录创建文件</h3><p>即在 根目录 <code>/</code>开始创建目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /aa/bb/directory</span><br></pre></td></tr></table></figure>

<h3 id="10-3-一次性创建多级目录"><a href="#10-3-一次性创建多级目录" class="headerlink" title="10.3  一次性创建多级目录"></a>10.3  一次性创建多级目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir  -p  /parentDirectory/childrenDirectory</span><br></pre></td></tr></table></figure>

<h2 id="11-cp"><a href="#11-cp" class="headerlink" title="11 cp"></a>11 cp</h2><p> copy -复制命令</p>
<h3 id="11-1-使用方式"><a href="#11-1-使用方式" class="headerlink" title="11.1 使用方式"></a>11.1 使用方式</h3><p><code>copy source  target</code></p>
<p>source 表示要拷贝的文件或者目录 ，注意拷贝目录要加参数 -r </p>
<p>traget 表示目录信息，若后面指定文件名</p>
<h3 id="11-2-拷贝文件"><a href="#11-2-拷贝文件" class="headerlink" title="11.2 拷贝文件"></a>11.2 拷贝文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 aa]# touch hello.txt</span><br><span class="line">[root@node6 aa]# ls</span><br><span class="line">bb  hello.txt</span><br><span class="line">[root@node6 aa]# cp hello.txt hello1.txt</span><br><span class="line">[root@node6 aa]# ls</span><br><span class="line">bb  hello1.txt  hello.txt</span><br><span class="line">[root@node6 aa]# cp hello.txt bb/hello2.txt</span><br><span class="line">[root@node6 aa]# cd bb</span><br><span class="line">[root@node6 bb]# ls</span><br><span class="line">hello2.txt</span><br></pre></td></tr></table></figure>

<h3 id="11-3-拷贝目录"><a href="#11-3-拷贝目录" class="headerlink" title="11.3  拷贝目录"></a>11.3  拷贝目录</h3><p><code>cp -r sourceDirectory  targetDirectory</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 Desktop]# cp aa aa1</span><br><span class="line">cp: omitting directory `aa'</span><br><span class="line">[root@node6 Desktop]# cp -r  aa aa1</span><br><span class="line">[root@node6 Desktop]# ls</span><br></pre></td></tr></table></figure>

<h2 id="12-rm"><a href="#12-rm" class="headerlink" title="12 rm"></a>12 rm</h2><p>remove -删除</p>
<h3 id="12-1-使用方式"><a href="#12-1-使用方式" class="headerlink" title="12.1 使用方式"></a>12.1 使用方式</h3><p><code>remove source</code> 删除，有提示</p>
<h3 id="12-2-删除文件"><a href="#12-2-删除文件" class="headerlink" title="12.2  删除文件"></a>12.2  删除文件</h3><p><code>remove -f  source</code>  删除文件，没有提示</p>
<h3 id="12-3-删除目录"><a href="#12-3-删除目录" class="headerlink" title="12.3 删除目录"></a>12.3 删除目录</h3><p><code>rm  -r  directoryName</code>参数 -r 必须添加，表示递归删除子目录及文件，否则不能删除目录</p>
<p><code>rm -rf  directoryName</code>删除目录，不提示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 aa]# ls</span><br><span class="line">bb  cc  hello1.txt</span><br><span class="line">[root@node6 aa]# rm cc</span><br><span class="line">rm: cannot remove `cc': Is a directory</span><br><span class="line">[root@node6 aa]# rm -r cc</span><br><span class="line">rm: descend into directory `cc'? n</span><br><span class="line">[root@node6 aa]# rm -rf cc</span><br><span class="line">[root@node6 aa]# ls</span><br><span class="line">bb  hello1.txt</span><br></pre></td></tr></table></figure>

<h2 id="13-mv"><a href="#13-mv" class="headerlink" title="13 mv"></a>13 mv</h2><p>move - 移动或重命名</p>
<h3 id="13-1-使用方式"><a href="#13-1-使用方式" class="headerlink" title="13.1 使用方式"></a>13.1 使用方式</h3><p><code>move source  target</code> 移动</p>
<p><code>mv  source newFileName</code> 重命名</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 Desktop]# cd aa</span><br><span class="line">[root@node6 aa]# ls</span><br><span class="line">bb  hello1.txt  hello.txt</span><br><span class="line">[root@node6 aa]# mv hello.txt helloWord.txt</span><br><span class="line">[root@node6 aa]# ls</span><br><span class="line">bb  hello1.txt  helloWord.txt</span><br><span class="line">[root@node6 aa]# mv helloWord.txt bb/</span><br><span class="line">[root@node6 aa]# cd bb</span><br><span class="line">[root@node6 bb]# ls</span><br><span class="line">hello2.txt  helloWord.txt</span><br></pre></td></tr></table></figure>

<h2 id="14-vi-vim"><a href="#14-vi-vim" class="headerlink" title="14  vi|vim"></a>14  vi|vim</h2><p>编辑文件，vim是增强命令，不是所有linux 版本都支持。vim 增强在有高亮显示。</p>
<h3 id="14-1使用方式"><a href="#14-1使用方式" class="headerlink" title="14.1使用方式"></a>14.1使用方式</h3><p><code>vi fileName</code></p>
<h3 id="14-2-命令模式"><a href="#14-2-命令模式" class="headerlink" title="14.2 命令模式"></a>14.2 命令模式</h3><p>是控制编辑的文件的状态的，如：保存，退出</p>
<h4 id="14-2-1-进入编辑模式："><a href="#14-2-1-进入编辑模式：" class="headerlink" title="14.2.1 进入编辑模式："></a>14.2.1 进入编辑模式：</h4><p>a -append，追加的方式进入编辑模式,位置在当前光标位置之后</p>
<p>i -insert，插入的方式进入编辑模式，位置在当前光标位置之前</p>
<p>o -underline ，在光标所在位置，新增一行，进入编辑模式</p>
<p>O -preline ，在光标所在位置的行前，新增一行，进入编辑模式</p>
<h4 id="14-2-2-dd"><a href="#14-2-2-dd" class="headerlink" title="14.2.2 dd"></a>14.2.2 dd</h4><p>[number] dd -dlete line 删除指定行，默认一行</p>
<h4 id="14-2-3-w"><a href="#14-2-3-w" class="headerlink" title="14.2.3  :w"></a>14.2.3  :w</h4><p>write - 保存</p>
<h4 id="14-2-4-q"><a href="#14-2-4-q" class="headerlink" title="14.2.4  :q"></a>14.2.4  :q</h4><p>quit  退出</p>
<h4 id="14-2-5-q"><a href="#14-2-5-q" class="headerlink" title="14.2.5  :q!"></a>14.2.5  :q!</h4><p>强制退出不提示</p>
<h4 id="14-2-6-set-nu"><a href="#14-2-6-set-nu" class="headerlink" title="14.2.6  :set nu"></a>14.2.6  :set nu</h4><p>显示行号</p>
<h3 id="14-2-7-keyword"><a href="#14-2-7-keyword" class="headerlink" title="14.2.7 /keyword"></a>14.2.7 /keyword</h3><p>查找关键字</p>
<h4 id="14-2-8-G"><a href="#14-2-8-G" class="headerlink" title="14.2.8 G"></a>14.2.8 G</h4><p>跳转到文件末尾</p>
<h3 id="14-2-9-gg"><a href="#14-2-9-gg" class="headerlink" title="14.2.9 gg"></a>14.2.9 gg</h3><p>光标跳转到文件头</p>
<h2 id="15-ifconfig"><a href="#15-ifconfig" class="headerlink" title="15  ifconfig"></a>15  ifconfig</h2><blockquote>
<p>查看网络编辑器，查看网卡信息</p>
</blockquote>
<p>eth0 表示网卡信息</p>
<p>lo -localhsot，本地环绕信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 aa]# ifconfig</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0C:29:04:94:F8  </span><br><span class="line">          inet addr:192.168.170.8  Bcast:192.168.170.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe04:94f8/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:63384 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:25407 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:74886225 (71.4 MiB)  TX bytes:2189499 (2.0 MiB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1/128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:309 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:309 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:171242 (167.2 KiB)  TX bytes:171242 (167.2 KiB)</span><br></pre></td></tr></table></figure>

<h3 id="15-1-ifconfig-a"><a href="#15-1-ifconfig-a" class="headerlink" title="15.1 ifconfig -a"></a>15.1 ifconfig -a</h3><blockquote>
<p>查看全部网卡信息</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 network-scripts]# ifconfig -a</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0C:29:04:94:F8  </span><br><span class="line">          inet addr:192.168.170.8  Bcast:192.168.170.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe04:94f8/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:63852 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:25669 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:74929053 (71.4 MiB)  TX bytes:2230063 (2.1 MiB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1/128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:309 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:309 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:171242 (167.2 KiB)  TX bytes:171242 (167.2 KiB)</span><br></pre></td></tr></table></figure>

<h3 id="15-2-查看当前网卡的信息"><a href="#15-2-查看当前网卡的信息" class="headerlink" title="15.2 查看当前网卡的信息"></a>15.2 查看当前网卡的信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 ~]# cd /etc/sysconfig/network-scripts/</span><br><span class="line">[root@node6 network-scripts]# ls</span><br><span class="line">ifcfg-eth0   ifdown-ipv6    ifdown-tunnel  ifup-ipv6   ifup-routes       network-functions</span><br><span class="line">ifcfg-lo     ifdown-isdn    ifup           ifup-isdn   ifup-sit          network-functions-ipv6</span><br><span class="line">ifdown       ifdown-post    ifup-aliases   ifup-plip   ifup-tunnel</span><br><span class="line">ifdown-bnep  ifdown-ppp     ifup-bnep      ifup-plusb  ifup-wireless</span><br><span class="line">ifdown-eth   ifdown-routes  ifup-eth       ifup-post   init.ipv6-global</span><br><span class="line">ifdown-ippp  ifdown-sit     ifup-ippp      ifup-ppp    net.hotplug</span><br></pre></td></tr></table></figure>

<h3 id="15-3-编辑网卡"><a href="#15-3-编辑网卡" class="headerlink" title="15.3 编辑网卡"></a>15.3 编辑网卡</h3><p>将 动态 IP 修改为 静态 IP </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DEVICE=eth0 </span><br><span class="line">BOOTPROTO=static </span><br><span class="line">ONBOOT=yes </span><br><span class="line">IPADDR=(设置IP地址) </span><br><span class="line">NETMASK=255.255.255.0 </span><br><span class="line">GATEWAY=（设置网关） </span><br><span class="line">DNS1=114.114.114.114 </span><br><span class="line">DNS2=4.4.4.4</span><br><span class="line">IPV6INIT=no</span><br></pre></td></tr></table></figure>

<h2 id="16-service"><a href="#16-service" class="headerlink" title="16 service"></a>16 service</h2><p>服务控制命令，常用服务：iptable -防火墙，vsfpd fpt  服务起，mysql</p>
<p>防火墙建议关闭，否则除 80,22端口 外，其他所有端口无法访问</p>
<h4 id="16-1-使用方式"><a href="#16-1-使用方式" class="headerlink" title="16.1 使用方式"></a>16.1 使用方式</h4><p>service 服务名称   start/stop/status/restart</p>
<p>eg.  service iptables start 启动防火墙</p>
<h2 id="17-ps"><a href="#17-ps" class="headerlink" title="17 ps"></a>17 ps</h2><p>查看当前的进程信息 ，相当于 window 下的任务管理器查看进程信息。</p>
<h3 id="17-1-使用方式"><a href="#17-1-使用方式" class="headerlink" title="17.1 使用方式"></a>17.1 使用方式</h3><p>ps  aux [| grep keyword]</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 ~]# ps aux</span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.0  0.2  19364  1100 ?        Ss   15:49   0:02 /sbin/init</span><br><span class="line">root          2  0.0  0.0      0     0 ?        S    15:49   0:00 [kthreadd]</span><br><span class="line">root          3  0.0  0.0      0     0 ?        S    15:49   0:00 [migration/0]</span><br><span class="line">root          4  0.0  0.0      0     0 ?        S    15:49   0:00 [ksoftirqd/0]</span><br><span class="line">root          5  0.0  0.0      0     0 ?        S    15:49   0:00 [stopper/0]</span><br><span class="line">root          6  0.0  0.0      0     0 ?        S    15:49   0:00 [watchdog/0]</span><br><span class="line">root          7  0.0  0.0      0     0 ?        S    15:49   0:07 [events/0]</span><br><span class="line">root          8  0.0  0.0      0     0 ?        S    15:49   0:00 [cgroup]</span><br><span class="line">root          9  0.0  0.0      0     0 ?        S    15:49   0:00 [khelper]</span><br><span class="line">root         10  0.0  0.0      0     0 ?        S    15:49   0:00 [netns]</span><br><span class="line">root         11  0.0  0.0      0     0 ?        S    15:49   0:00 [async/mgr]</span><br><span class="line">root         12  0.0  0.0      0     0 ?        S    15:49   0:00 [pm]</span><br><span class="line">root         13  0.0  0.0      0     0 ?        S    15:49   0:00 [sync_supers]</span><br><span class="line">root         14  0.0  0.0      0     0 ?        S    15:49   0:00 [bdi-default]</span><br><span class="line">root         15  0.0  0.0      0     0 ?        S    15:49   0:00 [kintegrityd/0]</span><br><span class="line">root         16  0.0  0.0      0     0 ?        S    15:49   0:02 [kblockd/0]</span><br><span class="line">root         17  0.0  0.0      0     0 ?        S    15:49   0:00 [kacpid]</span><br><span class="line">root         18  0.0  0.0      0     0 ?        S    15:49   0:00 [kacpi_notify]</span><br><span class="line">root         19  0.0  0.0      0     0 ?        S    15:49   0:00 [kacpi_hotplug]</span><br><span class="line">root         20  0.0  0.0      0     0 ?        S    15:49   0:00 [ata_aux]</span><br><span class="line">root         21  0.0  0.0      0     0 ?        S    15:49   0:00 [ata_sff/0]</span><br><span class="line">root         22  0.0  0.0      0     0 ?        S    15:49   0:00 [ksuspend_usbd]</span><br><span class="line">root         23  0.0  0.0      0     0 ?        S    15:49   0:00 [khubd]</span><br><span class="line">root         24  0.0  0.0      0     0 ?        S    15:49   0:00 [kseriod]</span><br><span class="line">root         25  0.0  0.0      0     0 ?        S    15:49   0:00 [md/0]</span><br><span class="line">root         26  0.0  0.0      0     0 ?        S    15:49   0:00 [md_misc/0]</span><br><span class="line">root         27  0.0  0.0      0     0 ?        S    15:49   0:00 [linkwatch]</span><br><span class="line">root         29  0.0  0.0      0     0 ?        S    15:49   0:00 [khungtaskd]</span><br><span class="line">root         30  0.0  0.0      0     0 ?        S    15:49   0:00 [kswapd0]</span><br><span class="line">root         31  0.0  0.0      0     0 ?        SN   15:49   0:00 [ksmd]</span><br><span class="line">root         32  0.0  0.0      0     0 ?        S    15:49   0:00 [aio/0]</span><br><span class="line">root         33  0.0  0.0      0     0 ?        S    15:49   0:00 [crypto/0]</span><br><span class="line">root         41  0.0  0.0      0     0 ?        S    15:49   0:00 [kthrotld/0]</span><br><span class="line">root         42  0.0  0.0      0     0 ?        S    15:49   0:00 [pciehpd]</span><br></pre></td></tr></table></figure>

<h3 id="17-2"><a href="#17-2" class="headerlink" title="17.2  |"></a>17.2  |</h3><p>管道，在管道左侧命令直接结果基础上，执行管道右侧的命令</p>
<h2 id="19-grep"><a href="#19-grep" class="headerlink" title="19  grep"></a>19  grep</h2><p>过滤 | 筛选，筛选符合关键字的数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node6 ~]# ps aux | grep network</span><br><span class="line">root       7306  0.0  0.1 103252   840 pts/0    S+   19:08   0:00 grep network</span><br></pre></td></tr></table></figure>

<h1 id="3-软件安装"><a href="#3-软件安装" class="headerlink" title="3  软件安装"></a>3  软件安装</h1><h2 id="3-1-安装-JDK"><a href="#3-1-安装-JDK" class="headerlink" title="3.1 安装 JDK"></a>3.1 安装 JDK</h2><h4 id="3-1-1-软件上传"><a href="#3-1-1-软件上传" class="headerlink" title="3.1.1 软件上传"></a>3.1.1 软件上传</h4><h5 id="使用-xtp-软件上传"><a href="#使用-xtp-软件上传" class="headerlink" title="使用  xtp 软件上传"></a>使用  xtp 软件上传</h5><h5 id="直接通过鼠标拖拽"><a href="#直接通过鼠标拖拽" class="headerlink" title="直接通过鼠标拖拽"></a>直接通过鼠标拖拽</h5><h2 id="3-2-文件解压"><a href="#3-2-文件解压" class="headerlink" title="3.2 文件解压"></a>3.2 文件解压</h2><p>tar 命令</p>
<h3 id="1常用方式"><a href="#1常用方式" class="headerlink" title="1常用方式"></a>1常用方式</h3><p>tar [参数] source  [target]</p>
<p>source 压缩文件</p>
<p>target 解压搜</p>
<p>解压缩 <code>tar -zxf    压缩文件名</code></p>
<p>解压缩  <code>tar -zxvf 压缩文件名</code></p>
<p>压缩  <code>tar -czf    要压缩的目录 压缩后的文件名</code></p>
<p>注意： f 参数一定要在最后出现</p>
<h4 id="1-1-z"><a href="#1-1-z" class="headerlink" title="1.1   z"></a>1.1   z</h4><p>zip 格式压缩文件，包括 zip，gz，tar.gz 等格式，不包括 rar.</p>
<h4 id="1-2-x"><a href="#1-2-x" class="headerlink" title="1.2 x"></a>1.2 x</h4><p>解压缩</p>
<h4 id="1-3-c"><a href="#1-3-c" class="headerlink" title="1.3  c"></a>1.3  c</h4><p> 创建压缩包</p>
<h4 id="1-4v"><a href="#1-4v" class="headerlink" title="1.4v"></a>1.4v</h4><p>  显示解压过程</p>
<h4 id="1-5-f"><a href="#1-5-f" class="headerlink" title="1.5 f"></a>1.5 f</h4><p> 指定文件</p>
<h2 id="3-3-配置环境变量"><a href="#3-3-配置环境变量" class="headerlink" title="3.3 配置环境变量"></a>3.3 配置环境变量</h2><p>修改系统级环境变量配置文件，文件是 ：<code>/etc/profile</code></p>
<p>JDk 解压后复制到了 /usr/local/java 目录中，这是配置环境变量的前提。</p>
<p>在配置文件中修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/local/jdk #jdk的位置</span><br><span class="line">export CLASSPATH=.$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>

<p>永久生效，重启机器<code>reboot</code></p>
<p>临时生效，重新加载 <code>. /etc/profile</code></p>
<h1 id="4-Tomcat-软件安装"><a href="#4-Tomcat-软件安装" class="headerlink" title="4 Tomcat 软件安装"></a>4 Tomcat 软件安装</h1><h2 id="4-1-软件安装"><a href="#4-1-软件安装" class="headerlink" title="4.1 软件安装"></a>4.1 软件安装</h2><h4 id="上传软件资源到-Linux-上"><a href="#上传软件资源到-Linux-上" class="headerlink" title="上传软件资源到 Linux 上"></a>上传软件资源到 Linux 上</h4><h4 id="解压缩"><a href="#解压缩" class="headerlink" title="解压缩"></a>解压缩</h4><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>启动 tomcat 服务器</span><br><span class="line"><span class="meta">#</span>进入 tomcat 根目录下</span><br><span class="line">./bin/startup.sh</span><br><span class="line"><span class="meta">#</span>关闭 tomcat 服务器</span><br><span class="line">./bin/shutdown.sh</span><br></pre></td></tr></table></figure>

<h5 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tail -f logs/catalina.out</span><br><span class="line"><span class="meta">#</span>或者</span><br><span class="line">tailf  logs/catalina.out</span><br></pre></td></tr></table></figure>

<h5 id="amp-命令连接符"><a href="#amp-命令连接符" class="headerlink" title="&amp; 命令连接符"></a>&amp; 命令连接符</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 启动 tocmat 服务器并打印 tomcat 服务器输出语句</span><br><span class="line">/bin/startup.sh &amp; tail -f logs/catalina.out</span><br><span class="line"><span class="meta">#</span> 或者</span><br><span class="line">/bin/startup.sh &amp; tailf logs/catalina.out</span><br></pre></td></tr></table></figure>

<h3 id="开放-8080-端口"><a href="#开放-8080-端口" class="headerlink" title="开放 8080 端口"></a>开放 8080 端口</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/sbin/iptables -I INPUT -p tcp --dport 8080 -j ACCEPT</span><br><span class="line">/etc/rc.d/init.d/iptables save</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>对于centos7</span><br><span class="line"><span class="meta">#</span>先开启防火墙服务（如果防火墙运行中直接跳过）</span><br><span class="line">systemctl start firewalld</span><br><span class="line"><span class="meta">#</span>开启端口</span><br><span class="line">firewall-cmd --add-port=8080/tcp --permanent</span><br><span class="line"><span class="meta">#</span>(如果不行再开启80端口)</span><br></pre></td></tr></table></figure>

<h3 id="解决-tomcat-启动慢的问题"><a href="#解决-tomcat-启动慢的问题" class="headerlink" title="解决 tomcat 启动慢的问题"></a>解决 tomcat 启动慢的问题</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>进入 tomcat服务器的根目录</span><br><span class="line"><span class="meta">#</span>执行 vi bin/catalina.sh</span><br><span class="line"><span class="meta">#</span>找到 Java_OPTS 修改为下面的值</span><br><span class="line">JAVA_OPTS="-Djava.security.egd=file:/dev/./urandom"</span><br></pre></td></tr></table></figure>

<h1 id="5-MySQL-安装"><a href="#5-MySQL-安装" class="headerlink" title="5 MySQL 安装"></a>5 MySQL 安装</h1><h2 id="5-1-yum-安装"><a href="#5-1-yum-安装" class="headerlink" title="5.1  yum 安装"></a>5.1  yum 安装</h2><h3 id="5-1-1-上传本地-yum-文件"><a href="#5-1-1-上传本地-yum-文件" class="headerlink" title="5.1.1 上传本地 yum 文件"></a>5.1.1 上传本地 yum 文件</h3><p>在MySQL官网中下载YUM源rpm安装包：<a href="http://dev.mysql.com/downloads/repo/yum/" target="_blank" rel="noopener">http://dev.mysql.com/downloads/repo/yum/</a> </p>
<p>或者</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 下载mysql源安装包</span><br><span class="line"><span class="meta">shell&gt;</span> wget http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm</span><br><span class="line"><span class="meta">#</span> 安装mysql源</span><br><span class="line"><span class="meta">shell&gt;</span> yum localinstall mysql57-community-release-el7-8.noarch.rpm</span><br></pre></td></tr></table></figure>

<h3 id="5-1-2-增加本地-yum-信息"><a href="#5-1-2-增加本地-yum-信息" class="headerlink" title="5.1.2  增加本地 yum 信息"></a>5.1.2  增加本地 yum 信息</h3><p>yum 安装，是通过远程的 yum 应用服务器下载安装包并安装软件的方式</p>
<p>yum 应用服务器中的数据是固定的</p>
<p>增加本地 yum 信息，相当于增加一个新的 yum 应用服务器中的软件列表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum localinstall  文件名</span><br></pre></td></tr></table></figure>

<h3 id="5-1-3-yum-远程下载并安装"><a href="#5-1-3-yum-远程下载并安装" class="headerlink" title="5.1.3 yum 远程下载并安装"></a>5.1.3 yum 远程下载并安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-server</span><br><span class="line"><span class="meta">#</span>或者</span><br><span class="line">yum install mysql-community-server</span><br></pre></td></tr></table></figure>

<h4 id="5-1-4-启动-mysql-服务器"><a href="#5-1-4-启动-mysql-服务器" class="headerlink" title="5.1.4 启动 mysql 服务器"></a>5.1.4 启动 mysql 服务器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>

<h3 id="5-1-5-设置-mysql-用户的密码"><a href="#5-1-5-设置-mysql-用户的密码" class="headerlink" title="5.1.5 设置 mysql 用户的密码"></a>5.1.5 设置 mysql 用户的密码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/mysqladmin -u root password 'new-password'</span><br></pre></td></tr></table></figure>

<h2 id="5-2-授权"><a href="#5-2-授权" class="headerlink" title="5.2 授权"></a>5.2 授权</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grant all privileges on *.* to 'root'@'%' identified by  'root' with grant option </span><br><span class="line"><span class="meta">#</span>grant all privileges 表示权限信息</span><br><span class="line"><span class="meta">#</span>to 'mysql用户名'@'可访问的IP'</span><br><span class="line"><span class="meta">#</span> % 代表所有 "identified by '用户密码' with  grant option"</span><br></pre></td></tr></table></figure>

<h3 id="5-2-2-刷新权限"><a href="#5-2-2-刷新权限" class="headerlink" title="5.2.2  刷新权限"></a>5.2.2  刷新权限</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>授权后一定要刷新权限信息</span><br><span class="line">flush  privileges</span><br></pre></td></tr></table></figure>

<h3 id="5-2-3-访问测试"><a href="#5-2-3-访问测试" class="headerlink" title="5.2.3 访问测试"></a>5.2.3 访问测试</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p【password】</span><br><span class="line"><span class="meta">#</span>注意 -p 直接输入密码，不能有空格</span><br></pre></td></tr></table></figure>

<h3 id="5-2-4-开机自启"><a href="#5-2-4-开机自启" class="headerlink" title="5.2.4  开机自启"></a>5.2.4  开机自启</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>Centos 6</span><br><span class="line">chkconfig mysqld on   </span><br><span class="line"><span class="meta">#</span>Centos 7</span><br><span class="line">systemctl mysqld enable</span><br></pre></td></tr></table></figure>

<h2 id="5-3-访问任意位置的-mysql-数据库"><a href="#5-3-访问任意位置的-mysql-数据库" class="headerlink" title="5.3 访问任意位置的 mysql  数据库"></a>5.3 访问任意位置的 mysql  数据库</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u 用户名 -p密码 -h主机名或IP地址 -p端口号</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/16/20190516 Maven 项目管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/16/20190516 Maven 项目管理/" class="post-title-link" itemprop="url">20190516 Maven</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-16 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-16T00:00:00+08:00">2019-05-16</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-20 16:37:29" itemprop="dateModified" datetime="2019-05-20T16:37:29+08:00">2019-05-20</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Maven-简介"><a href="#1-Maven-简介" class="headerlink" title="1 Maven 简介"></a>1 Maven 简介</h1><blockquote>
<p>Maven 使用项目对象模型（POM，Project Object Model） 的概念，可以通过一小段描述信息来管理项目的构建、报告和文档的<strong>软件项目管理工具</strong></p>
</blockquote>
<h1 id="2-Maven-的下载与IDE-的整合"><a href="#2-Maven-的下载与IDE-的整合" class="headerlink" title="2 Maven 的下载与IDE 的整合"></a>2 Maven 的下载与IDE 的整合</h1><h2 id="1-下载地址"><a href="#1-下载地址" class="headerlink" title="1 下载地址"></a>1 下载地址</h2><p>maven.apche.org</p>
<h2 id="2-Eclipse-整合Maven"><a href="#2-Eclipse-整合Maven" class="headerlink" title="2 Eclipse 整合Maven"></a>2 Eclipse 整合Maven</h2><p><strong>Step1:</strong>打开 Eclipse 中window -&gt; preference -&gt; maven -&gt;  InstallLocations </p>
<p>更换为自己下载的 maven ，不使用 eclipse 自带的 maven</p>
<p><strong>Step2:</strong>打开 maven -&gt; UserSetting </p>
<p>更换为自己的 settings.xml  配置文件，并修改 settings.xml 文件</p>
<h3 id="3-Maven-仓库与配置"><a href="#3-Maven-仓库与配置" class="headerlink" title="3 Maven 仓库与配置"></a>3 Maven 仓库与配置</h3><h2 id="3-1远程仓库"><a href="#3-1远程仓库" class="headerlink" title="3.1远程仓库"></a>3.1远程仓库</h2><p>中央仓库  <a href="https://mvnrepository.com/" target="_blank" rel="noopener">https://mvnrepository.com/</a> </p>
<h2 id="3-2-本地仓库"><a href="#3-2-本地仓库" class="headerlink" title="3.2 本地仓库"></a>3.2 本地仓库</h2><p>存储本机的拷贝，以及远程仓库中的下载的构件（Java API 资源）</p>
<h2 id="4-仓库配置"><a href="#4-仓库配置" class="headerlink" title="4 仓库配置"></a>4 仓库配置</h2><h3 id="5-1-settings-xml"><a href="#5-1-settings-xml" class="headerlink" title="5.1 settings.xml"></a>5.1 settings.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">设置本地仓库的地址 --&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>E://Maven//repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-配置镜像源"><a href="#5-2-配置镜像源" class="headerlink" title="5.2 配置镜像源"></a>5.2 配置镜像源</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 镜像的ID --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 指定镜像路径 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 匹配中央仓库 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span>        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="6-仓库优先级"><a href="#6-仓库优先级" class="headerlink" title="6 仓库优先级"></a>6 仓库优先级</h2><blockquote>
<p>本地仓库   &gt; 指定仓库  &gt;  远程仓库（镜像仓库 &gt; 中央仓库）</p>
</blockquote>
<h4 id="6-1-本地仓库"><a href="#6-1-本地仓库" class="headerlink" title="6.1 本地仓库"></a>6.1 本地仓库</h4><h4 id="6-2-指定仓库"><a href="#6-2-指定仓库" class="headerlink" title="6.2 指定仓库"></a>6.2 指定仓库</h4><h4 id="6-3-远程仓库"><a href="#6-3-远程仓库" class="headerlink" title="6.3 远程仓库"></a>6.3 远程仓库</h4><h5 id="镜像仓库"><a href="#镜像仓库" class="headerlink" title="镜像仓库"></a>镜像仓库</h5><h5 id="中央仓库"><a href="#中央仓库" class="headerlink" title="中央仓库"></a>中央仓库</h5><h1 id="3-Maven-工程"><a href="#3-Maven-工程" class="headerlink" title="3  Maven 工程"></a>3  Maven 工程</h1><h2 id="3-1-Pom-工程"><a href="#3-1-Pom-工程" class="headerlink" title="3.1 Pom 工程"></a>3.1 Pom 工程</h2><p>pom 工程是逻辑工程。</p>
<p>用在父级工程或者聚合工程。</p>
<p>用来做 jar 包的版本控制</p>
<h2 id="3-2-jar-工程"><a href="#3-2-jar-工程" class="headerlink" title="3.2 jar 工程"></a>3.2 jar 工程</h2><p>将会打包成 jar 用作 jar 包使用</p>
<h2 id="3-3-war-工程"><a href="#3-3-war-工程" class="headerlink" title="3.3 war 工程"></a>3.3 war 工程</h2><p>将会打包成 war ，发布在服务器上的工程。</p>
<h1 id="4-创建Maven-项目"><a href="#4-创建Maven-项目" class="headerlink" title="4 创建Maven 项目"></a>4 创建Maven 项目</h1><blockquote>
<p>使用 Eclipse 创建 Maven 项目，勾选简单工程，即创建纯净的项目。</p>
</blockquote>
<h2 id="4-1-Maven-创建"><a href="#4-1-Maven-创建" class="headerlink" title="4.1 Maven 创建"></a>4.1 Maven 创建</h2><blockquote>
<p>Group Id  Artifact Id  Version 这三个组合起来唯一定位项目的位置</p>
</blockquote>
<p>Group Id ： 域名倒着写</p>
<p>Artifact Id：项目名称</p>
<p>Version ： 版本</p>
<p>Packing ：项目类型</p>
<p>Name：任意</p>
<p>Description：描述任意</p>
<h2 id="4-2-Maven-目录"><a href="#4-2-Maven-目录" class="headerlink" title="4.2 Maven 目录"></a>4.2 Maven 目录</h2><table>
<thead>
<tr>
<th align="left"></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="left">src/main/java</td>
<td>存储 java 源代码</td>
</tr>
<tr>
<td align="left">src/man/resources</td>
<td>存储资源配置文件</td>
</tr>
<tr>
<td align="left">src/main/test</td>
<td>测试 java 源代码和资源文件</td>
</tr>
<tr>
<td align="left">src/</td>
<td>存储源代码和资源文件</td>
</tr>
<tr>
<td align="left">target</td>
<td>编译后内容放置的文件夹</td>
</tr>
<tr>
<td align="left">pom.xml</td>
<td>Maven 的基础配置文件。配置项目与项目之间关系，包括配置依赖关系等等</td>
</tr>
</tbody></table>
<h1 id="5-工程关系"><a href="#5-工程关系" class="headerlink" title="5 工程关系"></a>5 工程关系</h1><h2 id="5-1-依赖"><a href="#5-1-依赖" class="headerlink" title="5.1 依赖"></a>5.1 依赖</h2><p>如果 A工程 依赖于 B 工程的资源，则称 A 工程依赖于 B 工程</p>
<p>做法：将 B 工程的坐标加入 A 工程的 pom.xml 的依赖中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		complie 编译中有效</span></span><br><span class="line"><span class="comment">        runtime 运行中有效</span></span><br><span class="line"><span class="comment">        system 全部中有效[默认]</span></span><br><span class="line"><span class="comment">        provided 当前工程中有效</span></span><br><span class="line"><span class="comment">        test 只在测试有效</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-2-继承"><a href="#5-2-继承" class="headerlink" title="5.2  继承"></a>5.2  继承</h2><blockquote>
<p>如果 A 工程继承 B 工程，则A 工程可以使用 B 工程所有资源。</p>
<p>前提 B 工程必须是 pom 工程类型.</p>
</blockquote>
<h5 id="父工程的配置文件"><a href="#父工程的配置文件" class="headerlink" title="父工程的配置文件"></a>父工程的配置文件</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.edu.ahszu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ParentProject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">  		<span class="comment">&lt;!-- 配置当前项目依赖构建的版本 </span></span><br><span class="line"><span class="comment">  			 项目名最好见名知意</span></span><br><span class="line"><span class="comment">  		 --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">junit-version</span>&gt;</span>4.2<span class="tag">&lt;/<span class="name">junit-version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  			 <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	   		 <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	    	<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="子工程的配置文件"><a href="#子工程的配置文件" class="headerlink" title="子工程的配置文件"></a>子工程的配置文件</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 继承父项目 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.edu.ahszu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ParentProject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.edu.ahszu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ChildProject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	   	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-3-聚合"><a href="#5-3-聚合" class="headerlink" title="5.3 聚合"></a>5.3 聚合</h2><p>当我们开发的工程拥有 2 个以上模块的时候，每个模块都是一个独立的功能集合。</p>
<p>注意：在创建聚合工程的过程猴子那个，总的工程必须是 pom 类型的工程，子模块的工程类型任意。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.edu.ahszu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>04-Maven-Managerment<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 子模块 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">module</span>&gt;</span>04-Maben-sub<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">module</span>&gt;</span>04-Maven-sub2<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="6-创建-war-类型的项目"><a href="#6-创建-war-类型的项目" class="headerlink" title="6 创建 war 类型的项目"></a>6 创建 war 类型的项目</h1><p>创建war 类型的项目后，</p>
<p>war 默认没有 WEB-INF 目录及下面的 web.xml 文件，所以需要手动添加。</p>
<p>在 webapp 目录下创建 WEB-INF 目录该目录下的 web.xm 文件</p>
<h1 id="7-Maven-常用插件"><a href="#7-Maven-常用插件" class="headerlink" title="7 Maven 常用插件"></a>7 Maven 常用插件</h1><h2 id="7-1-编译器插件"><a href="#7-1-编译器插件" class="headerlink" title="7.1  编译器插件"></a>7.1  编译器插件</h2><p>前提是本机必须有 JDK ，并且JDK 的版本要对应</p>
<p>在 pom.xml 配置编译器插件，用于选择 JDK 的版本，并且对本项目生效。</p>
<p>若需全局配置，需要在 settings.xml 中配置编译器插件。</p>
<h3 id="pom-xml-局部配置"><a href="#pom-xml-局部配置" class="headerlink" title="pom.xml 局部配置"></a>pom.xml 局部配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- java 编译插件 --&gt;</span> </span><br><span class="line"> 	  <span class="tag">&lt;<span class="name">plugin</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>        </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span> </span><br><span class="line">          	<span class="tag">&lt;<span class="name">source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">source</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">target</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="settings-xml-全局配置"><a href="#settings-xml-全局配置" class="headerlink" title="settings.xml 全局配置"></a>settings.xml 全局配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span> </span><br><span class="line"> 	<span class="comment">&lt;!-- 定义的编译器插件 ID，全局唯一 --&gt;</span> </span><br><span class="line"> 	<span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.7<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line"> 	<span class="comment">&lt;!-- 插件标记，activeByDefault 默认编译器，jdk 提供编译器版本 --&gt;</span> </span><br><span class="line"> 	<span class="tag">&lt;<span class="name">activation</span>&gt;</span> </span><br><span class="line"> 	 	<span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span> </span><br><span class="line"> 	 	<span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span> </span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">activation</span>&gt;</span> </span><br><span class="line"> 	<span class="comment">&lt;!-- 配置信息 source-源信息，target-字节码信息，compilerVersion-编译过程版--&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">properties</span>&gt;</span> </span><br><span class="line"> 	 	<span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span> </span><br><span class="line"> 	 	<span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span> </span><br><span class="line">  		<span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span> </span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="7-2-Tomcat-插件"><a href="#7-2-Tomcat-插件" class="headerlink" title="7.2  Tomcat  插件"></a>7.2  Tomcat  插件</h2><blockquote>
<p>启动 tomcat 命令：<code>tocmat7 :run</code></p>
<p>命令中的 tomcat7 是插件命名，由插件提供商决定。run 为插件中的具体功能.</p>
</blockquote>
<h4 id="本地应用"><a href="#本地应用" class="headerlink" title="本地应用"></a>本地应用</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span> </span><br><span class="line">      <span class="comment">&lt;!-- 配置 Tomcat 插件 --&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">port</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">port</span>&gt;</span> </span><br><span class="line">          <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     				/ 表示访问 tocmat 中 webapp 中 ROOT 目录</span></span><br><span class="line"><span class="comment">					访问 http://localhost:8080/</span></span><br><span class="line"><span class="comment">		   --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="远程热部署"><a href="#远程热部署" class="headerlink" title="远程热部署"></a>远程热部署</h4><p>在 tomcat 容器运行过程中，动态实现 war 工程的部署，重新部署的功能。</p>
<p>使用 maven build ，使用 run:deploy  或者 run:redeploy</p>
<h5 id="配置-tocmat-服务器用户"><a href="#配置-tocmat-服务器用户" class="headerlink" title="配置 tocmat 服务器用户"></a>配置 tocmat 服务器用户</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-gui"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-script"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"tomcatUsername"</span> <span class="attr">password</span>=<span class="string">"tomcatPassword"</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">roles</span>=<span class="string">"manager-gui,manager-script"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="修改-pom-xml-文件"><a href="#修改-pom-xml-文件" class="headerlink" title="修改 pom.xml 文件"></a>修改 pom.xml 文件</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.szxy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>07-Maven-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span> </span><br><span class="line">      <span class="comment">&lt;!-- 配置 Tomcat 插件 --&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">port</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">port</span>&gt;</span> </span><br><span class="line">           <span class="comment">&lt;!-- path: 上传的 war 包解压后的路径命名 --&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">path</span>&gt;</span>/ROOT<span class="tag">&lt;/<span class="name">path</span>&gt;</span> </span><br><span class="line">           <span class="comment">&lt;!-- url : 上传 war 包到什么位置,除 IP 和端口可以修改外其他不变 --&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.170.8:8080//manager/text<span class="tag">&lt;/<span class="name">url</span>&gt;</span> </span><br><span class="line">          <span class="comment">&lt;!-- 为 tomcat 配置的管理用户名和密码. --&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">username</span>&gt;</span>tomcatUsername<span class="tag">&lt;/<span class="name">username</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">password</span>&gt;</span>tomcatPassword<span class="tag">&lt;/<span class="name">password</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="7-3-资源拷贝插件"><a href="#7-3-资源拷贝插件" class="headerlink" title="7.3 资源拷贝插件"></a>7.3 资源拷贝插件</h2><p>使用 maven 命令生成 war 类型的工程，默认打包 src/main/resources 下的配置文件，并不会打包src 目录下的配置文件，所以这时需要配置 pom.xml ，让maven 也打包src目录下的配置文件。</p>
<p>注意：当在 pom.xml 配置 src 目录配置文件时，还需再添加原来默认打包路径下 src/mian/resources 下的配置文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置资源插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/**.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/**.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/**.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="8-Maven-常用命令"><a href="#8-Maven-常用命令" class="headerlink" title="8 Maven 常用命令"></a>8 Maven 常用命令</h1><h3 id="install"><a href="#install" class="headerlink" title="install"></a>install</h3><p>本地安装，包含编译，打包，安装到本地仓库</p>
<p>编译 javac </p>
<p>打包 jar</p>
<p>安装到本地仓库，将打包 jar 文件，保存到本地仓库中。</p>
<h3 id="clean"><a href="#clean" class="headerlink" title="clean"></a>clean</h3><p>清除已编译信息，删除工程中的 target 目录。</p>
<h3 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h3><p>只编译，javac</p>
<h3 id="deploy"><a href="#deploy" class="headerlink" title="deploy"></a>deploy</h3><p>部署。</p>
<h3 id="package"><a href="#package" class="headerlink" title="package"></a>package</h3><p>打包。包括编译，打包的两个功能</p>
<h1 id="9-Maven-私服"><a href="#9-Maven-私服" class="headerlink" title="9 Maven 私服"></a>9 Maven 私服</h1><p>私服是一种特殊的远程仓库，它是架设在局域网的仓库服务，</p>
<p>私服代理广域网上的远程仓库，供局域网使用。</p>
<h3 id="安装私服-Nexus"><a href="#安装私服-Nexus" class="headerlink" title="安装私服 Nexus"></a>安装私服 Nexus</h3><p>默认端口为8081</p>
<h3 id="修改防火墙-开放端口"><a href="#修改防火墙-开放端口" class="headerlink" title="修改防火墙,开放端口"></a>修改防火墙,开放端口</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service stop iptables</span><br></pre></td></tr></table></figure>

<h3 id="开启-nexus-服务器"><a href="#开启-nexus-服务器" class="headerlink" title="开启 nexus 服务器"></a>开启 nexus 服务器</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nexus start</span><br></pre></td></tr></table></figure>

<h3 id="访问网站"><a href="#访问网站" class="headerlink" title="访问网站"></a>访问网站</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://IP:8081/nexus/</span><br></pre></td></tr></table></figure>

<h3 id="配置私服"><a href="#配置私服" class="headerlink" title="配置私服"></a>配置私服</h3><h5 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h5><p>Nexus 默认用户名是 admin、密码是admin123</p>
<h4 id="仓库类型"><a href="#仓库类型" class="headerlink" title="仓库类型"></a>仓库类型</h4><h5 id="hosted"><a href="#hosted" class="headerlink" title="hosted"></a>hosted</h5><p>存放自己项目的构件</p>
<h5 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h5><p>代理仓库：代理公共的远程仓库</p>
<h5 id="3rd-party"><a href="#3rd-party" class="headerlink" title="3rd party"></a>3rd party</h5><p>存放第三方构建</p>
<h3 id="设置-proxy-代理仓库准许远程下载"><a href="#设置-proxy-代理仓库准许远程下载" class="headerlink" title="设置 proxy 代理仓库准许远程下载"></a>设置 proxy 代理仓库准许远程下载</h3><p><img src="http://www.zwer.xyz/picGo/20190518150452.png" alt></p>
<h2 id="setting-xml"><a href="#setting-xml" class="headerlink" title="setting.xml"></a>setting.xml</h2><p>注意：配置了 nexus 服务器，就不需要配置镜像源</p>
<p>当 setting.xml 配置文件出错，则 eclipse maven插件不能读取 setting.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>  </span></span><br><span class="line"><span class="tag">  	<span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0"</span>   	        	      			     <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>   </span></span><br><span class="line"><span class="tag">     <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0      		          http://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</span> </span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>D:/repositories<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span> </span><br><span class="line"> <span class="comment">&lt;!--Maven是否需要和用户交互以获得输入。如果Maven需要和用户交互以获得输入，则设置成true，反之则应为false。默认为true。--&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">interactiveMode</span>&gt;</span>true<span class="tag">&lt;/<span class="name">interactiveMode</span>&gt;</span> </span><br><span class="line"> <span class="comment">&lt;!--表示Maven是否需要在离线模式下运行。如果构建系统需要在离线模式下运行，则为true，默认</span></span><br><span class="line"><span class="comment">为false。 --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">offline</span>&gt;</span>false<span class="tag">&lt;/<span class="name">offline</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	当插件的组织Id（groupId）没有显式提供时，供搜寻插件组织Id（groupId）的列表。该元素包含一个		pluginGroup元素列表，每个子元素包含了一个组织Id（groupId）。当我们使用某个插件，</span></span><br><span class="line"><span class="comment">    并且没有在命令行为其提供组织Id（groupId）的时候，Maven就会使用该列表。 </span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginGroup</span>&gt;</span>org.mortbay.jetty<span class="tag">&lt;/<span class="name">pluginGroup</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginGroup</span>&gt;</span>org.jenkins-ci.tools<span class="tag">&lt;/<span class="name">pluginGroup</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span> </span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">proxies</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">proxies</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--配置服务端的一些设置。一些设置如安全证书不应该和pom.xml一起分发。这种类型的信息应该存在于构建服务器上的settings.xml文件中。--&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">servers</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span> </span><br><span class="line">      <span class="comment">&lt;!-- server的id必须和pom.xml文件中的仓库id一致 --&gt;</span> </span><br><span class="line"> <span class="comment">&lt;!--这是server的id（注意不是用户登陆的id），该id与distributionManagement中 repository元素的id相匹配。--&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>deployment<span class="tag">&lt;/<span class="name">username</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>deployment123<span class="tag">&lt;/<span class="name">password</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>deployment<span class="tag">&lt;/<span class="name">username</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>deployment123<span class="tag">&lt;/<span class="name">password</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">servers</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--根据环境参数来调整构建配置的列表。--&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">profiles</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.7<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">activation</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">activation</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">properties</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">properties</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>sxt<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">activation</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>false<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span>         <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">activation</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">repositories</span>&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!-- 私有库配置 --&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span> </span><br><span class="line">          <span class="comment">&lt;!-- 私有库 id --&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">          <span class="comment">&lt;!-- 私有库地址 --&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.120.158:8081/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span> </span><br><span class="line">          <span class="comment">&lt;!-- 私有库是否支持 releases 版本 --&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">releases</span>&gt;</span> </span><br><span class="line">          <span class="comment">&lt;!-- 私有库是否支持 snapshots 版本 --&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span>       </span><br><span class="line">      <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!-- 插件库配置，具体含义私有库配置 --&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.120.158:8081/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">releases</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">releases</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span> </span><br><span class="line"> </span><br><span class="line">  <span class="comment">&lt;!-- 激活 profile --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- 根据 profile 的 id 标签值激活指定的内容 --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>sxt<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>  </span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span>  </span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>    <span class="attr">xsi:schemaLocation</span>=<span class="string">"     http://maven.apache.org/POM/4.0.0  </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>group<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">   </span><br><span class="line">  <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus Release Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.120.158:8081/nexus/content/repositories/releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus Snapshot Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.120.158:8081/nexus/content/repositories/snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-source-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-sources<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span> </span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 Maven 工程的 maven build 中，输入命令 deploy，即可实现发布工程信息到私服。 </p>
<p>如果同版本工程可能多次发布，需要修改 Nexus 配置。</p>
<h1 id="10-Maven-实战"><a href="#10-Maven-实战" class="headerlink" title="10 Maven 实战"></a>10 Maven 实战</h1><h2 id="1-需求分析"><a href="#1-需求分析" class="headerlink" title="1 需求分析"></a>1 需求分析</h2><p>基于 SSM 框架 的CRUD 案例</p>
<h2 id="2-项目选型"><a href="#2-项目选型" class="headerlink" title="2 项目选型"></a>2 项目选型</h2><h3 id="3-项目架构设计"><a href="#3-项目架构设计" class="headerlink" title="3 项目架构设计"></a>3 项目架构设计</h3><p>传统项目设计方式 –单体架构</p>
<p>Project</p>
<p>———-com.szxy</p>
<p>———————–Controller</p>
<p>————————Serviece</p>
<p>————————Pojo</p>
<p>————————Mapper</p>
<h3 id="Maven项目设计方式"><a href="#Maven项目设计方式" class="headerlink" title="Maven项目设计方式"></a>Maven项目设计方式</h3><p><img src="http://www.zwer.xyz/picGo/20190518160635.png" alt></p>
<h2 id="2-创建工程"><a href="#2-创建工程" class="headerlink" title="2 创建工程"></a>2 创建工程</h2><h3 id="2-1-建立-pom-父工程"><a href="#2-1-建立-pom-父工程" class="headerlink" title="2.1 建立 pom 父工程"></a>2.1 建立 pom 父工程</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.szy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>MavenParent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.1.3.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>3.2.8<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">mybatis.spring.version</span>&gt;</span></span><br><span class="line">			1.2.2</span><br><span class="line">		<span class="tag">&lt;/<span class="name">mybatis.spring.version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.32<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.6.4<span class="tag">&lt;/<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.0.9<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">jstl.version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">jstl.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">			<span class="tag">&lt;<span class="name">servlet-api.version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">servlet-api.version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">jsp-api.version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">jsp-api.version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tomcat.version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">tomcat.version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- jar包的依赖注入 ，由于该工程是一个父工程，所以jar包在该pom文件中只是声明 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 单元测试 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 日志处理 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- Mybatis --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- MySql --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 连接池 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- Spring --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- JSP相关 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jstl.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;servlet-api.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jsp-api.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 插件的开启 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- tomcat插件，由于子项目不一定每个都是web 项目，所以该插件只是声明，并未开启 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 配置Tomcat插件 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">					<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">					<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;tomcat.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- maven的编译器插件，该插件主要是决定了当前项目所使用jre版本 。由于无论是jar，还是war项目都需要制定jar的版本，所以该插件不需要生命，应当是开启的。 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line">					<span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-创建聚合-pom-工程"><a href="#2-2-创建聚合-pom-工程" class="headerlink" title="2.2  创建聚合 pom 工程"></a>2.2  创建聚合 pom 工程</h3><p>pom.xml 配置</p>
<p>当前是子模块全部创建后的 pom.xml 配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> 	      <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">		 <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.szxy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  		 <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>11-manager-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  		 <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.szxy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>11-manager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">module</span>&gt;</span>11-manager-pojo<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">module</span>&gt;</span>11-manager-mapper<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">module</span>&gt;</span>11-manger-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">module</span>&gt;</span>11-manager-controller<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-创建子模块-pojo-工程"><a href="#2-3-创建子模块-pojo-工程" class="headerlink" title="2.3  创建子模块 pojo 工程"></a>2.3  创建子模块 pojo 工程</h3><p>pom.xml 文件无需修改</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.szxy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>11-manager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>11-manager-pojo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-创建子模块-mapper-工程"><a href="#2-4-创建子模块-mapper-工程" class="headerlink" title="2.4 创建子模块 mapper 工程"></a>2.4 创建子模块 mapper 工程</h3><h5 id="pom-xml-配置文件"><a href="#pom-xml-配置文件" class="headerlink" title="pom.xml 配置文件"></a>pom.xml 配置文件</h5><p>添加 pojo 工程依赖</p>
<p>配置资源插件，复制映射文件到资源目录下</p>
<p>添加关于 mybatis 的 jar 包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.szxy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>11-manager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>11-manager-mapper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.szxy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>11-manager-pojo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- mybatis 依赖 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- MySql --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 连接池 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-创建子模块-service工程"><a href="#2-5-创建子模块-service工程" class="headerlink" title="2.5 创建子模块 service工程"></a>2.5 创建子模块 service工程</h3><p>pom.xml 配置文件</p>
<p>添加 maaper  工程依赖</p>
<p>添加 spring 相关 jar 包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.szxy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>11-manager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>11-manager-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.szxy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>11-manager-mapper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-6-创建子模块-controller-工程"><a href="#2-6-创建子模块-controller-工程" class="headerlink" title="2.6  创建子模块 controller 工程"></a>2.6  创建子模块 controller 工程</h3><p><img src="http://www.zwer.xyz/picGo/20190519114056.png" alt></p>
<h4 id="spring-配置"><a href="#spring-配置" class="headerlink" title="spring 配置"></a>spring 配置</h4><h5 id="applicationContext-Dao-xml"><a href="#applicationContext-Dao-xml" class="headerlink" title="applicationContext-Dao.xml"></a>applicationContext-Dao.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span> </span><br><span class="line"> </span><br><span class="line">	 <span class="comment">&lt;!-- 配置解析properties文件的工具类 --&gt;</span> </span><br><span class="line">	 <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:resource/*.properties"</span>/&gt;</span> </span><br><span class="line">	  </span><br><span class="line">	 <span class="comment">&lt;!-- 配置数据源 dataSource 阿里数据源--&gt;</span> </span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span> </span><br><span class="line">	     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span> </span><br><span class="line">		  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span> </span><br><span class="line">		  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span> </span><br><span class="line">		  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span> /&gt;</span> </span><br><span class="line">		  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span> </span><br><span class="line">		  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minIdle"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span> </span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	  </span><br><span class="line">	 <span class="comment">&lt;!-- 创建mybatis的上下文对象  --&gt;</span> </span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span> </span><br><span class="line">		  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span>&gt;</span> </span><br><span class="line">		   <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"dataSource"</span>/&gt;</span> </span><br><span class="line">		  <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">		  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span>&gt;</span> </span><br><span class="line">		 		<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:mybatis/SqlMapperClient.xml<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">		  <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	  </span><br><span class="line">	 <span class="comment">&lt;!-- 扫描mybatis的接口与映射配置文件 --&gt;</span> </span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span> </span><br><span class="line">	  	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.szxy.mapper"</span>/&gt;</span> </span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	 </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="applicationContext-service-xml"><a href="#applicationContext-service-xml" class="headerlink" title="applicationContext-service.xml"></a>applicationContext-service.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span>  </span></span><br><span class="line"><span class="tag">	   <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">	   <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span>  </span></span><br><span class="line"><span class="tag">	   <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span>  </span></span><br><span class="line"><span class="tag">	   <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span>  </span></span><br><span class="line"><span class="tag">	   <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">	   http://www.springframework.org/schema/beans/spring-beans.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span> </span><br><span class="line">       </span><br><span class="line"> 		<span class="comment">&lt;!-- 扫描bean对象 --&gt;</span> </span><br><span class="line"> 		<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.szxy.service"</span>/&gt;</span> </span><br><span class="line"> 		</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="applicationContext-tx-xml"><a href="#applicationContext-tx-xml" class="headerlink" title="applicationContext-tx.xml"></a>applicationContext-tx.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span>  </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span>  </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span>  </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>  </span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/beans/spring-beans-4.0.xsd  </span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/context/spring-context-4.0.xsd  </span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop/spring-aop-4.0.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd  </span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/util </span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/util/springutil-4.0.xsd"</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">   <span class="comment">&lt;!-- 配置事物管理器的切面 --&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionMananger"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span> </span><br><span class="line"> 		 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span>    </span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>     </span><br><span class="line">    </span><br><span class="line">   <span class="comment">&lt;!-- 配置事物传播行为 ：其实就是那些方法应该受什么样的事物控制--&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"advice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionMananger"</span>&gt;</span> </span><br><span class="line">	    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span> </span><br><span class="line">	     <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"add*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span> </span><br><span class="line">	     <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"modify*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span> </span><br><span class="line">	     <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span> </span><br><span class="line">	     <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"dorp*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span> </span><br><span class="line">	     <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"del*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span> </span><br><span class="line">	     <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span> </span><br><span class="line">	    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span> </span><br><span class="line">    </span><br><span class="line">   <span class="comment">&lt;!-- 那些类下的方法需要参与到当前的事物管理中 。配置切点 --&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"advice"</span> </span></span><br><span class="line"><span class="tag">                 <span class="attr">pointcut</span>=<span class="string">"execution(* com.bjsxt.service.*.*(..))"</span>/&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span> </span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="springmvc-xml"><a href="#springmvc-xml" class="headerlink" title="springmvc.xml"></a>springmvc.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/beans/spring-beans.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment">&lt;!-- 包的扫描器主要是扫描@controller --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span>  <span class="attr">base-package</span>=<span class="string">"com.szxy.web.controller"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 注册两个新对象 主要是为了来处理 springmvc中的其他anntation 如：@requestmapping --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 视图解析器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span> /&gt;</span><span class="comment">&lt;!-- jsp所在的前缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置静态资源映射 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/css/"</span> <span class="attr">mapping</span>=<span class="string">"/css/**"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/js/"</span> <span class="attr">mapping</span>=<span class="string">"/js/**"</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 文件上传处理器 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver"&gt;</span></span><br><span class="line"><span class="comment">		&lt;property name="defaultEncoding" value="utf-8"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">		&lt;property name="maxInMemorySize" value="1024"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">		单位字节</span></span><br><span class="line"><span class="comment">		org.springframework.web.multipart.MaxUploadSizeExc eededException</span></span><br><span class="line"><span class="comment">		&lt;property name="maxUploadSize" value="1000000"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	&lt;/bean&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="SqlMapperClient-xml"><a href="#SqlMapperClient-xml" class="headerlink" title="SqlMapperClient.xml"></a>SqlMapperClient.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line">  </span><br><span class="line"> <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> 	<span class="comment">&lt;!-- 设置分页 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="db-properties"><a href="#db-properties" class="headerlink" title="db.properties"></a>db.properties</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql:///test</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=root</span><br></pre></td></tr></table></figure>

<h3 id="2-7-开启服务器"><a href="#2-7-开启服务器" class="headerlink" title="2.7 开启服务器"></a>2.7 开启服务器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clean tocmat7:run</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/13/20190513 Shiro 安全框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/13/20190513 Shiro 安全框架/" class="post-title-link" itemprop="url">20190513 Shiro 安全框架</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-13 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-13T00:00:00+08:00">2019-05-13</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-15 22:06:16" itemprop="dateModified" datetime="2019-05-15T22:06:16+08:00">2019-05-15</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-shiro"><a href="#1-shiro" class="headerlink" title="1 shiro"></a>1 shiro</h1><p>Apache shiro 是一个 Java 安全框架。</p>
<p>功能：认证、授权、加密和会话管理功能</p>
<p>应用环境：JavaEE、JavaSE</p>
<p><img src="http://www.zwer.xyz/picGo/20190513200607.png" alt="shiro"></p>
<p>Subject 可看做成一个用户</p>
<p>SecurityManager 框架的核心API</p>
<p>Reaim 域对象，用于取数据库中的数据，进行权限比对。</p>
<p><img src="http://www.zwer.xyz/picGo/20190513201030.png" alt></p>
<table>
<thead>
<tr>
<th>名词</th>
<th>名词中文解释</th>
</tr>
</thead>
<tbody><tr>
<td>Subject</td>
<td>主体</td>
</tr>
<tr>
<td>Security</td>
<td>安全</td>
</tr>
<tr>
<td>Realm</td>
<td>领域、范围</td>
</tr>
<tr>
<td>Authenticator</td>
<td>认证器</td>
</tr>
<tr>
<td>Authentication</td>
<td>认证</td>
</tr>
<tr>
<td>Authorizer</td>
<td>授权器</td>
</tr>
<tr>
<td>Authorization</td>
<td>授权</td>
</tr>
<tr>
<td>Cryptography</td>
<td>密码、凭证</td>
</tr>
<tr>
<td><strong>Credential</strong></td>
<td>证书、凭证</td>
</tr>
<tr>
<td>Matcher</td>
<td>匹配器</td>
</tr>
<tr>
<td><strong>Principal</strong></td>
<td>身份</td>
</tr>
</tbody></table>
<h2 id="shiro-配置文件"><a href="#shiro-配置文件" class="headerlink" title="shiro 配置文件"></a>shiro 配置文件</h2><p>shiro.ini 文件放在 claspath 中，shiro会自动查找。其中格式是key/value键值对配置。 </p>
<p>Ini 配置文件一般适合与用户少且不需要在运行时动态创建的情景下使用。</p>
<p>ini 配置文件有四大类：main,users,roles,urls</p>
<h3 id="main"><a href="#main" class="headerlink" title="[main]"></a>[main]</h3><p>main 主要配置shiro 的一些对象，例如：securityManager，Realm，authenticator，authcStrategy</p>
<h3 id="users"><a href="#users" class="headerlink" title="[users]"></a>[users]</h3><p>作用：配置一组静态的用户</p>
<p>格式：key：value ，key表示密码的名字，value 表示密码的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zeros=1233</span><br></pre></td></tr></table></figure>

<h3 id="roles"><a href="#roles" class="headerlink" title="[roles]"></a>[roles]</h3><p>作用：将角色和权限关联操作</p>
<p>格式：资源：操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">role1= printer:create,printer:query</span><br></pre></td></tr></table></figure>

<h3 id="urls"><a href="#urls" class="headerlink" title="[urls]"></a>[urls]</h3><p>作用：拦截对应的 URL 请求。</p>
<h1 id="2-实现简单认证"><a href="#2-实现简单认证" class="headerlink" title="2 实现简单认证"></a>2 实现简单认证</h1><p>认证：验证用户是否合法。</p>
<h2 id="2-1-实现步骤"><a href="#2-1-实现步骤" class="headerlink" title="2.1 实现步骤"></a>2.1 实现步骤</h2><h3 id="导入-jar-包"><a href="#导入-jar-包" class="headerlink" title="导入 jar 包"></a>导入 jar 包</h3><p>junit-4.9.jar<br>log4j-1.2.17.jar<br>shiro-all-1.3.2.jar<br>slf4j-api-1.7.5.jar<br>slf4j-log4j12-1.7.5.jar</p>
<h3 id="编写-shiro-ini-配置文件"><a href="#编写-shiro-ini-配置文件" class="headerlink" title="编写 shiro.ini 配置文件"></a>编写 shiro.ini 配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[users]</span><br><span class="line">zeros=1233</span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.shiro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.config.IniSecurityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.SecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleAuthentication</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleAuthentication</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//构建  SecurityManagerFactory 工厂</span></span><br><span class="line">		IniSecurityManagerFactory factory = <span class="keyword">new</span> IniSecurityManagerFactory();</span><br><span class="line">		<span class="comment">//利用 SecurityManagerFactory 实例化  SecurityManager 对象</span></span><br><span class="line">		SecurityManager securityManager = factory.getInstance();</span><br><span class="line">		<span class="comment">// 将 SecurityManager 设置到运行环境中</span></span><br><span class="line">		SecurityUtils.setSecurityManager(securityManager);</span><br><span class="line">		<span class="comment">//通过SecurityUtils, 创建主体 Subject</span></span><br><span class="line">		Subject subject = SecurityUtils.getSubject();</span><br><span class="line">		<span class="comment">//创建用户密码令牌认证</span></span><br><span class="line">		UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">"admin1"</span>,<span class="string">"passwd"</span>);</span><br><span class="line">		<span class="comment">//验证身份</span></span><br><span class="line">		subject.login(token);</span><br><span class="line">		<span class="comment">//查看结果</span></span><br><span class="line">		System.out.println(subject.isAuthenticated());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-Realm-域"><a href="#3-Realm-域" class="headerlink" title="3 Realm 域"></a>3 Realm 域</h1><p>shiro 默认使用 IniRealm 源，默认从 init 配置文件中读取用户信息。</p>
<h2 id="3-1-实现步骤"><a href="#3-1-实现步骤" class="headerlink" title="3.1 实现步骤"></a>3.1 实现步骤</h2><h3 id="建立-users-表"><a href="#建立-users-表" class="headerlink" title="建立 users 表"></a>建立 users 表</h3><p>注意：<strong>表名必须是 users</strong> 。jdbcRealm 查找数据库中的表就是 users 表。</p>
<h3 id="导入-jar-包-1"><a href="#导入-jar-包-1" class="headerlink" title="导入 jar 包"></a>导入 jar 包</h3><p>com.springsource.com.mchange.v2.c3p0-0.9.1.2.jar<br>commons-beanutils-1.9.2.jar<br>commons-logging-1.1.1.jar<br>junit-4.9.jar<br>log4j-1.2.17.jar<br>mysql-connector-java-5.1.30.jar<br>shiro-all-1.3.2.jar<br>slf4j-api-1.7.5.jar<br>slf4j-log4j12-1.7.5.jar </p>
<h3 id="编写-shiro-ini-配置文件-1"><a href="#编写-shiro-ini-配置文件-1" class="headerlink" title="编写 shiro.ini 配置文件"></a>编写 shiro.ini 配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[main]</span><br><span class="line">#配置Realm</span><br><span class="line">jdbcRealm = org.apache.shiro.realm.jdbc.JdbcRealm</span><br><span class="line">#配置数据源</span><br><span class="line">dataSource = com.mchange.v2.c3p0.ComboPooledDataSource</span><br><span class="line">dataSource.driverClass = com.mysql.jdbc.Driver</span><br><span class="line">dataSource.jdbcUrl = jdbc:mysql:///rbac</span><br><span class="line">dataSource.user = root</span><br><span class="line">dataSource.password = root</span><br><span class="line"></span><br><span class="line">jdbcRealm.dataSource = $dataSource</span><br><span class="line"></span><br><span class="line">#将 Realm 注入给 SecurityManager</span><br><span class="line">securityManager.realm = $jdbcRealm</span><br></pre></td></tr></table></figure>

<h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><p>同简单认证的测试方法</p>
<h1 id="4-自定义-Realm"><a href="#4-自定义-Realm" class="headerlink" title="4 自定义 Realm"></a>4 自定义 Realm</h1><p>好处：可以给 securityManager 更加灵活的安全数据源（eg。jdbcRealm 中表和字段都限定了）</p>
<p>方式：通过实现 Realm 接口，或根据需要继承他的响应子类即可。 AuthenticatingRealm</p>
<h3 id="需求-使用自定义-Realm-，从而实现认证。"><a href="#需求-使用自定义-Realm-，从而实现认证。" class="headerlink" title="需求: 使用自定义 Realm ，从而实现认证。"></a>需求: 使用自定义 Realm ，从而实现认证。</h3><h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><h4 id="导入-jar-包-2"><a href="#导入-jar-包-2" class="headerlink" title="导入 jar 包"></a>导入 jar 包</h4><p>com.springsource.com.mchange.v2.c3p0-0.9.1.2.jar<br>commons-beanutils-1.9.2.jar<br>commons-logging-1.1.1.jar<br>junit-4.9.jar<br>log4j-1.2.17.jar<br>mysql-connector-java-5.1.30.jar<br>shiro-all-1.3.2.jar<br>slf4j-api-1.7.5.jar<br>slf4j-log4j12-1.7.5.jar </p>
<h4 id="编写自定义-Realm"><a href="#编写自定义-Realm" class="headerlink" title="编写自定义 Realm"></a>编写自定义 Realm</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.realm;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthenticatingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mysql.jdbc.Driver;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustRealm</span> <span class="keyword">extends</span>  <span class="title">AuthenticatingRealm</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String principals; <span class="comment">//用户名</span></span><br><span class="line">	<span class="keyword">private</span> String credentials;    <span class="comment">//密码</span></span><br><span class="line">	<span class="keyword">private</span> String driverName = <span class="string">"com.mysql.jdbc.Driver"</span>;</span><br><span class="line">	<span class="keyword">private</span> String url = <span class="string">"jdbc:mysql:///rbac"</span>;</span><br><span class="line">	<span class="keyword">private</span> String user = <span class="string">"root"</span>;</span><br><span class="line">	<span class="keyword">private</span> String password = <span class="string">"root"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">			<span class="comment">// 使用 jdbc 连接数据库</span></span><br><span class="line">			Connection conn = <span class="keyword">null</span>;</span><br><span class="line">			Statement stat = <span class="keyword">null</span>;</span><br><span class="line">			ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="comment">//注册驱动</span></span><br><span class="line">				<span class="comment">/*Driver driver = new Driver();</span></span><br><span class="line"><span class="comment">				DriverManager.registerDriver(driver);*/</span></span><br><span class="line">				Class.forName(driverName);</span><br><span class="line">				<span class="comment">//获取数据库连接</span></span><br><span class="line">				conn =  DriverManager.getConnection(url, user, password);</span><br><span class="line">				<span class="comment">//操作数据库对象</span></span><br><span class="line">				stat = conn.createStatement();</span><br><span class="line">				<span class="comment">//定义 sql 语句</span></span><br><span class="line">				String sql  = <span class="string">"select username,password from users"</span>;</span><br><span class="line">				<span class="comment">//执行 查询语句</span></span><br><span class="line">				rs = stat.executeQuery(sql);</span><br><span class="line">				<span class="comment">//获取 结果集</span></span><br><span class="line">				<span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">					principals = rs.getString(<span class="string">"username"</span>);</span><br><span class="line">					credentials = rs.getString(<span class="string">"password"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException | ClassNotFoundException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(rs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						rs.close();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(stat!=<span class="keyword">null</span>)&#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						stat.close();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(conn !=<span class="keyword">null</span>)&#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						conn.close();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//创建 AuthenticationInfo 接口 实现类</span></span><br><span class="line">			SimpleAuthenticationInfo info =</span><br><span class="line">					<span class="keyword">new</span> SimpleAuthenticationInfo(principals, credentials,<span class="string">"custRealm"</span>);</span><br><span class="line">			<span class="keyword">return</span> info;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写-shiro-ini-配置文件-2"><a href="#编写-shiro-ini-配置文件-2" class="headerlink" title="编写 shiro.ini 配置文件"></a>编写 shiro.ini 配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[main]</span><br><span class="line">#配置Realm</span><br><span class="line">custRealm = com.szxy.realm.CustRealm</span><br><span class="line"></span><br><span class="line">#将 Realm 注入给 SecurityManager</span><br><span class="line">securityManager.realm = $custRealm</span><br></pre></td></tr></table></figure>

<h4 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a>测试</h4><p>同上测试</p>
<h1 id="5-加密方式"><a href="#5-加密方式" class="headerlink" title="5 加密方式"></a>5 加密方式</h1><h2 id="对称加密算法"><a href="#对称加密算法" class="headerlink" title="对称加密算法"></a>对称加密算法</h2><blockquote>
<p>加密的密钥与解密的密钥相同</p>
</blockquote>
<p><img src="http://www.zwer.xyz/picGo/20190515215848.png" alt></p>
<h2 id="非对称算法算法"><a href="#非对称算法算法" class="headerlink" title="非对称算法算法"></a>非对称算法算法</h2><blockquote>
<p>加密的密钥与解密的密钥不相同</p>
</blockquote>
<p><a href="https://baike.baidu.com/item/公开密钥/7453570" target="_blank" rel="noopener">公开密钥</a>（publickey:简称公钥）和私有密钥（privatekey:简称私钥）。</p>
<p>公钥与私钥是一对，如果用公钥对数据进行加密，只有用对应的私钥才能解密。</p>
<p><img src="http://www.zwer.xyz/picGo/20190515215930.png" alt></p>
<h2 id="对称与非对称算法"><a href="#对称与非对称算法" class="headerlink" title="对称与非对称算法"></a>对称与非对称算法</h2><p><img src="https://gss3.bdstatic.com/-Po3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike80%2C5%2C5%2C80%2C26/sign=3e060ea182cb39dbd5cd6f04b17f6241/7acb0a46f21fbe0988a1a95f68600c338644adfa.jpg" alt></p>
<h2 id="散列算法比较"><a href="#散列算法比较" class="headerlink" title="散列算法比较"></a>散列算法比较</h2><p>![](D:\1-文档\MD_MarkDown 文档\20190515215956.png)</p>
<h2 id="MD5加密、加盐与迭代"><a href="#MD5加密、加盐与迭代" class="headerlink" title="MD5加密、加盐与迭代"></a>MD5加密、加盐与迭代</h2><h5 id="加盐"><a href="#加盐" class="headerlink" title="加盐"></a>加盐</h5><p>原因：相同的 password 生产相同的 Hash 值是相同</p>
<p>原理：给原文加入随机数生成新的MD5</p>
<p>加盐 salt：指往原文加入的随机数</p>
<h4 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h4><p>加密的次数</p>
<table>
<thead>
<tr>
<th>Md5Hash的构造方法</th>
<th>参数名用法</th>
</tr>
</thead>
<tbody><tr>
<td>public Md5Hash(Object source)</td>
<td>source指加密的数据</td>
</tr>
<tr>
<td>public Md5Hash(Object source, Object salt)</td>
<td>salt 加盐</td>
</tr>
<tr>
<td>public Md5Hash(Object source, Object salt, int hashIterations)</td>
<td>hashIterations 迭代次数</td>
</tr>
<tr>
<td>public Md5Hash()</td>
<td>无参构造器</td>
</tr>
</tbody></table>
<h4 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.md5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.hash.Md5Hash;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMd5</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//直接加密  </span></span><br><span class="line">		Md5Hash md5 = <span class="keyword">new</span> Md5Hash(<span class="string">"123"</span>);</span><br><span class="line">		System.out.println(md5);<span class="comment">//202cb962ac59075b964b07152d234b70</span></span><br><span class="line">		<span class="comment">//加盐 salt </span></span><br><span class="line">		md5 = <span class="keyword">new</span> Md5Hash(<span class="string">"123"</span>, <span class="string">"zwz"</span>);</span><br><span class="line">		System.out.println(md5); <span class="comment">//3b52ecfc4719fcb6c863208063548792</span></span><br><span class="line">		<span class="comment">//迭代，即加密的次数</span></span><br><span class="line">		md5 = <span class="keyword">new</span> Md5Hash(<span class="string">"123"</span>, <span class="string">"zwz"</span>, <span class="number">2</span>);</span><br><span class="line">		System.out.println(md5); <span class="comment">//de231265fe7ec45af1404ded2f365001	</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="6-凭证匹配器-Authentication"><a href="#6-凭证匹配器-Authentication" class="headerlink" title="6  凭证匹配器 Authentication"></a>6  凭证匹配器 Authentication</h1><blockquote>
<p>AuthenticatingRealm</p>
</blockquote>
<p>修改 realm</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ByteSource.Utilbytes(salt)</span></span><br><span class="line"><span class="keyword">package</span> com.szxy.realm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthenticatingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.ByteSource;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustRealm</span> <span class="keyword">extends</span>  <span class="title">AuthenticatingRealm</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String principals; <span class="comment">//用户名</span></span><br><span class="line">	<span class="keyword">private</span> String credentials;    <span class="comment">//密码</span></span><br><span class="line">	<span class="keyword">private</span> String driverName = <span class="string">"com.mysql.jdbc.Driver"</span>;</span><br><span class="line">	<span class="keyword">private</span> String url = <span class="string">"jdbc:mysql:///shiro"</span>;</span><br><span class="line">	<span class="keyword">private</span> String user = <span class="string">"root"</span>;</span><br><span class="line">	<span class="keyword">private</span> String password = <span class="string">"root"</span>;</span><br><span class="line">	<span class="keyword">private</span> String salt = <span class="keyword">null</span>;   <span class="comment">//加盐的盐值</span></span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">			<span class="comment">// 使用 jdbc 连接数据库</span></span><br><span class="line">			Connection conn = <span class="keyword">null</span>;</span><br><span class="line">			Statement stat = <span class="keyword">null</span>;</span><br><span class="line">			ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="comment">//注册驱动</span></span><br><span class="line">				<span class="comment">/*Driver driver = new Driver();</span></span><br><span class="line"><span class="comment">				DriverManager.registerDriver(driver);*/</span></span><br><span class="line">				Class.forName(driverName);</span><br><span class="line">				<span class="comment">//获取数据库连接</span></span><br><span class="line">				conn =  DriverManager.getConnection(url, user, password);</span><br><span class="line">				<span class="comment">//操作数据库对象</span></span><br><span class="line">				stat = conn.createStatement();</span><br><span class="line">				<span class="comment">//定义 sql 语句</span></span><br><span class="line">				String sql  = <span class="string">"select username,password,salt from starUsers"</span>;</span><br><span class="line">				<span class="comment">//执行 查询语句</span></span><br><span class="line">				rs = stat.executeQuery(sql);</span><br><span class="line">				<span class="comment">//获取 结果集</span></span><br><span class="line">				<span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">					principals = rs.getString(<span class="string">"username"</span>);</span><br><span class="line">					credentials = rs.getString(<span class="string">"password"</span>);</span><br><span class="line">					salt  = rs.getString(<span class="string">"salt"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException | ClassNotFoundException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(rs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						rs.close();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(stat!=<span class="keyword">null</span>)&#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						stat.close();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(conn !=<span class="keyword">null</span>)&#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						conn.close();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">				</span><br><span class="line">			ByteSource byteSource = ByteSource.Util.bytes(salt); <span class="comment">//加盐</span></span><br><span class="line">			<span class="comment">//创建 AuthenticationInfo 接口 实现类</span></span><br><span class="line">			SimpleAuthenticationInfo info =</span><br><span class="line">					<span class="keyword">new</span> SimpleAuthenticationInfo(principals, credentials,byteSource,<span class="string">"customRealm"</span>);</span><br><span class="line">			<span class="keyword">return</span> info;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置-shiro-配置文件"><a href="#配置-shiro-配置文件" class="headerlink" title="配置 shiro 配置文件"></a>配置 shiro 配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[main]</span><br><span class="line"></span><br><span class="line">#配置凭证匹配器</span><br><span class="line">credentialsMatcher=org.apache.shiro.authc.credential.HashedCredentialsMatcher</span><br><span class="line"></span><br><span class="line">#设置凭证匹配器的相关属性</span><br><span class="line">credentialsMatcher.hashAlgorithmName=MD5</span><br><span class="line">credentialsMatcher.hashIterations=2</span><br><span class="line"></span><br><span class="line">#配置Realm</span><br><span class="line">customRealm=com.szxy.realm.CustRealm</span><br><span class="line"></span><br><span class="line">#配置Realm的凭证匹配器属性</span><br><span class="line">customRealm.credentialsMatcher=$credentialsMatcher</span><br><span class="line"></span><br><span class="line">#将Realm注入给SecurityManager</span><br><span class="line">securityManager.realm=$customRealm</span><br></pre></td></tr></table></figure>

<h1 id="7-授权-Authorization"><a href="#7-授权-Authorization" class="headerlink" title="7  授权 Authorization"></a>7  授权 Authorization</h1><blockquote>
<p>授权，又称访问控制，是对资源访问管理的过程。</p>
<p>即对于认证通过的用户，授予他可以访问某些资源的权限    </p>
</blockquote>
<h3 id="授权方式"><a href="#授权方式" class="headerlink" title="授权方式"></a>授权方式</h3><p>代码触发、注解触发、标签触发</p>
<h3 id="授权流程图"><a href="#授权流程图" class="headerlink" title="授权流程图"></a>授权流程图</h3><p><img src="http://www.zwer.xyz/picGo/20190514091710.png" alt></p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[main]</span><br><span class="line"></span><br><span class="line">#配置凭证匹配器</span><br><span class="line">credentialsMatcher=org.apache.shiro.authc.credential.HashedCredentialsMatcher</span><br><span class="line"></span><br><span class="line">#设置凭证匹配器的相关属性</span><br><span class="line">credentialsMatcher.hashAlgorithmName=MD5</span><br><span class="line">credentialsMatcher.hashIterations=2</span><br><span class="line"></span><br><span class="line">#配置Realm</span><br><span class="line">customRealm=com.szxy.realm.CustRealm</span><br><span class="line"></span><br><span class="line">#配置Realm的凭证匹配器属性</span><br><span class="line">customRealm.credentialsMatcher=$credentialsMatcher</span><br><span class="line"></span><br><span class="line">#将Realm注入给SecurityManager</span><br><span class="line">securityManager.realm=$customRealm</span><br></pre></td></tr></table></figure>

<h3 id="代码示例-1"><a href="#代码示例-1" class="headerlink" title="代码示例"></a>代码示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.realm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthenticatingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.ByteSource;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustRealm</span> <span class="keyword">extends</span>  <span class="title">AuthorizingRealm</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String principals; <span class="comment">//用户名</span></span><br><span class="line">	<span class="keyword">private</span> String credentials;    <span class="comment">//密码</span></span><br><span class="line">	<span class="keyword">private</span> String driverName = <span class="string">"com.mysql.jdbc.Driver"</span>;</span><br><span class="line">	<span class="keyword">private</span> String url = <span class="string">"jdbc:mysql:///shiro"</span>;</span><br><span class="line">	<span class="keyword">private</span> String user = <span class="string">"root"</span>;</span><br><span class="line">	<span class="keyword">private</span> String password = <span class="string">"root"</span>;</span><br><span class="line">	<span class="keyword">private</span> String salt = <span class="keyword">null</span>;   <span class="comment">//加盐的盐值</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String roleName;  <span class="comment">//角色名称</span></span><br><span class="line">	<span class="keyword">private</span> String remark;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 验证的方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">			<span class="comment">// 使用 jdbc 连接数据库</span></span><br><span class="line">			Connection conn = <span class="keyword">null</span>;</span><br><span class="line">			Statement stat = <span class="keyword">null</span>;</span><br><span class="line">			ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="comment">//注册驱动</span></span><br><span class="line">				<span class="comment">/*Driver driver = new Driver();</span></span><br><span class="line"><span class="comment">				DriverManager.registerDriver(driver);*/</span></span><br><span class="line">				Class.forName(driverName);</span><br><span class="line">				<span class="comment">//获取数据库连接</span></span><br><span class="line">				conn =  DriverManager.getConnection(url, user, password);</span><br><span class="line">				<span class="comment">//操作数据库对象</span></span><br><span class="line">				stat = conn.createStatement();</span><br><span class="line">				<span class="comment">//定义 sql 语句</span></span><br><span class="line">				String sql  = <span class="string">"select username,password,salt from starUsers"</span>;</span><br><span class="line">				<span class="comment">//执行 查询语句</span></span><br><span class="line">				rs = stat.executeQuery(sql);</span><br><span class="line">				<span class="comment">//获取 结果集</span></span><br><span class="line">				<span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">					principals = rs.getString(<span class="string">"username"</span>);</span><br><span class="line">					credentials = rs.getString(<span class="string">"password"</span>);</span><br><span class="line">					salt  = rs.getString(<span class="string">"salt"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException | ClassNotFoundException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(rs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						rs.close();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(stat!=<span class="keyword">null</span>)&#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						stat.close();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(conn !=<span class="keyword">null</span>)&#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						conn.close();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">				</span><br><span class="line">			ByteSource byteSource = ByteSource.Util.bytes(salt); <span class="comment">//加盐</span></span><br><span class="line">			<span class="comment">//创建 AuthenticationInfo 接口 实现类</span></span><br><span class="line">			SimpleAuthenticationInfo info =</span><br><span class="line">					<span class="keyword">new</span> SimpleAuthenticationInfo(principals, credentials,byteSource,<span class="string">"customRealm"</span>);</span><br><span class="line">			<span class="keyword">return</span> info;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 授权的方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			PrincipalCollection principals)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 使用 jdbc 连接数据库</span></span><br><span class="line">		Connection conn = <span class="keyword">null</span>;</span><br><span class="line">		Statement stat = <span class="keyword">null</span>;</span><br><span class="line">		ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//注册驱动</span></span><br><span class="line">			<span class="comment">/*Driver driver = new Driver();</span></span><br><span class="line"><span class="comment">			DriverManager.registerDriver(driver);*/</span></span><br><span class="line">			Class.forName(driverName);</span><br><span class="line">			<span class="comment">//获取数据库连接</span></span><br><span class="line">			conn =  DriverManager.getConnection(url, user, password);</span><br><span class="line">			<span class="comment">//操作数据库对象</span></span><br><span class="line">			stat = conn.createStatement();</span><br><span class="line">			<span class="comment">//定义 sql 语句</span></span><br><span class="line">			<span class="comment">//String sql  = "select rolename from roles";</span></span><br><span class="line">			String  sql = <span class="string">"select * from permission"</span>; </span><br><span class="line">			<span class="comment">//执行 查询语句</span></span><br><span class="line">			rs = stat.executeQuery(sql);</span><br><span class="line">			<span class="comment">//获取 结果集</span></span><br><span class="line">			<span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">				<span class="comment">//roleName = rs.getString("rolename");</span></span><br><span class="line">				remark = rs.getString(<span class="string">"remark"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException | ClassNotFoundException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(rs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					rs.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">					<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(stat!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					stat.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">					<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(conn !=<span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					conn.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">					<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		SimpleAuthorizationInfo info = <span class="keyword">new</span> SimpleAuthorizationInfo();	</span><br><span class="line">		<span class="comment">//info.addRole(roleName);         //添加角色信息</span></span><br><span class="line">		info.addStringPermission(remark); <span class="comment">//添加权限信息</span></span><br><span class="line">		<span class="keyword">return</span> info;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试-3"><a href="#测试-3" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.shiro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.config.IniSecurityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.hash.Md5Hash;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.SecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestShiro</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestAuthorization</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//构建  SecurityManagerFactory 工厂</span></span><br><span class="line">		IniSecurityManagerFactory factory = <span class="keyword">new</span> IniSecurityManagerFactory();</span><br><span class="line">		<span class="comment">//利用 SecurityManagerFactory 实例化  SecurityManager 对象</span></span><br><span class="line">		SecurityManager securityManager = factory.getInstance();</span><br><span class="line">		<span class="comment">// 将 SecurityManager 设置到运行环境中</span></span><br><span class="line">		SecurityUtils.setSecurityManager(securityManager);</span><br><span class="line">		<span class="comment">//通过SecurityUtils, 创建主体 Subject</span></span><br><span class="line">		Subject subject = SecurityUtils.getSubject();</span><br><span class="line">		<span class="comment">//创建用户密码令牌认证</span></span><br><span class="line">		UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">"admin"</span>,<span class="string">"123"</span>);</span><br><span class="line">		<span class="comment">//验证身份</span></span><br><span class="line">		subject.login(token);</span><br><span class="line">		<span class="comment">//查看结果</span></span><br><span class="line">		System.out.println(subject.isAuthenticated());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//验证权限</span></span><br><span class="line">		<span class="comment">//基于角色授权</span></span><br><span class="line">		<span class="keyword">boolean</span> flag = subject.hasRole(<span class="string">"管理员1"</span>);</span><br><span class="line">		System.out.println(flag);</span><br><span class="line">		<span class="comment">//权限授权</span></span><br><span class="line">		<span class="keyword">boolean</span> flag2 = subject.isPermitted(<span class="string">"一级菜单，基本设置操作权限"</span>);</span><br><span class="line">		System.out.println(flag2);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="8-spring-整合Shiro"><a href="#8-spring-整合Shiro" class="headerlink" title="8 spring 整合Shiro"></a>8 spring 整合Shiro</h1><h3 id="新建项目，导入-jar-包"><a href="#新建项目，导入-jar-包" class="headerlink" title="新建项目，导入 jar 包"></a>新建项目，导入 jar 包</h3><h3 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h3><h4 id="编写-web-xml"><a href="#编写-web-xml" class="headerlink" title="编写 web.xml"></a>编写 web.xml</h4><h3 id="DelegatingFilterProxy"><a href="#DelegatingFilterProxy" class="headerlink" title="DelegatingFilterProxy"></a>DelegatingFilterProxy</h3><p>通过代理模式将 servlet 容器中 filter 同 spring 容器的 bean 关联起来</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>RBACDemo<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 监听 ServletContext ,注册  Spring 容器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 指定 spring 配置文件的名称及位置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext-*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- 注册 SpringMVC 容器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span> org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 指定 SpringMVC 配置文件的位置 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:SpringMVC.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- 开启编码过滤器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- 注册 DelegatingFilterProxy </span></span><br><span class="line"><span class="comment">  	      通过代理模式将 servlet 容器中 filter 同 spring 容器的 bean 关联起来</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>delegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> 		该属性为 true 表名启用引用 filter 的init() 和 destroy() </span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>targetFilterLifecycle<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		该属性设置 spring 容器中 filter 的bean的 id</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>targetBeanName<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>shiroFilter<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>  	</span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>delegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="spring-shiro-xml"><a href="#spring-shiro-xml" class="headerlink" title="spring-shiro.xml"></a>spring-shiro.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册凭证匹配器，并为其注入属性值--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"credentialsMatcher"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.authc.credential.HashedCredentialsMatcher"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 加密方式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashAlgorithmName"</span> <span class="attr">value</span>=<span class="string">"md5"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 迭代次数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashIterations"</span> <span class="attr">value</span>=<span class="string">"2"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 注册自定义 realm  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"customRealm"</span> <span class="attr">class</span>=<span class="string">"com.szxy.realm.CustomRealm"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"credentialsMatcher"</span> <span class="attr">ref</span>=<span class="string">"credentialsMatcher"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 注册 SecurityManager  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"securityManager"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.web.mgt.DefaultWebSecurityManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"realm"</span> <span class="attr">ref</span>=<span class="string">"customRealm"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">   注册 shiroFilterFactoryBean </span></span><br><span class="line"><span class="comment">   注意：bean 的id 名称必须与过滤器中的名称一致</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"shiroFilter"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.web.ShiroFilterFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"securityManager"</span> <span class="attr">ref</span>=<span class="string">"securityManager"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"loginUrl"</span> <span class="attr">value</span>=<span class="string">"/login.do"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"successUrl"</span> <span class="attr">value</span>=<span class="string">"/jsp/users.jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"unauthorizedUrl"</span> <span class="attr">value</span>=<span class="string">"/jsp/refuse.jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置过滤器链属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filterChainDefinitions"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">            /login.do=authc</span><br><span class="line">            /**=anon</span><br><span class="line">        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="代码示例-2"><a href="#代码示例-2" class="headerlink" title="代码示例"></a>代码示例</h3><h1 id="9-DelegatingFilterProxy"><a href="#9-DelegatingFilterProxy" class="headerlink" title="9 DelegatingFilterProxy"></a>9 DelegatingFilterProxy</h1><h4 id="DelegatingFilterProxy-源码分析"><a href="#DelegatingFilterProxy-源码分析" class="headerlink" title="DelegatingFilterProxy 源码分析"></a>DelegatingFilterProxy 源码分析</h4><p> void initFilterBean() 初始化过滤器 bean 对象，并调用 Filter initDelegate(WebApplicationContext wac) 方法，</p>
<p>从 spring 容器取出 目标 target 的bean 对象，并对其他进行初始化操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initFilterBean</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>.delegateMonitor) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.delegate == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// If no target bean name specified, use filter name.</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.targetBeanName == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.targetBeanName = getFilterName();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Fetch Spring root application context and initialize the delegate early,</span></span><br><span class="line">            <span class="comment">// if possible. If the root application context will be started after this</span></span><br><span class="line">            <span class="comment">// filter proxy, we'll have to resort to lazy initialization.</span></span><br><span class="line">            WebApplicationContext wac = findWebApplicationContext();</span><br><span class="line">            <span class="keyword">if</span> (wac != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.delegate = initDelegate(wac); </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Initialize the Filter delegate, defined as bean the given Spring</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Filter <span class="title">initDelegate</span><span class="params">(WebApplicationContext wac)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		Filter delegate = wac.getBean(getTargetBeanName(), Filter.class);</span><br><span class="line">		<span class="keyword">if</span> (isTargetFilterLifecycle()) &#123;</span><br><span class="line">            <span class="comment">//该属性为 true 表名启用引用 filter 的init() 和 destroy() 交给 spring 容器管理 </span></span><br><span class="line">			delegate.init(getFilterConfig());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> delegate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="10-spring-整合-Shiro-之注册"><a href="#10-spring-整合-Shiro-之注册" class="headerlink" title="10 spring 整合 Shiro 之注册"></a>10 spring 整合 Shiro 之注册</h1><blockquote>
<p>密码使用 md5 方式加密</p>
</blockquote>
<h3 id="表单序列化"><a href="#表单序列化" class="headerlink" title="表单序列化"></a>表单序列化</h3><p>使用该操作，可以直接获取表单数据，简化操作。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery-1.7.2.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> &gt;</span></span><br><span class="line"><span class="javascript">		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		 	$(<span class="string">"#btn"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		 		$.ajax(&#123;</span></span><br><span class="line"><span class="javascript">		 			url:<span class="string">"/user/register"</span>,</span></span><br><span class="line"><span class="javascript">		 			type:<span class="string">"POST"</span>,</span></span><br><span class="line"><span class="javascript">		 			data:$(<span class="string">"#myForm"</span>).serialize(),<span class="comment">//表单序列化，传递表单数据</span></span></span><br><span class="line"><span class="javascript">		 			success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line">		 				alert(data);</span><br><span class="line">		 			&#125;</span><br><span class="line">		 		&#125;);</span><br><span class="line">		 	&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="md5加密"><a href="#md5加密" class="headerlink" title="md5加密"></a>md5加密</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">userRegister</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//使用 md5 加密用户的密码，并使用用户名作为 salt 值</span></span><br><span class="line">    Md5Hash newPassword = </span><br><span class="line">        <span class="keyword">new</span> Md5Hash(user.getPassword(),user.getUsername(), <span class="number">2</span>);</span><br><span class="line">    user.setPassword(newPassword.toString());</span><br><span class="line">    user.setSalt(user.getUsername());</span><br><span class="line">    <span class="keyword">return</span> userMapper.insertUser(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="9-实现菜单授权"><a href="#9-实现菜单授权" class="headerlink" title="9 实现菜单授权"></a>9 实现菜单授权</h1><h1 id="11-SessionMapper-的使用"><a href="#11-SessionMapper-的使用" class="headerlink" title="11 SessionMapper 的使用"></a>11 SessionMapper 的使用</h1><p>sessionMamanager 会话管理器管理着应用中所有的 Subject 的会话的创建、维护、删除、失效、验证等工作。</p>
<p>Shiro 提供了三个默认实现类：</p>
<table>
<thead>
<tr>
<th>类名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>DefaultSessionManager</td>
<td>用于 JavaSE 环境</td>
</tr>
<tr>
<td>ServletContainerSessionManager</td>
<td>用于 Web  环境，直接使用 tomcat 容器管理对象</td>
</tr>
<tr>
<td>DefaultWebSessionManager</td>
<td>用于Web 环境，替代 类名功能DefaultSessionManager用于 JavaSE 环境ServletContainerSessionManager，自己维护会话。</td>
</tr>
</tbody></table>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册 sessionManager  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionManager"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.session.mgt.DefaultSessionManager"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置 session 超时时间  ,以毫秒为单位 ms   1s 等于 1000ms --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"globalSessionTimeout"</span> <span class="attr">value</span>=<span class="string">"500000"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"deleteInvalidSessions"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="12-remeber-me-功能实现"><a href="#12-remeber-me-功能实现" class="headerlink" title="12   remeber me 功能实现"></a>12   remeber me 功能实现</h1><blockquote>
<p>即登录成功后，下次免登录</p>
</blockquote>
<h3 id="实现步骤-1"><a href="#实现步骤-1" class="headerlink" title="实现步骤"></a>实现步骤</h3><p>用户类即及其引用类的都需要序列化</p>
<p>修改页面 index .jsp</p>
<p>修改 Spring-shiro.xml</p>
<h1 id="13-Shiro-内置过滤器"><a href="#13-Shiro-内置过滤器" class="headerlink" title="13 Shiro 内置过滤器"></a>13 Shiro 内置过滤器</h1><h3 id="1-认证过滤器"><a href="#1-认证过滤器" class="headerlink" title="1 认证过滤器"></a>1 认证过滤器</h3><p>anon  authcBasic auchc user</p>
<h3 id="2-授权过滤器"><a href="#2-授权过滤器" class="headerlink" title="2 授权过滤器"></a>2 授权过滤器</h3><p>perms roles ssl  rest port </p>
<p><img src="http://www.zwer.xyz/picGo/20190515205815.png" alt></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"shiroFilter"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.web.ShiroFilterFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"securityManager"</span> <span class="attr">ref</span>=<span class="string">"securityManager"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"loginUrl"</span> <span class="attr">value</span>=<span class="string">"/user/login.do"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"successUrl"</span> <span class="attr">value</span>=<span class="string">"/user/loginSuccess.do"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"unauthorizedUrl"</span> <span class="attr">value</span>=<span class="string">"/jsp/refuse.jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置过滤器链属性 </span></span><br><span class="line"><span class="comment">       authc 认证过滤器,表示表单认证</span></span><br><span class="line"><span class="comment">       anon  放行，可以匿名访问，不需要认证</span></span><br><span class="line"><span class="comment">       user  用户过滤器，用于识别当前用户是否登录并保存密码  RememberMe</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filterChainDefinitions"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">            /user/login.do=authc </span><br><span class="line">            /user/loginSuccess.do=user</span><br><span class="line">            /menu/showMenu.do=user</span><br><span class="line">            /**=anon</span><br><span class="line">        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><p>使用 Shiro 框架做用户登录的时候，若登录成功后，在使用浏览器回来之前的登录界面，这时就登录不上了，不仅是使用之前登录的账号，还是其他账号。</p>
<p>推测：可能是同一 浏览器登录后存在 cookie ，影响用户的二次登录。</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/11/20190511 RBAC 用户权限控制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/11/20190511 RBAC 用户权限控制/" class="post-title-link" itemprop="url">20190511 RBAC</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-11 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-11T00:00:00+08:00">2019-05-11</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-14 08:08:54" itemprop="dateModified" datetime="2019-05-14T08:08:54+08:00">2019-05-14</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-RBAC-简介"><a href="#1-RBAC-简介" class="headerlink" title="1 RBAC 简介"></a>1 RBAC 简介</h1><blockquote>
<p>RBAC（Role-Based Access Contrl ）基于角色的访问控制。</p>
<p>RBAC 认为权限的过程可以抽象概括为：</p>
<p>判断 【 Who 是否 可以对 What 进行 How 的访问 操作（Operation）】</p>
<p>who： 权限的拥有者或者主题</p>
<p>What ： 权限针对的对象或者资源</p>
<p>How： 具体的权限</p>
<p>Operator ：操作：表示对 What 的 How 操作。 也就是 Privilege + Resource </p>
<p>Role： 角色：，一定数量的权限的集合。权限的分配的单位与载体。</p>
<p>目的：隔离 User  与 Privilege 的逻辑关系</p>
<p>应用场景： OA 系统、后台系统</p>
</blockquote>
<h2 id="1-1-RBAC-96"><a href="#1-1-RBAC-96" class="headerlink" title="1.1 RBAC 96"></a>1.1 RBAC 96</h2><blockquote>
<p>RBAC 模型，RBAC 96 模型中有 RBAC0~3</p>
<p>其中RBAC0 已经满足目前的权限控制</p>
</blockquote>
<h3 id="RBAC0"><a href="#RBAC0" class="headerlink" title="RBAC0"></a>RBAC0</h3><p>定义了能构成一个 RBAC 控制系统的最小的元素集合</p>
<p>1、 用户 User</p>
<p>2、角色 Role </p>
<p>3、许可 Permission</p>
<p>4、 会话 Session</p>
<p><img src="http://www.zwer.xyz/picGo/20190512104815.png" alt></p>
<p>UA   User Assignment : 用户角色分配。</p>
<p>PA Permission Assignment 角色许可分配</p>
<h3 id="RBAC1、RABC2、RBAC3"><a href="#RBAC1、RABC2、RBAC3" class="headerlink" title="RBAC1、RABC2、RBAC3"></a>RBAC1、RABC2、RBAC3</h3><p>RBAC1 在 RBAC0 的基础上增加继承关系，一个角色可以继承其他角色的权限 Permission</p>
<p>RBAC2 在 RBAC1 的基础上增加责任分离关系（eg。财务：出纳和会计）</p>
<p>RBAC3 结合了 RBAC0 和 RBAC1 ，既提供了角色间的继承关系和责任分离关系</p>
<h1 id="2-RBAC0-实战"><a href="#2-RBAC0-实战" class="headerlink" title="2 RBAC0 实战"></a>2 RBAC0 实战</h1><h2 id="2-1-需求分析与数据库设计"><a href="#2-1-需求分析与数据库设计" class="headerlink" title="2.1 需求分析与数据库设计"></a>2.1 需求分析与数据库设计</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>​    实现用户登录功能</p>
<p>​    使用 RBAC0 模型管理系统权限</p>
<p>​    对系统的菜单以及菜单中选项</p>
<p>​    </p>
<h3 id="技术选择"><a href="#技术选择" class="headerlink" title="技术选择"></a>技术选择</h3><p>​    框架：SSM ：SpringMVC+Spring+Mybatis</p>
<p>​    数据库：Mysql</p>
<h3 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h3><p><img src="http://www.zwer.xyz/picGo/20190512110138.png" alt></p>
<h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><p>用户表、角色表、菜单表、菜单角色中间表、功能表</p>
<h4 id="动态菜单实现"><a href="#动态菜单实现" class="headerlink" title="动态菜单实现"></a>动态菜单实现</h4><p>使用菜单表</p>
<h3 id="SSM-框架整合"><a href="#SSM-框架整合" class="headerlink" title="SSM 框架整合"></a>SSM 框架整合</h3><p>WEB-INF 目录下的资源只有服务器可以访问，客户端是无法直接访问的。</p>
<p>把 Spring 配置文件分离提高配置文件的可读性、方便查找位置。</p>
<p>定义 pojo类，以及类中的属性关联关系 </p>
<p>编写 mapper 映射文件</p>
<p>自定义异常，继承运行时异常，在业务层抛出</p>
<h3 id="页面布局"><a href="#页面布局" class="headerlink" title="页面布局"></a>页面布局</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>主页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">			 总体的布局 头 header 中间 center 尾部 footer </span></span><br><span class="line"><span class="comment">			注意：使用 frameset 和 frame 标签是不可以使用在它们标签的外面使用 body 标签</span></span><br><span class="line"><span class="comment">			否则：页面不显示</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">frameset</span> <span class="attr">rows</span>=<span class="string">"20%,*,10%"</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">   			<span class="comment">&lt;!-- 头部 --&gt;</span></span><br><span class="line">   			<span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">"header"</span> <span class="attr">scrolling</span>=<span class="string">"no"</span> <span class="attr">name</span>=<span class="string">"header"</span>&gt;</span></span><br><span class="line">   			</span><br><span class="line">   			<span class="comment">&lt;!-- 中间部分 --&gt;</span></span><br><span class="line">   			<span class="tag">&lt;<span class="name">frameset</span> <span class="attr">cols</span>=<span class="string">"20%,*"</span>&gt;</span></span><br><span class="line">   				<span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">"menu"</span> <span class="attr">scrolling</span>=<span class="string">"no"</span> <span class="attr">name</span>=<span class="string">"menu"</span>&gt;</span></span><br><span class="line">   				<span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">"body"</span> <span class="attr">scrolling</span>=<span class="string">"no"</span> <span class="attr">name</span>=<span class="string">"body"</span>&gt;</span></span><br><span class="line">   			<span class="tag">&lt;/<span class="name">frameset</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   			<span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">"footer"</span> <span class="attr">scrolling</span>=<span class="string">"no"</span> <span class="attr">name</span>=<span class="string">"header"</span>&gt;</span></span><br><span class="line">   		<span class="tag">&lt;/<span class="name">frameset</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-DTree"><a href="#2-2-DTree" class="headerlink" title="2.2 DTree"></a>2.2 DTree</h2><blockquote>
<p>用 js 开发的导航目录</p>
</blockquote>
<h3 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h3><h4 id="add"><a href="#add" class="headerlink" title="add()"></a>add()</h4><p>Adds a node to the tree.<br>Can only be called before the tree is drawn.</p>
<p>id, pid and name are required.</p>
<h4 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h4><table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>Number</td>
<td>Unique identity number.</td>
</tr>
<tr>
<td>pid</td>
<td>Number</td>
<td>Number refering to the parent node. The value for the root node has to be -1.</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>Text label for the node.</td>
</tr>
<tr>
<td>url</td>
<td>String</td>
<td>Url for the node.</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>Title for the node.</td>
</tr>
<tr>
<td>target</td>
<td>String</td>
<td>Target for the node.</td>
</tr>
<tr>
<td>icon</td>
<td>String</td>
<td>Image file to use as the icon. Uses default if not specified.</td>
</tr>
<tr>
<td>iconOpen</td>
<td>String</td>
<td>Image file to use as the open icon. Uses default if not specified.</td>
</tr>
<tr>
<td>open</td>
<td>Boolean</td>
<td>Is the node open.</td>
</tr>
</tbody></table>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mytree.add(1, 0, 'My node', 'node.html', 'node title', 'mainframe', 'img/musicfolder.gif');</span><br></pre></td></tr></table></figure>

<h3 id="添加菜单"><a href="#添加菜单" class="headerlink" title="添加菜单"></a>添加菜单</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="用户登录过滤器"><a href="#用户登录过滤器" class="headerlink" title="用户登录过滤器"></a>用户登录过滤器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest arg0, ServletResponse arg1,</span></span></span><br><span class="line"><span class="function"><span class="params">                     FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将 ServletRequest 对象强转为 HttpServletRequest 对象</span></span><br><span class="line">    HttpServletRequest req = (HttpServletRequest)arg0;</span><br><span class="line">    <span class="comment">//获取统一资源标识符</span></span><br><span class="line">    String uri = req.getRequestURI();</span><br><span class="line">    System.out.println(<span class="string">"uri: "</span>+uri);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据 URI 判断用户所访问的资源位置是否满足条件允许访问</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(uri.indexOf(<span class="string">"login"</span>) != -<span class="number">1</span> || uri.indexOf(<span class="string">"userLogin"</span>) != -<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">//对用户登录资源放行</span></span><br><span class="line">        chain.doFilter(arg0, arg1);</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">        User user = (User)req.getSession().getAttribute(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="keyword">null</span>)&#123;<span class="comment">//用户未登录</span></span><br><span class="line">            req.setAttribute(<span class="string">"error"</span>, <span class="string">"请先登录"</span>);</span><br><span class="line">            req.getRequestDispatcher(<span class="string">"login"</span>).forward(req, arg1);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;<span class="comment">//用户已登录</span></span><br><span class="line">            chain.doFilter(arg0, arg1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-权限管理"><a href="#2-3-权限管理" class="headerlink" title="2.3 权限管理"></a>2.3 权限管理</h2><h3 id="越级访问"><a href="#越级访问" class="headerlink" title="越级访问"></a>越级访问</h3><p>虽然 DTree 菜单管理可以实现不同角色下的用户的菜单不同，其他菜单下的功能可能没有在菜单栏中显示，但是用户可以猜测方式在浏览器地址栏上直接输入URI ，访问本身用户不能访问的资源或者功能。在黑客领域中，这样的操作叫做<strong>越级访问</strong>，简单来说就是用低级别的角色访问高级别的资源。</p>
<h3 id="用户基础资源管理"><a href="#用户基础资源管理" class="headerlink" title="用户基础资源管理"></a>用户基础资源管理</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">1</span>,<span class="string">'首页'</span>,<span class="string">'index'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">2</span>,<span class="string">'头页面'</span>,<span class="string">'header'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">3</span>,<span class="string">'菜单页面'</span>,<span class="string">'menu'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">4</span>,<span class="string">'操作页面'</span>,<span class="string">'body'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">5</span>,<span class="string">'底页面'</span>,<span class="string">'footer'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">6</span>,<span class="string">'错误页面'</span>,<span class="string">'error'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">7</span>,<span class="string">'角色错误页面'</span>,<span class="string">'roleerror'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">8</span>,<span class="string">'成功'</span>,<span class="string">'ok'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">100</span>,<span class="string">'添加用户页面'</span>,<span class="string">'addUser'</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">101</span>,<span class="string">'添加用户动作'</span>,<span class="string">'addUserDo'</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">102</span>,<span class="string">'查询用户页面'</span>,<span class="string">'findUser'</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">103</span>,<span class="string">'查询用户页面动作'</span>,<span class="string">'findUserDo'</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">104</span>,<span class="string">'显示用户页面'</span>,<span class="string">'showUser'</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">105</span>,<span class="string">'预更新用户动作'</span>,<span class="string">'preUpdateUserDo'</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">106</span>,<span class="string">'更新用户页面'</span>,<span class="string">'updateUser'</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">107</span>,<span class="string">'添加用户动作'</span>,<span class="string">'updateUserDo'</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">200</span>,<span class="string">'添加客户页面'</span>,<span class="string">'addCust'</span>,<span class="number">6</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">201</span>,<span class="string">'添加客户动作'</span>,<span class="string">'addCustDo'</span>,<span class="number">6</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">202</span>,<span class="string">'查询客户页面'</span>,<span class="string">'findCust'</span>,<span class="number">7</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">203</span>,<span class="string">'查询客户动作'</span>,<span class="string">'findCust'</span>,<span class="number">7</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">204</span>,<span class="string">'显示客户页面'</span>,<span class="string">'findCustDo'</span>,<span class="number">7</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">205</span>,<span class="string">'预更新客户动作'</span>,<span class="string">'preUpdateCust'</span>,<span class="number">7</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">206</span>,<span class="string">'更新客户页面'</span>,<span class="string">'updateCust'</span>,<span class="number">7</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">207</span>,<span class="string">'更新客户动作'</span>,<span class="string">'updateCustDo'</span>,<span class="number">7</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> fun <span class="keyword">value</span>(<span class="number">208</span>,<span class="string">'删除客户动作'</span>,<span class="string">'delCustDo'</span>,<span class="number">7</span>);</span><br></pre></td></tr></table></figure>

<h3 id="查询资源"><a href="#查询资源" class="headerlink" title="查询资源"></a>查询资源</h3><h4 id="修改查询-SQL-语句"><a href="#修改查询-SQL-语句" class="headerlink" title="修改查询 SQL 语句"></a>修改查询 SQL 语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> us.username,us.password,ro.*,me.* ,f.funurl</span><br><span class="line">		<span class="keyword">from</span> <span class="keyword">users</span> us </span><br><span class="line">		<span class="keyword">join</span> <span class="keyword">role</span> ro <span class="keyword">on</span> us.role_id = ro.role_id</span><br><span class="line">		<span class="keyword">join</span> role_menu rm <span class="keyword">on</span> ro.role_id = rm.role_id</span><br><span class="line">		<span class="keyword">join</span> menu me <span class="keyword">on</span> rm.menu_id  = me.menu_id</span><br><span class="line">		<span class="keyword">left</span> <span class="keyword">join</span> fun f <span class="keyword">on</span> me.menu_id = f.menu_id</span><br><span class="line">		<span class="keyword">where</span> us.username = <span class="comment">#&#123;username&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="修改-ResultMap"><a href="#修改-ResultMap" class="headerlink" title="修改 ResultMap"></a>修改 ResultMap</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.szxy.mapper.UserMapper"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置结果集映射 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"User"</span> <span class="attr">id</span>=<span class="string">"userMapper"</span> &gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 定义主键关联 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"password"</span> <span class="attr">column</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 属性关联， 一对多 </span></span><br><span class="line"><span class="comment">			 需要指定 javaType 的类型</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"role"</span> <span class="attr">javaType</span>=<span class="string">"Role"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"roleid"</span> <span class="attr">column</span>=<span class="string">"role_id"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"rolename"</span> <span class="attr">column</span>=<span class="string">"role_name"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 属性关联 多对一 </span></span><br><span class="line"><span class="comment">			 需要指定 ofType 类型</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"menus"</span> <span class="attr">ofType</span>=<span class="string">"Menu"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"menuid"</span> <span class="attr">column</span>=<span class="string">"menu_id"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"menuame"</span> <span class="attr">column</span>=<span class="string">"menu_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"menuurl"</span> <span class="attr">column</span>=<span class="string">"menuurl"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"fatherid"</span> <span class="attr">column</span>=<span class="string">"father_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 属性关联  fun 表功能表 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"funs"</span> <span class="attr">ofType</span>=<span class="string">"Fun"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"funurl"</span> <span class="attr">column</span>=<span class="string">"funurl"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		parameterType 表示参数类型</span></span><br><span class="line"><span class="comment">		string 是 java.lang.String 的别名</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUserByName"</span> <span class="attr">parameterType</span>=<span class="string">"string"</span> <span class="attr">resultMap</span>=<span class="string">"userMapper"</span>&gt;</span></span><br><span class="line">		 	select us.username,us.password,ro.*,me.* ,f.funurl</span><br><span class="line">			from users us </span><br><span class="line">			join role ro on us.role_id = ro.role_id</span><br><span class="line">			join role_menu rm on ro.role_id = rm.role_id</span><br><span class="line">			join menu me on rm.menu_id  = me.menu_id</span><br><span class="line">			left join fun f on me.menu_id = f.menu_id</span><br><span class="line">			where us.username = #&#123;username&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="权限过滤器"><a href="#权限过滤器" class="headerlink" title="权限过滤器"></a>权限过滤器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest arg0, ServletResponse arg1,</span></span></span><br><span class="line"><span class="function"><span class="params">                     FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">    <span class="comment">//强转为 req 对象</span></span><br><span class="line">    HttpServletRequest req = (HttpServletRequest)arg0;</span><br><span class="line">    <span class="comment">//获取 URI </span></span><br><span class="line">    String uri = req.getRequestURI();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//放行静态资源</span></span><br><span class="line">    <span class="keyword">if</span>(uri.indexOf(<span class="string">"images"</span>) !=-<span class="number">1</span> || uri.indexOf(<span class="string">"js"</span>) !=-<span class="number">1</span>)&#123;</span><br><span class="line">        chain.doFilter(arg0, arg1);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(uri.indexOf(<span class="string">"login"</span>) != -<span class="number">1</span> || uri.indexOf(<span class="string">"userLogin"</span>) != -<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">//对用户登录资源放行</span></span><br><span class="line">            chain.doFilter(arg0, arg1);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//从 session 中获取 funs 获取当前用户的角色权限</span></span><br><span class="line">            User user = (User)req.getSession().getAttribute(<span class="string">"user"</span>);</span><br><span class="line">            <span class="comment">//获取 funs 集合</span></span><br><span class="line">            List&lt;Fun&gt; funs = user.getFuns();</span><br><span class="line">            <span class="comment">//判断 uri 是否存在与 funs 中的标志</span></span><br><span class="line">            <span class="keyword">boolean</span> flag = <span class="keyword">false</span>; </span><br><span class="line">            <span class="keyword">for</span> (Fun f : funs) &#123;</span><br><span class="line">                <span class="keyword">if</span>(uri.indexOf(f.getFunurl()) != -<span class="number">1</span>)&#123;</span><br><span class="line">                    flag = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(flag)&#123;<span class="comment">//允许用户访问当前资源</span></span><br><span class="line">                chain.doFilter(arg0, arg1);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//强转为 resp 对象</span></span><br><span class="line">                HttpServletResponse resp = (HttpServletResponse)arg1;</span><br><span class="line">                <span class="comment">//重定向</span></span><br><span class="line">                resp.sendRedirect(<span class="string">"roleerror"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><h2 id="WEB-INF简介"><a href="#WEB-INF简介" class="headerlink" title="WEB-INF简介"></a>WEB-INF简介</h2><p>WEB-INF是Java的WEB应用的<strong>安全目录</strong>。</p>
<p>所谓安全就是客户端无法访问，只有服务端可以访问的目录。</p>
<p>如果想在页面中直接访问其中的文件，</p>
<p>必须通过 web.xml 文件对要访问的文件进行相应映射才能访问。</p>
<h4 id="filter-中-lt-url-pattern-gt-的配置"><a href="#filter-中-lt-url-pattern-gt-的配置" class="headerlink" title="filter 中  &lt;url-pattern&gt; 的配置"></a>filter 中  <code>&lt;url-pattern&gt;</code> 的配置</h4><p>使用 <code>/*</code> 拦截所有请求，优先级高</p>
<h4 id="spring-配置文件-context-property-placeholder-标签"><a href="#spring-配置文件-context-property-placeholder-标签" class="headerlink" title="spring 配置文件 context:property-placeholder  标签"></a>spring 配置文件 context:property-placeholder  标签</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加载常量配置文件</span></span><br><span class="line"><span class="comment">   	 	   注意： context:property-placeholde 标签一个 spring.xml 整体只能有一个</span></span><br><span class="line"><span class="comment">   	 	  否侧报 Could not resolve placeholder。</span></span><br><span class="line"><span class="comment">   	 	  解决方法：若要一个整体的 spring 配置文件有多个  context:property-placeholde</span></span><br><span class="line"><span class="comment">   	 	  属性必须加上 ignore-unresolvable="true" </span></span><br><span class="line"><span class="comment">   	  --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:constants.properties"</span> <span class="attr">ignore-unresolvable</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/10/20190510 SSM框架整合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/10/20190510 SSM框架整合/" class="post-title-link" itemprop="url">20190510 SSM 框架整合</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-10 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-10T00:00:00+08:00">2019-05-10</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-11 14:50:39" itemprop="dateModified" datetime="2019-05-11T14:50:39+08:00">2019-05-11</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-框架环境搭建"><a href="#1-框架环境搭建" class="headerlink" title="1  框架环境搭建"></a>1  框架环境搭建</h1><p>需求 ：完成基金开户及购买功能</p>
<h2 id="1-1-配置-xml-文件"><a href="#1-1-配置-xml-文件" class="headerlink" title="1.1  配置 xml 文件"></a>1.1  配置 xml 文件</h2><blockquote>
<p>JdbcTemplate spring  框架中提供的模板类，简化 jdbc 的操作。</p>
</blockquote>
<h3 id="中文乱码问题"><a href="#中文乱码问题" class="headerlink" title="中文乱码问题"></a>中文乱码问题</h3><p>在 web.xml 添加过滤器 filter </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置编码过滤器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 必须设置为 true， 否则设置 utf-8 编码无效 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="注册-Spring-监听器"><a href="#注册-Spring-监听器" class="headerlink" title="注册 Spring 监听器"></a>注册 Spring 监听器</h3><p>spring 配置文件及路径 ContextLoaderListener</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置 spring 监听器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置 spring 配置文件的名称及位置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="注册-springmvc-中央调度器"><a href="#注册-springmvc-中央调度器" class="headerlink" title="注册 springmvc 中央调度器"></a>注册 springmvc 中央调度器</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- springmvc 配置 中央调度器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 指定 springmvc 配置文件名称及位置 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-2-完整-web-xml-配置"><a href="#1-2-完整-web-xml-配置" class="headerlink" title="1.2 完整 web.xml 配置"></a>1.2 完整 web.xml 配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>ssm-01-jdbc<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置 spring 监听器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置 spring 配置文件的名称及位置 --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置编码过滤器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="comment">&lt;!-- 必须设置为 true， 否则设置 utf-8 编码无效 --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- springmvc 配置 中央调度器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 指定 springmvc 配置文件名称及位置 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-3-spring-xml-配置"><a href="#1-3-spring-xml-配置" class="headerlink" title="1.3 spring.xml 配置"></a>1.3 spring.xml 配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 注册组件扫描器 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.service"</span>/&gt;</span></span><br><span class="line">     </span><br><span class="line">     <span class="comment">&lt;!-- 加载 jdbc 数据库配置文件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 加载 c3p0 数据源 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span>	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 注册 AccountDaoImpl  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.AccountDaoImpl"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 注册 FundDaoImpl  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"FundDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.FundDaoImpl"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-4-springmvc-xml-配置"><a href="#1-4-springmvc-xml-配置" class="headerlink" title="1.4  springmvc.xml 配置"></a>1.4  springmvc.xml 配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 放行静态资源 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/images/"</span> <span class="attr">mapping</span>=<span class="string">"/images/*"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/js/"</span> <span class="attr">mapping</span>=<span class="string">"/js/*"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 注册组件扫描器 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.handle"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 开启自动注解 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span>    </span><br><span class="line">    <span class="comment">&lt;!-- 开启视图解析器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span> &gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/jsp/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="2-SSM-整合"><a href="#2-SSM-整合" class="headerlink" title="2 SSM 整合"></a>2 SSM 整合</h1><h2 id="2-1-搭建环境"><a href="#2-1-搭建环境" class="headerlink" title="2.1  搭建环境"></a>2.1  搭建环境</h2><h4 id="导入-jar-包"><a href="#导入-jar-包" class="headerlink" title="导入 jar 包"></a>导入 jar 包</h4><p>asm-3.3.1.jar<br>cglib-2.2.2.jar<br>com.springsource.com.mchange.v2.c3p0-0.9.1.2.jar<br>com.springsource.org.aopalliance-1.0.0.jar<br>com.springsource.org.apache.commons.logging-1.1.1.jar<br>com.springsource.org.apache.log4j-1.2.15.jar<br>com.springsource.org.aspectj.weaver-1.6.8.RELEASE.jar<br>commons-logging-1.1.1.jar<br>jackson-annotations-2.5.0.jar<br>jackson-core-2.5.0.jar<br>jackson-databind-2.5.0.jar<br>javassist-3.17.1-GA.jar<br>junit-4.9.jar<br>log4j-1.2.17.jar<br>log4j-api-2.0-rc1.jar<br>log4j-core-2.0-rc1.jar<br>mybatis-3.2.7.jar<br>mybatis-spring-1.2.3.jar<br>mysql-connector-java-5.1.30.jar<br>slf4j-api-1.7.5.jar<br>slf4j-log4j12-1.7.5.jar<br>spring-aop-4.1.6.RELEASE.jar<br>spring-aspects-4.1.6.RELEASE.jar<br>spring-beans-4.1.6.RELEASE.jar<br>spring-context-4.1.6.RELEASE.jar<br>spring-context-support-4.1.6.RELEASE.jar<br>spring-core-4.1.6.RELEASE.jar<br>spring-expression-4.1.6.RELEASE.jar<br>spring-jdbc-4.1.6.RELEASE.jar<br>spring-orm-4.1.6.RELEASE.jar<br>spring-tx-4.1.6.RELEASE.jar<br>spring-web-4.1.6.RELEASE.jar<br>spring-webmvc-4.1.6.RELEASE.jar</p>
<h4 id="修改-spring-xml-配置文件"><a href="#修改-spring-xml-配置文件" class="headerlink" title="修改 spring.xml 配置文件"></a>修改 spring.xml 配置文件</h4><ul>
<li><p>采用 spring 默认数据源 </p>
<p>DriverManagerDataSource</p>
</li>
<li><p>注册 SqlSessionFactoryBean         </p>
<p>sqlsesison 工厂，依赖于数据源</p>
</li>
<li><p>注册 MapperScannerConfigurer  </p>
<p> 获取mapper 代理对象，依赖于sqlSessionFactory  指定basepackage</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 注册组件扫描器 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.service"</span>/&gt;</span></span><br><span class="line">     </span><br><span class="line">     <span class="comment">&lt;!-- 加载 jdbc 数据库配置文件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 加载 c3p0 数据源 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	&lt;bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"&gt;</span></span><br><span class="line"><span class="comment">		&lt;property name="driverClass" value="$&#123;jdbc.driver&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     	&lt;property name="jdbcUrl" value="$&#123;jdbc.url&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     	&lt;property name="user" value="$&#123;jdbc.username&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     	&lt;property name="password" value="$&#123;jdbc.password&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	&lt;/bean&gt;	</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- spring 默认数据源 --&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">	 		</span><br><span class="line">	 		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	 				Property 'driverClassName' threw exception; nested exception is java.lang.IllegalStateException: Could not load JDBC driver class [$&#123;jdbc.driver&#125;]</span></span><br><span class="line"><span class="comment">	 		 --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///test"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	 		&lt;property name="driverClassName" value="$&#123;jdbc.driver&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	 		&lt;property name="url" value="$&#123;jdbc.url&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	 		&lt;property name="username" value="$&#123;jdbc.username&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	 		&lt;property name="password" value="$&#123;jdbc.password&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	 		 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- 注册 Mybatis 中 SqlSessionFactory  --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span>  <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- 指定数据源 --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- 指定 mybatis 配置文件的位置 --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- 获取Mapper 代理对象 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.szxy.mapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="添加-MyBatis-xml-配置文件"><a href="#添加-MyBatis-xml-配置文件" class="headerlink" title="添加 MyBatis.xml  配置文件"></a>添加 MyBatis.xml  配置文件</h4><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">  PUBLIC <span class="string">"-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line">  <span class="string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 设置 M<span class="function"><span class="title">ybatis</span> 对 Log4J 的支持  --&gt;</span></span><br><span class="line">	&lt;settings&gt;</span><br><span class="line">		&lt;setting <span class="keyword">name</span>=<span class="string">"logImpl"</span> value=<span class="string">"LOG4J"</span>/&gt;</span><br><span class="line">	&lt;/settings&gt;</span><br><span class="line">	&lt;!--  设置 <span class="function"><span class="title">pojo</span>类的别名   减少 mapper.xml文件的书写量，不用写包名+类名，直接写类名 --&gt;</span></span><br><span class="line">	&lt;typeAliases&gt;</span><br><span class="line">		&lt;package <span class="keyword">name</span>=<span class="string">"com.szxy.pojo"</span>/&gt;</span><br><span class="line">	&lt;/typeAliases&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 扫描配置文件  --&gt;</span><br><span class="line">	&lt;mappers&gt;</span><br><span class="line">		&lt;package <span class="keyword">name</span>=<span class="string">"com.szxy.mapper"</span>/&gt;</span><br><span class="line">		&lt;!-- &lt;<span class="function"><span class="title">mapper</span> resource="cn/szxy/mapper/StudentMapper.xml"/&gt; --&gt;</span></span><br><span class="line">	&lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h4 id="添加-Mapper-xml-配置文件"><a href="#添加-Mapper-xml-配置文件" class="headerlink" title="添加 **Mapper.xml 配置文件"></a>添加 **Mapper.xml 配置文件</h4><ul>
<li>AccountMappe.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.szxy.mapper.AccountMapper"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	 <span class="comment">&lt;!-- 添加账户信息 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertAccount"</span>&gt;</span></span><br><span class="line">	 		insert into account(acount,money) values(#&#123;aname&#125;,#&#123;balance&#125;)</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateAccount"</span>&gt;</span></span><br><span class="line">	 		update account set money = money - #&#123;balance&#125; where acount = #&#123;aname&#125;</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>FundMapper.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.szxy.mapper.FundMapper"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	&lt;resultMap type="clazz" id="cmap"&gt;</span></span><br><span class="line"><span class="comment">		&lt;id column="cid" property="cid"/&gt;</span></span><br><span class="line"><span class="comment">		&lt;result column="cname" property="cname"/&gt;</span></span><br><span class="line"><span class="comment">		&lt;result column="croom" property="croom"/&gt;</span></span><br><span class="line"><span class="comment">	 	&lt;collection property="students" select="cn.szxy.mapper.StudentMapper.selByCId" column="cid" /&gt;</span></span><br><span class="line"><span class="comment">	&lt;/resultMap&gt;</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	&lt;select id="selAll"&gt;</span></span><br><span class="line"><span class="comment">		select</span></span><br><span class="line"><span class="comment">		c.id cid,c.name cname,c.room croom </span></span><br><span class="line"><span class="comment">	   from t_class c  </span></span><br><span class="line"><span class="comment">	&lt;/select&gt;</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- 添加账户信息 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertFund"</span>&gt;</span></span><br><span class="line">	 		insert into fund(fname,count) values(#&#123;fname&#125;,#&#123;count&#125;)</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateFund"</span>&gt;</span></span><br><span class="line">	 		update fund set count = count + #&#123;count&#125; where fname = #&#123;fname&#125;</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-修改-mybatis-xml-部分文件"><a href="#2-2-修改-mybatis-xml-部分文件" class="headerlink" title="2.2 修改 mybatis.xml 部分文件"></a>2.2 修改 mybatis.xml 部分文件</h2><ul>
<li>mybatis.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 设置 Mybatis 对 Log4J 的支持  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"logImpl"</span> <span class="attr">value</span>=<span class="string">"LOG4J"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--  设置 pojo类的别名   减少 mapper.xml文件的书写量，不用写包名+类名，直接写类名 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	&lt;typeAliases&gt;</span></span><br><span class="line"><span class="comment">		&lt;package name="com.szxy.pojo"/&gt;</span></span><br><span class="line"><span class="comment">	&lt;/typeAliases&gt;</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 扫描配置文件  --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	&lt;mappers&gt;</span></span><br><span class="line"><span class="comment">		&lt;package name="com.szxy.mapper"/&gt;</span></span><br><span class="line"><span class="comment">		&lt;mapper resource="cn/szxy/mapper/StudentMapper.xml"/&gt;</span></span><br><span class="line"><span class="comment">	&lt;/mappers&gt;</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>spring.xml 增加部分</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册 Mybatis 中 SqlSessionFactory  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span>  <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 mybatis 配置文件的位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 替换 mybatis.xml 下的 typeAliases 标签 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliasesPackage"</span> <span class="attr">value</span>=<span class="string">"com.szxy.pojo"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 获取Mapper 代理对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 替换 mybatis.xml 下的 mappers 标签，作用是扫描配置文件  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.szxy.mapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="3-源码分析"><a href="#3-源码分析" class="headerlink" title="3  源码分析"></a>3  源码分析</h1><blockquote>
<p>Eclipse 小技巧：</p>
<p>通过<code>Ctrl+O</code>查看当前类或者 接口的方法</p>
<p> 通过 Ctrl + T 查看当前类或者 接口 继承实现关系</p>
</blockquote>
<h2 id="3-1-ContextLoadListener-类"><a href="#3-1-ContextLoadListener-类" class="headerlink" title="3.1 ContextLoadListener 类"></a>3.1 ContextLoadListener 类</h2><ul>
<li>web.xml </li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	配置 spring 监听器，监听 ServletContext，</span></span><br><span class="line"><span class="comment">	当其初始化时，创建 spring 容器对象，</span></span><br><span class="line"><span class="comment">		并且将 spring</span></span><br><span class="line"><span class="comment"> 	容器对象放入 ServletContext 作用域中</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span></span><br><span class="line">        	org.springframework.web.context.ContextLoaderListener</span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ContextLoader.class 中部分源码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> WebApplicationContext <span class="title">initWebApplicationContext</span><span class="params">(ServletContext servletContext)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (servletContext.getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE) != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">					<span class="string">"Cannot initialize context because there is already a root application context present - "</span> +</span><br><span class="line">					<span class="string">"check whether you have multiple ContextLoader* definitions in your web.xml!"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Log logger = LogFactory.getLog(ContextLoader.class);</span><br><span class="line">		servletContext.log(<span class="string">"Initializing Spring root WebApplicationContext"</span>);</span><br><span class="line">		<span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">			logger.info(<span class="string">"Root WebApplicationContext: initialization started"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// Store context in local instance variable, to guarantee that</span></span><br><span class="line">			<span class="comment">// it is available on ServletContext shutdown.</span></span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>.context == <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">this</span>.context = createWebApplicationContext(servletContext);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>.context <span class="keyword">instanceof</span> ConfigurableWebApplicationContext) &#123;</span><br><span class="line">				ConfigurableWebApplicationContext cwac = (ConfigurableWebApplicationContext) <span class="keyword">this</span>.context;</span><br><span class="line">				<span class="keyword">if</span> (!cwac.isActive()) &#123;</span><br><span class="line">					<span class="comment">// The context has not yet been refreshed -&gt; provide services such as</span></span><br><span class="line">					<span class="comment">// setting the parent context, setting the application context id, etc</span></span><br><span class="line">					<span class="keyword">if</span> (cwac.getParent() == <span class="keyword">null</span>) &#123;</span><br><span class="line">						<span class="comment">// The context instance was injected without an explicit parent -&gt;</span></span><br><span class="line">						<span class="comment">// determine parent for root web application context, if any.</span></span><br><span class="line">						ApplicationContext parent = loadParentContext(servletContext);</span><br><span class="line">						cwac.setParent(parent);</span><br><span class="line">					&#125;</span><br><span class="line">					configureAndRefreshWebApplicationContext(cwac, servletContext);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, <span class="keyword">this</span>.context);</span><br></pre></td></tr></table></figure>

<p>ContextLoadListener  类继承了 ContextLoader 类并且实现了 ServletContextListener 接口。</p>
<p>当 ServletContext 应用 application 上下文创建时，监听 ServletContext初始化</p>
<p>调用 public void contextInitialized(ServletContextEvent event) 方法</p>
<p>再在该 contextInitialized 方法 调用父类 ContextLoader 中</p>
<p> initWebApplicationContext(ServletContext servletContext)  方法</p>
<p>为spring 容器初始化，然后放入 Servletcontext 中。</p>
<h2 id="3-2-DriverManagerDataSource-类"><a href="#3-2-DriverManagerDataSource-类" class="headerlink" title="3.2 DriverManagerDataSource 类"></a>3.2 DriverManagerDataSource 类</h2><ul>
<li>spring.xml 部分 </li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">      Property 'driverClassName' threw exception; nested exception is java.lang.IllegalStateException: Could not load JDBC driver class [$&#123;jdbc.driver&#125;]</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///test"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    &lt;property name="driverClassName" value="$&#123;jdbc.driver&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">    &lt;property name="url" value="$&#123;jdbc.url&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">    &lt;property name="username" value="$&#123;jdbc.username&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">    &lt;property name="password" value="$&#123;jdbc.password&#125;"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>DriverManagerDataSource  类继承了 AbstractDriverBasedDataSource  父类</p>
<p>在 DriverManagerDataSource  类中可以找到 </p>
<p>public void setDriverClassName(String driverClassName) 方法，</p>
<p>用于 spring 通过设值注入到 属性 driverClassName 。 </p>
<p>在它父类 AbstractDriverBasedDataSource    类中，有 属性 url、username、password</p>
<p>并提供了 setter 方法。</p>
<h2 id="3-3-SqlSessionFactoryBean-与-MapperScannerConfigurer"><a href="#3-3-SqlSessionFactoryBean-与-MapperScannerConfigurer" class="headerlink" title="3.3  SqlSessionFactoryBean 与  MapperScannerConfigurer"></a>3.3  SqlSessionFactoryBean 与  MapperScannerConfigurer</h2><blockquote>
<p>配置属性通过到源码中找到对应  setter 方法即可。</p>
</blockquote>
<ul>
<li>spring.xml 配置文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册 Mybatis 中 SqlSessionFactory  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span>  <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 mybatis 配置文件的位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 获取Mapper 代理对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.szxy.mapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="BUG"><a href="#BUG" class="headerlink" title="BUG"></a>BUG</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">      Property 'driverClassName' threw exception; nested exception is java.lang.IllegalStateException: Could not load JDBC driver class [$&#123;jdbc.driver&#125;]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">       上述出错的原因是 ： 		</span></span><br><span class="line"><span class="comment">       之前的用过这个 sqlSessionFactory ，报错</span></span><br><span class="line"><span class="comment">       &lt;property name="sqlSessionFactory" ref="sqlSessionFactory"&gt;&lt;/property&gt; </span></span><br><span class="line"><span class="comment">        改用 sqlSessionFactoryBeanName 就可以使用配置文件 db.properties </span></span><br><span class="line"><span class="comment">       &lt;property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">    &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">    &lt;property name="url" value="jdbc:mysql:///test"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">    &lt;property name="username" value="root"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">    &lt;property name="password" value="root"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/08/20190508 SpringMVC 框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/08/20190508 SpringMVC 框架/" class="post-title-link" itemprop="url">20190508 SpringMVC 框架</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-08 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-08T00:00:00+08:00">2019-05-08</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-10 11:59:48" itemprop="dateModified" datetime="2019-05-10T11:59:48+08:00">2019-05-10</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Spring-MVC-概念"><a href="#1-Spring-MVC-概念" class="headerlink" title="1 Spring MVC 概念"></a>1 Spring MVC 概念</h1><blockquote>
<p>SpringMVC 是 Spring 框架中一部分（子框架），是实现对 Servlet 技术进行封装。</p>
</blockquote>
<h2 id="1-1-MVC-介绍"><a href="#1-1-MVC-介绍" class="headerlink" title="1.1 MVC 介绍"></a>1.1 MVC 介绍</h2><p>MVC 全名是 Model View Controller  ，是模型 视图 控制的缩写，是一种软件设计典范，是一种软件架构设计分层模式</p>
<p>Model 模型 是应用程序中用于<strong>处理数据</strong>逻辑部分‘</p>
<p>View 视图 是应用程序<strong>处理数据</strong>显示的部分’</p>
<p>Controller 控制器 是应用程序处理<strong>用户交互</strong>的部分‘</p>
<p>例子： JSP + Servlet + Bean   分层开发</p>
<h2 id="1-2-SpringMVC-运行原理"><a href="#1-2-SpringMVC-运行原理" class="headerlink" title="1.2 SpringMVC 运行原理"></a>1.2 SpringMVC 运行原理</h2><p>Dispatherservlet  中央控制器</p>
<h2 id="1-3-第一个SpringMVC-项目"><a href="#1-3-第一个SpringMVC-项目" class="headerlink" title="1.3 第一个SpringMVC 项目"></a>1.3 第一个SpringMVC 项目</h2><ol>
<li><p>新建JavaWeb 工程 ，导入 jar包 </p>
<p>com.springsource.com.mchange.v2.c3p0-0.9.1.2.jar<br>com.springsource.org.aopalliance-1.0.0.jar<br>com.springsource.org.apache.commons.logging-1.1.1.jar<br>com.springsource.org.apache.log4j-1.2.15.jar<br>com.springsource.org.aspectj.weaver-1.6.8.RELEASE.jar<br>junit-4.9.jar<br>mysql-connector-java-5.1.30.jar<br>spring-aop-4.1.6.RELEASE.jar<br>spring-aspects-4.1.6.RELEASE.jar<br>spring-beans-4.1.6.RELEASE.jar<br>spring-context-4.1.6.RELEASE.jar<br>spring-context-support-4.1.6.RELEASE.jar<br>spring-core-4.1.6.RELEASE.jar<br>spring-expression-4.1.6.RELEASE.jar<br>spring-jdbc-4.1.6.RELEASE.jar<br>spring-tx-4.1.6.RELEASE.jar<br>spring-web-4.1.6.RELEASE.jar<br>spring-webmvc-4.1.6.RELEASE.jar</p>
</li>
</ol>
<ol start="2">
<li><p>编写 web.xml ，配置中央调度器</p>
<p>注意：配置中央调度器中 springmvc.xml 文件的配置</p>
</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;web-app xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> xmlns=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> xsi:schemaLocation=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> id=<span class="string">"WebApp_ID"</span> version=<span class="string">"3.0"</span>&gt;</span><br><span class="line"></span><br><span class="line">	  &lt;!-- 配置 SpringMVC 中央控制器 --&gt;</span><br><span class="line">	  &lt;servlet&gt;</span><br><span class="line">	  		&lt;servlet-name&gt;SpringMVC&lt;/servlet-name&gt;</span><br><span class="line">	  	 	&lt;servlet-<span class="class"><span class="keyword">class</span>&gt;<span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">servlet</span>.<span class="title">DispatcherServlet</span>&lt;/<span class="title">servlet</span>-<span class="title">class</span>&gt;</span></span><br><span class="line"><span class="class">	  	 	&lt;!-- 配置<span class="title">SpringMVC</span>.<span class="title">xml</span> 的位置及名称 --&gt;</span></span><br><span class="line"><span class="class">	  	 	&lt;<span class="title">init</span>-<span class="title">param</span>&gt;</span></span><br><span class="line"><span class="class">	  	 		&lt;<span class="title">param</span>-<span class="title">name</span>&gt;<span class="title">contextConfigLocation</span>&lt;/<span class="title">param</span>-<span class="title">name</span>&gt;</span></span><br><span class="line">	  	 		&lt;param-value&gt;classpath:SpringMVC.xml&lt;/param-value&gt;</span><br><span class="line">	  	 	&lt;/init-param&gt;</span><br><span class="line">	  &lt;/servlet&gt;</span><br><span class="line">	  &lt;servlet-mapping&gt;</span><br><span class="line">	  		&lt;servlet-name&gt;SpringMVC&lt;/servlet-name&gt;</span><br><span class="line">	  		&lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">	  &lt;/servlet-mapping&gt;</span><br><span class="line">	  </span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>编写 后台控制器</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.Controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> <span class="keyword">implements</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleRequest</span><span class="params">(HttpServletRequest req,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse resp)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">			<span class="comment">//创建 ModelAndView 对象</span></span><br><span class="line">			ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">			<span class="comment">//添加响应信息</span></span><br><span class="line">			mv.addObject(<span class="string">"msg"</span>, <span class="string">"HelloWorld"</span>);</span><br><span class="line">			<span class="comment">//设置逻辑视图</span></span><br><span class="line">			mv.setViewName(<span class="string">"/jsp/index.jsp"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>编写  springmvc.xml 中注册 bean</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 注册 MyController --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"/*.do"</span> <span class="attr">class</span>=<span class="string">"com.szxy.controller.MyController"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>编写 jsp </li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>My JSP 'index.jsp' starting page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"pragma"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"cache-control"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"expires"</span> <span class="attr">content</span>=<span class="string">"0"</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"keywords"</span> <span class="attr">content</span>=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">"This is my page"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	&lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    	$&#123;msg&#125;  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-4-web-xml-中urlpathern-问题"><a href="#1-4-web-xml-中urlpathern-问题" class="headerlink" title="1.4  web.xml 中urlpathern 问题"></a>1.4  web.xml 中urlpathern 问题</h2><ul>
<li><p>配置 / 与 配置 /* 的区别</p>
<p>/ 拦截某个路径下的所有资源</p>
<p>/* 拦截所有资源包括静态资源</p>
</li>
<li><p>静态资源无法访问的问题</p>
</li>
</ul>
<ol>
<li>第一种解决方案</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	  <span class="comment">&lt;!-- 第一种解决方案 --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.png<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>		</span><br><span class="line">	  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.js<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>		</span><br><span class="line">	  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.css<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>		</span><br><span class="line">		</span><br><span class="line">	  <span class="comment">&lt;!-- 配置 SpringMVC 中央控制器 --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	  	 	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">	  	 	<span class="comment">&lt;!-- 配置SpringMVC.xml 的位置及名称 --&gt;</span></span><br><span class="line">	  	 	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">	  	 		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">	  	 		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:SpringMVC.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	  	 	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	  </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>第二种解决方案</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	第二种 解决方案 </span></span><br><span class="line"><span class="comment">	在 springmvc.xml 文件中添加下面的标签 	</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>第三种解决方案</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第三种 解决方案 </span></span><br><span class="line"><span class="comment">	 在springmvc.xml 文件指定静态的位置及映射</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/images/"</span> <span class="attr">mapping</span>=<span class="string">"/images/**"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="2-SpringMVC-注解开发"><a href="#2-SpringMVC-注解开发" class="headerlink" title="2  SpringMVC 注解开发"></a>2  SpringMVC 注解开发</h1><h2 id="2-1-搭建环境"><a href="#2-1-搭建环境" class="headerlink" title="2.1 搭建环境"></a>2.1 搭建环境</h2><p>后台控制器不需要实现 Ctroller 接口，添加相应的注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//访问路径  http://localhost:8080/mvc/springmvc/hander</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  使用注解后台控制器</span></span><br><span class="line"><span class="comment"> *	不需要实现 Contrller 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span>  	<span class="comment">//将该后台控制器交给 spring 容器管理</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/springmvc"</span>)   <span class="comment">//指定命令空间</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/hander"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleRequest</span><span class="params">(HttpServletRequest req,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse resp)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">			<span class="comment">//创建 ModelAndView 对象</span></span><br><span class="line">			ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">			<span class="comment">//添加响应信息</span></span><br><span class="line">			mv.addObject(<span class="string">"msg"</span>, <span class="string">"HelloWorld"</span>);</span><br><span class="line">			<span class="comment">//设置逻辑视图</span></span><br><span class="line">			mv.setViewName(<span class="string">"/jsp/index.jsp"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 配置 springmvc.xml 文档</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 开启组件扫描器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 开启注解驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-视图解析器"><a href="#2-2-视图解析器" class="headerlink" title="2.2   视图解析器"></a>2.2   视图解析器</h2><ul>
<li>springmvc.xml 配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 开启组件扫描器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 开启注解驱动 </span></span><br><span class="line"><span class="comment">    	 自动注册 适配器、处理器</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span>  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 注册视图解析器</span></span><br><span class="line"><span class="comment">    	 由 springmvc 调用，故不需要 设置 id 属性</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> 	<span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/jsp/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>后台控制器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  使用注解后台控制器</span></span><br><span class="line"><span class="comment"> *	不需要实现 Contrller 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span>  	<span class="comment">//将该后台控制器交给 spring 容器管理</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/springmvc"</span>)   <span class="comment">//指定命令空间</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/hander"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-处理器方法常用的方法参数"><a href="#2-3-处理器方法常用的方法参数" class="headerlink" title="2.3 处理器方法常用的方法参数"></a>2.3 处理器方法常用的方法参数</h2><ul>
<li>HttpServletRequest</li>
<li>HttpServletResponse</li>
<li>HttpSession</li>
<li>用于承载数据的Model 、Map、ModelMap</li>
<li>请求中携带的参数</li>
</ul>
<h2 id="2-4-接受请求参数"><a href="#2-4-接受请求参数" class="headerlink" title="2.4 接受请求参数"></a>2.4 接受请求参数</h2><ul>
<li><h4 id="逐个接受请求参数"><a href="#逐个接受请求参数" class="headerlink" title="逐个接受请求参数"></a>逐个接受请求参数</h4><p>@RequestParam  在方法名前使用</p>
<p>应用场景：表示当表单属性名与方法参数名不一致的和接受集合方式的数据</p>
</li>
<li><h4 id="使用对象整体接受"><a href="#使用对象整体接受" class="headerlink" title="使用对象整体接受"></a>使用对象整体接受</h4><p>注意：对象属性名与表单属性名一致。</p>
</li>
<li><h4 id="以域属性接受（也就是属性对象）"><a href="#以域属性接受（也就是属性对象）" class="headerlink" title="以域属性接受（也就是属性对象）"></a>以域属性接受（也就是属性对象）</h4><p>注意：表单中域属性的属性名填写方式 对象名.属性名 pattern.name</p>
</li>
<li><h4 id="数组或集合的接受-PathVaiable"><a href="#数组或集合的接受-PathVaiable" class="headerlink" title="数组或集合的接受 @PathVaiable"></a>数组或集合的接受 @PathVaiable</h4><p>注意：以集合形式接受数据 (@RequestParam List<string>  arr)</string></p>
</li>
<li><h4 id="restful-风格传参-PathVaiable"><a href="#restful-风格传参-PathVaiable" class="headerlink" title="restful 风格传参  @PathVaiable"></a>restful 风格传参  @PathVaiable</h4><p>(地址栏路径上带有参数 /hello/zhangsan/3）</p>
<p>RequestMapping(“/hello/{name}/{age}”)</p>
<p>注意: 在控制器方法名参数名前加上 @PathVaiable</p>
</li>
<li><h4 id="接受-json-格式字符串-RequestBody"><a href="#接受-json-格式字符串-RequestBody" class="headerlink" title="接受 json 格式字符串 @RequestBody"></a>接受 json 格式字符串 @RequestBody</h4><p>pathContext.request.contextPath</p>
<p>contentType: application/json</p>
<p>JSON.stringify()   //将 json对象转为 json字符串</p>
<p>注意：要导入 json jar 包</p>
<p>jackson-annotations-2.5.0.jar<br>jackson-core-2.5.0.jar<br>jackson-databind-2.5.0.jar</p>
</li>
<li><h4 id="获取请求头的参数-RequestHeader"><a href="#获取请求头的参数-RequestHeader" class="headerlink" title="获取请求头的参数 @RequestHeader"></a>获取请求头的参数 @RequestHeader</h4></li>
</ul>
<ul>
<li>测试类-控制器</li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestHeader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.Star;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *	接受请求数据</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/mvc"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReceviceDataFormRequest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//逐个接受请求参数</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata0"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">getFormData0</span><span class="params">(String uname,<span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建 ModelAndView 对象</span></span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//添加响应信息</span></span><br><span class="line">		mv.addObject(<span class="string">"uname"</span>, uname);</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,age);</span><br><span class="line">		mv.setViewName(<span class="string">"showData"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//逐个接受请求参数2</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata1"</span>)    <span class="comment">//更正接受参数名称</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">getFormData1</span><span class="params">(@RequestParam(<span class="string">"uname"</span>)</span>String username,<span class="keyword">int</span> age)</span>&#123;</span><br><span class="line">		<span class="comment">//创建 ModelAndView 对象</span></span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//添加响应信息</span></span><br><span class="line">		mv.addObject(<span class="string">"uname"</span>, username);</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,age);</span><br><span class="line">		mv.setViewName(<span class="string">"showData"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//通过对象整体接受</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata2"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">getFormData2</span><span class="params">(Star star)</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建 ModelAndView 对象</span></span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//添加响应信息</span></span><br><span class="line">		mv.addObject(<span class="string">"uname"</span>, star.getUname());</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,star.getAge());</span><br><span class="line">		mv.setViewName(<span class="string">"showData"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//接受域属性数据</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata3"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">getFormData3</span><span class="params">(Star star)</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建 ModelAndView 对象</span></span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//添加响应信息</span></span><br><span class="line">		mv.addObject(<span class="string">"uname"</span>, star.getUname());</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,star.getAge());</span><br><span class="line">		mv.addObject(<span class="string">"pattern"</span>,star.getPattern().getName());</span><br><span class="line">		mv.setViewName(<span class="string">"showData"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//接受数组数据</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata4"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFormData4</span><span class="params">(String[] hobbys)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (String str : hobbys) &#123;</span><br><span class="line">			System.out.println(str);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//以集合方式接受多条数据</span></span><br><span class="line">	<span class="comment">//注意：使用集合</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata5"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFormData5</span><span class="params">(@RequestParam List&lt;String&gt; hobbys)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (String str : hobbys) &#123;</span><br><span class="line">			System.out.println(str);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//接受 restful 风格的数据  </span></span><br><span class="line">	<span class="comment">// /getFormData6/zhangsan/12</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata6/&#123;uname&#125;/&#123;age&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFormData6</span><span class="params">(@PathVariable String uname,@PathVariable <span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(uname+<span class="string">"\t"</span>+age);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//接受 json 格式字符串数据</span></span><br><span class="line">	<span class="comment">//注意：要导入 json jar包，不然包 415 服务器不能处理该类型的请求</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata7"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFormData7</span><span class="params">(@RequestBody Star star)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(star.getUname()+<span class="string">"\t"</span>+star.getAge());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 获取请求头信息</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/formdata8"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFormData8</span><span class="params">(@RequestHeader String host,@RequestHeader  String cookie)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(host+<span class="string">"\t"</span>+cookie);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>发送 ajax 请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery-1.7.2.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#btn"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="comment">// json 对象</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> varJson = &#123;</span></span><br><span class="line"><span class="javascript">						uname:<span class="string">"zhangsan"</span>,</span></span><br><span class="line">						age:31</span><br><span class="line">				&#125;;</span><br><span class="line">				</span><br><span class="line"><span class="javascript">				$.ajax(&#123;</span></span><br><span class="line"><span class="javascript">					url:<span class="string">"mvc/formdata7"</span>,</span></span><br><span class="line"><span class="javascript">					type:<span class="string">"POST"</span>,</span></span><br><span class="line"><span class="javascript">					contentType:<span class="string">"application/json"</span>, <span class="comment">//以 json格式发送请求</span></span></span><br><span class="line"><span class="javascript">					data:<span class="built_in">JSON</span>.stringify(varJson)  <span class="comment">//将 json 对象转为 json格式的字符串</span></span></span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h2 id="2-5-处理器方法返回值"><a href="#2-5-处理器方法返回值" class="headerlink" title="2.5 处理器方法返回值"></a>2.5 处理器方法返回值</h2><ul>
<li>ModelAndView  承载数据和跳转视图资源</li>
<li>String 返回值类型  </li>
<li>void 无返回值类型</li>
<li>Object  Object 返回值类型</li>
</ul>
<h4 id="String-类型返回值"><a href="#String-类型返回值" class="headerlink" title="String 类型返回值"></a>String 类型返回值</h4><ul>
<li>使用 Model 、 Map 、ModelMap 承载数据</li>
<li>直接返回 json 字符串，添加注解@ReponseBody</li>
</ul>
<h4 id="Obejct-类型返回值"><a href="#Obejct-类型返回值" class="headerlink" title="Obejct 类型返回值"></a>Obejct 类型返回值</h4><ul>
<li>注解@ResponseBody</li>
<li>注册 springmvc 驱动 </li>
<li>导入 jackson 包</li>
</ul>
<h4 id="解决中文乱码问题"><a href="#解决中文乱码问题" class="headerlink" title="解决中文乱码问题"></a>解决中文乱码问题</h4><p>​    在 @RequestMapping 注解中添加 produces = “text/html;charset=utf-8”</p>
<p>​    同时在方法前添加注解@ResponseBody</p>
<h4 id="ResponseBody-注解作用"><a href="#ResponseBody-注解作用" class="headerlink" title="@ResponseBody 注解作用"></a>@ResponseBody 注解作用</h4><ul>
<li><p>将当前方法的返回值放到响应体中，并转成 json 格式</p>
</li>
<li><p>接受 json 格式的字符串，将该注解放在方法名参数前</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.ModelMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/return"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReturningToView</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//使用 Model 、 Map 、 ModelMap 承载数据</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/sendData1"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String  <span class="title">sendData</span><span class="params">(String username,<span class="keyword">int</span> age,Model model,Map&lt;String,Integer&gt; map,ModelMap modelMap)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">			<span class="comment">//承载数据 </span></span><br><span class="line">			model.addAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">			map.put(<span class="string">"age"</span>, age);</span><br><span class="line">			modelMap.addAttribute(<span class="string">"age1"</span>, age);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"showData"</span>;  <span class="comment">//只写视图即可，前缀和后缀由视图解析器完成</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//返回 json格式字符串</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/sendData2"</span>,produces=<span class="string">"text/html;charset=utf-8"</span>) <span class="comment">//解决响应中文乱码问题</span></span><br><span class="line">	<span class="meta">@ResponseBody</span>      <span class="comment">//作用：将当前方法的返回值放到响应体中，并转成 json 格式</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String  <span class="title">sendData2</span><span class="params">()</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"&#123;china:中国&#125;"</span>; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// void 返回类型    </span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/sendData3"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendData3</span><span class="params">(HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		resp.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		String json = <span class="string">"&#123;\"name\":\"张三\",\"age\":32&#125;"</span>;</span><br><span class="line">		resp.getWriter().print(json);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/sendData4"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span>   <span class="comment">//作用：将当前方法的返回值放到响应体中，并转成 json 格式</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">sendData4</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"aaa"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-6-请求转发与重定向"><a href="#2-6-请求转发与重定向" class="headerlink" title="2.6 请求转发与重定向"></a>2.6 请求转发与重定向</h2><h4 id="请求转发（服务内部跳转）"><a href="#请求转发（服务内部跳转）" class="headerlink" title="请求转发（服务内部跳转）"></a>请求转发（服务内部跳转）</h4><p>springmvc 默认使用请求转发</p>
<ul>
<li>请求转发到视图</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setViewName(<span class="string">"逻辑视图名"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>请求转发给处理器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">"forward:***.do"</span>;</span><br></pre></td></tr></table></figure>

<h4 id="重定向（服务器外部跳转）"><a href="#重定向（服务器外部跳转）" class="headerlink" title="重定向（服务器外部跳转）"></a>重定向（服务器外部跳转）</h4><ul>
<li>重定向到视图</li>
</ul>
<p>springmvc 使用重定向，会将默认会将数据通过地址栏的方式传递物理视图</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setViewName(<span class="string">"redirct:逻辑视图名"</span>)</span><br><span class="line"><span class="comment">//http://localhost:8080/mvc/jsp/showData.jsp?username=张三&amp;age=123</span></span><br><span class="line"><span class="comment">//获取地址栏中的数据  </span></span><br><span class="line"><span class="comment">//$&#123;param.username&#125;---$&#123;param.age&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>重定向到处理器</li>
</ul>
<p>注意：<strong>前面不需要加斜杠</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setViewName(<span class="string">"redirct:处理器方法请求路径"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/redirect"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedirctController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//请求转发到视图页面中</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/helloWord"</span>,produces=<span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testDispather</span><span class="params">(String username,<span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//承载数据</span></span><br><span class="line">		mv.addObject(<span class="string">"username"</span>, username);</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,age);</span><br><span class="line">		<span class="comment">//采用默认的请求转发</span></span><br><span class="line">		mv.setViewName(<span class="string">"showData"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/helloWord4"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testDispather2</span><span class="params">(String username,<span class="keyword">int</span> age,Map&lt;String,Object&gt; map)</span></span>&#123;</span><br><span class="line">		map.put(<span class="string">"username"</span>, username);</span><br><span class="line">		map.put(<span class="string">"age"</span>, age);</span><br><span class="line">		System.out.println(map);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"forward:helloWorld5.do"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/helloWord5.do"</span>,produces=<span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDispather3</span><span class="params">(String username,<span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			System.out.println(username+<span class="string">"\t"</span>+age);</span><br><span class="line">			</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//重定向到视图页面</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/helloWord2"</span>,produces=<span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testRedirect</span><span class="params">(String username,<span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//承载数据</span></span><br><span class="line">		mv.addObject(<span class="string">"username"</span>, username);</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,age);</span><br><span class="line">		<span class="comment">//采用重定向</span></span><br><span class="line">		mv.setViewName(<span class="string">"redirect:/jsp/showData.jsp"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 重定向另一个处理器</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/helloWord3"</span>,produces=<span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testRedirect2</span><span class="params">(String username,<span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">//承载数据</span></span><br><span class="line">		mv.addObject(<span class="string">"username"</span>, username);</span><br><span class="line">		mv.addObject(<span class="string">"age"</span>,age);</span><br><span class="line">		<span class="comment">//采用重定向，到另一个处理器中</span></span><br><span class="line">		mv.setViewName(<span class="string">"redirect:helloWord"</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-7-文件上传"><a href="#2-7-文件上传" class="headerlink" title="2.7 文件上传"></a>2.7 文件上传</h2><p>要求：</p>
<ul>
<li><p>注册 mvc 注解驱动</p>
</li>
<li><p><strong>文件上传解析器</strong>-   </p>
<p>CommonsoMultipartRes</p>
</li>
<li><p>导入相关 jar 包</p>
<p>com.springsource.org.apache.commons.fileupload-1.2.0.jar<br>com.springsource.org.apache.commons.io-1.4.0.jar</p>
</li>
</ul>
<h4 id="form-表单修改上传类型"><a href="#form-表单修改上传类型" class="headerlink" title="form 表单修改上传类型"></a>form 表单修改上传类型</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"file/fileUpload"</span> <span class="attr">method</span>=<span class="string">"post"</span>  <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> &gt;</span></span><br><span class="line">    图片<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span>  <span class="attr">name</span>=<span class="string">"img"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>  <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="后台控制器-—上传文件"><a href="#后台控制器-—上传文件" class="headerlink" title="后台控制器 —上传文件"></a>后台控制器 —上传文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/file"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUploadController</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//单文件上传</span></span><br><span class="line">		<span class="meta">@RequestMapping</span>(value=<span class="string">"/fileUpload"</span>,method= RequestMethod.POST)</span><br><span class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">fileUploadOne</span><span class="params">(MultipartFile img,Model model)</span></span>&#123;</span><br><span class="line">			<span class="comment">//指定文件上传路径</span></span><br><span class="line">			String path = <span class="string">"E:/"</span>;  <span class="comment">//这里是服务器目录下</span></span><br><span class="line">			<span class="comment">//获取文件上传名,中文处理在 springmvc.xml 的文件上传解析器修改默认编码</span></span><br><span class="line">			String fileName = img.getOriginalFilename();</span><br><span class="line">			<span class="comment">//上传文件</span></span><br><span class="line">			File file = <span class="keyword">new</span> File(path,fileName);</span><br><span class="line">			<span class="comment">//上传文件到服务器中 </span></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				img.transferTo(file);</span><br><span class="line">				model.addAttribute(<span class="string">"fileName"</span>, fileName);</span><br><span class="line">				model.addAttribute(<span class="string">"flag"</span>, <span class="string">"上传成功"</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">				model.addAttribute(<span class="string">"flag"</span>, <span class="string">"上传失败"</span>);</span><br><span class="line">			&#125; </span><br><span class="line">			<span class="comment">//返回视图界面</span></span><br><span class="line">			<span class="keyword">return</span> <span class="string">"showData"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//多文件上传</span></span><br><span class="line">		<span class="comment">//多文件上传，需采用 @RequestParam 自动修正参数</span></span><br><span class="line">		<span class="meta">@RequestMapping</span>(value=<span class="string">"/fileUpload2"</span>,method= RequestMethod.POST)</span><br><span class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">fileUploadMany</span><span class="params">(@RequestParam MultipartFile imgs[],Model model,HttpSession session)</span></span>&#123;</span><br><span class="line">			<span class="comment">//获取服务器上下文，找到 images 目录</span></span><br><span class="line">			String path = session.getServletContext().getRealPath(<span class="string">"/images"</span>);</span><br><span class="line">			System.out.println(<span class="string">"path="</span>+path);</span><br><span class="line">			<span class="comment">//存储数据</span></span><br><span class="line">			Map&lt;String,String&gt;  map = <span class="keyword">new</span> HashMap&lt;String,String&gt;(); </span><br><span class="line">			<span class="comment">//遍历文件</span></span><br><span class="line">			<span class="keyword">for</span> (MultipartFile img : imgs) &#123;</span><br><span class="line">				<span class="comment">//获取文件上传名,中文处理在 springmvc.xml 的文件上传解析器修改默认编码</span></span><br><span class="line">				String fileName = img.getOriginalFilename();</span><br><span class="line">				<span class="comment">//上传文件</span></span><br><span class="line">				File file = <span class="keyword">new</span> File(path,fileName);</span><br><span class="line">				<span class="comment">//上传文件到服务器中 </span></span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					img.transferTo(file);</span><br><span class="line">					map.put(<span class="string">"flag"</span>, <span class="string">"成功"</span>);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">					map.put(<span class="string">"flag"</span>, <span class="string">"失败"</span>);</span><br><span class="line">				&#125; </span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//Map 添加到 model 中</span></span><br><span class="line">			model.addAllAttributes(map);</span><br><span class="line">			<span class="comment">//返回视图界面</span></span><br><span class="line">			<span class="keyword">return</span> <span class="string">"showData"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注册文件上传解析器"><a href="#注册文件上传解析器" class="headerlink" title="注册文件上传解析器"></a>注册文件上传解析器</h4><p>​    注意：文件上传解析器的 id 属性是由 DispatherServlet 中获取的。</p>
<p>​    因为文件上传解析器是由中央调度器 DispatherServlet 控制的  </p>
<p>​    记住：文件上传解析器的类名  CommonsMultipartResolver</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 注册文件上传解析器 --&gt;</span><br><span class="line"> &lt;bean id=<span class="string">"multipartResolver"</span>  </span><br><span class="line">    <span class="class"><span class="keyword">class</span></span>=<span class="string">" org.springframework.web.multipart.commons.CommonsMultipartResolver"</span> &gt;</span><br></pre></td></tr></table></figure>

<h4 id="解决上传文件中文名乱码"><a href="#解决上传文件中文名乱码" class="headerlink" title="解决上传文件中文名乱码"></a>解决上传文件中文名乱码</h4><p>​    在 springmvc.xml 中的文件上传解析器中，添加属性 defaultEncoding 为 utf-8</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册文件上传解析器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span>  </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">" org.springframework.web.multipart.commons.CommonsMultipartResolver"</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 处理中文乱码问题 --&gt;</span>	 </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"utf-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="上传文件路径问题"><a href="#上传文件路径问题" class="headerlink" title="上传文件路径问题"></a>上传文件路径问题</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取服务器上下文，找到 images 目录</span></span><br><span class="line">String path = session.getServletContext().getRealPath(<span class="string">"/images"</span>);</span><br></pre></td></tr></table></figure>

<h4 id="多文件上传参数问题"><a href="#多文件上传参数问题" class="headerlink" title="多文件上传参数问题"></a>多文件上传参数问题</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP Status 500 - Request processing failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [[Lorg.springframework.web.multipart.MultipartFile;]: No default constructor found; nested exception is java.lang.NoSuchMethodException: [Lorg.springframework.web.multipart.MultipartFile;.&lt;init&gt;()</span><br></pre></td></tr></table></figure>

<p>解决：</p>
<p>​    添加方法参数类型前添加注解 @RequestParam ，自动修正参数</p>
<p>​    <code>public String fileUploadMany(@RequestParam MultipartFile imgs[];</code></p>
<h2 id="2-8-文件下载"><a href="#2-8-文件下载" class="headerlink" title="2.8  文件下载"></a>2.8  文件下载</h2><ul>
<li>使用返回值类型 ReponseEntity&lt;byte[]&gt;</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.HttpStatusCodeException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/fileDownload"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileDownLoadController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/download"</span>)</span><br><span class="line">	<span class="keyword">public</span> ResponseEntity&lt;<span class="keyword">byte</span>[]&gt; downloadFile(HttpSession session) <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">		<span class="comment">//要下载文件路径</span></span><br><span class="line">		String path = session.getServletContext().getRealPath(<span class="string">"/images"</span>);</span><br><span class="line">		<span class="comment">/*	String path = "d:/ab小情歌.jpg";*/</span></span><br><span class="line">		<span class="comment">//要下载文件对象</span></span><br><span class="line">		File file = <span class="keyword">new</span> File(path,<span class="string">"ab.png"</span>);</span><br><span class="line">		<span class="comment">//获取文件输入流对象</span></span><br><span class="line">		InputStream is = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">		<span class="comment">//创建字节数组，数组大小根据  is 对象可用字节数指定</span></span><br><span class="line">		<span class="keyword">byte</span>[] body = <span class="keyword">new</span> <span class="keyword">byte</span>[is.available()];</span><br><span class="line">		<span class="comment">//将文件读字节数组</span></span><br><span class="line">		is.read(body);</span><br><span class="line">		<span class="comment">//添加响应信息</span></span><br><span class="line">		HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">		<span class="comment">//解决文件名文件乱码问题</span></span><br><span class="line">		String fileName = file.getName();</span><br><span class="line">		String fileDownloadName = <span class="keyword">new</span> String(fileName.getBytes(<span class="string">"utf-8"</span>),<span class="string">"iso-8859-1"</span>);</span><br><span class="line">		<span class="comment">//以附件的形式发送给浏览器，并指定下载名称</span></span><br><span class="line">		headers.add(<span class="string">"Content-Disposition"</span>, <span class="string">"attatchment;filename="</span>+fileDownloadName);</span><br><span class="line">		<span class="comment">//设置响应状态码</span></span><br><span class="line">		HttpStatus statusCode = HttpStatus.OK;  <span class="comment">//200  浏览器正常访问</span></span><br><span class="line">		</span><br><span class="line">		ResponseEntity&lt;<span class="keyword">byte</span>[]&gt; responseEntity = </span><br><span class="line">				<span class="keyword">new</span> ResponseEntity&lt;<span class="keyword">byte</span>[]&gt;(body, headers, statusCode);</span><br><span class="line">				</span><br><span class="line">		<span class="keyword">return</span> responseEntity;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-9-自定义拦截器"><a href="#2-9-自定义拦截器" class="headerlink" title="2.9 自定义拦截器"></a>2.9 自定义拦截器</h2><p>要求：</p>
<ul>
<li>实现 HandleInterceptor 接口 </li>
<li>注册拦截器  <code>&lt;mvc:interceptores&gt;</code></li>
</ul>
<p>拦截情况</p>
<ul>
<li>拦截所有请求</li>
<li>拦截特定请求路径</li>
<li>放行请求路径</li>
<li>使用多个拦截器拦截的顺序</li>
</ul>
<h4 id="后台拦截器"><a href="#后台拦截器" class="headerlink" title="后台拦截器"></a>后台拦截器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.intercetor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstInterceptor</span> <span class="keyword">implements</span>  <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//在服务器响应给浏览器数据之前拦截</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest arg0,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse arg1, Object arg2, Exception arg3)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">			System.out.println(<span class="string">"FirstInterceptor.afterCompletion() 执行！"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//在处理器方法执行之后拦截</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1,</span></span></span><br><span class="line"><span class="function"><span class="params">			Object arg2, ModelAndView arg3)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">			System.out.println(<span class="string">"FirstInterceptor.postHandle() 执行！"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//在处理器方法执行之前拦截</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1,</span></span></span><br><span class="line"><span class="function"><span class="params">			Object arg2)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"FirstInterceptor.preHandle() 执行！"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">// false 表示拦截对应请求，不交给对应 处理器处理   </span></span><br><span class="line">					 <span class="comment">//true 表示放行</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注册拦截器"><a href="#注册拦截器" class="headerlink" title="注册拦截器"></a>注册拦截器</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册自定义拦截器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 执行拦截器中拦截路径 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;mvc:mapping path="/**"/&gt; --&gt;</span><span class="comment">&lt;!-- 拦截所有 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 方式1 ：执行指定路径的处理器方法  --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;mvc:mapping path="/mvc/formdata0" /&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 方式2 ：执行指定路径的处理器方法  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span><span class="comment">&lt;!-- 拦截所有 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 排除在拦截器之外，直接放行 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/mvc/formdata1"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注册拦截器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.szxy.intercetor.HelloInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.szxy.intercetor.FirstInterceptor"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.szxy.intercetor.SecondInterceptora"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="使用多个拦截器拦截的顺序"><a href="#使用多个拦截器拦截的顺序" class="headerlink" title="使用多个拦截器拦截的顺序"></a>使用多个拦截器拦截的顺序</h4><ul>
<li>在处理器执行之前，拦截器的顺序由springmvc.xml 声明自定义拦截器的顺序执行</li>
<li>在处理执行完成后。拦截器的顺序是从后往前执行</li>
<li>在服务器响应数据给客户端之前，拦截器的顺序是从后往前执行（一般情况）</li>
</ul>
<h2 id="2-10-Spring-与-SpringMVC-父子容器关系"><a href="#2-10-Spring-与-SpringMVC-父子容器关系" class="headerlink" title="2.10  Spring 与 SpringMVC  父子容器关系"></a>2.10  Spring 与 SpringMVC  父子容器关系</h2><ul>
<li><p>在Spring 整体框架中，容器是核心思想，是用来管理 bean 的生命周期的。</p>
</li>
<li><p>Spring 是父容器，SpringMVC 是子容器。</p>
</li>
<li><p>SpringMVC 可以访问父容器中 注册的bean 对象，但是父容器不能访问子容器注册的 bean 对象。</p>
<p>例如：SpringMVC  容器可以访问 Spring 容器中 dao 层、 service 层 中 bean 对象。</p>
</li>
</ul>
<p>​    </p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/05/06/20190506 Spring 框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/05/06/20190506 Spring 框架/" class="post-title-link" itemprop="url">20190506 Spring 框架</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-05-06 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-06T00:00:00+08:00">2019-05-06</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-10 12:04:09" itemprop="dateModified" datetime="2019-05-10T12:04:09+08:00">2019-05-10</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Spring-简介"><a href="#1-Spring-简介" class="headerlink" title="1 Spring 简介"></a>1 Spring 简介</h1><blockquote>
<p> Spring 是一个轻量级控制反转（IOC）和面向切面（AOP）的容器框架</p>
<p>IOC：Inversion of  Control   控制反转  DI</p>
<p>AOP：Aspect of program      面向切面编程  Aspect</p>
</blockquote>
<h2 id="1-1-常用-jar-包"><a href="#1-1-常用-jar-包" class="headerlink" title="1.1 常用 jar 包"></a>1.1 常用 jar 包</h2><table>
<thead>
<tr>
<th align="center">Spring 常用jar包</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">spring-aop</td>
<td align="center">提供AOP（面向切面编程）实现</td>
</tr>
<tr>
<td align="center">spring-aspect</td>
<td align="center">spring提供对AspectJ 框架的整合</td>
</tr>
<tr>
<td align="center">spring-beans</td>
<td align="center">提供IoC（控制反转）的基础实现</td>
</tr>
<tr>
<td align="center">spring-context-support</td>
<td align="center">对Spring-context 的扩展支持</td>
</tr>
<tr>
<td align="center">spring-context</td>
<td align="center">Spring提供在IoC 基础功能上的扩展服务</td>
</tr>
<tr>
<td align="center">spring-core</td>
<td align="center">spring 的核心组件</td>
</tr>
<tr>
<td align="center">spring-expression</td>
<td align="center">spring 表达式语言</td>
</tr>
<tr>
<td align="center">spring-jdbc</td>
<td align="center">spring 提供的对 JDBC 支持包</td>
</tr>
<tr>
<td align="center">spring-orm</td>
<td align="center">整合第三方的ORM框架</td>
</tr>
<tr>
<td align="center">spring-test</td>
<td align="center">对单元测试和继承测试的简单封装</td>
</tr>
<tr>
<td align="center">spring-tx</td>
<td align="center">对事务管理的封装</td>
</tr>
<tr>
<td align="center">spring-web</td>
<td align="center">SpringMVC支持WEB端应用部署架构</td>
</tr>
<tr>
<td align="center">spring-webmvc</td>
<td align="center">REST Web 服务和Web 应用的视图控制器的实现</td>
</tr>
</tbody></table>
<h2 id="1-2-Spring-版本差异"><a href="#1-2-Spring-版本差异" class="headerlink" title="1.2 Spring 版本差异"></a>1.2 Spring 版本差异</h2><p>sprin 4  支持 JavaEE 7 </p>
<p>spring 5 支持 JavaEE 8，Junit 5</p>
<h1 id="2-Spring-之-IOC-控制反转"><a href="#2-Spring-之-IOC-控制反转" class="headerlink" title="2 Spring 之 IOC 控制反转"></a>2 Spring 之 IOC 控制反转</h1><blockquote>
<p>IOC 控制反转：将对象的控制权(对象的创建、初始化、销毁等操作)由原先的调用者交给 Spring 容器管理。</p>
<p>DI 依赖注入：  若一个对象需要调用另一个对象，无须在代码中创建被调用者，而是依赖于外部容器，由外部容器创建后传递给程序。</p>
<p>IoC 是一个概念，一种思想， DI 是其中实现之一。</p>
</blockquote>
<h2 id="2-1-第一个-spring-程序"><a href="#2-1-第一个-spring-程序" class="headerlink" title="2.1  第一个 spring 程序"></a>2.1  第一个 spring 程序</h2><h3 id="2-2-1-导入-jar-包"><a href="#2-2-1-导入-jar-包" class="headerlink" title="2.2.1 导入 jar 包"></a>2.2.1 导入 jar 包</h3><blockquote>
<p>导入 jar 包</p>
<p>com.springsource.junit-3.8.2.jar<br>com.springsource.org.apache.commons.logging-1.1.1.jar<br>com.springsource.org.apache.log4j-1.2.15.jar<br>spring-beans-4.1.6.RELEASE.jar<br>spring-context-4.1.6.RELEASE.jar<br>spring-context-support-4.1.6.RELEASE.jar<br>spring-core-4.1.6.RELEASE.jar<br>spring-expression-4.1.6.RELEASE.jar</p>
<p>查找 约束文档的位置 spring-framework-4.1.6.RELEASE-dist/spring-framework-4.1.6.RELEASE/docs/spring-framework-reference/html/xsd-config.html</p>
</blockquote>
<h3 id="2-2-2-创建-spring-配置文件"><a href="#2-2-2-创建-spring-配置文件" class="headerlink" title="2.2.2 创建 spring 配置文件"></a>2.2.2 创建 spring 配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">   </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-3-Bean-的定义与注册"><a href="#2-2-3-Bean-的定义与注册" class="headerlink" title="2.2.3 Bean 的定义与注册"></a>2.2.3 Bean 的定义与注册</h3><blockquote>
<p>在 beans 标签中添加下面的语句</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 定义 bean 对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"com.szxy.spring.TestSpring"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-4-从-spring-容器中获取-Bean"><a href="#2-2-4-从-spring-容器中获取-Bean" class="headerlink" title="2.2.4 从 spring 容器中获取 Bean"></a>2.2.4 从 spring 容器中获取 Bean</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.szxy.spring.TestSpring;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 测试类与 service 实现类 耦合</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">traditionalTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">		SomeServiceImpl service = <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line">		service.someMethod();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">///Spring 测试类与 service 实现类 解耦合</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ClassPathXmlApplicationContext context = </span><br><span class="line">				<span class="keyword">new</span>  ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		TestSpring t1 = (TestSpring)context.getBean(<span class="string">"bean1"</span>);</span><br><span class="line">		t1.testMethod();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-BeanFactory-与-ApplicationContext"><a href="#2-2-BeanFactory-与-ApplicationContext" class="headerlink" title="2.2 BeanFactory 与 ApplicationContext"></a>2.2 BeanFactory 与 ApplicationContext</h2><blockquote>
<p>ApplicationContext 在加载配置文件时，对容器中所有 bean 进行对象创建及初始化操作。</p>
<p>BeanFactory 在执行 getBean 时，对容器中指定的 bean 进行对象的创建及初始化操作。</p>
<p>另外： BeanFactory  父接口，ApplicationContext  是 BeanFactory   的子接口</p>
<p>​        </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ApplicationContext context = </span><br><span class="line">				<span class="keyword">new</span>  ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		<span class="comment">//TestSpring t1 = (TestSpring)context.getBean("bean1");</span></span><br><span class="line">		TestSpring t1 =  context.getBean(<span class="string">"bean1"</span>,TestSpring.class);</span><br><span class="line">		t1.testMethod();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//使用 断点调试，区别 BeanFactory 与  ApplicationContext 的区别</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		BeanFactory bf = <span class="keyword">new</span> XmlBeanFactory(<span class="keyword">new</span> ClassPathResource(<span class="string">"applicationContext.xml"</span>));</span><br><span class="line">		TestSpring t1 =  bf.getBean(<span class="string">"bean1"</span>,TestSpring.class);</span><br><span class="line">		t1.testMethod();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-bean-装配"><a href="#2-3-bean-装配" class="headerlink" title="2.3  bean 装配"></a>2.3  bean 装配</h2><blockquote>
<p>Bean 装配指对象的创建方式</p>
<ol>
<li>默认装配方式（构造方法）</li>
<li>动态/实例工厂模式</li>
<li>静态工厂模式</li>
</ol>
</blockquote>
<h3 id="2-3-1-dynamicFactory"><a href="#2-3-1-dynamicFactory" class="headerlink" title="2.3.1 dynamicFactory"></a>2.3.1 dynamicFactory</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 动态/实例工厂模式 </span></span><br><span class="line"><span class="comment">   相当于 	SomeDynamicFactory factory = new SomeDynamicFactory();</span></span><br><span class="line"><span class="comment">    SomeService service = factory.getSomeService();</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"someDynamicFactory"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dynamicFactory.SomeDynamicFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"somServiceByDyFactory"</span> <span class="attr">factory-bean</span>=<span class="string">"someDynamicFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getSomeService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-staticFactory"><a href="#2-3-2-staticFactory" class="headerlink" title="2.3.2  staticFactory"></a>2.3.2  staticFactory</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 静态工厂模式</span></span><br><span class="line"><span class="comment">    相当于 SomeService service = SomeStaticFactory.getSomeService();</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"someServiceByStaticFactory"</span>  <span class="attr">class</span>=<span class="string">"com.szxy.staticFactory.SomeStaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getSomeService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-4-bean-作用域"><a href="#2-4-bean-作用域" class="headerlink" title="2.4 bean 作用域"></a>2.4 bean 作用域</h2><blockquote>
<p>单列模式 singleton</p>
<p>默认采用单例模式，每次使用getBean 方法获取相同 ID 类对象只获取同一个对象</p>
<p>原型列 prototype 每次都获取一个新的对象</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 默认单列模式</span></span><br><span class="line"><span class="comment">  每次从容器获取同一个的对象</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"service1"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.SomeServiceImpl"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 原型列模式</span></span><br><span class="line"><span class="comment">  每次从容器获取一个新的对象</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"service2"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.SomeServiceImpl"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-5-基于XML-方式的-DI"><a href="#2-5-基于XML-方式的-DI" class="headerlink" title="2.5 基于XML 方式的 DI"></a>2.5 基于XML 方式的 DI</h2><blockquote>
<p>依赖注入：为对象的属性赋值,通过 setter 方法。</p>
</blockquote>
<h3 id="2-5-1-设值注入"><a href="#2-5-1-设值注入" class="headerlink" title="2.5.1 设值注入"></a>2.5.1 设值注入</h3><blockquote>
<ol>
<li><p>简单数据类型注入和引用数据类型注入通过 property 标签</p>
</li>
<li><p>集合 Collection 属性的注入 （array、set、list、map、property）</p>
</li>
<li><p>域属性自动注入（autoWire = “by Mame” 方式 、autWiire = “by Type ”；全局/局部）</p>
<p>注意：</p>
<ol>
<li><p>byName 方式 注入的对象的属性名必须与它的id 名称相同</p>
</li>
<li><p>byType 方式注入自动注入：spring 配置文件中查询与属性类型一致的的bean并进行注入.</p>
</li>
</ol>
</li>
<li><p>注入 null 或 空串</p>
</li>
</ol>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">default-autowire</span>=<span class="string">"byType"</span> &gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span> <span class="comment">&lt;!-- 全局配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>/&gt;</span>  <span class="comment">&lt;!--注入空串--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">null</span>/&gt;</span>  <span class="comment">&lt;!--  null --&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">    xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">"</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">         http://www.springframework.org/schema/beans/spring-beans.xsd"</span></span><br><span class="line">         <span class="keyword">default</span>-autowire=<span class="string">"byType"</span> &gt; &lt;!-- 全局自动注入 --&gt;</span><br><span class="line">         </span><br><span class="line">     &lt;!-- 定义 bean 对象 --&gt;</span><br><span class="line">     &lt;!-- <span class="number">1</span>. 简单类型注入和引用类型注入 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"student"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="张三"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="score" value="90"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 引用类型注入 --&gt;</span><br><span class="line">		&lt;property name="teacher" ref="teacher"&gt;&lt;/property&gt; </span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;bean id=<span class="string">"teacher"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Teacher"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="雷老师"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">&lt;!-- 	&lt;bean id=<span class="string">"teacher1"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Teacher"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="马老师"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"teacher2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Teacher"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="曹老师"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt; --&gt;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	&lt;!-- <span class="number">2</span>. 集合类型注入  --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"collect"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.CollectionDI"</span>&gt;</span><br><span class="line">		&lt;property name=<span class="string">"myArray"</span>&gt;</span><br><span class="line">			&lt;array &gt;</span><br><span class="line">					&lt;value&gt;蜡笔小新&lt;/value&gt;</span><br><span class="line">					&lt;value&gt;美少女战士&lt;/value&gt;</span><br><span class="line">					&lt;value&gt;路飞&lt;/value&gt;</span><br><span class="line">			&lt;/array&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;property name=<span class="string">"mySet"</span>&gt;</span><br><span class="line">			&lt;set&gt;</span><br><span class="line">				&lt;ref bean="teacher"&gt;&lt;/ref&gt; </span><br><span class="line">			&lt;!-- 	&lt;ref bean="teacher1"&gt;&lt;/ref&gt;</span><br><span class="line">				&lt;ref bean="teacher2"&gt;&lt;/ref&gt; --&gt;</span><br><span class="line">			&lt;/set&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;property name=<span class="string">"myList"</span>&gt;</span><br><span class="line">			&lt;list&gt;</span><br><span class="line">				&lt;ref bean=<span class="string">"student"</span>/&gt;</span><br><span class="line">			&lt;/list&gt;</span><br><span class="line">		&lt;/property&gt;		</span><br><span class="line">		&lt;property name=<span class="string">"myMap"</span>&gt;</span><br><span class="line">			&lt;map&gt;</span><br><span class="line">				&lt;entry key="一"  value="1"&gt;&lt;/entry&gt;</span><br><span class="line">				&lt;entry key="二"  value="2"&gt;&lt;/entry&gt;</span><br><span class="line">				&lt;entry key="三"  value="3"&gt;&lt;/entry&gt;</span><br><span class="line">			&lt;/map&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;property name=<span class="string">"myProp"</span>&gt;</span><br><span class="line">			&lt;props&gt;</span><br><span class="line">				&lt;prop key="1"&gt;一是一&lt;/prop&gt;</span><br><span class="line">				&lt;prop key="2"&gt;二是二&lt;/prop&gt;</span><br><span class="line">			&lt;/props&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">   </span><br><span class="line">   	&lt;!-- <span class="number">3</span>. 域类型自动注入 --&gt;</span><br><span class="line">   	&lt;!-- 域类型自动注入 byName  byType  --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"student1"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span> autowire=<span class="string">"byName"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="张三"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="score" value="90"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 引用类型注入 --&gt;</span><br><span class="line">		&lt;!-- &lt;property name="teacher" ref="teacher"&gt;&lt;/property&gt;  --&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;!-- </span><br><span class="line">		 域属性自动注入值 byType </span><br><span class="line">		No qualifying bean of type [com.szxy.bean.Teacher] is defined: </span><br><span class="line">		expected single matching bean but found <span class="number">3</span>: teacher,teacher1,teacher2</span><br><span class="line">		</span><br><span class="line">		即使用 byType 作为自动注入，不能注册 多个  bean 是同一个类的，这样会导致 spring 容器不知道选择哪一个，因为类型都相同。</span><br><span class="line"> </span><br><span class="line">	 --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"student2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span> autowire=<span class="string">"byType"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="张三2"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="score" value="60"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 全局自动注入 --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">"student3"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span><br><span class="line">		&lt;property name="name" value="张三3"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="score" value="100"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	&lt;!-- <span class="number">4</span>. 空串或 <span class="keyword">null</span> 注入 --&gt;</span><br><span class="line">	 &lt;bean id=<span class="string">"student4"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span><br><span class="line">		&lt;property name="name"&gt;&lt;value/&gt;&lt;/property&gt;&lt;!-- 空串注入 --&gt;</span><br><span class="line">		&lt;property name="score" value="0"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	 &lt;bean id=<span class="string">"student5"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span><br><span class="line">		&lt;property name="name"&gt;&lt;null/&gt;&lt;/property&gt;&lt;!--  null注入  --&gt;</span><br><span class="line">		&lt;property name="score" value="0"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-2-构造注入"><a href="#2-5-2-构造注入" class="headerlink" title="2.5.2 构造注入"></a>2.5.2 构造注入</h3><p>要求：在 bean 对象中要有参构造方法，同时注意添加无参构造方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 构造注入 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1.1 构造注入 按照名称 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student6"</span> <span class="attr">class</span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"小方"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"score"</span> <span class="attr">value</span>=<span class="string">"90"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"teacher"</span> <span class="attr">ref</span>=<span class="string">"teacher"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1.2 构造注入 按照索引--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student7"</span> <span class="attr">class</span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"小方2"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"90"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"2"</span> <span class="attr">ref</span>=<span class="string">"teacher"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1.3 构造注入 按照默认位置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student8"</span> <span class="attr">class</span>=<span class="string">"com.szxy.bean.Student"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">value</span>=<span class="string">"小方3 "</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">value</span>=<span class="string">"100"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">ref</span>=<span class="string">"teacher1"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-6-基于注解-annotation-方式DI"><a href="#2-6-基于注解-annotation-方式DI" class="headerlink" title="2.6 基于注解 annotation 方式DI"></a>2.6 基于注解 annotation 方式DI</h2><h3 id="2-6-1-环境搭建"><a href="#2-6-1-环境搭建" class="headerlink" title="2.6.1 环境搭建"></a>2.6.1 环境搭建</h3><blockquote>
<p>导入 aop 包，添加 context 约束头信息(组件扫描器)</p>
</blockquote>
<h2 id="2-6-2-常用注解"><a href="#2-6-2-常用注解" class="headerlink" title="2.6.2 常用注解"></a>2.6.2 常用注解</h2><blockquote>
<p> @Component  表名当前类交给Spring容器管理 </p>
<p> @Repository  该注解添加在Dao 中</p>
<p>@Service  该注解添加在 Service 中 </p>
<p>@Controller  该注解添加在 Controller </p>
<p>@Autowired   引用数据类型注入，默认byType</p>
<p>@Qualifier(“id”)   与@Autowired 联合使用 byName 方式注入</p>
<p>@Value  简单数据类型注入</p>
<p>@Resource  引用数据类型默认使用 byName 方式，</p>
<p>若找不到名称匹配的 bean ，才会采用 byType 方式</p>
<p>@Scope()  表明作用域</p>
</blockquote>
<ul>
<li>xml 文档约束</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 使用注解方式 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.szxy.bean"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>栗子</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Scope;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">//表明将当前类交给 Spring 容器管理</span></span><br><span class="line"><span class="meta">@Component</span>(<span class="string">"student"</span>)  </span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"小白2"</span>)</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"100"</span>)</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> score;</span><br><span class="line">	<span class="comment">/*	</span></span><br><span class="line"><span class="comment">	@Autowired  //默认以 byType 方式自动注入</span></span><br><span class="line"><span class="comment">	@Qualifier("teacher")  //与 @Autowired 联合使用，以byName 方式自动注入</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="meta">@Resource</span>    <span class="comment">//默认以 byName 方式，若找不到，则以byType 查找</span></span><br><span class="line">	<span class="keyword">private</span> Teacher teacher; <span class="comment">//引用对象</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, <span class="keyword">int</span> score, Teacher teacher)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.score = score;</span><br><span class="line">		<span class="keyword">this</span>.teacher = teacher;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, <span class="keyword">int</span> score)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.score = score;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getScore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> score;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScore</span><span class="params">(<span class="keyword">int</span> score)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.score = score;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Teacher <span class="title">getTeacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> teacher;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeacher</span><span class="params">(Teacher teacher)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.teacher = teacher;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Student [name="</span> + name + <span class="string">", score="</span> + score + <span class="string">", teacher="</span></span><br><span class="line">				+ teacher + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-AOP"><a href="#3-AOP" class="headerlink" title="3  AOP"></a>3  AOP</h1><blockquote>
<p>AOP 面向切面编程(编程思想)，是将交叉业务逻辑封装成切面，利用AOP的功能将切面织入主业务逻辑中。</p>
<p>交叉业务逻辑是值，通用的、与主业务无关的代码，如安全检查、事务、日志等。</p>
<p>切面：泛指交叉业务逻辑。</p>
<p>织入：将切面代码插入到目标对象的过程。</p>
<p>连接点：切面可以织入的位置。</p>
<p>切入点：切面具体织入的位置。注意：切入点的范围比连接点的范围小</p>
<p>通知（advice）： 切面的一种实现，是在目标方法执行前或后，切入。</p>
<p>顾问（advisor）： 不仅指定了切入时间点，还指定具体的    切入点</p>
</blockquote>
<h2 id="3-1-三种代理方式"><a href="#3-1-三种代理方式" class="headerlink" title="3.1 三种代理方式"></a>3.1 三种代理方式</h2><blockquote>
<p>应用场景:</p>
<ul>
<li>可以隐藏目标类的具体实现</li>
<li>在不修改目标类代码的情况下能够对其功能进行增强</li>
</ul>
</blockquote>
<h3 id="3-1-1-静态代理"><a href="#3-1-1-静态代理" class="headerlink" title="3.1.1 静态代理"></a>3.1.1 静态代理</h3><blockquote>
<p>测试静态代理，写一个接口，一个目标实现类，再写一个代理类也实现该接口，并将目标类对象传入代理类中，代理类调用目标类对象的方法。最后测试。</p>
<p>注意： 代理类与目标类实现相同的接口</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.staticProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.service.SomeService;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestStaticProxy</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 目标类</span></span><br><span class="line">		SomeService target= <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line">		<span class="comment">// 代理类</span></span><br><span class="line">		SomeProxy proxy = <span class="keyword">new</span> SomeProxy(target);</span><br><span class="line">		<span class="comment">//调用 代理类，获取返回值</span></span><br><span class="line">		String result = proxy.someMethod();</span><br><span class="line">		System.out.println(result);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-2-JDK动态代理"><a href="#3-1-2-JDK动态代理" class="headerlink" title="3.1.2  JDK动态代理"></a>3.1.2  JDK动态代理</h3><blockquote>
<p>动态代理不在程序中声明代理类代码，而是在运行中使用 Proxy 类 动态执行代理类的方法。</p>
<p>应用场景：目标类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.dynamicProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.service.SomeService;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * JDK 动态代理方式</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDynamicProxy</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//目标类</span></span><br><span class="line">		<span class="comment">//内部类调用外部类中的对象时，要求外部类中的对象必须由 final 关键字 修饰</span></span><br><span class="line">		<span class="keyword">final</span> SomeService target = <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line">		<span class="comment">//代理类</span></span><br><span class="line">		SomeService proxy = </span><br><span class="line">				(SomeService) Proxy.newProxyInstance(target.getClass().getClassLoader(), <span class="comment">//获取目标类类加载器</span></span><br><span class="line">							   target.getClass().getInterfaces(), <span class="comment">//获取目标类实现的接口类</span></span><br><span class="line">							   <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">								</span><br><span class="line">								<span class="comment">/**</span></span><br><span class="line"><span class="comment">								 *   proxy : 代理对象</span></span><br><span class="line"><span class="comment">								 *   method: 目标方法</span></span><br><span class="line"><span class="comment">								 *   args: 目标参数 </span></span><br><span class="line"><span class="comment">								 */</span></span><br><span class="line">								<span class="meta">@Override</span></span><br><span class="line">								<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span></span><br><span class="line"><span class="function">										<span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">									    <span class="comment">//执行目标类的方法</span></span><br><span class="line">										String  result = (String)method.invoke(target, args); </span><br><span class="line">										<span class="keyword">return</span>  result.toLowerCase();</span><br><span class="line">								&#125;</span><br><span class="line">							&#125;);</span><br><span class="line">		<span class="comment">//调用目标类的方法</span></span><br><span class="line">		String result = proxy.someMethod();</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-3-CGLIB-代理"><a href="#3-1-3-CGLIB-代理" class="headerlink" title="3.1.3 CGLIB 代理"></a>3.1.3 CGLIB 代理</h3><blockquote>
<p>应用场景： 实现目标类没有实现目标接口</p>
<p>注意： CGLIB 代理需要引入 cglib 架包</p>
</blockquote>
<ol>
<li><h4 id="CGLIB-代理类工厂"><a href="#CGLIB-代理类工厂" class="headerlink" title="CGLIB 代理类工厂"></a>CGLIB 代理类工厂</h4></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.cglibDynamicProxy.SomeService2;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.asm.Type;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.transform.impl.InterceptFieldFilter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  CGLIB 动态代理工厂</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> *  实现 MethodInterceptore 接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CGLIBProxyFactory</span>  <span class="keyword">implements</span> <span class="title">MethodInterceptor</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span>  SomeService2 target;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CGLIBProxyFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CGLIBProxyFactory</span><span class="params">(SomeService2 target)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.target = target;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> SomeService2 <span class="title">createProxy</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//创建增强类对象</span></span><br><span class="line">		Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">		<span class="comment">//指定父类对象，即目标类</span></span><br><span class="line">		enhancer.setSuperclass(SomeService2.class);</span><br><span class="line">		<span class="comment">//指定回调接口的对象</span></span><br><span class="line">		enhancer.setCallback(<span class="keyword">this</span>);</span><br><span class="line">		<span class="comment">//创建 cglib 代理类对象</span></span><br><span class="line">		<span class="keyword">return</span> (SomeService2) enhancer.create();</span><br><span class="line">	&#125;	</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *    ojb：     目标对象</span></span><br><span class="line"><span class="comment">	 *    method：  目标方法</span></span><br><span class="line"><span class="comment">	 */</span>	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object obj, Method method, Object[] args,</span></span></span><br><span class="line"><span class="function"><span class="params">			MethodProxy arg3)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">			</span><br><span class="line">			String result = (String)method.invoke(target, args);</span><br><span class="line">			<span class="keyword">return</span> result.toLowerCase();</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.cglibDynamicProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.factory.CGLIBProxyFactory;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.impl.SomeServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCGLIBProxy</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建目标类对象</span></span><br><span class="line">		SomeService2 target = <span class="keyword">new</span> SomeService2();</span><br><span class="line">		<span class="comment">//创建CGLIB 工厂</span></span><br><span class="line">		SomeService2 proxy = <span class="keyword">new</span>  CGLIBProxyFactory(target).createProxy();</span><br><span class="line">		<span class="comment">//调用 代理类方法</span></span><br><span class="line">		String result = proxy.someMethod();</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-基于Schema-based方式之通知"><a href="#3-2-基于Schema-based方式之通知" class="headerlink" title="3.2 基于Schema-based方式之通知"></a>3.2 基于Schema-based方式之通知</h2><blockquote>
<p>导入 两个 jar 包（aop \ aopalliance）</p>
<p>MethodBeforeAdivce</p>
<p>AfterReturningAdvice</p>
<p>MethodInterceptor</p>
</blockquote>
<blockquote>
<p>Eclipse 小技巧： Ctrl+Shirt+I  根据类名查找类所在位置</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">    xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">"</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">         http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span><br><span class="line">        </span><br><span class="line">    &lt;!-- 注册 bean对象，默认通过无参构造方法初始化 bean 对象 </span><br><span class="line">    	 相当于 SomeService service = <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line">    --&gt;</span><br><span class="line">	&lt;bean id="someService" class="com.szxy.service.impl.SomeServiceImpl"&gt;&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 注册切面：前置通知 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"methodBeforeAdviceImpl2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.aspects.MethodBeforeAdviceImpl2"</span>/&gt;</span><br><span class="line">	&lt;!-- 注册切面：后置通知 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"myMethodBeforeAdivce"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.aspects.MyMethodBeforeAdivce"</span>/&gt;</span><br><span class="line">	&lt;!-- 注册切面：环绕通知 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"myMethodInterceptor"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.aspects.MyMethodInterceptor"</span>/&gt;</span><br><span class="line">	&lt;!-- 注册切面：异常通知 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"myThrowAdvice"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.szxy.aspects.MyThrowAdvice"</span>/&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 注册代理类对象 --&gt;</span><br><span class="line">	&lt;bean id=<span class="string">"ProxyFactoryBean"</span>  <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;</span><br><span class="line">		&lt;!-- 指明目标类对象 --&gt;</span><br><span class="line">		&lt;property name="target" ref="someService"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 指明目标类所有接口 --&gt;</span><br><span class="line">		&lt;property name="interfaces" value="com.szxy.service.SomeService"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;!-- 指明切面 --&gt;</span><br><span class="line">		&lt;property name="interceptorNames"  value="myThrowAdvice"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-3-基于-AspectJ-方式之通知"><a href="#3-3-基于-AspectJ-方式之通知" class="headerlink" title="3.3  基于 AspectJ 方式之通知"></a>3.3  基于 AspectJ 方式之通知</h2><blockquote>
<p>支持注解式开发</p>
<p>最终通知：无论程序执行是否正常，该通知都会执行。</p>
</blockquote>
<h3 id="3-3-1-切入点表达式"><a href="#3-3-1-切入点表达式" class="headerlink" title="3.3.1 切入点表达式"></a>3.3.1 切入点表达式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">execution( </span><br><span class="line">	[modifiers-pattern]  访问权限类型</span><br><span class="line">	ret-type-pattern   返回值类型 </span><br><span class="line">	[deciaring-type-pattern]   全限定类名</span><br><span class="line">	name-pattern(param-pattern) 方法名（参数名）</span><br><span class="line">    [<span class="keyword">throws</span>-pattern]   抛出异常类型</span><br><span class="line">)</span><br><span class="line">   </span><br><span class="line">  * 表示 <span class="number">0</span>个或多个任意字符</span><br><span class="line">  </span><br><span class="line">  .. 用在方法参数前，表示任意多个参数</span><br><span class="line">     用在包名后，表示当前包及其子包路径</span><br><span class="line">     </span><br><span class="line">  +  用在类名后，表示当前类及其子类</span><br><span class="line">  	 用在接口后，表示当前接口及其实现类</span><br><span class="line">    </span><br><span class="line">execution(* *..service.*.*(..))</span><br><span class="line">指定所有包下的 service 子包下所有类(接口) 中的所有方法为切入点</span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-基于注解方式通知"><a href="#3-3-2-基于注解方式通知" class="headerlink" title="3.3.2 基于注解方式通知"></a>3.3.2 基于注解方式通知</h3><blockquote>
<p>@Aspect              表明当前类为切面</p>
<p>@Before              表明前置通知</p>
<p>@AfterReturning(value=””,returning=””)   表明后置通知</p>
<p>@Around               表明环绕通知</p>
<p>@AfterThrowing(value=””,throwing=””)      表明异常通知</p>
<p>@After  表明最终通知(不论程序是否正常运行，都执行该通知)</p>
</blockquote>
<ul>
<li>测试通知类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.aspects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//将当前作为切面</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspects</span> </span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	//前置通知</span></span><br><span class="line"><span class="comment">	@Before("execution(* *..service.*.someMethod(..))") </span></span><br><span class="line"><span class="comment">	public void methodBefore()&#123;</span></span><br><span class="line"><span class="comment">		System.out.println("前置通知...");</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	//后置通知  </span></span><br><span class="line"><span class="comment">	//注意：后置通知方法中的参数名与注解中的返回值参数名保持一致</span></span><br><span class="line"><span class="comment">	@AfterReturning(value="execution(* *..service.*.doOthers(..))",returning="result")</span></span><br><span class="line"><span class="comment">	public void afterMethod(Object result)&#123;</span></span><br><span class="line"><span class="comment">		</span></span><br><span class="line"><span class="comment">		System.out.println("后置通知... 目标方法的返回值:"+result);</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	//环绕通知</span></span><br><span class="line"><span class="comment">	@Around(value="execution(* *..service.*.doOthers(..))")</span></span><br><span class="line"><span class="comment">	public Object  aroundMethod(ProceedingJoinPoint joinPoint) throws Throwable&#123;</span></span><br><span class="line"><span class="comment">		System.out.println("环绕通知前 ..");</span></span><br><span class="line"><span class="comment">		//执行目标方法</span></span><br><span class="line"><span class="comment">		String result = (String)joinPoint.proceed();</span></span><br><span class="line"><span class="comment">		if(result != null)&#123;</span></span><br><span class="line"><span class="comment">			result = result.toUpperCase();//转换为大写</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">		System.out.println("环绕通知后 ..");</span></span><br><span class="line"><span class="comment">		return result;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="comment">//异常通知</span></span><br><span class="line">	<span class="meta">@AfterThrowing</span>(value=<span class="string">"execution(* *..service.*.someMethod(..))"</span>,throwing=<span class="string">"e"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testThrowing</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"异常通知..."</span>+e);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//最终通知</span></span><br><span class="line">	<span class="meta">@After</span>(<span class="string">"execution(* *..service.*.someMethod(..))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLastAdvice</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"最终通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>applicationContext.xml 文档配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">&lt;!-- 注册 bean对象，默认通过无参构造方法初始化 bean 对象 </span></span><br><span class="line"><span class="comment">    	 相当于 SomeService service = new SomeServiceImpl();</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"someService"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.SomeServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 注册切面 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspects"</span> <span class="attr">class</span>=<span class="string">"com.szxy.aspects.MyAspects"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--  aspectJ  自动代理 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-3-基于-XML-方式通知"><a href="#3-3-3-基于-XML-方式通知" class="headerlink" title="3.3.3 基于 XML 方式通知"></a>3.3.3 基于 XML 方式通知</h3><ul>
<li>applicationContext.xml 配置，注意配置前置带参数通知参数类型所导入的包</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">&lt;!-- 注册 bean对象，默认通过无参构造方法初始化 bean 对象 </span></span><br><span class="line"><span class="comment">    	 相当于 SomeService service = new SomeServiceImpl();</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"someService"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.SomeServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 注册切面 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspects"</span> <span class="attr">class</span>=<span class="string">"com.szxy.aspects.MyAspects"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- AOP 配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 目标方法 --&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* *..service.*.someMethod(..))"</span> <span class="attr">id</span>=<span class="string">"someMethodPC"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* *..service.*.doOthers(..))"</span> <span class="attr">id</span>=<span class="string">"doOthersPC"</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 定义切面 --&gt;</span></span><br><span class="line">	</span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspects"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 前置通知 --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- &lt;aop:before method="methodBefore" pointcut-ref="someMethodPC"/&gt; --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 带参数的前置通知 </span></span><br><span class="line"><span class="comment">				 方法名写参数的类型的全限定路径类名  org.aspectj.lang.JoinPoint		 </span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"methodBefore(org.aspectj.lang.JoinPoint)"</span> <span class="attr">pointcut-ref</span>=<span class="string">"someMethodPC"</span>/&gt;</span> </span><br><span class="line">			<span class="comment">&lt;!-- 后置通知 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"afterMethod(java.lang.Object)"</span>  <span class="attr">pointcut-ref</span>=<span class="string">"doOthersPC"</span> <span class="attr">returning</span>=<span class="string">"result"</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 环绕通知 </span></span><br><span class="line"><span class="comment">				 org.aspectj.lang.ProceedingJoinPoint  默认参数类型可以选择不加</span></span><br><span class="line"><span class="comment">			 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"aroundMethod(org.aspectj.lang.ProceedingJoinPoint)"</span> <span class="attr">pointcut-ref</span>=<span class="string">"doOthersPC"</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 异常通知 </span></span><br><span class="line"><span class="comment">				 带参数的异常通知  方法中写参数类型的全限定路径名 </span></span><br><span class="line"><span class="comment">				 throwing="e" 中的指定的参数 e 与 方法名中参数名一致</span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"testThrowing(java.lang.Exception)"</span> <span class="attr">pointcut-ref</span>=<span class="string">"someMethodPC"</span> <span class="attr">throwing</span>=<span class="string">"e"</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 最终通知 </span></span><br><span class="line"><span class="comment">				 不论程序是否发生问题，都要执行</span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"testLastAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"someMethodPC"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>切面测试类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.aspects;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;  <span class="comment">//导入这个包，别导错了 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  切入类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspects</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//前置通知</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">methodBefore</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"前置通知..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">methodBefore</span><span class="params">(JoinPoint jp)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"前置通知... jp:"</span>+jp);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//后置通知  </span></span><br><span class="line">	<span class="comment">//注意：后置通知方法中的参数名与注解中的返回值参数名保持一致</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterMethod</span><span class="params">(Object result)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"后置通知... 目标方法的返回值:"</span>+result);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//环绕通知</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object  <span class="title">aroundMethod</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"环绕通知前 .."</span>);</span><br><span class="line">		<span class="comment">//执行目标方法</span></span><br><span class="line">		String result = (String)joinPoint.proceed();</span><br><span class="line">		<span class="keyword">if</span>(result != <span class="keyword">null</span>)&#123;</span><br><span class="line">			result = result.toUpperCase();<span class="comment">//转换为大写</span></span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"环绕通知后 .."</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//异常通知</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testThrowing</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"异常通知..."</span>+e);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//最终通知</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLastAdvice</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"最终通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-Spring-事务管理"><a href="#4-Spring-事务管理" class="headerlink" title="4 Spring 事务管理"></a>4 Spring 事务管理</h1><blockquote>
<p>一般情况下，将事务从 dao 层提升到业务层，目的是运用事务的特性（ACID），便于管理具体的业务</p>
</blockquote>
<h2 id="4-1-Spring-事务管理API"><a href="#4-1-Spring-事务管理API" class="headerlink" title="4.1 Spring 事务管理API"></a>4.1 Spring 事务管理API</h2><p>PlatformTransctionManager 接口作为事务管理的对象。</p>
<p>其主要用于完成事务的提交、回滚、获取事务的状态信息</p>
<p>DataSourceTransactionManager 实现类  用于 jdbc 、mybatis </p>
<p>Spring 回滚方式：发生运行异常时回滚，发生受检查异常时提交。</p>
<p>事务定义接口 TransactionDefinition 中定义了事务描述相关变量：</p>
<ul>
<li>事务隔离级别</li>
<li>事务传播行为</li>
<li>事务默认超时时限</li>
<li>对上述事务的操作</li>
</ul>
<p>事务传播行为：处于不同事务中的方法在相互调用时，执行期间事务的维护情况。</p>
<p>REQUIRED: 指定方法必须在事务内执行</p>
<h2 id="4-2-使用-AspectJ-的AOP-配置管理事务"><a href="#4-2-使用-AspectJ-的AOP-配置管理事务" class="headerlink" title="4.2 使用 AspectJ 的AOP 配置管理事务"></a>4.2 使用 AspectJ 的AOP 配置管理事务</h2><blockquote>
<ol>
<li>注册事务管理器，依赖于数据源 dataSource</li>
<li>注册事务通知，设置连接的事务描述</li>
<li>AOP 配置</li>
</ol>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd "</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">     <span class="comment">&lt;!-- 加载数据库配置文件 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"db.properties"</span>/&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 加载数据源 ,使用 c3p0 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   	 </span><br><span class="line">   	 <span class="comment">&lt;!-- 账户  --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.AccountDaoImpl"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 基金 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fundDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.FundDaoImpl"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 基金业务层 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fundServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.FundServiceImpl"</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">ref</span>=<span class="string">"accountDaoImpl"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fundDaoImpl"</span> <span class="attr">ref</span>=<span class="string">"fundDaoImpl"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- 注册事务管理器 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">	 	 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- 注册事务通知 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- 连接点方法事务属性配置 --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"open*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	 			  注意：  rollback-for 的属性值是 异常类名</span></span><br><span class="line"><span class="comment">	 		 --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"buy*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"FundException"</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- AOP 配置 --&gt;</span>	</span><br><span class="line">	 <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!-- 切入点 --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* *..service.*.buyFund(..))"</span> <span class="attr">id</span>=<span class="string">"buyFundPC"</span>/&gt;</span>	</span><br><span class="line">	 		<span class="comment">&lt;!-- 通知 --&gt;</span>		</span><br><span class="line">		 	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"buyFundPC"</span>/&gt;</span> </span><br><span class="line">	 <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-3-AOP-事务注解方式"><a href="#4-3-AOP-事务注解方式" class="headerlink" title="4.3  AOP 事务注解方式"></a>4.3  AOP 事务注解方式</h2><ul>
<li>修改 代码，添加注释</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用 AOP 注解方式管理事务</span></span><br><span class="line"><span class="meta">@Transactional</span>(rollbackFor=FundException.class) </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buyFund</span><span class="params">(String aname, <span class="keyword">double</span> money, String fname, <span class="keyword">int</span> count)</span> <span class="keyword">throws</span> FundException </span>&#123;</span><br><span class="line">    accountDaoImpl.update(aname, money);</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span>==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FundException(<span class="string">"购买基金异常"</span>);			</span><br><span class="line">    &#125;</span><br><span class="line">    fundDaoImpl.update(fname, count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>applicationContext.xml  配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd "</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">     <span class="comment">&lt;!-- 加载数据库配置文件 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"db.properties"</span>/&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 加载数据源 ,使用 c3p0 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   	 </span><br><span class="line">   	 <span class="comment">&lt;!-- 账户  --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.AccountDaoImpl"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 基金 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fundDaoImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.dao.impl.FundDaoImpl"</span>&gt;</span></span><br><span class="line">     	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 基金业务层 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"fundServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.szxy.service.impl.FundServiceImpl"</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDaoImpl"</span> <span class="attr">ref</span>=<span class="string">"accountDaoImpl"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fundDaoImpl"</span> <span class="attr">ref</span>=<span class="string">"fundDaoImpl"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- 注册事务管理器 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">	 	 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- 注册事务通知 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- 连接点方法事务属性配置 --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"open*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	 			  注意：  rollback-for 的属性值是 异常类名</span></span><br><span class="line"><span class="comment">	 		 --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"buy*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"FundException"</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- AOP 配置 --&gt;</span>	</span><br><span class="line">	<span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">	 &lt;aop:config&gt;</span></span><br><span class="line"><span class="comment">	 		切入点</span></span><br><span class="line"><span class="comment">	 		&lt;aop:pointcut expression="execution(* *..service.*.buyFund(..))" id="buyFundPC"/&gt;	</span></span><br><span class="line"><span class="comment">	 		通知		</span></span><br><span class="line"><span class="comment">		 	&lt;aop:advisor advice-ref="txAdvice" pointcut-ref="buyFundPC"/&gt; </span></span><br><span class="line"><span class="comment">	 &lt;/aop:config&gt;</span></span><br><span class="line"><span class="comment">	  --&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!-- 使用 AOP 注解 --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>FundException 异常类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.exceptions;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  基金异常类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FundException</span> <span class="keyword">extends</span>  <span class="title">Exception</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">FundException</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	 </span><br><span class="line">	 <span class="function"><span class="keyword">public</span> <span class="title">FundException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">	        <span class="keyword">super</span>(message);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/04/04/20190404 OA管理系统开发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/04/04/20190404 OA管理系统开发/" class="post-title-link" itemprop="url">20190404 OA管理系统开发</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-04-04 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-04T00:00:00+08:00">2019-04-04</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-09 10:02:43" itemprop="dateModified" datetime="2019-05-09T10:02:43+08:00">2019-05-09</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-项目概况"><a href="#1-项目概况" class="headerlink" title="1 项目概况"></a>1 项目概况</h1><blockquote>
</blockquote>
<h1 id="2-搭建项目框架"><a href="#2-搭建项目框架" class="headerlink" title="2 搭建项目框架"></a>2 搭建项目框架</h1><p>1 设置工作空间的编码，设置 workspace 的编码为 utf-8</p>
<p>2  创建包和文件，注意可以不同文件夹创建相同的包，但是不能建相同类名的类</p>
<p>​    system 人事 、 duty 、 expense  、 inout 收支</p>
<p>3 导入 jar 包 和 工具类以及配置文件 </p>
<p>4 导入 SQL 脚本</p>
<h1 id="3-部门模块"><a href="#3-部门模块" class="headerlink" title="3 部门模块"></a>3 部门模块</h1><h2 id="3-1-Junit-测试"><a href="#3-1-Junit-测试" class="headerlink" title="3.1 Junit 测试"></a>3.1 Junit 测试</h2><blockquote>
<p>使用注解<code>@Test</code>进行测试</p>
<p>​                <code>@ignore</code>取消该方法的测试</p>
<p>建议测试方法名<code>testMethod()</code></p>
</blockquote>
<h2 id="3-2-重定向和请求转发"><a href="#3-2-重定向和请求转发" class="headerlink" title="3.2  重定向和请求转发"></a>3.2  重定向和请求转发</h2><blockquote>
<p>建议在提交表单后，使用重定向，防止表单重复提交，保护第一次请求数据。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.getContextPath()  <span class="comment">//动态获取上下文路径</span></span><br></pre></td></tr></table></figure>

<h2 id="3-3-断点调试"><a href="#3-3-断点调试" class="headerlink" title="3.3 断点调试"></a>3.3 断点调试</h2><blockquote>
<p>在 servlet 中，设置断点，然后在客户端执行相应的操作，查看代码的运行过程。</p>
</blockquote>
<ol>
<li>以 dubug 模式开启 server 服务器</li>
<li>设置断点</li>
<li>查看运行过程</li>
</ol>
<h2 id="3-3-时序图"><a href="#3-3-时序图" class="headerlink" title="3.3 时序图"></a>3.3 时序图</h2><h3 id="3-3-1-添加部门信息"><a href="#3-3-1-添加部门信息" class="headerlink" title="3.3.1 添加部门信息"></a>3.3.1 添加部门信息</h3><p><img src="http://www.zwer.xyz/picGo/20190404213006.png" alt></p>
<h3 id="3-3-2-部门信息更新操作"><a href="#3-3-2-部门信息更新操作" class="headerlink" title="3.3.2 部门信息更新操作"></a>3.3.2 部门信息更新操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">title: 更新操作</span><br><span class="line"></span><br><span class="line">participant deptList.jsp</span><br><span class="line">participant deptUpdate.jsp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DeparmentServlet -&gt; DepartmentService:调用 findDeptById(req,resp)方法</span><br><span class="line">DepartmentService -&gt; DepartmentDao:调用 findDeptById(int deptno)方法</span><br><span class="line">DepartmentDao -&gt; DBUtil:调用 findDeptById(int deptno)方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DBUtil - &gt; DepartmentDao: return dept</span><br><span class="line">DepartmentDao -&gt; DepartmentService: return dept </span><br><span class="line">DepartmentService-&gt; DeparmentServlet: return dept </span><br><span class="line">DeparmentServlet -&gt; deptUpdate.jsp:显示</span><br><span class="line"></span><br><span class="line">deptUpdate.jsp -&gt; DeparmentServlet: 发送请求update(Department dept)</span><br><span class="line">DeparmentServlet -&gt;DepartmentService: 调用update(Department dept)</span><br><span class="line">DepartmentService -&gt; DepartmentDao:调用 update(Department dept) </span><br><span class="line">DepartmentDao-&gt;DBUtil:调用 update(Department dept) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DBUtil - &gt; DepartmentDao: return dept</span><br><span class="line">DepartmentDao -&gt; DepartmentService: return dept </span><br><span class="line">DepartmentService-&gt; DeparmentServlet: return dept </span><br><span class="line">DeparmentServlet -&gt; deptList.jsp:显示</span><br></pre></td></tr></table></figure>

<h2 id="3-4-属性关联"><a href="#3-4-属性关联" class="headerlink" title="3.4  属性关联"></a>3.4  属性关联</h2><blockquote>
<p>用于实体类一对多关系</p>
<p>将表中的外键关系，在 java 语言用 类与类之间的关系表表示</p>
<p>new  java.sql.Date(().getTime);</p>
<p>如何表示员工所属一个部门、一个岗位、一个上级、甚至多个下级的信息？</p>
<p>在数据库中通过外键来实现： deptno、posid、mgrid</p>
<p>在 Java 类中通过属性关联来实现，即通过添加类有私有属性完成。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一对多的联系</span></span><br><span class="line"><span class="comment"> * 在 Java 类中通过属性关联的方式实现</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 	private Department dept;// 所在部门的信息</span></span><br><span class="line"><span class="comment">	private Position pos; //所在岗位的信息</span></span><br><span class="line"><span class="comment">	private Employee mgr; //上级领导</span></span><br><span class="line"><span class="comment">	private List&lt;Employee&gt; empList = new ArrayList&lt;&gt;(); //下级员工</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String empId;</span><br><span class="line">	<span class="keyword">private</span> String passWord;</span><br><span class="line">	<span class="keyword">private</span> String realName;</span><br><span class="line">	<span class="keyword">private</span> String sex;</span><br><span class="line">	<span class="keyword">private</span> Date birthDate; <span class="comment">//出生日期</span></span><br><span class="line">	<span class="keyword">private</span> Date hireDate;  <span class="comment">//入职日期</span></span><br><span class="line">	<span class="keyword">private</span> Date leaveDate; <span class="comment">//离职日期</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> onduty; <span class="comment">//   0-离职  1-在职         </span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> emptype;<span class="comment">//   1.普通员工  2.管理人员 含经理、总监、总裁等  3.管理员 	</span></span><br><span class="line">	<span class="keyword">private</span> String phone;</span><br><span class="line">	<span class="keyword">private</span> String qq;</span><br><span class="line">	<span class="keyword">private</span> String emerContactPerson;<span class="comment">//紧急联系人</span></span><br><span class="line">	<span class="keyword">private</span> String idCard; <span class="comment">// 身份证号</span></span><br><span class="line">	<span class="keyword">private</span> Department dept;<span class="comment">// 所在部门的信息</span></span><br><span class="line">	<span class="keyword">private</span> Position pos; <span class="comment">//所在岗位的信息</span></span><br><span class="line">	<span class="keyword">private</span> Employee mgr; <span class="comment">//上级领导</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Employee&gt; empList = <span class="keyword">new</span> ArrayList&lt;&gt;(); <span class="comment">//下级员工</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(String empId, String passWord, String realName, String sex,</span></span></span><br><span class="line"><span class="function"><span class="params">			Date birthDate, Date hireDate, Date leaveDate, <span class="keyword">int</span> onduty,</span></span></span><br><span class="line"><span class="function"><span class="params">			<span class="keyword">int</span> emptype, String phone, String qq, String emerContactPerson,</span></span></span><br><span class="line"><span class="function"><span class="params">			String idCard, Department dept, Position pos, Employee mgr,</span></span></span><br><span class="line"><span class="function"><span class="params">			List&lt;Employee&gt; empList)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.empId = empId;</span><br><span class="line">		<span class="keyword">this</span>.passWord = passWord;</span><br><span class="line">		<span class="keyword">this</span>.realName = realName;</span><br><span class="line">		<span class="keyword">this</span>.sex = sex;</span><br><span class="line">		<span class="keyword">this</span>.birthDate = birthDate;</span><br><span class="line">		<span class="keyword">this</span>.hireDate = hireDate;</span><br><span class="line">		<span class="keyword">this</span>.leaveDate = leaveDate;</span><br><span class="line">		<span class="keyword">this</span>.onduty = onduty;</span><br><span class="line">		<span class="keyword">this</span>.emptype = emptype;</span><br><span class="line">		<span class="keyword">this</span>.phone = phone;</span><br><span class="line">		<span class="keyword">this</span>.qq = qq;</span><br><span class="line">		<span class="keyword">this</span>.emerContactPerson = emerContactPerson;</span><br><span class="line">		<span class="keyword">this</span>.idCard = idCard;</span><br><span class="line">		<span class="keyword">this</span>.dept = dept;</span><br><span class="line">		<span class="keyword">this</span>.pos = pos;</span><br><span class="line">		<span class="keyword">this</span>.mgr = mgr;</span><br><span class="line">		<span class="keyword">this</span>.empList = empList;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(String empId, String passWord, String realName, String sex,</span></span></span><br><span class="line"><span class="function"><span class="params">			Date birthDate, Date hireDate, Date leaveDate, <span class="keyword">int</span> onduty,</span></span></span><br><span class="line"><span class="function"><span class="params">			<span class="keyword">int</span> emptype, String phone, String qq, String emerContactPerson,</span></span></span><br><span class="line"><span class="function"><span class="params">			String idCard, Department dept, Position pos, Employee mgr)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.empId = empId;</span><br><span class="line">		<span class="keyword">this</span>.passWord = passWord;</span><br><span class="line">		<span class="keyword">this</span>.realName = realName;</span><br><span class="line">		<span class="keyword">this</span>.sex = sex;</span><br><span class="line">		<span class="keyword">this</span>.birthDate = birthDate;</span><br><span class="line">		<span class="keyword">this</span>.hireDate = hireDate;</span><br><span class="line">		<span class="keyword">this</span>.leaveDate = leaveDate;</span><br><span class="line">		<span class="keyword">this</span>.onduty = onduty;</span><br><span class="line">		<span class="keyword">this</span>.emptype = emptype;</span><br><span class="line">		<span class="keyword">this</span>.phone = phone;</span><br><span class="line">		<span class="keyword">this</span>.qq = qq;</span><br><span class="line">		<span class="keyword">this</span>.emerContactPerson = emerContactPerson;</span><br><span class="line">		<span class="keyword">this</span>.idCard = idCard;</span><br><span class="line">		<span class="keyword">this</span>.dept = dept;</span><br><span class="line">		<span class="keyword">this</span>.pos = pos;</span><br><span class="line">		<span class="keyword">this</span>.mgr = mgr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmpId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> empId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmpId</span><span class="params">(String empId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.empId = empId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassWord</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> passWord;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassWord</span><span class="params">(String passWord)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.passWord = passWord;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getRealName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> realName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRealName</span><span class="params">(String realName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.realName = realName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sex = sex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getBirthDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> birthDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthDate</span><span class="params">(Date birthDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.birthDate = birthDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getHireDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> hireDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHireDate</span><span class="params">(Date hireDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.hireDate = hireDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getLeaveDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> leaveDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeaveDate</span><span class="params">(Date leaveDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.leaveDate = leaveDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOnduty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> onduty;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnduty</span><span class="params">(<span class="keyword">int</span> onduty)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.onduty = onduty;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getEmptype</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> emptype;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmptype</span><span class="params">(<span class="keyword">int</span> emptype)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.emptype = emptype;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPhone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> phone;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPhone</span><span class="params">(String phone)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.phone = phone;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getQq</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> qq;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQq</span><span class="params">(String qq)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.qq = qq;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmerContactPerson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> emerContactPerson;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmerContactPerson</span><span class="params">(String emerContactPerson)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.emerContactPerson = emerContactPerson;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getIdCard</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> idCard;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIdCard</span><span class="params">(String idCard)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.idCard = idCard;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Department <span class="title">getDept</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dept;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDept</span><span class="params">(Department dept)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.dept = dept;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Position <span class="title">getPos</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pos;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPos</span><span class="params">(Position pos)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pos = pos;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Employee <span class="title">getMgr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mgr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMgr</span><span class="params">(Employee mgr)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mgr = mgr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> empList;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmpList</span><span class="params">(List&lt;Employee&gt; empList)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.empList = empList;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="keyword">int</span> prime = <span class="number">31</span>;</span><br><span class="line">		<span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((birthDate == <span class="keyword">null</span>) ? <span class="number">0</span> : birthDate.hashCode());</span><br><span class="line">		result = prime * result + ((dept == <span class="keyword">null</span>) ? <span class="number">0</span> : dept.hashCode());</span><br><span class="line">		result = prime</span><br><span class="line">				* result</span><br><span class="line">				+ ((emerContactPerson == <span class="keyword">null</span>) ? <span class="number">0</span> : emerContactPerson</span><br><span class="line">						.hashCode());</span><br><span class="line">		result = prime * result + ((empId == <span class="keyword">null</span>) ? <span class="number">0</span> : empId.hashCode());</span><br><span class="line">		result = prime * result + ((empList == <span class="keyword">null</span>) ? <span class="number">0</span> : empList.hashCode());</span><br><span class="line">		result = prime * result + emptype;</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((hireDate == <span class="keyword">null</span>) ? <span class="number">0</span> : hireDate.hashCode());</span><br><span class="line">		result = prime * result + ((idCard == <span class="keyword">null</span>) ? <span class="number">0</span> : idCard.hashCode());</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((leaveDate == <span class="keyword">null</span>) ? <span class="number">0</span> : leaveDate.hashCode());</span><br><span class="line">		result = prime * result + ((mgr == <span class="keyword">null</span>) ? <span class="number">0</span> : mgr.hashCode());</span><br><span class="line">		result = prime * result + onduty;</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((passWord == <span class="keyword">null</span>) ? <span class="number">0</span> : passWord.hashCode());</span><br><span class="line">		result = prime * result + ((phone == <span class="keyword">null</span>) ? <span class="number">0</span> : phone.hashCode());</span><br><span class="line">		result = prime * result + ((pos == <span class="keyword">null</span>) ? <span class="number">0</span> : pos.hashCode());</span><br><span class="line">		result = prime * result + ((qq == <span class="keyword">null</span>) ? <span class="number">0</span> : qq.hashCode());</span><br><span class="line">		result = prime * result</span><br><span class="line">				+ ((realName == <span class="keyword">null</span>) ? <span class="number">0</span> : realName.hashCode());</span><br><span class="line">		result = prime * result + ((sex == <span class="keyword">null</span>) ? <span class="number">0</span> : sex.hashCode());</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span> == obj)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		<span class="keyword">if</span> (obj == <span class="keyword">null</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (getClass() != obj.getClass())</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		Employee other = (Employee) obj;</span><br><span class="line">		<span class="keyword">if</span> (birthDate == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.birthDate != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!birthDate.equals(other.birthDate))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (dept == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.dept != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!dept.equals(other.dept))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (emerContactPerson == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.emerContactPerson != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!emerContactPerson.equals(other.emerContactPerson))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (empId == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.empId != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!empId.equals(other.empId))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (empList == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.empList != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!empList.equals(other.empList))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (emptype != other.emptype)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (hireDate == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.hireDate != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!hireDate.equals(other.hireDate))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (idCard == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.idCard != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!idCard.equals(other.idCard))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (leaveDate == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.leaveDate != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!leaveDate.equals(other.leaveDate))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (mgr == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.mgr != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!mgr.equals(other.mgr))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (onduty != other.onduty)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (passWord == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.passWord != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!passWord.equals(other.passWord))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (phone == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.phone != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!phone.equals(other.phone))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (pos == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.pos != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!pos.equals(other.pos))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (qq == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.qq != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!qq.equals(other.qq))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (realName == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.realName != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!realName.equals(other.realName))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (sex == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (other.sex != <span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!sex.equals(other.sex))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Employee [empId="</span> + empId + <span class="string">", passWord="</span> + passWord</span><br><span class="line">				+ <span class="string">", realName="</span> + realName + <span class="string">", sex="</span> + sex + <span class="string">", birthDate="</span></span><br><span class="line">				+ birthDate + <span class="string">", hireDate="</span> + hireDate + <span class="string">", leaveDate="</span></span><br><span class="line">				+ leaveDate + <span class="string">", onduty="</span> + onduty + <span class="string">", emptype="</span> + emptype</span><br><span class="line">				+ <span class="string">", phone="</span> + phone + <span class="string">", qq="</span> + qq + <span class="string">", emerContactPerson="</span></span><br><span class="line">				+ emerContactPerson + <span class="string">", idCard="</span> + idCard + <span class="string">", dept="</span> + dept</span><br><span class="line">				+ <span class="string">", pos="</span> + pos + <span class="string">", mgr="</span> + mgr + <span class="string">", empList="</span> + empList</span><br><span class="line">				+ <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-5-日历插件"><a href="#3-5-日历插件" class="headerlink" title="3.5  日历插件"></a>3.5  日历插件</h2><blockquote>
<p>使用日历插件的步骤</p>
<p>导入日历插件的Js文件，对 input 输入框添加焦点事件，使用 WdatePicker()函数，</p>
<p>配置使用参数 Json 格式 {属性名：属性值}</p>
</blockquote>
<ol>
<li>导入日历插件的 Js 文件</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入日历插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"My97DatePicker/WdatePicker.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>添加鼠标事件，使用日历插件</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>出生日期<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"dfinput"</span> 		       <span class="attr">onfocus</span>=<span class="string">"WdatePicker(&#123;lang:'en',skin:'whyGreen'&#125;)"</span>/&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">i</span>&gt;</span>也可以根据身份证号自动获取<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>调整日历插件的配置,使用 json 格式</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WdatePicker(&#123;lang:'en',skin:'whyGreen'&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="3-6-富文本编辑器"><a href="#3-6-富文本编辑器" class="headerlink" title="3.6 富文本编辑器"></a>3.6 富文本编辑器</h2><blockquote>
<p>使用富文本编辑器 KindEditor</p>
</blockquote>
<ol>
<li>导入富文本编辑器 JS 文件</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入富文本编辑器插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"editor/kindeditor.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>绑定 ID</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>紧急联系人信息<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">""</span>  <span class="attr">id</span>=<span class="string">"ecp"</span> <span class="attr">cols</span>=<span class="string">""</span> <span class="attr">rows</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"textinput"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改配置</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">		<span class="comment">// 注意：要选择 id 键，指明在哪里使用富文本编辑器</span></span></span><br><span class="line"><span class="javascript">		KE.show(&#123;<span class="attr">id</span>:<span class="string">"ecp"</span>,<span class="attr">width</span>:<span class="string">"500px"</span>,<span class="attr">height</span>:<span class="string">"300px;"</span>,<span class="attr">resizeType</span>:<span class="number">1</span>,<span class="attr">skinType</span>:<span class="string">"tinymce"</span>,</span></span><br><span class="line">			items:[</span><br><span class="line"><span class="javascript">		        <span class="string">'source'</span>, <span class="string">'|'</span>, <span class="string">'undo'</span>, <span class="string">'redo'</span>, <span class="string">'|'</span>, <span class="string">'preview'</span>, <span class="string">'print'</span>, <span class="string">'template'</span>, <span class="string">'code'</span>, <span class="string">'cut'</span>, <span class="string">'copy'</span>, <span class="string">'paste'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'plainpaste'</span>, <span class="string">'wordpaste'</span>, <span class="string">'|'</span>, <span class="string">'justifyleft'</span>, <span class="string">'justifycenter'</span>, <span class="string">'justifyright'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'justifyfull'</span>, <span class="string">'insertorderedlist'</span>, <span class="string">'insertunorderedlist'</span>, <span class="string">'indent'</span>, <span class="string">'outdent'</span>, <span class="string">'subscript'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'superscript'</span>, <span class="string">'clearhtml'</span>, <span class="string">'quickformat'</span>, <span class="string">'selectall'</span>, <span class="string">'|'</span>, <span class="string">'fullscreen'</span>, <span class="string">'/'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'formatblock'</span>, <span class="string">'fontname'</span>, <span class="string">'fontsize'</span>, <span class="string">'|'</span>, <span class="string">'forecolor'</span>, <span class="string">'hilitecolor'</span>, <span class="string">'bold'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'italic'</span>, <span class="string">'underline'</span>, <span class="string">'strikethrough'</span>, <span class="string">'lineheight'</span>, <span class="string">'removeformat'</span>, <span class="string">'|'</span>, <span class="string">'image'</span>, <span class="string">'multiimage'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'flash'</span>, <span class="string">'media'</span>, <span class="string">'insertfile'</span>, <span class="string">'table'</span>, <span class="string">'hr'</span>, <span class="string">'emoticons'</span>, <span class="string">'baidumap'</span>, <span class="string">'pagebreak'</span>,</span></span><br><span class="line"><span class="javascript">		        <span class="string">'anchor'</span>, <span class="string">'link'</span>, <span class="string">'unlink'</span>, <span class="string">'|'</span>, <span class="string">'about'</span></span></span><br><span class="line">		]</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-8-一对多查询"><a href="#3-8-一对多查询" class="headerlink" title="3.8  一对多查询"></a>3.8  一对多查询</h2><blockquote>
<p>SQL 语句采用多表连接的方式，按需求将所需数据查找出来。</p>
<p>不建议采用 调用其他 dao 层 对象查找所需数据，再组合起来，这样耦合性高，查询效率不理想。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">findAllEmpsInfoService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Connection conn = <span class="keyword">null</span>;</span><br><span class="line">		PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">		ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">		List&lt;Employee&gt; emps = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			conn = DBUtil.getConnection();</span><br><span class="line">			<span class="comment">/*String sql = "select * from employee";*/</span></span><br><span class="line">			String sql = <span class="string">"select  e.*,d.deptname,d.location,p.pname,mgr.empid,mgr.realname"</span>+</span><br><span class="line">						 <span class="string">"	from employee e"</span>+</span><br><span class="line">						 <span class="string">"	left join dept d"</span>+</span><br><span class="line">						 <span class="string">"	on e.deptno = d.deptno"</span>+</span><br><span class="line">						 <span class="string">"	left join position p"</span>+</span><br><span class="line">						 <span class="string">"	on e.posid = p.posid"</span>+</span><br><span class="line">						 <span class="string">"	left join employee mgr"</span>+</span><br><span class="line">						 <span class="string">"	on e.mgrid = mgr.empid"</span>;</span><br><span class="line">			ps = conn.prepareStatement(sql);</span><br><span class="line">			rs = ps.executeQuery();</span><br><span class="line">			emps = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">			<span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">				Employee emp = <span class="keyword">new</span> Employee();</span><br><span class="line">				emp.setEmpId(rs.getString(<span class="string">"empid"</span>));</span><br><span class="line">				emp.setRealName(rs.getString(<span class="string">"realname"</span>));</span><br><span class="line">				emp.setPassWord(rs.getString(<span class="string">"password"</span>));</span><br><span class="line">				emp.setSex(rs.getString(<span class="string">"sex"</span>));</span><br><span class="line">				emp.setHireDate(rs.getDate(<span class="string">"hiredate"</span>));</span><br><span class="line">				emp.setBirthDate(rs.getDate(<span class="string">"birthdate"</span>));</span><br><span class="line">				emp.setLeaveDate(rs.getDate(<span class="string">"leavedate"</span>));</span><br><span class="line">				emp.setPhone(rs.getString(<span class="string">"phone"</span>));</span><br><span class="line">				emp.setEmptype(rs.getInt(<span class="string">"emptype"</span>));</span><br><span class="line">				emp.setOnduty(rs.getInt(<span class="string">"onduty"</span>));</span><br><span class="line">				emp.setQq(rs.getString(<span class="string">"qq"</span>));</span><br><span class="line">				emp.setEmerContactPerson(rs.getString(<span class="string">"emercontactperson"</span>));</span><br><span class="line">				emp.setIdCard(rs.getString(<span class="string">"idcard"</span>));</span><br><span class="line">				</span><br><span class="line">				Department dept = <span class="keyword">new</span> Department();</span><br><span class="line">				dept.setDeptno(rs.getInt(<span class="string">"deptno"</span>));</span><br><span class="line">				dept.setDeptName(rs.getString(<span class="string">"deptName"</span>));</span><br><span class="line">				emp.setDept(dept);</span><br><span class="line">				</span><br><span class="line">				Position pos = <span class="keyword">new</span> Position();</span><br><span class="line">				pos.setPosid(rs.getInt(<span class="string">"posid"</span>));</span><br><span class="line">				pos.setPosName(rs.getString(<span class="string">"pname"</span>));</span><br><span class="line">				emp.setPos(pos);</span><br><span class="line">				</span><br><span class="line">				Employee mgr = <span class="keyword">new</span> Employee();</span><br><span class="line">				mgr.setEmpId(rs.getString(<span class="string">"empid"</span>));</span><br><span class="line">				mgr.setRealName(rs.getString(<span class="string">"realname"</span>));</span><br><span class="line">				emp.setMgr(mgr);</span><br><span class="line">				</span><br><span class="line">				<span class="comment">// 耦合性太高，而且查询速度慢</span></span><br><span class="line">			<span class="comment">/*	//调用 DepartmentDao</span></span><br><span class="line"><span class="comment">				DepartmentDao deptDao = new DepartmentDaoImpl();</span></span><br><span class="line"><span class="comment">				Department dept = deptDao.findDeptInfoByIdDao(rs.getInt("emptype")); </span></span><br><span class="line"><span class="comment">				emp.setDept(dept);</span></span><br><span class="line"><span class="comment">				//调用 PositionDao </span></span><br><span class="line"><span class="comment">				PositionDao posDao = new PositionDaoImpl();</span></span><br><span class="line"><span class="comment">				Position pos = posDao.findPosInfoById(rs.getString("posid"));</span></span><br><span class="line"><span class="comment">				emp.setPos(pos);</span></span><br><span class="line"><span class="comment">				//调用 this ,查找该员工的上级信息</span></span><br><span class="line"><span class="comment">				Employee mgr = this.findEmpInfoByIdDao(rs.getString("mgrid"));</span></span><br><span class="line"><span class="comment">				emp.setMgr(mgr);</span></span><br><span class="line"><span class="comment">				//调用 this ，查找该员工的所有下级信息</span></span><br><span class="line"><span class="comment">				List&lt;Employee&gt; empList = this.findEmpsInfoByMgrDao(rs.getString("mgrid"));</span></span><br><span class="line"><span class="comment">				emp.setEmpList(empList);*/</span></span><br><span class="line">						</span><br><span class="line">				emps.add(emp);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			DBUtil.closeAll(rs, ps, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> emps; </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-9-动态-SQL语句"><a href="#3-9-动态-SQL语句" class="headerlink" title="3.9  动态 SQL语句"></a>3.9  动态 SQL语句</h2><blockquote>
<p>使用 <code>StringBuilder</code> 类中 <code>append</code> 方法，j加上 if  条件动态控制 where 子句的查询条件的选择</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*String sql = "select * from employee";*/</span></span><br><span class="line">StringBuilder sql = <span class="keyword">new</span> StringBuilder(<span class="string">"select  e.*,d.deptname,d.location,p.pname,mgr.empid,mgr.realname mgrRealName"</span>+</span><br><span class="line">				<span class="string">" from employee e"</span>+</span><br><span class="line">				<span class="string">" left join dept d"</span>+</span><br><span class="line">				<span class="string">" on e.deptno = d.deptno"</span>+</span><br><span class="line">				<span class="string">" left join position p"</span>+</span><br><span class="line">				<span class="string">" on e.posid = p.posid"</span>+</span><br><span class="line">				<span class="string">" left join employee mgr"</span>+</span><br><span class="line">				<span class="string">" on e.mgrid = mgr.empid where 1=1"</span>);</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(empId !=<span class="keyword">null</span>&amp;&amp;!empId.equals(<span class="string">""</span>))&#123;</span><br><span class="line">					sql.append(<span class="string">" and e.empid like '%"</span>+empId+<span class="string">"%'"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(deptNO !=<span class="keyword">null</span> &amp;&amp; !deptNO.equals(<span class="string">"0"</span>))&#123;</span><br><span class="line">					sql.append(<span class="string">" and e.deptno ="</span>+deptNO);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(onDuty !=<span class="keyword">null</span> &amp;&amp; !empId.equals(<span class="string">""</span>))&#123;</span><br><span class="line">					sql.append(<span class="string">" and e.onDuty ="</span>+onDuty);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				</span><br><span class="line">				System.out.println(sql.toString());</span><br><span class="line">				ps = conn.prepareStatement(sql.toString());</span><br></pre></td></tr></table></figure>

<h2 id="3-10-servlet-接受表单数据预处理"><a href="#3-10-servlet-接受表单数据预处理" class="headerlink" title="3.10 servlet 接受表单数据预处理"></a>3.10 servlet 接受表单数据预处理</h2><blockquote>
<p>通过预先对传入的数据进行 null 值判断。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转换日期格式</span></span><br><span class="line">SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-mm-dd"</span>);</span><br><span class="line">Date birthDate = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    birthDate = sdf.parse(sBirthDay);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(hireDate !=<span class="keyword">null</span> &amp;&amp; !hireDate.equals(<span class="string">""</span>))&#123;</span><br><span class="line">    Date date = <span class="keyword">new</span> java.sql.Date(hireDate.getTime());</span><br><span class="line">    sql.append(<span class="string">" and to_char(e.hiredate,'yyyy-MM-dd') &gt;='"</span>+date+<span class="string">"'"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-11-获取同名列的问题"><a href="#3-11-获取同名列的问题" class="headerlink" title="3.11 获取同名列的问题"></a>3.11 获取同名列的问题</h2><blockquote>
<p>解决方法：为同名列起别名，区分不同同名列。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">StringBuilder sql = </span><br><span class="line"> 	<span class="keyword">new</span> StringBuilder(<span class="string">"select  e.*,d.deptname,d.location,p.pname,mgr.empid,mgr.realname mgrRealName"</span>+</span><br><span class="line">                      <span class="string">" from employee e"</span>+</span><br><span class="line">                      <span class="string">" left join dept d"</span>+</span><br><span class="line">                      <span class="string">" on e.deptno = d.deptno"</span>+</span><br><span class="line">                      <span class="string">" left join position p"</span>+</span><br><span class="line">                      <span class="string">" on e.posid = p.posid"</span>+</span><br><span class="line">                      <span class="string">" left join employee mgr"</span>+</span><br><span class="line">                      <span class="string">" on e.mgrid = mgr.empid where 1=1"</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-12-form表单提交问题"><a href="#3-12-form表单提交问题" class="headerlink" title="3.12 form表单提交问题"></a>3.12 form表单提交问题</h2><blockquote>
<p>注意：写明提交方式，否则 action 后面附带的参数不提交。</p>
</blockquote>
<h2 id="3-13-删除员工"><a href="#3-13-删除员工" class="headerlink" title="3.13 删除员工"></a>3.13 删除员工</h2><blockquote>
<p>不删除员工，将员工设为离职状态</p>
</blockquote>
<h2 id="3-14-更新员工信息"><a href="#3-14-更新员工信息" class="headerlink" title="3.14 更新员工信息"></a>3.14 更新员工信息</h2><blockquote>
<p>设置员工的用户名不可修改</p>
<p>寻找插件将输入的用户名中文转为收汉语拼音</p>
</blockquote>
<h1 id="4-考勤模块"><a href="#4-考勤模块" class="headerlink" title="4 考勤模块"></a>4 考勤模块</h1><h2 id="4-1-登录模块"><a href="#4-1-登录模块" class="headerlink" title="4.1 登录模块"></a>4.1 登录模块</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"pwd"</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"loginpwd"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">onclick</span>=<span class="string">"JavaScript:this.value=''"</span>/&gt;</span>  <span class="comment">&lt;!-- 单击清空输入框  -&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-1-1-菜单分栏"><a href="#4-1-1-菜单分栏" class="headerlink" title="4.1.1 菜单分栏"></a>4.1.1 菜单分栏</h3><blockquote>
<p>根据用户的类型，显示不同的菜单。</p>
</blockquote>
<h3 id="4-1-2-验证码"><a href="#4-1-2-验证码" class="headerlink" title="4.1.2 验证码"></a>4.1.2 验证码</h3><blockquote>
<p>登录验证码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.Font;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 在内存中创建图象</span></span><br><span class="line">		<span class="keyword">int</span> width = <span class="number">110</span>, height = <span class="number">30</span>;</span><br><span class="line">		BufferedImage image = <span class="keyword">new</span> BufferedImage(width, height,</span><br><span class="line">				BufferedImage.TYPE_INT_RGB);</span><br><span class="line">		<span class="comment">// 获取图形上下文</span></span><br><span class="line">		Graphics g = image.getGraphics();</span><br><span class="line">		<span class="comment">// 生成随机类</span></span><br><span class="line">		Random random = <span class="keyword">new</span> Random();</span><br><span class="line">		<span class="comment">// 设定背景色</span></span><br><span class="line">		g.setColor(getRandColor(<span class="number">200</span>, <span class="number">250</span>));</span><br><span class="line">		g.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">		<span class="comment">// 设定字体</span></span><br><span class="line">		g.setFont(<span class="keyword">new</span> Font(<span class="string">"Times New Roman"</span>, Font.PLAIN, <span class="number">20</span>));</span><br><span class="line">		<span class="comment">// 随机产生155条干扰线，使图象中的认证码不易被其它程序探测到</span></span><br><span class="line">		g.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">155</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">int</span> x = random.nextInt(width);</span><br><span class="line">			<span class="keyword">int</span> y = random.nextInt(height);</span><br><span class="line">			<span class="keyword">int</span> xl = random.nextInt(<span class="number">12</span>);</span><br><span class="line">			<span class="keyword">int</span> yl = random.nextInt(<span class="number">12</span>);</span><br><span class="line">			g.drawLine(x, y, x + xl, y + yl);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 取随机产生的认证码(6位数字)</span></span><br><span class="line">		String sRand = <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">			String rand = String.valueOf(random.nextInt(<span class="number">10</span>));</span><br><span class="line">			sRand += rand;</span><br><span class="line">			<span class="comment">// 将认证码显示到图象中</span></span><br><span class="line">			g.setColor(<span class="keyword">new</span> Color(<span class="number">20</span> + random.nextInt(<span class="number">110</span>), <span class="number">20</span> + random</span><br><span class="line">					.nextInt(<span class="number">110</span>), <span class="number">20</span> + random.nextInt(<span class="number">110</span>)));</span><br><span class="line">			<span class="comment">// 调用函数出来的颜色相同，可能是因为种子太接近，所以只能直接生成</span></span><br><span class="line">			g.drawString(rand, <span class="number">13</span> * i + <span class="number">6</span>, <span class="number">16</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 图象生效</span></span><br><span class="line">		g.dispose();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			ImageIO.write(image, <span class="string">"JPEG"</span>, response.getOutputStream());</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			System.out.println(<span class="string">"验证码图片产生出现错误："</span> + e.toString());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//保存验证码到Session</span></span><br><span class="line">		request.getSession().setAttribute(<span class="string">"randStr"</span>, sRand);</span><br><span class="line">	<span class="comment">/*	System.out.println("randStr"+sRand);*/</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>.doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 给定范围获得随机颜色</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Color <span class="title">getRandColor</span><span class="params">(<span class="keyword">int</span> fc, <span class="keyword">int</span> bc)</span> </span>&#123;</span><br><span class="line">		Random random = <span class="keyword">new</span> Random();</span><br><span class="line">		<span class="keyword">if</span> (fc &gt; <span class="number">255</span>)</span><br><span class="line">			fc = <span class="number">255</span>;</span><br><span class="line">		<span class="keyword">if</span> (bc &gt; <span class="number">255</span>)</span><br><span class="line">			bc = <span class="number">255</span>;</span><br><span class="line">		<span class="keyword">int</span> r = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">int</span> g = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">int</span> b = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Color(r, g, b);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-5-查看考勤信息模块"><a href="#4-5-查看考勤信息模块" class="headerlink" title="4.5 查看考勤信息模块"></a>4.5 查看考勤信息模块</h2><h3 id="4-5-1-动态-SQL"><a href="#4-5-1-动态-SQL" class="headerlink" title="4.5.1  动态 SQL"></a>4.5.1  动态 SQL</h3><blockquote>
<p>注意：拼接 字符串SQL 时，注意两边需要加单引号</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">StringBuilder  sql = <span class="keyword">new</span> StringBuilder(<span class="string">"select dt.*,e.realname,d.deptno deptno,d.deptname"</span>+</span><br><span class="line">						<span class="string">" from duty  dt"</span>+</span><br><span class="line">						<span class="string">" join employee e"</span>+</span><br><span class="line">						<span class="string">" on dt.emprid = e.empid"</span>+</span><br><span class="line">						<span class="string">" join dept d"</span>+</span><br><span class="line">						<span class="string">" on e.deptno = d.deptno"</span>+</span><br><span class="line">						<span class="string">" where 1=1"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(empId!=<span class="keyword">null</span>&amp;&amp;!<span class="string">""</span>.equals(empId))&#123;</span><br><span class="line">				sql.append(<span class="string">"and dt.emprid = '"</span>+empId+<span class="string">"'"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(deptNo!=<span class="number">0</span>)&#123;</span><br><span class="line">				sql.append(<span class="string">"and d.deptno = "</span>+deptNo);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(dtDate!=<span class="keyword">null</span>&amp;!<span class="string">""</span>.equals(dtDate))&#123;</span><br><span class="line">				sql.append(<span class="string">"and to_char(dt.dtdate,'yyyy-MM-dd') &gt;='"</span>+dtDate+<span class="string">"'"</span>);</span><br><span class="line">			</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(sql.toString());</span><br></pre></td></tr></table></figure>

<h3 id="4-5-2-PIO"><a href="#4-5-2-PIO" class="headerlink" title="4.5.2 PIO"></a>4.5.2 PIO</h3><blockquote>
<p><a href="https://baike.baidu.com/item/Apache/6265" target="_blank" rel="noopener">Apache</a> POI 是用<a href="https://baike.baidu.com/item/Java/85979" target="_blank" rel="noopener">Java</a>编写的免费开源的跨平台的 Java API，Apache POI提供API给Java程式对[Microsoft Office](<a href="https://baike.baidu.com/item/Microsoft" target="_blank" rel="noopener">https://baike.baidu.com/item/Microsoft</a> Office)格式档案读和写的功能。POI为“Poor Obfuscation Implementation”的首字母缩写，意为“简洁版的模糊实现”。</p>
</blockquote>
<ul>
<li><p>栗子</p>
<p>将考勤信息导出为 xls 格式的文档，然后通过浏览器下载到本地保存</p>
<p>注意：将xls格式的文档通过流的方式发送给客户端，并且要设置响应数据的格式和响应头</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据条件查询考勤信息</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllDutyInfoByCondition</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException, ServletException</span>&#123;</span><br><span class="line">		<span class="comment">//获取请求处理参数</span></span><br><span class="line">		String empId = req.getParameter(<span class="string">"empId"</span>);</span><br><span class="line">		</span><br><span class="line">		String sdeptNo = req.getParameter(<span class="string">"deptNo"</span>);</span><br><span class="line">		<span class="keyword">int</span> deptNo = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			deptNo = Integer.valueOf(sdeptNo); <span class="comment">// null 、非法字符</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(NumberFormatException e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		String sdtDate = req.getParameter(<span class="string">"dtDate"</span>);</span><br><span class="line">		Date dtDate = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			DateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">			dtDate = sdf.parse(sdtDate);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//调用业务层对象</span></span><br><span class="line">		List&lt;Duty&gt; dutyList = dutyService.findAllDutyInfoByConditionService(empId,deptNo,dtDate);</span><br><span class="line">		<span class="comment">//响应处理结果</span></span><br><span class="line">		Gson gson = <span class="keyword">new</span> GsonBuilder().setDateFormat(<span class="string">"yyyy-MM-dd"</span>).create();<span class="comment">//日期格式化</span></span><br><span class="line">		resp.getWriter().print(gson.toJson(dutyList));<span class="comment">//使用 ajax ，直接响应</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 导出 考勤信息 xls 文档</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exportXls</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException, ServletException</span>&#123;</span><br><span class="line">		<span class="comment">//获取请求处理参数</span></span><br><span class="line">		String empId = req.getParameter(<span class="string">"empId"</span>);</span><br><span class="line">		</span><br><span class="line">		String sdeptNo = req.getParameter(<span class="string">"deptNo"</span>);</span><br><span class="line">		<span class="keyword">int</span> deptNo = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			deptNo = Integer.valueOf(sdeptNo); <span class="comment">// null 、非法字符</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(NumberFormatException e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		String sdtDate = req.getParameter(<span class="string">"dtDate"</span>);</span><br><span class="line">		Date dtDate = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			DateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">			dtDate = sdf.parse(sdtDate);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//调用业务层对象</span></span><br><span class="line">		List&lt;Duty&gt; dutyList = dutyService.findAllDutyInfoByConditionService(empId,deptNo,dtDate);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//响应处理结果</span></span><br><span class="line">		createExcel(dutyList,resp);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createExcel</span><span class="params">(List&lt;Duty&gt; list,HttpServletResponse resp)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建一个Excel文件</span></span><br><span class="line">        HSSFWorkbook workbook = <span class="keyword">new</span> HSSFWorkbook();</span><br><span class="line">        <span class="comment">// 创建一个工作表</span></span><br><span class="line">        HSSFSheet sheet = workbook.createSheet(<span class="string">"考勤表一"</span>);</span><br><span class="line">        </span><br><span class="line">        CellRangeAddress region = <span class="keyword">new</span> CellRangeAddress(<span class="number">0</span>, <span class="comment">// first row</span></span><br><span class="line">                <span class="number">0</span>, <span class="comment">// last row</span></span><br><span class="line">                <span class="number">0</span>, <span class="comment">// first column</span></span><br><span class="line">                <span class="number">2</span> <span class="comment">// last column</span></span><br><span class="line">        );</span><br><span class="line">        sheet.addMergedRegion(region);</span><br><span class="line">        </span><br><span class="line">        HSSFRow hssfRow = sheet.createRow(<span class="number">0</span>);</span><br><span class="line">        HSSFCell headCell = hssfRow.createCell(<span class="number">0</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"OA系统之考勤列表"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置单元格格式居中</span></span><br><span class="line">        HSSFCellStyle cellStyle = workbook.createCellStyle();</span><br><span class="line">    	cellStyle.setAlignment(HSSFCellStyle.ALIGN_CENTER);</span><br><span class="line">      </span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加表头行</span></span><br><span class="line">        hssfRow = sheet.createRow(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 添加表头内容</span></span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">0</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"用户名"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">1</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"真实姓名"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">2</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"所属部门"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line">        </span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">3</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"出勤日期"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line">        </span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">4</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"签到时间"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line">        </span><br><span class="line">        headCell = hssfRow.createCell(<span class="number">5</span>);</span><br><span class="line">        headCell.setCellValue(<span class="string">"签退时间"</span>);</span><br><span class="line">        headCell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加数据内容</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            hssfRow = sheet.createRow((<span class="keyword">int</span>) i + <span class="number">2</span>);</span><br><span class="line">            Duty duty = list.get(i);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建单元格，并设置值</span></span><br><span class="line">            HSSFCell cell = hssfRow.createCell(<span class="number">0</span>);</span><br><span class="line">            cell.setCellValue(duty.getEmpId());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">            cell = hssfRow.createCell(<span class="number">1</span>);</span><br><span class="line">            cell.setCellValue(duty.getEmp().getRealName());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line"></span><br><span class="line">            cell = hssfRow.createCell(<span class="number">2</span>);</span><br><span class="line">            cell.setCellValue(duty.getEmp().getDept().getDeptName());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line">            </span><br><span class="line">            cell = hssfRow.createCell(<span class="number">3</span>);</span><br><span class="line">            cell.setCellValue(duty.getDtDate());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line">            </span><br><span class="line">            cell = hssfRow.createCell(<span class="number">4</span>);</span><br><span class="line">            cell.setCellValue(duty.getSignInTime());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line">            </span><br><span class="line">            cell = hssfRow.createCell(<span class="number">5</span>);</span><br><span class="line">            cell.setCellValue(duty.getSignOutTime());</span><br><span class="line">            cell.setCellStyle(cellStyle);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存Excel文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">/* OutputStream outputStream = new FileOutputStream("D:/students.xls");*/</span> <span class="comment">//保存到本地（即服务器）</span></span><br><span class="line">        		<span class="comment">//设置响应数据格式</span></span><br><span class="line">        		resp.setContentType(<span class="string">"application/vnd.ms-excel"</span>);</span><br><span class="line">        		resp.setHeader(<span class="string">"Content-disposition"</span>, <span class="string">"attachment; fileName=duty.xls"</span>);</span><br><span class="line">        		OutputStream outputStream  = resp.getOutputStream();</span><br><span class="line">	            workbook.write(outputStream);</span><br><span class="line">	            outputStream.close();</span><br><span class="line">	        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	            e.printStackTrace();</span><br><span class="line">	        &#125;</span><br><span class="line">	    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="5-报销模块"><a href="#5-报销模块" class="headerlink" title="5 报销模块"></a>5 报销模块</h1><p>注意： Oracle 不能获取 char 类型的字符     </p>
<h2 id="5-1-自定义异常"><a href="#5-1-自定义异常" class="headerlink" title="5.1 自定义异常"></a>5.1 自定义异常</h2><blockquote>
<p>直接异常的结果抛给调用该类的上级处理</p>
</blockquote>
<h3 id="5-5-1-自定义异常类"><a href="#5-5-1-自定义异常类" class="headerlink" title="5.5.1 自定义异常类"></a>5.5.1 自定义异常类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.util;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义异常信息</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">super</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">super</span>(message);</span><br><span class="line">		&#125;</span><br><span class="line">	  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-1-2-DBUtil-使用自定义异常类"><a href="#5-1-2-DBUtil-使用自定义异常类" class="headerlink" title="5.1.2 DBUtil 使用自定义异常类"></a>5.1.2 DBUtil 使用自定义异常类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">executeDML</span><span class="params">(String sql,Object...objs)</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">				Connection conn = <span class="keyword">null</span>;</span><br><span class="line">				PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">				<span class="keyword">int</span> i = -<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">	</span><br><span class="line">					conn = DBUtil.getConnection();</span><br><span class="line"></span><br><span class="line">					conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">					ps = conn.prepareStatement(sql);</span><br><span class="line">					<span class="keyword">if</span>(objs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">						<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;objs.length;j++)&#123;</span><br><span class="line">							ps.setObject(j+<span class="number">1</span>,objs[j]);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				</span><br><span class="line">					i = ps.executeUpdate();</span><br><span class="line">					conn.commit();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						conn.rollback();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e1.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">					<span class="comment">//抛出给上级调用者</span></span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> MyException(e.toString());</span><br><span class="line">				&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">					DBUtil.closeAll(<span class="keyword">null</span>, ps, conn);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> i;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-servlet-中调用业务层发生错误的处理办法"><a href="#5-2-servlet-中调用业务层发生错误的处理办法" class="headerlink" title="5.2 servlet 中调用业务层发生错误的处理办法"></a>5.2 servlet 中调用业务层发生错误的处理办法</h2><blockquote>
<p>使用 try{}catch{}语句,若调业务层发生错误，则直接打印错误信息，并把错误信息返回给客户端</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">				expenseService.add(exp); <span class="comment">//不接受返回值	</span></span><br><span class="line">				<span class="comment">//响应处理结果</span></span><br><span class="line">				resp.sendRedirect(req.getContextPath()+<span class="string">"/expense/myExpense.jsp"</span>);</span><br><span class="line">			&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">				<span class="comment">//业务层发生错误，则重定向到添加报销单界面，并携带错误信息</span></span><br><span class="line">				req.setAttribute(<span class="string">"error"</span>, <span class="string">"添加报销单失败"</span>);</span><br><span class="line">				req.getRequestDispatcher(<span class="string">"/expense/expenseAdd.jsp"</span>).forward(req, resp);</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-3-service-层事务处理"><a href="#5-3-service-层事务处理" class="headerlink" title="5.3 service 层事务处理"></a>5.3 service 层事务处理</h2><blockquote>
<p>在 dao 层，一个DML操作就相当于一个事务。</p>
<p>但是当 service 层，调用两个不同 dao 层，就相当于执行不同两个事务。</p>
<p>问题：将 两个 dao 层的事务，在 service 层合并成一个事务操作？</p>
<p>解决：</p>
<p>在 service 层，先关闭事务的自动提交，并在DML 操作成功执行完毕后 commit 提交，否则 rollback 。    </p>
<p>​    1. 在 service 创建 Connection 连接对象，将该对象传入 DML 操作中。 缺点：过于麻烦</p>
<p>​    2.修改 DBUtil 工具类，改用 TreadLocal 类获取 Connection 连接对象。</p>
<p>注意：保证两个不同 dao 层的 DML 操作使用同一个 Connection 连接对象。 </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.ExpenseDao;</span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.ExpenseItemDao;</span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.impl.ExpenseDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.szxy.dao.impl.ExpenseItemDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.Expense;</span><br><span class="line"><span class="keyword">import</span> com.szxy.pojo.ExpenseItem;</span><br><span class="line"><span class="keyword">import</span> com.szxy.service.ExpenseService;</span><br><span class="line"><span class="keyword">import</span> com.szxy.util.DBUtil;</span><br><span class="line"><span class="keyword">import</span> com.szxy.util.DBUtil2;</span><br><span class="line"><span class="keyword">import</span> com.szxy.util.MyException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 	报销单类</span></span><br><span class="line"><span class="comment"> * 	</span></span><br><span class="line"><span class="comment"> * 问题：怎么获取当前报销单编号？ </span></span><br><span class="line"><span class="comment"> * 解决：获取当前序列的值</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 在 dao 层，一个DML操作就相当于一个事务。</span></span><br><span class="line"><span class="comment"> * 但是当 service 层，调用两个不同 dao 层，就相当于执行不同两个事务。</span></span><br><span class="line"><span class="comment"> * 问题：将 两个 dao 层的事务，在 service 层合并成一个事务操作？</span></span><br><span class="line"><span class="comment"> * 解决：</span></span><br><span class="line"><span class="comment"> * 		在 service 层，先关闭事务的自动提交，并在DML 操作成功执行完毕后 commit 提交，否则 rollback 。	</span></span><br><span class="line"><span class="comment"> * 		1. 在 service 创建 Connection 连接对象，将该对象传入 DML 操作中。 缺点：过于麻烦</span></span><br><span class="line"><span class="comment"> * 		2. 修改 DBUtil 工具类，改用 TreadLocal 类获取 Connection 连接对象。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 注意：保证两个不同 dao 层的 DML 操作使用同一个 Connection 连接对象。 </span></span><br><span class="line"><span class="comment"> * 	</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExpenseServiceImpl</span> <span class="keyword">implements</span> <span class="title">ExpenseService</span></span>&#123;</span><br><span class="line">	ExpenseDao  expenseDao = <span class="keyword">new</span> ExpenseDaoImpl();</span><br><span class="line">	ExpenseItemDao itemDao = <span class="keyword">new</span> ExpenseItemDaoImpl();</span><br><span class="line">	<span class="comment">//添加报销单信息s</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Expense exp)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取当前序列的值</span></span><br><span class="line">		<span class="keyword">int</span> nextVal = expenseDao.getExpidNextval();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取 数据库连接 对象</span></span><br><span class="line">		Connection conn = DBUtil2.getConnection();</span><br><span class="line">		<span class="comment">//关闭事务自动提交</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">			<span class="comment">//保存报销单主表</span></span><br><span class="line">			java.sql.Date exptime = <span class="keyword">new</span> java.sql.Date(exp.getExptime().getTime());</span><br><span class="line">			Expense expense = </span><br><span class="line">			<span class="keyword">new</span> Expense(nextVal,exp.getEmpId(), exp.getTotalAmount(),exptime , exp.getExpdesc(), exp.getNextAuditor(), exp.getLastResult(), exp.getStatus());</span><br><span class="line">			expenseDao.save(expense);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//保存报销单明细</span></span><br><span class="line">			List&lt;ExpenseItem&gt; itemList = exp.getItemList();</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; itemList.size(); i++) &#123;</span><br><span class="line">				ExpenseItem item = </span><br><span class="line">				<span class="keyword">new</span> ExpenseItem(nextVal,itemList.get(i).getType(), itemList.get(i).getAmount(), itemList.get(i).getItemdesc());</span><br><span class="line">				itemDao.save(item);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//成功执行上面的 DML 操作后，提交事务</span></span><br><span class="line">			conn.commit(); </span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="comment">//抛出给上级调用者</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MyException(e.toString());</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="comment">//关闭数据库连接</span></span><br><span class="line">			DBUtil2.closeAll(<span class="keyword">null</span>, <span class="keyword">null</span>, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">			</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-4-使用浏览器地址栏上的信息"><a href="#5-4-使用浏览器地址栏上的信息" class="headerlink" title="5.4 使用浏览器地址栏上的信息"></a>5.4 使用浏览器地址栏上的信息</h2><blockquote>
<p>不通过 servlet 转发，采用 EL 表达式实现 </p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">$&#123;param.地址栏上带有的参数名&#125;</span> "/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 相当于 req.getParameter("参数名") --&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-5-关闭子窗口，刷新父窗口"><a href="#5-5-关闭子窗口，刷新父窗口" class="headerlink" title="5.5 关闭子窗口，刷新父窗口"></a>5.5 关闭子窗口，刷新父窗口</h2><blockquote>
<p> <code>window.close();</code>//关闭当前窗口<br><code>window.opener.location.reload();</code>    //刷新父窗口</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">$.ajax(&#123;</span></span><br><span class="line"><span class="javascript">    url:<span class="string">"expense"</span>,</span></span><br><span class="line"><span class="javascript">    data:&#123;<span class="attr">method</span>:<span class="string">"audit"</span>,<span class="attr">expId</span>:expId,<span class="attr">result</span>:result,<span class="attr">auditDesc</span>:auditDesc&#125;,</span></span><br><span class="line"><span class="javascript">    type:<span class="string">"POST"</span>,</span></span><br><span class="line"><span class="javascript">    success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(data == <span class="string">"success"</span>)&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">"审核成功"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.close(); <span class="comment">//关闭当前窗口</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.opener.location.reload();    <span class="comment">//刷新父窗口</span></span></span><br><span class="line"><span class="javascript">             <span class="comment">/* 	window.location.reload(); //刷新当前窗口 */</span></span></span><br><span class="line"><span class="javascript">        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">"审核失败"</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-6-画业务流程图"><a href="#5-6-画业务流程图" class="headerlink" title="5.6  画业务流程图"></a>5.6  画业务流程图</h2><p><img src="http://www.zwer.xyz/picGo/%E5%AE%A1%E6%A0%B8%E6%B5%81%E7%A8%8B%E5%9B%BE1.png" alt></p>
<h3 id="5-6-1-第一步"><a href="#5-6-1-第一步" class="headerlink" title="5.6.1 第一步"></a>5.6.1 第一步</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *   审核报销单</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">audit</span><span class="params">(Auditing audit)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//根据业务流程图，写出大概步骤</span></span><br><span class="line">		<span class="keyword">if</span>(是财务)&#123;<span class="comment">//是财务</span></span><br><span class="line">			<span class="comment">//添加财务支出信息</span></span><br><span class="line">			<span class="comment">//修改报销单状态</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;<span class="comment">//不是财务</span></span><br><span class="line">			<span class="keyword">if</span>(审核通过)&#123;<span class="comment">//审核通过</span></span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span>(&gt;<span class="number">2500</span>)&#123;</span><br><span class="line">					<span class="keyword">if</span>(总裁)&#123; <span class="comment">//是总裁</span></span><br><span class="line">						<span class="comment">//添加审核记录</span></span><br><span class="line">						<span class="comment">//修改报销单状态</span></span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">						<span class="comment">//添加审核记录</span></span><br><span class="line">						<span class="comment">//修改报销单状态</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;<span class="comment">//小于 2500</span></span><br><span class="line">					<span class="comment">//添加审核记录</span></span><br><span class="line">					<span class="comment">//修改报销单状态</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;<span class="comment">//审核没通过</span></span><br><span class="line">				<span class="comment">//添加审核记录</span></span><br><span class="line">				<span class="comment">//修改报销单状态</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-6-2-第二步"><a href="#5-6-2-第二步" class="headerlink" title="5.6.2 第二步"></a>5.6.2 第二步</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">audit</span><span class="params">(Auditing audit)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//获取当前数据库连接</span></span><br><span class="line">		Connection conn = DBUtil2.getConnection();</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			conn.setAutoCommit(<span class="keyword">false</span>); <span class="comment">//关闭自动提交</span></span><br><span class="line">			<span class="comment">//根据业务流程图，写出大概步骤</span></span><br><span class="line">			String empId = audit.getEmpId();<span class="comment">//审核人的ID </span></span><br><span class="line">			<span class="keyword">if</span>(empId.equals(Constants.POSITION_CFO))&#123;<span class="comment">//是财务</span></span><br><span class="line">				<span class="comment">//添加财务支出信息</span></span><br><span class="line">				<span class="comment">//修改报销单状态</span></span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;<span class="comment">//不是财务</span></span><br><span class="line">				String result = audit.getResult();</span><br><span class="line">				<span class="keyword">if</span>(result.equals(<span class="string">"通过"</span>))&#123;<span class="comment">//审核通过</span></span><br><span class="line">					Expense expense = expenseDao.findExpenseByExpId(audit.getExpId());</span><br><span class="line">					<span class="keyword">double</span> totalAmount = expense.getTotalAmount();</span><br><span class="line">					<span class="keyword">if</span>(totalAmount &gt; <span class="number">2500</span>)&#123;</span><br><span class="line">						<span class="keyword">if</span>(empId.equals(Constants.POSITION_CEO))&#123; <span class="comment">//是总裁</span></span><br><span class="line">							<span class="comment">//添加审核记录</span></span><br><span class="line">							auditDao.save(audit);</span><br><span class="line">							</span><br><span class="line">							Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">							exp.setExpId(audit.getExpId());</span><br><span class="line">							exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">							exp.setLastResult(<span class="string">"审核通过"</span>);</span><br><span class="line">							exp.setStatus(Constants.EXPENSE_STATUS_AUDITED); 						</span><br><span class="line">							<span class="comment">//修改报销单状态</span></span><br><span class="line">							expenseDao.update(exp);</span><br><span class="line">						&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">							<span class="comment">//添加审核记录</span></span><br><span class="line">							auditDao.save(audit);</span><br><span class="line">							</span><br><span class="line">							Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">							exp.setExpId(audit.getExpId());</span><br><span class="line">							exp.setNextAuditor(<span class="string">"gaoqi"</span>);   <span class="comment">//交给下一个审核人，简化难度</span></span><br><span class="line">							exp.setNextAuditor(audit.getExp().getNextAuditor());  </span><br><span class="line">							exp.setLastResult(Constants.EXPENSE_STATUS_AUDITING);</span><br><span class="line">							exp.setStatus(<span class="string">"1"</span>);</span><br><span class="line">							<span class="comment">//修改报销单状态</span></span><br><span class="line">							expenseDao.update(exp);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;<span class="comment">//小于 2500</span></span><br><span class="line">						<span class="comment">//添加审核记录</span></span><br><span class="line">						auditDao.save(audit);</span><br><span class="line">						Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">						exp.setExpId(audit.getExpId());</span><br><span class="line">						exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">						exp.setLastResult(<span class="string">"审核通过"</span>);</span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_AUDITED); 						</span><br><span class="line">						<span class="comment">//修改报销单状态</span></span><br><span class="line">						expenseDao.update(exp);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;<span class="comment">//审核没通过 ，一种是打回，一种是拒绝</span></span><br><span class="line">					</span><br><span class="line">					<span class="comment">//添加审核记录</span></span><br><span class="line">					auditDao.save(audit);</span><br><span class="line">					</span><br><span class="line">					Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">					exp.setExpId(audit.getExpId());</span><br><span class="line">					exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">					exp.setLastResult(<span class="string">"未通过"</span>);</span><br><span class="line">					<span class="keyword">if</span>(<span class="string">"打回"</span>.equals(audit.getResult()))&#123;</span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_BACK); 						</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;<span class="comment">//拒绝</span></span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_REJECT); 						</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="comment">//修改报销单状态</span></span><br><span class="line">					expenseDao.update(exp);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			conn.commit(); <span class="comment">//提交事务</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			<span class="comment">//回滚</span></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				conn.rollback();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">				e1.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MyException(e.toString());</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			DBUtil2.closeAll(<span class="keyword">null</span>, <span class="keyword">null</span>, conn);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;*/</span><br></pre></td></tr></table></figure>

<h3 id="5-6-3-第三步优化"><a href="#5-6-3-第三步优化" class="headerlink" title="5.6.3 第三步优化"></a>5.6.3 第三步优化</h3><blockquote>
<p>使用常量类，及合并多余代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">audit</span><span class="params">(Auditing audit)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//添加审核记录</span></span><br><span class="line">		auditDao.save(audit);</span><br><span class="line">		<span class="comment">//添加报销单信息</span></span><br><span class="line">		Expense exp = <span class="keyword">new</span> Expense();</span><br><span class="line">		exp.setExpId(audit.getExpId());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取当前数据库连接</span></span><br><span class="line">		Connection conn = DBUtil2.getConnection();</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			conn.setAutoCommit(<span class="keyword">false</span>); <span class="comment">//关闭自动提交</span></span><br><span class="line">			<span class="comment">//根据业务流程图，写出大概步骤</span></span><br><span class="line">			String empId = audit.getEmpId();<span class="comment">//审核人的ID </span></span><br><span class="line">			<span class="keyword">if</span>(empId.equals(Constants.POSITION_CFO))&#123;<span class="comment">//是财务</span></span><br><span class="line">				<span class="comment">//添加财务支出信息</span></span><br><span class="line">				<span class="comment">//修改报销单状态</span></span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;<span class="comment">//不是财务</span></span><br><span class="line">				String result = audit.getResult();</span><br><span class="line">				<span class="keyword">if</span>(result.equals(<span class="string">"通过"</span>))&#123;<span class="comment">//审核通过</span></span><br><span class="line">					Expense expense = expenseDao.findExpenseByExpId(audit.getExpId());</span><br><span class="line">					<span class="keyword">double</span> totalAmount = expense.getTotalAmount();</span><br><span class="line">					<span class="keyword">if</span>(totalAmount &gt; <span class="number">2500</span>)&#123;</span><br><span class="line">						<span class="keyword">if</span>(empId.equals(Constants.POSITION_CEO))&#123; <span class="comment">//是总裁</span></span><br><span class="line">							<span class="comment">//添加审核记录</span></span><br><span class="line">							exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">							exp.setLastResult(<span class="string">"审核通过"</span>);</span><br><span class="line">							exp.setStatus(Constants.EXPENSE_STATUS_AUDITED); 						</span><br><span class="line">						&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">							<span class="comment">//添加审核记录</span></span><br><span class="line">							exp.setNextAuditor(<span class="string">"gaoqi"</span>);   <span class="comment">//交给下一个审核人，简化难度</span></span><br><span class="line">							<span class="comment">/*exp.setNextAuditor(audit.getExp().getNextAuditor()); */</span> </span><br><span class="line">							exp.setLastResult(Constants.EXPENSE_STATUS_AUDITING);</span><br><span class="line">							exp.setStatus(<span class="string">"1"</span>);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;<span class="comment">//小于 2500</span></span><br><span class="line">						exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">						exp.setLastResult(<span class="string">"审核通过"</span>);</span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_AUDITED); 						</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;<span class="comment">//审核没通过 ，一种是打回，一种是拒绝</span></span><br><span class="line">					exp.setNextAuditor(<span class="keyword">null</span>);</span><br><span class="line">					exp.setLastResult(<span class="string">"未通过"</span>);</span><br><span class="line">					<span class="keyword">if</span>(<span class="string">"打回"</span>.equals(audit.getResult()))&#123;</span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_BACK); 						</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;<span class="comment">//拒绝</span></span><br><span class="line">						exp.setStatus(Constants.EXPENSE_STATUS_REJECT); 						</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			expenseDao.update(exp); <span class="comment">//修改报销单状态</span></span><br><span class="line">			conn.commit();    <span class="comment">//提交事务</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			<span class="comment">//回滚</span></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				conn.rollback();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">				e1.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MyException(e.toString());</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			DBUtil2.closeAll(<span class="keyword">null</span>, <span class="keyword">null</span>, conn);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-7-使用常量类"><a href="#5-7-使用常量类" class="headerlink" title="5.7 使用常量类"></a>5.7 使用常量类</h2><blockquote>
<p>替代直接使用变量</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.util;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 常量类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//审核状态</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_AUDITING = <span class="string">"1"</span>;  <span class="comment">// 审核中</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_AUDITED = <span class="string">"2"</span>;   <span class="comment">// 审核完成</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_BACK = <span class="string">"3"</span>;      <span class="comment">// 打回</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_REJECT = <span class="string">"4"</span>;    <span class="comment">// 拒绝</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPENSE_STATUS_CASHED = <span class="string">"5"</span>;    <span class="comment">// 打款</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//部门特殊职位姓名</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String POSITION_CEO = <span class="string">"gaoqi"</span>;    <span class="comment">//总裁</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String POSITION_CFO = <span class="string">"lifuying"</span>; <span class="comment">//首席账务官</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-8-bug之数据库连接关闭"><a href="#5-8-bug之数据库连接关闭" class="headerlink" title="5.8  bug之数据库连接关闭"></a>5.8  bug之数据库连接关闭</h2><blockquote>
<p>问题描述：最开始是使用一个用户处理报销单操作，审核没有问题，但是换到下一个用户时再处理报销单操作，出现审核失败，原因是数据库连接被关闭，但是数据库连接对象并没有被销毁。</p>
<p>解决：</p>
<p>在DBUtil2中，获取数据库连接方法中判断 conn 对象是否关闭 isClose()，若关闭则重新创建新的数据连接对象。</p>
<p>问题推测：可能是切换用户时，出现了数据库连接关闭或者 使用 ThreadLocal 管理 conn 对象的原因。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Connection conn=<span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 从 ThreadLocal 中获取 Connection 数据库连接对象</span></span><br><span class="line">		conn = threadLocal.get();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>( conn == <span class="keyword">null</span> || conn.isClosed())&#123;  <span class="comment">//第一次创建 Connection 数据库连接对象,并且判断当前数据库是否关闭，若关闭需要重新创建</span></span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					conn = DriverManager.getConnection(url, username, password);</span><br><span class="line">					<span class="comment">//将 conn 放入 ThreadLocal 中</span></span><br><span class="line">					threadLocal.set(conn);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">					<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/*try &#123;</span></span><br><span class="line"><span class="comment">			System.out.println("conn的状态："+conn.isClosed());</span></span><br><span class="line"><span class="comment">		&#125; catch (SQLException e1) &#123;</span></span><br><span class="line"><span class="comment">			// TODO Auto-generated catch block</span></span><br><span class="line"><span class="comment">			e1.printStackTrace();</span></span><br><span class="line"><span class="comment">		&#125;*/</span></span><br><span class="line">		<span class="keyword">return</span> conn;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h1 id="6-收支管理"><a href="#6-收支管理" class="headerlink" title="6 收支管理"></a>6 收支管理</h1><h2 id="6-1-echart-（Enterprise-charts-商业产品图标库）入门"><a href="#6-1-echart-（Enterprise-charts-商业产品图标库）入门" class="headerlink" title="6.1  echart （Enterprise charts 商业产品图标库）入门"></a>6.1  echart （Enterprise charts 商业产品图标库）入门</h2><blockquote>
<p>ECharts，一个使用 JavaScript 实现的开源可视化库，可以流畅的运行在 PC 和移动设备上，兼容当前绝大部分浏览器（IE8/9/10/11，Chrome，Firefox，Safari等），底层依赖轻量级的矢量图形库 <a href="https://github.com/ecomfe/zrender" target="_blank" rel="noopener">ZRender</a>，提供直观，交互丰富，可高度个性化定制的数据可视化图表。</p>
</blockquote>
<h3 id="6-1-1-特性"><a href="#6-1-1-特性" class="headerlink" title="6.1.1  特性"></a>6.1.1  特性</h3><ol>
<li><p>丰富的可视化类型</p>
<p>ECharts 提供了常规的<a href="https://echarts.baidu.com/option.html#series-line" target="_blank" rel="noopener">折线图</a>、<a href="https://echarts.baidu.com/option.html#series-line" target="_blank" rel="noopener">柱状图</a>、<a href="https://echarts.baidu.com/option.html#series-scatter" target="_blank" rel="noopener">散点图</a>、<a href="https://echarts.baidu.com/option.html#series-pie" target="_blank" rel="noopener">饼图</a>、<a href="https://echarts.baidu.com/option.html#series-candlestick" target="_blank" rel="noopener">K线图</a>，用于统计的<a href="https://echarts.baidu.com/option.html#series-boxplot" target="_blank" rel="noopener">盒形图</a>，用于地理数据可视化的<a href="https://echarts.baidu.com/option.html#series-map" target="_blank" rel="noopener">地图</a>、<a href="https://echarts.baidu.com/option.html#series-heatmap" target="_blank" rel="noopener">热力图</a>、<a href="https://echarts.baidu.com/option.html#series-lines" target="_blank" rel="noopener">线图</a>，用于关系数据可视化的<a href="https://echarts.baidu.com/option.html#series-graph" target="_blank" rel="noopener">关系图</a>、<a href="https://echarts.baidu.com/option.html#series-treemap" target="_blank" rel="noopener">treemap</a>、<a href="https://echarts.baidu.com/option.html#series-sunburst" target="_blank" rel="noopener">旭日图</a>，多维数据可视化的<a href="https://echarts.baidu.com/option.html#series-parallel" target="_blank" rel="noopener">平行坐标</a>，还有用于 BI 的<a href="https://echarts.baidu.com/option.html#series-funnel" target="_blank" rel="noopener">漏斗图</a>，<a href="https://echarts.baidu.com/option.html#series-gauge" target="_blank" rel="noopener">仪表盘</a>，并且支持图与图之间的混搭。</p>
</li>
<li><p>多种数据格式无需转换直接使用</p>
<p>ECharts 内置的 dataset 属性（4.0+）支持直接传入包括二维表，key-value 等多种格式的数据源，通过简单的设置 encode 属性就可以完成从数据到图形的映射，这种方式更符合可视化的直觉，省去了大部分场景下数据转换的步骤，而且多个组件能够共享一份数据而不用克隆</p>
</li>
</ol>
<h3 id="6-1-2-使用"><a href="#6-1-2-使用" class="headerlink" title="6.1.2 使用"></a>6.1.2 使用</h3><ul>
<li>导入 eCharts.js 文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入 eCharts 文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/echarts.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>新建一个 div ，并设置图标的格式和数据</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>eCharts 图标入门<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"pragma"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"cache-control"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"expires"</span> <span class="attr">content</span>=<span class="string">"0"</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"keywords"</span> <span class="attr">content</span>=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">"This is my page"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	&lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 导入 Jquery  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 导入 eCharts 文件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/echarts.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  	</span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">   		  <span class="comment">&lt;!-- 为 ECharts 准备一个具备大小（宽高）的 DOM --&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"main"</span> <span class="attr">style</span>=<span class="string">"width: 600px;height:400px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    	</span><br><span class="line">    	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">	        <span class="comment">// 基于准备好的dom，初始化echarts实例</span></span></span><br><span class="line"><span class="javascript">	        <span class="keyword">var</span> myChart = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">'main'</span>));</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">	        <span class="comment">// 指定图表的配置项和数据</span></span></span><br><span class="line"><span class="javascript">	        <span class="keyword">var</span> option = &#123;</span></span><br><span class="line">	            title: &#123;</span><br><span class="line"><span class="javascript">	                text: <span class="string">'ECharts 入门示例'</span></span></span><br><span class="line">	            &#125;,</span><br><span class="line">	            tooltip: &#123;&#125;,</span><br><span class="line">	            legend: &#123;</span><br><span class="line"><span class="javascript">	                data:[<span class="string">'销量'</span>]</span></span><br><span class="line">	            &#125;,</span><br><span class="line">	            xAxis: &#123;</span><br><span class="line"><span class="javascript">	                data: [<span class="string">"衬衫"</span>,<span class="string">"羊毛衫"</span>,<span class="string">"雪纺衫"</span>,<span class="string">"裤子"</span>,<span class="string">"高跟鞋"</span>,<span class="string">"袜子"</span>]</span></span><br><span class="line">	            &#125;,</span><br><span class="line">	            yAxis: &#123;&#125;,</span><br><span class="line">	            series: [&#123;</span><br><span class="line"><span class="javascript">	                name: <span class="string">'销量'</span>,</span></span><br><span class="line"><span class="javascript">	                type: <span class="string">'bar'</span>,  <span class="comment">//表示柱状图</span></span></span><br><span class="line">	                data: [5, 20, 36, 10, 10, 20]</span><br><span class="line">	            &#125;]</span><br><span class="line">	        &#125;;</span><br><span class="line">	</span><br><span class="line"><span class="javascript">	        <span class="comment">// 使用刚指定的配置项和数据显示图表。</span></span></span><br><span class="line">	        myChart.setOption(option);</span><br><span class="line">	   	 <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-1-3-效果"><a href="#6-1-3-效果" class="headerlink" title="6.1.3 效果"></a>6.1.3 效果</h3><p><img src="http://www.zwer.xyz/picGo/20190428205130.png" alt></p>
<h1 id="7-项目总结"><a href="#7-项目总结" class="headerlink" title="7 项目总结"></a>7 项目总结</h1><h2 id="7-1-项目核心知识点"><a href="#7-1-项目核心知识点" class="headerlink" title="7.1 项目核心知识点"></a>7.1 项目核心知识点</h2><ol>
<li>ServletAPI 的使用</li>
<li>JSP 四个作用域</li>
<li>JSTL 标签库与 EL 表达式</li>
</ol>
<h2 id="7-2-分层功能分配"><a href="#7-2-分层功能分配" class="headerlink" title="7.2 分层功能分配"></a>7.2 分层功能分配</h2><ul>
<li>实体类、dao 层基本上与数据库表相对应</li>
<li>业务层、控制层、视图层更倾向于按照模块划分</li>
</ul>
<h1 id="8-分页功能"><a href="#8-分页功能" class="headerlink" title="8 分页功能"></a>8 分页功能</h1><h2 id="8-1-分页的意义"><a href="#8-1-分页的意义" class="headerlink" title="8.1 分页的意义"></a>8.1 分页的意义</h2><ol>
<li>数据量较大，一次加载所需的时间长</li>
<li>数据量较大，浏览器页面不能全局显示，采用分页，数据更加清晰明了</li>
</ol>
<h2 id="8-2-PageBean-分页工具类"><a href="#8-2-PageBean-分页工具类" class="headerlink" title="8.2  PageBean 分页工具类"></a>8.2  PageBean 分页工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页的三个基本属性</span></span><br><span class="line"><span class="comment"> * 1.每页几条记录size  可以有默认值5</span></span><br><span class="line"><span class="comment"> * 2.当前页号  index    可以有默认值1</span></span><br><span class="line"><span class="comment"> * 3.记录总数totalCount：不可能有默认值，需要查询数据库获取真正的记录总数</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 4.一共多少页 ：totalPageCount=totalCount/size+1</span></span><br><span class="line"><span class="comment"> * 		5  30  31 32 33 34 35  </span></span><br><span class="line"><span class="comment"> * 5.上一页    index-1  当前页1，上一页1</span></span><br><span class="line"><span class="comment"> * 6.下一页   index+1  当前页是最后一页  下一页：还是最后一页</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 扩展</span></span><br><span class="line"><span class="comment"> * 分页Bean还可以放要查询的数据  protected List&lt;T&gt; list;</span></span><br><span class="line"><span class="comment"> * 分页Bean还可以放页码列表     [1]  2  3  4  5   private int[] numbers;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageBean</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">5</span>;<span class="comment">//每页显示记录  //</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> index = <span class="number">1</span>;<span class="comment">// 当前页号      </span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> totalCount = <span class="number">0</span>;<span class="comment">// 记录总数      ok</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> totalPageCount = <span class="number">1</span>;<span class="comment">// 总页数   ok</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span>[] numbers;<span class="comment">//展示页数集合  //ok</span></span><br><span class="line">	<span class="keyword">protected</span> List&lt;T&gt; list;<span class="comment">//要显示到页面的数据集  </span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 得到开始记录</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStartRow</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> (index - <span class="number">1</span>) * size;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 得到结束记录</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getEndRow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> index * size;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the size.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;		</span><br><span class="line">		<span class="keyword">return</span> size;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> size</span></span><br><span class="line"><span class="comment">	 * The size to set.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSize</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.size = size;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the currentPageNo.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (totalPageCount == <span class="number">0</span>) &#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> index;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> currentPageNo</span></span><br><span class="line"><span class="comment">	 * The currentPageNo to set.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.index = index;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the totalCount.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> totalCount;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> totalCount</span></span><br><span class="line"><span class="comment">	 *  The totalCount to set.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalCount</span><span class="params">(<span class="keyword">int</span> totalCount)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (totalCount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.totalCount = totalCount;</span><br><span class="line">			setTotalPageCountByRs();<span class="comment">//根据总记录数计算总页�?</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPageCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.totalPageCount;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据总记录数计算总页�?</span></span><br><span class="line"><span class="comment">	 * 5   </span></span><br><span class="line"><span class="comment">	 * 20    4</span></span><br><span class="line"><span class="comment">	 * 23    5</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setTotalPageCountByRs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.size &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.totalCount &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.totalCount % <span class="keyword">this</span>.size == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.totalPageCount = <span class="keyword">this</span>.totalCount / <span class="keyword">this</span>.size;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.size &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.totalCount &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.totalCount % <span class="keyword">this</span>.size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.totalPageCount = (<span class="keyword">this</span>.totalCount / <span class="keyword">this</span>.size) + <span class="number">1</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">this</span>.totalPageCount = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		setNumbers(totalPageCount);<span class="comment">//获取展示页数集合</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span>[] getNumbers() &#123;</span><br><span class="line">		<span class="keyword">return</span> numbers;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置显示页数集合</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * 默认显示10个页码</span></span><br><span class="line"><span class="comment">	 * 41  42  43  44    [45 ]   46  47  48  49  50</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 *  [1] 2  3 4  5 6 7 8  9  10</span></span><br><span class="line"><span class="comment">	 *  </span></span><br><span class="line"><span class="comment">	 *  41  42  43  44    45    46  47  [48]  49  50</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> totalPageCount</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumbers</span><span class="params">(<span class="keyword">int</span> totalPageCount)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(totalPageCount&gt;<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="comment">//!.当前数组的长度</span></span><br><span class="line">			<span class="keyword">int</span>[] numbers = <span class="keyword">new</span> <span class="keyword">int</span>[totalPageCount&gt;<span class="number">10</span>?<span class="number">10</span>:totalPageCount];<span class="comment">//页面要显示的页数集合</span></span><br><span class="line">			<span class="keyword">int</span> k =<span class="number">0</span>;</span><br><span class="line">			<span class="comment">//</span></span><br><span class="line">			<span class="comment">//1.数组长度&lt;10   1 2 3 4 ....   7</span></span><br><span class="line">			<span class="comment">//2.数组长度&gt;=10</span></span><br><span class="line">			<span class="comment">//     当前页&lt;=6  1 2 3 4    10</span></span><br><span class="line">			<span class="comment">//     当前页&gt;=总页数-5           ......12 13 14 15  </span></span><br><span class="line">			<span class="comment">//     其他                                5  6  7 8   9 当前页(10)  10  11 12  13</span></span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; totalPageCount;i++)&#123;</span><br><span class="line">				<span class="comment">//保证当前页为集合的中�?</span></span><br><span class="line">				<span class="keyword">if</span>((i&gt;=index- (numbers.length/<span class="number">2</span>+<span class="number">1</span>) || i &gt;= totalPageCount-numbers.length) &amp;&amp; k&lt;numbers.length)&#123;</span><br><span class="line">					numbers[k] = i+<span class="number">1</span>;</span><br><span class="line">					k++;</span><br><span class="line">				&#125;<span class="keyword">else</span> <span class="keyword">if</span>(k&gt;=numbers.length)&#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;				</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">this</span>.numbers = numbers;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumbers</span><span class="params">(<span class="keyword">int</span>[] numbers)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.numbers = numbers;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">getList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setList</span><span class="params">(List&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.list = list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	public static int getTotalPageCount(int iTotalRecordCount, int iPageSize) &#123;</span></span><br><span class="line"><span class="comment">		if (iPageSize == 0) &#123;</span></span><br><span class="line"><span class="comment">			return 0;</span></span><br><span class="line"><span class="comment">		&#125; else &#123;</span></span><br><span class="line"><span class="comment">			return (iTotalRecordCount % iPageSize) == 0 ? (iTotalRecordCount / iPageSize) : (iTotalRecordCount / iPageSize) + 1;</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">	&#125;*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-3-数据库分页"><a href="#8-3-数据库分页" class="headerlink" title="8.3 数据库分页"></a>8.3 数据库分页</h3><h3 id="8-3-1-Oracle-分页"><a href="#8-3-1-Oracle-分页" class="headerlink" title="8.3.1 Oracle 分页"></a>8.3.1 Oracle 分页</h3><blockquote>
<p>需要用到三层子查询，注意 rownum 不能使用 大于，否则查询不到记录。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span>(</span><br><span class="line">  <span class="keyword">select</span> <span class="keyword">rownum</span> rn,t.* <span class="keyword">from</span>(</span><br><span class="line">  <span class="keyword">select</span> * <span class="keyword">from</span> student  <span class="keyword">order</span> <span class="keyword">by</span> score <span class="keyword">desc</span> )t  </span><br><span class="line">  <span class="keyword">where</span> <span class="keyword">rownum</span> &lt;= <span class="number">10</span> <span class="comment">-- end 结束位置</span></span><br><span class="line">  )stu </span><br><span class="line">  <span class="keyword">where</span> rn &gt; <span class="number">5</span>  <span class="comment">-- 开始位置</span></span><br></pre></td></tr></table></figure>

<h3 id="8-3-2-MySql-分页"><a href="#8-3-2-MySql-分页" class="headerlink" title="8.3.2 MySql 分页"></a>8.3.2 MySql 分页</h3><blockquote>
<p>较为简单，只需使用 limit 子句</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- select * from tbl_book limit a,b ; </span></span><br><span class="line"><span class="comment">-- 第一参数 a(a&gt;=0) 表示从那条记录开始，第二个参数表示从索引 a(a&gt;=0)  开始以后的 b(b&gt;1) 条记录</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl_book <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">5</span>; </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl_book <span class="keyword">limit</span> <span class="number">5</span>,<span class="number">5</span>;  </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl_book <span class="keyword">limit</span> <span class="number">10</span>,<span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<h2 id="8-4-通过函数提交表单"><a href="#8-4-通过函数提交表单" class="headerlink" title="8.4  通过函数提交表单"></a>8.4  通过函数提交表单</h2><ol>
<li>使用 Js 方式提交表单数据</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;sciprt&gt;</span><br><span class="line"><span class="comment">//修改每页显示的记录数  可行</span></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex2</span>(<span class="params">size,index</span>)</span>&#123;</span><br><span class="line">			<span class="comment">//获取第一个表单的 action 属性</span></span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].action = <span class="string">"servlet/SizeServlet?size="</span>+size+<span class="string">"&amp;index="</span>+index;</span><br><span class="line">			</span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); <span class="comment">//提交表单</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//修改每页显示的记录数 可行</span></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex</span>(<span class="params">size,index</span>)</span>&#123;</span><br><span class="line">			<span class="comment">//赋值 当前表单项的 name 属性键的值</span></span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].size.value = size;</span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].index.value = index;</span><br><span class="line">			<span class="comment">//获取表单</span></span><br><span class="line">			<span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); <span class="comment">//提交表单</span></span><br><span class="line">		&#125;</span><br><span class="line">&lt;<span class="regexp">/sciprt&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>栗子</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@taglib</span> <span class="attr">prefix</span>=<span class="string">"c"</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/core"</span>%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>查询并显示所有学生信息<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"pragma"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"cache-control"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"expires"</span> <span class="attr">content</span>=<span class="string">"0"</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"keywords"</span> <span class="attr">content</span>=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">"This is my page"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	&lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">		<span class="comment">//跳转到指定页码</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">chageIndex</span>(<span class="params">index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">/* window.location.href="servlet/ShowAllServlet?index="+index; */</span></span></span><br><span class="line"><span class="javascript">			<span class="built_in">window</span>.location.href=<span class="string">"servlet/SizeServlet?size="</span>+size+<span class="string">"&amp;index="</span>+index;</span></span><br><span class="line">		&#125;</span><br><span class="line"><span class="javascript">		<span class="comment">//修改每页显示的记录数   有问题</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex3</span>(<span class="params">size,index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> name = $(<span class="string">"input[name=name]"</span>).val();</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> score = $(<span class="string">"input[name=score]"</span>).val();</span></span><br><span class="line"><span class="javascript">			<span class="comment">//window.location.href="servlet/SizeServlet?size="+size+"&amp;index="+index+"&amp;name="+name+"&amp;score="+score;</span></span></span><br><span class="line">		&#125;</span><br><span class="line"><span class="javascript">		<span class="comment">//修改每页显示的记录数  可行</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex2</span>(<span class="params">size,index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//获取第一个表单的 action 属性</span></span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].action = <span class="string">"servlet/SizeServlet?size="</span>+size+<span class="string">"&amp;index="</span>+index;</span></span><br><span class="line">			</span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); <span class="comment">//提交表单</span></span></span><br><span class="line">		&#125;</span><br><span class="line"><span class="javascript">		<span class="comment">//修改每页显示的记录数 可行</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">changeSizeAndIndex</span>(<span class="params">size,index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//赋值 当前表单项的 name 属性键的值</span></span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].size.value = size;</span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].index.value = index;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//获取表单</span></span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); <span class="comment">//提交表单</span></span></span><br><span class="line">		&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">  	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">align</span>=<span class="string">"center"</span> <span class="attr">style</span>=<span class="string">"font-size:20px;font-weight: 400;margin-bottom:50px;"</span>&gt;</span>查询和分页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"servlet/SizeServlet"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"size"</span> <span class="attr">value</span>=<span class="string">"$&#123;pageBean.size&#125;"</span>&gt;</span></span><br><span class="line">  	    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"index"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">	  	姓名<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">"$&#123;student.name&#125;"</span>/&gt;</span>&amp;nbsp;&amp;nbsp;</span><br><span class="line">	  	<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;student.score == 0.0&#125;"</span>&gt;</span></span><br><span class="line">		  	成绩&gt;=<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"score"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">	  	<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">	  	<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;student.score != 0.0 &#125;"</span>&gt;</span></span><br><span class="line">		  	成绩&gt;=<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"score"</span> <span class="attr">value</span>=<span class="string">"$&#123;student.score&#125;"</span> /&gt;</span></span><br><span class="line">	  	<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">  	    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"查询"</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 显示所有学生   /stumanager/    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">align</span>=<span class="string">"center"</span> <span class="attr">border</span>=<span class="string">"1"</span> <span class="attr">width</span>=<span class="string">"60%"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>学生 编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>学生姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>学生年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>学生成绩<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>vs.index<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>更新操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">th</span>&gt;</span>删除操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;pageBean.list&#125;"</span> <span class="attr">var</span>=<span class="string">"stu"</span> <span class="attr">varStatus</span>=<span class="string">"vs"</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.id &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.name &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.age &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;stu.score &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;vs.index &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/stumanager/servlet/StudentServlet?operate=preupdate&amp;sid=$&#123;stu.id&#125;"</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/stumanager/servlet/StudentServlet?operate=delete&amp;sid=$&#123;stu.id&#125;"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">"6"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,1)"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.index-1 &gt;= 1&#125;"</span>&gt;</span></span><br><span class="line">	    			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;pageBean.index-1&#125;)"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.index-1 &lt; 1&#125;"</span>&gt;</span></span><br><span class="line">	    				上一页</span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;pageBean.numbers&#125;"</span> <span class="attr">var</span>=<span class="string">"nums"</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;nums == pageBean.index &#125;"</span>&gt;</span></span><br><span class="line">	    				[<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;nums&#125;)"</span>&gt;</span>$&#123;nums&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>]</span><br><span class="line">    				<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;nums != pageBean.index &#125;"</span>&gt;</span></span><br><span class="line">	    				<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;nums&#125;)"</span>&gt;</span>$&#123;nums&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.index+1 &lt;=pageBean.totalPageCount&#125;"</span>&gt;</span></span><br><span class="line">	    			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;pageBean.index+1&#125;)"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span>   </span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span>  			</span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.index+1 &gt; pageBean.totalPageCount&#125;"</span>&gt;</span></span><br><span class="line">	    				下一页							</span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span>  </span><br><span class="line">    			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:changeSizeAndIndex($&#123;pageBean.size&#125;,$&#123;pageBean.totalPageCount&#125;)"</span>&gt;</span>尾页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    			每页显示多少条记录数  </span><br><span class="line">    			<span class="tag">&lt;<span class="name">%--</span> 明天开始任务 <span class="attr">--</span>%&gt;</span></span><br><span class="line">   				<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">onchange</span>=<span class="string">"changeSizeAndIndex(this.value,$&#123;pageBean.index&#125;)"</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">begin</span>=<span class="string">"5"</span> <span class="attr">end</span>=<span class="string">"25"</span> <span class="attr">step</span>=<span class="string">"5"</span> <span class="attr">var</span>=<span class="string">"i"</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.size == i&#125;"</span>&gt;</span></span><br><span class="line">	    					<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;i&#125;"</span> <span class="attr">selected</span>=<span class="string">"selected"</span>&gt;</span>$&#123;i&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pageBean.size != i&#125;"</span>&gt;</span></span><br><span class="line">	    					<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;i&#125;"</span>&gt;</span>$&#123;i&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">   				<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    			<span class="comment">&lt;!-- 跳转到第几页  --&gt;</span></span><br><span class="line">    			跳转到</span><br><span class="line">    			<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">onchange</span>=<span class="string">"changeSizeAndIndex($&#123;pageBean.size&#125;,this.value)"</span> &gt;</span></span><br><span class="line">	    			<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;pageBean.numbers&#125;"</span> <span class="attr">var</span>=<span class="string">"num"</span>&gt;</span></span><br><span class="line">	    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;num == pageBean.index&#125;"</span>&gt;</span></span><br><span class="line">	    					<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;num&#125;"</span> <span class="attr">selected</span>=<span class="string">"selected"</span>&gt;</span>$&#123;num &#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span>	    					</span><br><span class="line">	    				<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">	    				<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;num != pageBean.index&#125;"</span>&gt;</span></span><br><span class="line">	    					<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;num&#125;"</span>&gt;</span>$&#123;num &#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span>	    					</span><br><span class="line">	    				<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    			</span><br><span class="line">    	</span><br><span class="line">    			共有$&#123;pageBean.totalCount&#125; 条记录</span><br><span class="line">    		<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="9-文件上传与下载"><a href="#9-文件上传与下载" class="headerlink" title="9 文件上传与下载"></a>9 文件上传与下载</h1><h2 id="9-1-导入-jar-包"><a href="#9-1-导入-jar-包" class="headerlink" title="9.1 导入 jar 包"></a>9.1 导入 jar 包</h2><p>commons-fileupload.jar 依赖于下面的 commons-io.jar 。<br>commons-io.jar</p>
<h2 id="9-2-文件上传"><a href="#9-2-文件上传" class="headerlink" title="9.2 文件上传"></a>9.2 文件上传</h2><h3 id="9-2-1-获取动态上下文地址"><a href="#9-2-1-获取动态上下文地址" class="headerlink" title="9.2.1 获取动态上下文地址"></a>9.2.1 获取动态上下文地址</h3><blockquote>
<p>用于获取服务端存储文件的位置</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//File dir = new File("D:\\upload\\"); //这里指服务器的目录下</span></span><br><span class="line"><span class="comment">//File dir = new File("D:\\Program Files\\apache-tomcat-7.0.69-windows-x64\\apache-tomcat-7.0.69\\webapps\\updownload1\\WEB-INF\\upload"); //这里指服务器的目录下</span></span><br><span class="line"><span class="comment">//完善2：动态获取上下文路径</span></span><br><span class="line">File dir = <span class="keyword">new</span> File(<span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"upload"</span>));</span><br></pre></td></tr></table></figure>

<h3 id="9-2-2-上传文件的中文乱码问题"><a href="#9-2-2-上传文件的中文乱码问题" class="headerlink" title="9.2.2 上传文件的中文乱码问题"></a>9.2.2 上传文件的中文乱码问题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line"></span><br><span class="line">ServletFileUpload fileUpload = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">fileUpload.setHeaderEncoding(<span class="string">"utf-8"</span>);  <span class="comment">//设置上传文件的名字编码格式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//name </span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">"name"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">    name = fileItem.getString(<span class="string">"utf-8"</span>); <span class="comment">//按 utf-8 格式编码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-3-限制文件上传的类型"><a href="#9-2-3-限制文件上传的类型" class="headerlink" title="9.2.3  限制文件上传的类型"></a>9.2.3  限制文件上传的类型</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//完善4：限制上传文件的类型</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="string">"image/png"</span>.equals(photoType))&#123;</span><br><span class="line">    request.setAttribute(<span class="string">"mess"</span>, <span class="string">"文件的类型不正确，应为 png 格式的图片"</span>);</span><br><span class="line">    request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request,response);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-4-限制文件上传的大小"><a href="#9-2-4-限制文件上传的大小" class="headerlink" title="9.2.4 限制文件上传的大小"></a>9.2.4 限制文件上传的大小</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//完善3：限制上传文件的大小</span></span><br><span class="line">    <span class="comment">//设置单个上传文件的大小</span></span><br><span class="line">    fileUpload.setFileSizeMax(<span class="number">200</span>*<span class="number">1024</span>); <span class="comment">//限制的单个文件的大小为 200KB</span></span><br><span class="line">    <span class="comment">//设置上传文件的总大小</span></span><br><span class="line">    fileUpload.setSizeMax(<span class="number">5</span>*<span class="number">200</span>*<span class="number">1024</span>); <span class="comment">//限制上传文件的总大小为 1000KB</span></span><br><span class="line">    <span class="comment">//将表单数据封装到 FileItem 对象中</span></span><br><span class="line">    itemList = fileUpload.parseRequest(request);</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileUploadException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="comment">//若超出文件大小，则 itemList 为 null,直接返回客户端错误信息</span></span><br><span class="line">    request.setAttribute(<span class="string">"mess"</span>, <span class="string">"单个文件大小超过限制 200KB"</span>);</span><br><span class="line">    request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request,response);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-5-使用UUID"><a href="#9-2-5-使用UUID" class="headerlink" title="9.2.5 使用UUID"></a>9.2.5 使用UUID</h3><blockquote>
<p>用于图片名称，防止图片名重复。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UUID uuid = UUID.randomUUID(); <span class="comment">//获取32位的16进制的数</span></span><br><span class="line">String ufileName = uuid.toString(); <span class="comment">//图片 uuid 名</span></span><br><span class="line">String extName = </span><br><span class="line">realName.substring(realName.lastIndexOf(<span class="string">"."</span>)+<span class="number">1</span>).toLowerCase();<span class="comment">//图片格式扩展名</span></span><br><span class="line">photoName = ufileName+<span class="string">"."</span>+extName;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-6-栗子"><a href="#9-2-6-栗子" class="headerlink" title="9.2.6 栗子"></a>9.2.6 栗子</h3><blockquote>
<ol>
<li>创建 FileItemFactory 工厂</li>
<li>创建  ServletFileUpload 上传类</li>
<li>解析 request 对象，获取 FileItem集合 </li>
<li>遍历 FileItem 集合，获取表单数据和非表单数据</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItem;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileUploadException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.bjsxt.entity.Student;</span><br><span class="line"><span class="keyword">import</span> com.bjsxt.service.StudentService;</span><br><span class="line"><span class="keyword">import</span> com.bjsxt.service.impl.StudentServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doPost(request, response);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        <span class="comment">//创建 FileItemFactory 工厂</span></span><br><span class="line">        FileItemFactory factory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建  ServletFileUpload 上传类</span></span><br><span class="line">        ServletFileUpload fileUpload = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">        fileUpload.setHeaderEncoding(<span class="string">"utf-8"</span>);  <span class="comment">//设置上传文件的名字编码格式</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//解析 request 对象，获取 FileItem集合 </span></span><br><span class="line">        List&lt;FileItem&gt; itemList  = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//完善3：限制上传文件的大小</span></span><br><span class="line">            <span class="comment">//设置单个上传文件的大小</span></span><br><span class="line">            fileUpload.setFileSizeMax(<span class="number">200</span>*<span class="number">1024</span>); <span class="comment">//限制的单个文件的大小为 200KB</span></span><br><span class="line">            <span class="comment">//设置上传文件的总大小</span></span><br><span class="line">            fileUpload.setSizeMax(<span class="number">5</span>*<span class="number">200</span>*<span class="number">1024</span>); <span class="comment">//限制上传文件的总大小为 1000KB</span></span><br><span class="line">            <span class="comment">//将表单数据封装到 FileItem 对象中</span></span><br><span class="line">            itemList = fileUpload.parseRequest(request);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileUploadException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">//若超出文件大小，则 itemList 为 null,直接返回客户端错误信息</span></span><br><span class="line">            request.setAttribute(<span class="string">"mess"</span>, <span class="string">"单个文件大小超过限制 200KB"</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String name = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> age =  <span class="number">0</span>;</span><br><span class="line">        Double score = <span class="number">0.0</span>;</span><br><span class="line">        String realName = <span class="keyword">null</span>;  <span class="comment">//图片真实名称</span></span><br><span class="line">        String photoName = <span class="keyword">null</span>; <span class="comment">//图片名称</span></span><br><span class="line">        String photoType = <span class="keyword">null</span>; <span class="comment">//图片格式类型</span></span><br><span class="line">        <span class="comment">//遍历 FileItem 集合</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; itemList.size(); i++) &#123;</span><br><span class="line">            FileItem fileItem = itemList.get(i);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(fileItem.isFormField())&#123; <span class="comment">//是非 file 表单项</span></span><br><span class="line">                <span class="comment">//name </span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"name"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">                    name = fileItem.getString(<span class="string">"utf-8"</span>); <span class="comment">//按 utf-8 格式编码</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//age</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"age"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">                    age = Integer.valueOf(fileItem.getString());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//score</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"score"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">                    String sScore = fileItem.getString();</span><br><span class="line">                    score = Double.valueOf(sScore);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;<span class="comment">// 是 file 表单项</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"photo"</span>.equals(fileItem.getFieldName()))&#123;</span><br><span class="line">                    realName = fileItem.getName();  <span class="comment">//获取上传图片名称</span></span><br><span class="line">                    photoType = fileItem.getContentType(); <span class="comment">//获取上传图片的类型</span></span><br><span class="line">                    <span class="comment">//String is = fileItem.getString(); //获取上传图片的资源</span></span><br><span class="line">                    <span class="comment">//System.out.println(photoName+"\t"+photoType+"\t");</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//完善4：限制上传文件的类型</span></span><br><span class="line">                    <span class="keyword">if</span>(!<span class="string">"image/png"</span>.equals(photoType))&#123;</span><br><span class="line">                        request.setAttribute(<span class="string">"mess"</span>, <span class="string">"文件的类型不正确，应为 png 格式的图片"</span>);</span><br><span class="line">                        request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request,response);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//File dir = new File("D:\\upload\\"); //这里指服务器的目录下</span></span><br><span class="line">                    <span class="comment">//File dir = new File("D:\\Program Files\\apache-tomcat-7.0.69-windows-x64\\apache-tomcat-7.0.69\\webapps\\updownload1\\WEB-INF\\upload"); //这里指服务器的目录下</span></span><br><span class="line">                    <span class="comment">//完善2：动态获取上下文路径</span></span><br><span class="line">                    File dir = <span class="keyword">new</span> File(<span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"upload"</span>));</span><br><span class="line">                    <span class="comment">//完善1：若文件夹不存在则创建该文件夹</span></span><br><span class="line">                    <span class="keyword">if</span>(!dir.exists())&#123;</span><br><span class="line">                        dir.mkdirs();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//完善5：使用UUID 作为图片名</span></span><br><span class="line">                    UUID uuid = UUID.randomUUID(); <span class="comment">//获取32位的16进制的数</span></span><br><span class="line">                    String ufileName = uuid.toString(); <span class="comment">//图片 uuid 名</span></span><br><span class="line">                    String extName = realName.substring(realName.lastIndexOf(<span class="string">"."</span>)+<span class="number">1</span>).toLowerCase();<span class="comment">//图片格式扩展名</span></span><br><span class="line">                    photoName = ufileName+<span class="string">"."</span>+extName;</span><br><span class="line">                    <span class="comment">//System.out.println("图片格式扩展名："+extName);</span></span><br><span class="line"></span><br><span class="line">                    File  file = <span class="keyword">new</span> File(dir,photoName);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//上传到指定的目录下</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        fileItem.write(file);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//System.out.println(name+"\t"+age+"\t"+score);</span></span><br><span class="line"></span><br><span class="line">        StudentService service = <span class="keyword">new</span> StudentServiceImpl();</span><br><span class="line">        Student stu = <span class="keyword">new</span> Student(name, age, score, realName, photoName, photoType);</span><br><span class="line">        <span class="keyword">int</span> n = service.save(stu) ; <span class="comment">//保存学生信息</span></span><br><span class="line">        <span class="comment">//页面跳转</span></span><br><span class="line">        <span class="keyword">if</span>(n!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//重定向:/后面要跟上下文路径  /stumgr   /stumgr2</span></span><br><span class="line"></span><br><span class="line">            response.sendRedirect(request.getContextPath()+<span class="string">"/servlet/ShowAllServlet"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            request.setAttribute(<span class="string">"mess"</span>, <span class="string">"添加失败!"</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/add.jsp"</span>).forward(request, response);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-3-文件下载"><a href="#9-3-文件下载" class="headerlink" title="9.3 文件下载"></a>9.3 文件下载</h2><blockquote>
<p>使用IO流的方式将服务器的文件资源发送给客户端</p>
<p>中间使用 IOUtils 工具类（org.apache.commons.io.IOUtils）。</p>
<p>注意：流使用后要关闭。</p>
<p>​          添加响应头说明该文件是的大小、类型及文件名</p>
</blockquote>
<h3 id="9-3-1-下载中文名乱码问题"><a href="#9-3-1-下载中文名乱码问题" class="headerlink" title="9.3.1 下载中文名乱码问题"></a>9.3.1 下载中文名乱码问题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">String realName = stu.getRealName();</span><br><span class="line"><span class="comment">/*byte[] bytes = realName.getBytes("utf-8");</span></span><br><span class="line"><span class="comment">			String realName2 = new String(bytes,"utf-8");*/</span> </span><br><span class="line">String realName2 = <span class="keyword">null</span>;</span><br><span class="line">String userAgent = req.getHeader(<span class="string">"User-Agent"</span>).toLowerCase();</span><br><span class="line"><span class="keyword">if</span>(userAgent.indexOf(<span class="string">"trident"</span>) &gt;= <span class="number">0</span>)&#123;<span class="comment">//如果是 IE 浏览器</span></span><br><span class="line">    realName2 = URLEncoder.encode(realName,<span class="string">"utf-8"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    realName2 = <span class="keyword">new</span> String(realName.getBytes(<span class="string">"utf-8"</span>),<span class="string">"iso-8859-1"</span>); <span class="comment">//服务器发送给客户端，Get 编码方式反过来</span></span><br><span class="line">&#125;</span><br><span class="line">resp.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span>+realName2);</span><br><span class="line">OutputStream out = resp.getOutputStream();</span><br></pre></td></tr></table></figure>

<h3 id="9-3-2-栗子"><a href="#9-3-2-栗子" class="headerlink" title="9.3.2 栗子"></a>9.3.2 栗子</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.bjsxt.entity.Student;</span><br><span class="line"><span class="keyword">import</span> com.bjsxt.service.StudentService;</span><br><span class="line"><span class="keyword">import</span> com.bjsxt.service.impl.StudentServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">			<span class="comment">//1. 接受请求数据，学生的ID</span></span><br><span class="line">			String sId = req.getParameter(<span class="string">"id"</span>);</span><br><span class="line">			<span class="keyword">int</span> id = -<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				id = Integer.valueOf(sId);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//2. 处理请求数据</span></span><br><span class="line">			StudentService service = <span class="keyword">new</span> StudentServiceImpl();</span><br><span class="line">			Student stu = service.findById(id);</span><br><span class="line">			<span class="comment">//3. 响应请求数据      使用IO流的方式</span></span><br><span class="line">			<span class="comment">//3.1  获取输入输出流</span></span><br><span class="line">			String realPath = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"upload"</span>);</span><br><span class="line">			File file = <span class="keyword">new</span> File(realPath+<span class="string">"/"</span>+stu.getPhotoName());</span><br><span class="line">			InputStream is  = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">			<span class="comment">// 添加响应头信息</span></span><br><span class="line">			resp.setContentLength((<span class="keyword">int</span>)file.length()); <span class="comment">//设置响应内容的长度</span></span><br><span class="line">			resp.setContentType(stu.getPhotoType()); <span class="comment">//设置响应内容的格式</span></span><br><span class="line">			<span class="comment">//处理图片真实名称中文乱码问题</span></span><br><span class="line">			String realName = stu.getRealName();</span><br><span class="line">			<span class="comment">/*byte[] bytes = realName.getBytes("utf-8");</span></span><br><span class="line"><span class="comment">			String realName2 = new String(bytes,"utf-8");*/</span> </span><br><span class="line">			String realName2 = <span class="keyword">null</span>;</span><br><span class="line">			String userAgent = req.getHeader(<span class="string">"User-Agent"</span>).toLowerCase();</span><br><span class="line">			<span class="keyword">if</span>(userAgent.indexOf(<span class="string">"trident"</span>) &gt;= <span class="number">0</span>)&#123;<span class="comment">//如果是 IE 浏览器</span></span><br><span class="line">				realName2 = URLEncoder.encode(realName,<span class="string">"utf-8"</span>);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				realName2 = <span class="keyword">new</span> String(realName.getBytes(<span class="string">"utf-8"</span>),<span class="string">"iso-8859-1"</span>); <span class="comment">//服务器发送给客户端，Get 编码方式反过来</span></span><br><span class="line">			&#125;</span><br><span class="line">			resp.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span>+realName2);</span><br><span class="line">			OutputStream out = resp.getOutputStream();</span><br><span class="line">			<span class="comment">//3.2 将输入流复制到输出流中</span></span><br><span class="line">			IOUtils.copy(is, out);</span><br><span class="line">			<span class="comment">//3.3 关闭流</span></span><br><span class="line">			is.close();</span><br><span class="line">			out.close();</span><br><span class="line">			</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="10-版本管理与SVN-入门"><a href="#10-版本管理与SVN-入门" class="headerlink" title="10 版本管理与SVN 入门"></a>10 版本管理与SVN 入门</h1><h2 id="10-1-版本管理的概念"><a href="#10-1-版本管理的概念" class="headerlink" title="10.1 版本管理的概念"></a>10.1 版本管理的概念</h2><blockquote>
<p>解决：代码合并、历史版本中的迭代、重复</p>
</blockquote>
<h3 id="10-1-2-版本控制软件"><a href="#10-1-2-版本控制软件" class="headerlink" title="10.1.2  版本控制软件"></a>10.1.2  版本控制软件</h3><p>a) VSS：Microsoft 提供，Window 平台，小型开发团队所适合的工具。</p>
<p>b) CVS：开源工具，跨平台。绝大多数 CVS 服务已改用 SVN。CVS 已停止维护</p>
<p>c) SVN（Subversion）：开源，跨平台，在 CVS 的基础上开发。使用企业众多， 稳定安全，操作简单。集中式版本控制系统。</p>
<p>d) GIT：开源的分布式版本控制系统，用以有效高速的处理从很小到非常大的项</p>
<p>目版本管理。（GITHUB 是一个用 GIT 做版本控制的项目托管平台，B/S 架构。放到 GITHUB 上的代码需要开源，并且是互联网开发）</p>
<p><img src="http://www.zwer.xyz/picGo/20190506083256.png" alt></p>
<h2 id="10-2-SVN入门"><a href="#10-2-SVN入门" class="headerlink" title="10.2 SVN入门"></a>10.2 SVN入门</h2><h3 id="10-2-1-安装软件"><a href="#10-2-1-安装软件" class="headerlink" title="10.2.1 安装软件"></a>10.2.1 安装软件</h3><p>a) 指定软件安装位置和版本库位置</p>
<p>b) 默认端口 443</p>
<p>c) 使用 SVN authentication</p>
<h3 id="10-2-2-创建版本库"><a href="#10-2-2-创建版本库" class="headerlink" title="10.2.2  创建版本库"></a>10.2.2  创建版本库</h3><p>a) 创建默认结构 use default struction</p>
<p>b) 默认结构的含义</p>
<p>i. trunk：主干    开发时代码存储的位置，永远是最新的代码</p>
<p>ii. brank：分支    在不影响Trunk 其它用户情况下进行一些关于新功能的探索性或实验性的开发，待新功能完善后它也可以合并到 Trunk 中</p>
<p>iii. tags：标签 历史版本 阶段性里程碑版本 比如 1.0 2.0 3.0</p>
<h3 id="10-2-3-创建用户"><a href="#10-2-3-创建用户" class="headerlink" title="10.2.3 创建用户"></a>10.2.3 创建用户</h3><h3 id="10-2-4-创建组"><a href="#10-2-4-创建组" class="headerlink" title="10.2.4 创建组"></a>10.2.4 创建组</h3><h3 id="1-0-2-5-为组指定用户"><a href="#1-0-2-5-为组指定用户" class="headerlink" title="1 0.2.5 为组指定用户"></a>1 0.2.5 为组指定用户</h3><h3 id="10-2-6-为组指定对版本库的操作权限"><a href="#10-2-6-为组指定对版本库的操作权限" class="headerlink" title="10.2.6  为组指定对版本库的操作权限"></a>10.2.6  为组指定对版本库的操作权限</h3><p>​    a) 默认 everyone 具有 read/write 权限，无法删除，要修改为 no access</p>
<h3 id="10-2-7-通过浏览器访问服务器端"><a href="#10-2-7-通过浏览器访问服务器端" class="headerlink" title="10.2.7  通过浏览器访问服务器端"></a>10.2.7  通过浏览器访问服务器端</h3><h3 id="10-3-客户端-subclipse"><a href="#10-3-客户端-subclipse" class="headerlink" title="10.3 客户端 subclipse"></a>10.3 客户端 subclipse</h3><blockquote>
<p>一款 eclipse 中的 SNV 客户端插件。</p>
</blockquote>
<h3 id="10-3-1-安装"><a href="#10-3-1-安装" class="headerlink" title="10.3.1 安装"></a>10.3.1 安装</h3><p>a) 解压后将其中的 features 和 plugin 文件夹放入MyEclipse 的 dropins 目录下</p>
<p>b) 重新启动MyEclipse，即可自动发现并安装</p>
<p>c) 安装后在 window——preferrences——team 中可以看到 SVN</p>
<h3 id="10-3-2-提交项目到服务器端"><a href="#10-3-2-提交项目到服务器端" class="headerlink" title="10.3.2  提交项目到服务器端"></a>10.3.2  提交项目到服务器端</h3><p>a) 选中项目右键——–team—-share project    选择 SVN</p>
<p>b) 提交版本位置、用户名、密码都会由相关服务器管理人员提供。</p>
<p><img src="http://www.zwer.xyz/picGo/20190506083833.png" alt></p>
<p>a) 可以选择记住密码，避免多次的重复输入。</p>
<p>b) 提交后会跳到 team synchronizing view，还需要真正同步代码到服务器，同步之前可以选择哪些代码不需要使用 svn 进行管理</p>
<p>c) 提交成功后可以观察版本库容量的变化</p>
<p>d) 提交成功后客户端项目会显示专门的标记，并且增加了相应的.svn 项目，来存储操作记录</p>
<p><img src="http://www.zwer.xyz/picGo/20190506083935.png" alt></p>
<p><img src="http://www.zwer.xyz/picGo/20190506083951.png" alt></p>
<h3 id="10-3-4-断开和服务器连接"><a href="#10-3-4-断开和服务器连接" class="headerlink" title="10.3.4 断开和服务器连接"></a>10.3.4 断开和服务器连接</h3><p>a) team—断开连接    从项目中删除 SVN 元信息</p>
<h3 id="10-3-5-客户端从-SVN-检出项目"><a href="#10-3-5-客户端从-SVN-检出项目" class="headerlink" title="10.3.5 客户端从 SVN 检出项目"></a>10.3.5 客户端从 SVN 检出项目</h3><p>a) new— Project…——–SVN    从 SVN 检出项目</p>
<h3 id="10-3-6-更新和提交操作"><a href="#10-3-6-更新和提交操作" class="headerlink" title="10.3.6 更新和提交操作"></a>10.3.6 更新和提交操作</h3><p>a) 更新将服务器最新代码更新到本地；提交是将本地最新代码提交到服务器</p>
<p>b) <strong>提交之前要先更新</strong>，因为可能其他程序员期间以及提交了最新代码到服务器</p>
<p>c) <strong>提交一定要给出注释</strong>，对提交内容进行说明，作为以后辨别版本的主要依据。</p>
<h3 id="10-3-7-解决冲突"><a href="#10-3-7-解决冲突" class="headerlink" title="10.3.7 解决冲突"></a>10.3.7 解决冲突</h3><p>a) 模拟两个用户对一个类进行修改，分别修改相同的方法和增加一个新方法</p>
<p>b) 更新后出现冲突，和冲突方沟通后，对冲突文件给出最终解决方案</p>
<p>c) 还需要 team    标记为解决，相应冲突文件为自动删除，当前文件由冲突状态</p>
<p>转换为已修改状态，待提交</p>
<h4 id="10-3-8-还原没有提交的提交的代码"><a href="#10-3-8-还原没有提交的提交的代码" class="headerlink" title="10.3.8 还原没有提交的提交的代码"></a>10.3.8 还原没有提交的提交的代码</h4><p>a) team    还原</p>
<h4 id="10-3-9-还原已经提交的代码"><a href="#10-3-9-还原已经提交的代码" class="headerlink" title="10.3.9 还原已经提交的代码"></a>10.3.9 还原已经提交的代码</h4><p>a) 如果最新的代码出现问题，可以直接修改，也可以回滚到之前的某个历史版本，直接使用或者进行修改</p>
<p>b) 查看资源历史记录</p>
<p>c) 根据注释确定要还原的版本，无法确定可以查看或者比较代码</p>
<p>d) 确定版本后，右键选择”从修订班x 回复更改”</p>
<p>e) 可能出现冲突，解决后提交代码到服务器</p>
<h1 id="Bug-与-技巧"><a href="#Bug-与-技巧" class="headerlink" title="Bug 与 技巧"></a>Bug 与 技巧</h1><ol>
<li>使用 try catch 提高程序健壮性。列如在 servlet 中接受数字类型参数，需要格式转换，这时可以使用 trycatch语句，防止传入的参数有 null 和 空字符串或者其他的字符等等。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取请求参数</span></span><br><span class="line"><span class="comment">// 1.1 获取每页的记录数</span></span><br><span class="line">String sSize = req.getParameter(<span class="string">"size"</span>);</span><br><span class="line"><span class="keyword">int</span> size = <span class="number">5</span>; <span class="comment">//每页记录数</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    size = Integer.valueOf(sSize);</span><br><span class="line">&#125;<span class="keyword">catch</span>(NumberFormatException e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1.2 获取页码索引</span></span><br><span class="line">String sIndex = req.getParameter(<span class="string">"index"</span>);</span><br><span class="line"><span class="keyword">int</span> index = <span class="number">1</span>;<span class="comment">//页码索引 </span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    index = Integer.valueOf(sIndex);  <span class="comment">//null ," "				</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;	</span><br><span class="line"><span class="comment">// 1.3 获取当前成绩</span></span><br><span class="line">String sScore = req.getParameter(<span class="string">"score"</span>);</span><br><span class="line">Double score = <span class="number">0.0</span>;		 		</span><br><span class="line"><span class="keyword">if</span>(sScore == <span class="keyword">null</span> || sScore.equals(<span class="string">""</span>))&#123;</span><br><span class="line">    sScore = <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    score = Double.parseDouble(sScore);</span><br><span class="line">&#125;<span class="keyword">catch</span>(NumberFormatException e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1.4 获取学生姓名</span></span><br><span class="line">String name = req.getParameter(<span class="string">"name"</span>);</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/04/03/20190403 过滤器和监听器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/04/03/20190403 过滤器和监听器/" class="post-title-link" itemprop="url">20190403 过滤器和监听器</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-04-03 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-03T00:00:00+08:00">2019-04-03</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-09-08 20:03:30" itemprop="dateModified" datetime="2019-09-08T20:03:30+08:00">2019-09-08</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-监听器"><a href="#1-监听器" class="headerlink" title="1 监听器"></a>1 监听器</h1><blockquote>
<p>serlvet 监听器是 serlvet 规范中定义中一种特殊的类，用于监听 <code>ServeltContext</code>、<code>HttpSession</code> 和<code>ServletRequest</code> 等域对象的创建与销毁事件，以及监听这些域对象属性发生改变的事件。</p>
<p>监听对象：applicatin 、 session 、 request</p>
<p>监听内容：创建、销毁、属性改变</p>
<p>监听作用：在事件发生前与事件发生后做一些处理，比如在线人数统计。</p>
<p>使用： 监听 request </p>
<ol>
<li><p>创建一个普通 java 类实现指定的接口</p>
<pre><code>1. 监听 request 的创建和销毁：ServletRequestListener 
     2. 监听 request 作用域数据的变更：ServletRequestAttributeListener </code></pre><ol start="2">
<li>在项目中的 web.xml 中配置监听器，让监听器生效</li>
</ol>
</li>
</ol>
</blockquote>
<h2 id="1-1-测试代码"><a href="#1-1-测试代码" class="headerlink" title="1.1 测试代码"></a>1.1 测试代码</h2><h3 id="1-1-1-MyServletListener-java"><a href="#1-1-1-MyServletListener-java" class="headerlink" title="1.1.1  MyServletListener.java"></a>1.1.1  MyServletListener.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextAttributeEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextAttributeListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestAttributeEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestAttributeListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionActivationListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionAttributeListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionBindingEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionBindingListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	实现监听器的步骤</span></span><br><span class="line"><span class="comment"> *		1. 实现监听器特定的接口</span></span><br><span class="line"><span class="comment"> *			1. 实现 ServletRequestListener 接口，监听 request 对象的创建和销毁 </span></span><br><span class="line"><span class="comment"> *			2. 实现 ServletRequestAttributeListener 接口， 监听 request 对象中属性的添加电、删除和数据更新</span></span><br><span class="line"><span class="comment"> *		2. 配置 web.xml 路径，让服务器知道该监听器的存在</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServletListener</span>  <span class="keyword">implements</span> <span class="title">ServletRequestListener</span>,<span class="title">ServletRequestAttributeListener</span>,<span class="title">HttpSessionListener</span>,<span class="title">HttpSessionAttributeListener</span>,<span class="title">ServletContextListener</span>,<span class="title">ServletContextAttributeListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//实现 ServletRequestListener ，监听 request 对象的创建和销毁 </span></span><br><span class="line">	<span class="comment">// request 对象在一次请求结束后即销毁了</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"request 被销毁了...."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> </span>&#123;</span><br><span class="line">		ServletRequest request = sre.getServletRequest();</span><br><span class="line">		request.setAttribute(<span class="string">"hello"</span>, <span class="string">"HeloListener"</span>);</span><br><span class="line">		System.out.println(<span class="string">"request 被创建了...."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//实现 ServletRequestAttributeListener 接口，监听 request 对象中属性的添加、删除、替换（数据更新）</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span><span class="params">(ServletRequestAttributeEvent srae)</span> </span>&#123;</span><br><span class="line">		String key = srae.getName();</span><br><span class="line">		Object value = srae.getValue();</span><br><span class="line">		System.out.println(<span class="string">"request 对象中 "</span>+key+<span class="string">"被添加,其值为"</span>+value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span><span class="params">(ServletRequestAttributeEvent srae)</span> </span>&#123;</span><br><span class="line">		String key = srae.getName();</span><br><span class="line">		System.out.println(<span class="string">"request 对象中 "</span>+key+<span class="string">"被移除了"</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span><span class="params">(ServletRequestAttributeEvent srae)</span> </span>&#123;</span><br><span class="line">		String key = srae.getName();</span><br><span class="line">		Object value = srae.getValue();</span><br><span class="line">		System.out.println(<span class="string">"request 对象中 "</span>+key+<span class="string">"被更新了,更新后的其值为"</span>+value);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 监听 session 对象的创建、销毁</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session 对象被创建了"</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session 对象被销毁了"</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 监听 session 对象的添加、删除、数据更新</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span><span class="params">(HttpSessionBindingEvent event)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session 对象中添加属性"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span><span class="params">(HttpSessionBindingEvent event)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session 对象中移除属性"</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span><span class="params">(HttpSessionBindingEvent event)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"session 对象中更新属性"</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 监听 context 对象的属性的添加、删除和数据更新</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span><span class="params">(ServletContextAttributeEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span><span class="params">(ServletContextAttributeEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span><span class="params">(ServletContextAttributeEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 监听 context 对象的初始化和销毁</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"context 对象初始化..."</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"context 对象被销毁了..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-1-2-web-xml"><a href="#1-1-2-web-xml" class="headerlink" title="1.1.2  web.xml"></a>1.1.2  web.xml</h2><blockquote>
<p>配置监听器的格式<br>  <listener><br>       <listener-class>监听器的全限定路径名</listener-class><br>  </listener></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>TestListener<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置监听器  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">  	 <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.szxy.listener.MyServletListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.szxy.servlet.MyServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/my<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-2-监听器应用之统计在线用户数"><a href="#1-2-监听器应用之统计在线用户数" class="headerlink" title="1.2 监听器应用之统计在线用户数"></a>1.2 监听器应用之统计在线用户数</h2><blockquote>
<p>bug: 只要用户登录该网站无须登录，也算在在线用户数中</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 统计当前在线人数 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 1. 实现 ServletContextListener 和 HttpSessionListener 接口</span></span><br><span class="line"><span class="comment"> * 用 application 对象保存 当前人数的值</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 2. 在 web.xml 中配置监听器 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CurrentNetUserListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span>,<span class="title">HttpSessionListener</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"....  开启服务器        ...."</span>);</span><br><span class="line">		<span class="comment">// 获取 application 对象</span></span><br><span class="line">		ServletContext context = sce.getServletContext();</span><br><span class="line">		<span class="comment">// 创建计数器 将计数器放入 application 对象中保存</span></span><br><span class="line">		context.setAttribute(<span class="string">"count"</span>, <span class="number">0</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 获取服务器 application 对象</span></span><br><span class="line">		ServletContext context = se.getSession().getServletContext();</span><br><span class="line">		<span class="comment">// 获取当前计数器</span></span><br><span class="line">		<span class="keyword">int</span> count = (<span class="keyword">int</span>) context.getAttribute(<span class="string">"count"</span>);</span><br><span class="line">		<span class="comment">// 计数器 +1</span></span><br><span class="line">		++count;</span><br><span class="line">		context.setAttribute(<span class="string">"count"</span>, count);</span><br><span class="line">		System.out.println(<span class="string">"session 对象被创建 "</span>+count);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 获取服务器 application 对象</span></span><br><span class="line">		ServletContext context = se.getSession().getServletContext();</span><br><span class="line">		<span class="comment">// 获取当前计数器</span></span><br><span class="line">		<span class="keyword">int</span> count = (<span class="keyword">int</span>) context.getAttribute(<span class="string">"count"</span>);</span><br><span class="line">		<span class="comment">// 计数器 -1</span></span><br><span class="line">		<span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">			--count;			</span><br><span class="line">		&#125;</span><br><span class="line">		context.setAttribute(<span class="string">"count"</span>, count);</span><br><span class="line">		System.out.println(<span class="string">"session 对象被销毁 "</span>+count);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-过滤器"><a href="#2-过滤器" class="headerlink" title="2 过滤器"></a>2 过滤器</h1><h2 id="2-1-过滤器的原理"><a href="#2-1-过滤器的原理" class="headerlink" title="2.1 过滤器的原理"></a>2.1 过滤器的原理</h2><blockquote>
<p>作用：保证数据的安全，保护服务器中的资源。</p>
<p>使用：可以拦截浏览器的任意请求，所以可以在访问 servlet 之前校验请求的合法性，符合要求再调用对应的 servlet 。</p>
</blockquote>
<p><img src="http://www.zwer.xyz/picGo/20190403214151.png" alt></p>
<h2 id="2-2-过滤器的使用"><a href="#2-2-过滤器的使用" class="headerlink" title="2.2 过滤器的使用"></a>2.2 过滤器的使用</h2><blockquote>
<p>使用：根据需求拦截对应路径的 <code>servlet</code></p>
<pre><code>1. 创建一个 普通 java 类，并实现 Filter 接口
2.  在` web.xml` 配置过滤器</code></pre></blockquote>
<h3 id="2-2-1-doFilter方法"><a href="#2-2-1-doFilter方法" class="headerlink" title="2.2.1 doFilter方法"></a>2.2.1 <code>doFilter</code>方法</h3><blockquote>
<p>作用：服务器在接收到浏览器发过来的请求后，先解析请求信息</p>
<p>创建对象 request 和 response ，然后根据请求 URL 地址判断如果符合过滤器的过滤范围，则会调用过滤器中 <code>doFilter</code> 来进行请求拦截，并将 request 和 response 对象作为实参传递给 doFilter 方法。所以可以在 <code>doFilter</code> 方法中声明过滤器拦截代码。</p>
<p>参数： </p>
<p>​    <code>servletRequest</code>：接受此次拦截的 request 参数</p>
<p>​    <code>servletResponse</code>： 接受此次拦截的 response 参数</p>
<p>​    <code>FilterChain</code>： 可以进行请求放行   <code>chain.doFilter(req,resp);</code>  相当于请求转发，后面的代码可以加 return ;</p>
</blockquote>
<h3 id="2-2-2init-方法-和-destory-方法"><a href="#2-2-2init-方法-和-destory-方法" class="headerlink" title="2.2.2init 方法 和 destory 方法"></a>2.2.2<code>init</code> 方法 和 <code>destory</code> 方法</h3><blockquote>
<p>init 方法：服务器启动时调用</p>
<p>destory 方法: 服务器关闭时调用</p>
<p>即：过滤器的生命周期为服务器启动到服务器关闭。</p>
</blockquote>
<h3 id="2-2-3-拦截范围配置"><a href="#2-2-3-拦截范围配置" class="headerlink" title="2.2.3 拦截范围配置"></a>2.2.3 拦截范围配置</h3><ol>
<li>拦截所有      <code>/*</code></li>
<li>拦截部分 <code>servlet</code> 请求     栗子： <code>*.do</code></li>
<li>拦截特定 <code>servlet</code> 请求    与要拦截的 <code>servlet</code> 的 <code>url-pattern</code> 的路径相同      栗子：<code>/xxx</code></li>
</ol>
<p>注意： 过滤器之间会出现多重拦截，web.xml 配置范围先大后小。</p>
<p>如果是按照拦截范围的大小在 web.xml 中自大而小的配置，则会</p>
<p>先执行大范围的拦截器，再执行小范围的拦截器。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置过滤器: 全局拦截器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>myFilter3<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.szxy.filter.MyFilter3<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>myFilter3<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置过滤器: 部分拦截器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>myFilter2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.szxy.filter.MyFilter2<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>myFilter2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置过滤器: 特定拦截器  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>MyFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.szxy.filter.MyFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>MyFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/my.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.szxy.servlet.MyServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/my.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-3-测试代码"><a href="#2-3-测试代码" class="headerlink" title="2.3 测试代码"></a>2.3 测试代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szxy.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 过滤器的使用</span></span><br><span class="line"><span class="comment"> * 	1. 实现 Filter 接口</span></span><br><span class="line"><span class="comment"> * 	2. 在 web.xml 中 Filter</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"MyFilter.init() 初始化....."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">			FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">			System.out.println(<span class="string">"MyFilter.doFilter(张三家的保安...)"</span>);</span><br><span class="line">			<span class="comment">//放行</span></span><br><span class="line">			chain.doFilter(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"MyFilter.destroy() 销毁...."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-web-xml"><a href="#2-4-web-xml" class="headerlink" title="2.4 web.xml"></a>2.4 web.xml</h2><blockquote>
<p>配置过滤器的格式<br>  <filter><br>      <filter-name>过滤器名</filter-name><br>      <filter-class>过滤器的全限定路径名</filter-class><br>  </filter><br>  <filter-mapping><br>      <filter-name>过滤器名</filter-name><br>      <url-pattern>拦截路径</url-pattern><br>  </filter-mapping></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置过滤器  --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>MyFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.szxy.filter.MyFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>MyFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/my<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="3-过滤器之统一请求编码"><a href="#3-过滤器之统一请求编码" class="headerlink" title="3  过滤器之统一请求编码"></a>3  过滤器之统一请求编码</h1><blockquote>
<p>拦截范围：拦截所有请求，设置请求响应编码格式</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">			FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">			<span class="comment">//设置请求编码格式</span></span><br><span class="line">			request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">			<span class="comment">//设置响应编码格式</span></span><br><span class="line">			response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">        	<span class="comment">//放行</span></span><br><span class="line">			chain.doFilter(request, response);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-过滤器之-session-管理（sesson-统一校验）"><a href="#4-过滤器之-session-管理（sesson-统一校验）" class="headerlink" title="4  过滤器之 session 管理（sesson 统一校验）"></a>4  过滤器之 session 管理（sesson 统一校验）</h1><blockquote>
<p>拦截范围：拦截所有请求</p>
<p>判断 session 对象是否失效，若不存在则重定向到登录界面上，反之则放行。</p>
<p>问题：</p>
<p>​    在过滤器中使用 session 校验后，造成重定向死循环。</p>
<p>解决：</p>
<p>​    <strong>放行对登录界面和登录请求不做拦截处理</strong></p>
<p>问题：过滤器会拦截所有的请求，包括静态资源 (css资源、js资源、图片资源)</p>
<p>解决：</p>
<p>​    对静态资源放行。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	过滤器的使用：</span></span><br><span class="line"><span class="comment"> *	1. 统一编码格式</span></span><br><span class="line"><span class="comment"> *	2. 管理 session   </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"服务器开启...."</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">			FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">			<span class="comment">//设置请求编码格式</span></span><br><span class="line">			request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">			<span class="comment">//设置响应编码格式</span></span><br><span class="line">			response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">			<span class="comment">//强转 ServletRequest 对象</span></span><br><span class="line">			HttpServletRequest req = ((HttpServletRequest)request);</span><br><span class="line">			<span class="comment">//强转 ServletResponse 对象</span></span><br><span class="line">			HttpServletResponse resp = ((HttpServletResponse)response);</span><br><span class="line">			<span class="comment">//获取当前请求 uri</span></span><br><span class="line">			String uri = req.getRequestURI();</span><br><span class="line">			<span class="comment">/*System.out.println(uri);*/</span></span><br><span class="line">			String method = req.getParameter(<span class="string">"method"</span>);</span><br><span class="line">		<span class="comment">/*	System.out.println(method);*/</span></span><br><span class="line">			<span class="comment">// 放行登录界面，登录请求,静态资源</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="string">"/projectsxt2/login.jsp"</span>.equals(uri) || (<span class="string">"/projectsxt2/register.jsp"</span>.equals(uri) ) ||((<span class="string">"/projectsxt2/data"</span>.equals(uri) &amp;&amp; method.equals(<span class="string">"userLogin"</span>))) || ((<span class="string">"/projectsxt2/data"</span>.equals(uri) &amp;&amp; method.equals(<span class="string">"userRegister"</span>)))|| uri.startsWith(<span class="string">"/projectsxt2/css/"</span>) || uri.startsWith(<span class="string">"/projectsxt2/js/"</span>) ||uri.startsWith(<span class="string">"/projectsxt2/images/"</span>))&#123;</span><br><span class="line">				<span class="comment">//放行</span></span><br><span class="line">				chain.doFilter(request, response);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">//获取 session 对象</span></span><br><span class="line">				HttpSession session = req.getSession();</span><br><span class="line">				Object obj = session.getAttribute(<span class="string">"user"</span>);</span><br><span class="line">				<span class="keyword">if</span>(obj != <span class="keyword">null</span>)&#123;</span><br><span class="line">					chain.doFilter(request, response);</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="comment">//重定向</span></span><br><span class="line">					resp.sendRedirect(<span class="string">"/projectsxt2/login.jsp"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"服务器关闭..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>user.jsp </li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params">uid</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">if</span>( confirm(<span class="string">"您确定要删除吗?"</span>))&#123;</span></span><br><span class="line"><span class="javascript">		<span class="comment">//使用 ajax 发送请求</span></span></span><br><span class="line"><span class="javascript">		$.<span class="keyword">get</span>("data",&#123;method:<span class="string">"delUserInfo"</span>,<span class="attr">uid</span>:uid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span>(data != <span class="string">"true"</span>)&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"登录已过期，请重新登录"</span>);</span></span><br><span class="line"><span class="javascript">				<span class="built_in">window</span>.top.location.href = <span class="string">"/projectsxt2/login.jsp"</span>;</span></span><br><span class="line">			&#125;</span><br><span class="line"><span class="javascript">			<span class="comment">//响应数据</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span>(<span class="built_in">eval</span>(data))&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"该用户已被删除"</span>);</span></span><br><span class="line"><span class="javascript">				<span class="comment">//刷新当前浏览器，重新发送请求</span></span></span><br><span class="line"><span class="javascript">				<span class="built_in">window</span>.location.href = <span class="string">"data?method=selAllUsers"</span>;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>设置 login.jsp 为最顶层界面</li>
</ul>
<blockquote>
<p>在login.jsp 的头部添加如下代码</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 声明 JS 代码域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="comment">//判断login.jsp 是否是顶层界面，若不是则跳转到顶层界面中</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">if</span>(<span class="built_in">window</span> != top)&#123;</span></span><br><span class="line"><span class="javascript">		<span class="built_in">window</span>.top.location.href = <span class="built_in">window</span>.location.href; </span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="5-过滤器之-权限管理"><a href="#5-过滤器之-权限管理" class="headerlink" title="5 过滤器之 权限管理"></a>5 过滤器之 权限管理</h1><blockquote>
<p>需求：不同的用户在对同一个功能使用是，有的用户可以直接使用，有的</p>
<p>用户会被提示权限不足。</p>
<p>思路：</p>
<p>​    1、 在数据库中创建一个URL 权限表，该表存储了该系统需要被管理的URI</p>
<p>​    2、 在数据库中创建用户权限中间表，用来进行权限分配</p>
<p>​    3、在数据库中将权限给用户分配好</p>
<p>​    4、在用户登录成功后查询该用户具备的URL 权限，存储到该用户的session中。</p>
<p>​    5、在过滤器中对当前发起请求的用户的请求地址进行校验，校验该用户是否</p>
<p>具备该请求地址的权限，如果具备则放行执行，如果不具备则提示权限不足。</p>
<p>数据库设计：<br>    URL 权限表：t_url</p>
<p>​        编号： url_id</p>
<p>​        url地址： location</p>
<p>​        描述：remark</p>
<p>​    用户权限中间表： t_user_url</p>
<p>​        uid</p>
<p>​        urlid</p>
<p>​    SQL 语句的设计</p>
<p>​        select * from t_url where urlid in (select urlid from t_user_url where user_id = ?);    </p>
</blockquote>
<h2 id="5-1-MyFilter-java"><a href="#5-1-MyFilter-java" class="headerlink" title="5.1 MyFilter.java"></a>5.1 MyFilter.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">			FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">			<span class="comment">//设置请求编码格式</span></span><br><span class="line">			request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">			<span class="comment">//设置响应编码格式</span></span><br><span class="line">			response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">			<span class="comment">//强转 ServletRequest 对象</span></span><br><span class="line">			HttpServletRequest req = ((HttpServletRequest)request);</span><br><span class="line">			<span class="comment">//强转 ServletResponse 对象</span></span><br><span class="line">			HttpServletResponse resp = ((HttpServletResponse)response);</span><br><span class="line">			<span class="comment">//获取当前请求 uri</span></span><br><span class="line">			String uri = req.getRequestURI();</span><br><span class="line">			System.out.println(uri);</span><br><span class="line">			String method = req.getParameter(<span class="string">"method"</span>);</span><br><span class="line">		<span class="comment">/*	System.out.println(method);*/</span></span><br><span class="line">			<span class="comment">// 放行登录界面，登录请求,静态资源</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="string">"/projectsxt2/login.jsp"</span>.equals(uri) || (<span class="string">"/projectsxt2/register.jsp"</span>.equals(uri) ) ||((<span class="string">"/projectsxt2/data"</span>.equals(uri) &amp;&amp; method.equals(<span class="string">"userLogin"</span>))) || ((<span class="string">"/projectsxt2/data"</span>.equals(uri) &amp;&amp; method.equals(<span class="string">"userRegister"</span>)))|| uri.startsWith(<span class="string">"/projectsxt2/css/"</span>) || uri.startsWith(<span class="string">"/projectsxt2/js/"</span>) ||uri.startsWith(<span class="string">"/projectsxt2/images/"</span>))&#123;</span><br><span class="line">				<span class="comment">//放行</span></span><br><span class="line">				chain.doFilter(request, response);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">//获取 session 对象</span></span><br><span class="line">				HttpSession session = req.getSession();</span><br><span class="line">				Object obj = session.getAttribute(<span class="string">"user"</span>);</span><br><span class="line">				<span class="keyword">if</span>(obj != <span class="keyword">null</span>)&#123;</span><br><span class="line">					List&lt;URL&gt; list = (List&lt;URL&gt;) session.getAttribute(<span class="string">"power"</span>);</span><br><span class="line">					<span class="keyword">for</span> (URL u : list) &#123;</span><br><span class="line">						<span class="keyword">if</span>(u.getLocation().equals(method) || u.getLocation().equals(uri))&#123;</span><br><span class="line">							<span class="comment">// 放行</span></span><br><span class="line">							chain.doFilter(request, response);							</span><br><span class="line">							<span class="comment">//后面的 for 循环直接终止，返回。</span></span><br><span class="line">							<span class="keyword">return</span>;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="comment">//响应     权限不足</span></span><br><span class="line">					resp.getWriter().print(<span class="string">"power"</span>);</span><br><span class="line">					</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="comment">//重定向</span></span><br><span class="line">					resp.sendRedirect(<span class="string">"/projectsxt2/login.jsp"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-DataServlet-java"><a href="#5-2-DataServlet-java" class="headerlink" title="5.2 DataServlet.java"></a>5.2 DataServlet.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户登录</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userLogin</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="comment">//System.out.println("DataServlet.userLogin() 处理请求...");</span></span><br><span class="line">		<span class="comment">// 获取请求数据</span></span><br><span class="line">		String uname = req.getParameter(<span class="string">"uname"</span>);</span><br><span class="line">		String pwd = req.getParameter(<span class="string">"pwd"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 处理请求数据</span></span><br><span class="line">		<span class="comment">// 获取 业务逻辑层对象</span></span><br><span class="line">		UserService service = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">		User u = service.getUserInfoService(uname, pwd);</span><br><span class="line">		<span class="comment">//System.out.println(u);</span></span><br><span class="line">		<span class="comment">// 获取或创建 session 对象</span></span><br><span class="line">		HttpSession session = req.getSession();</span><br><span class="line">		<span class="comment">// 设置 session 有效期,以秒为单位</span></span><br><span class="line">		<span class="comment">/*session.setMaxInactiveInterval(10);*/</span></span><br><span class="line">		<span class="comment">// 检查用户名和密码</span></span><br><span class="line">		<span class="keyword">if</span> (u != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">// 获取当前用户权限信息</span></span><br><span class="line">			List&lt;URL&gt; list = service.getUserPowerInfoService(u.getUid());</span><br><span class="line">			System.out.println(list);</span><br><span class="line">			session.setAttribute(<span class="string">"power"</span>, list);</span><br><span class="line">			<span class="comment">// 处理响应结果</span></span><br><span class="line">			session.setAttribute(<span class="string">"user"</span>, u);</span><br><span class="line">			session.setAttribute(<span class="string">"uname"</span>, uname);</span><br><span class="line">			session.setAttribute(<span class="string">"pwd"</span>, pwd);</span><br><span class="line">			<span class="comment">// 重定向</span></span><br><span class="line">			resp.sendRedirect(<span class="string">"/projectsxt2/index.jsp"</span>);</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 处理响应结果</span></span><br><span class="line">			session.setAttribute(<span class="string">"flag"</span>, <span class="string">"LoginFailure"</span>);</span><br><span class="line">			<span class="comment">// 重定向</span></span><br><span class="line">			resp.sendRedirect(<span class="string">"/projectsxt2/login.jsp"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-3-User-jsp"><a href="#5-3-User-jsp" class="headerlink" title="5.3 User.jsp"></a>5.3 User.jsp</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params">uid</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">if</span>( confirm(<span class="string">"您确定要删除吗?"</span>))&#123;</span></span><br><span class="line"><span class="javascript">		<span class="comment">//使用 ajax 发送请求</span></span></span><br><span class="line"><span class="javascript">		$.<span class="keyword">get</span>("data",&#123;method:<span class="string">"delUserInfo"</span>,<span class="attr">uid</span>:uid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span>(data == <span class="string">"power"</span>)&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"权限不足"</span>);</span></span><br><span class="line"><span class="javascript">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(data != <span class="string">"true"</span>)&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"登录已过期，请重新登录"</span>);</span></span><br><span class="line"><span class="javascript">				<span class="built_in">window</span>.top.location.href = <span class="string">"/projectsxt2/login.jsp"</span>;</span></span><br><span class="line"><span class="javascript">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">eval</span>(data))&#123;<span class="comment">//响应数据</span></span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"该用户已被删除"</span>);</span></span><br><span class="line"><span class="javascript">				<span class="comment">//刷新当前浏览器，重新发送请求</span></span></span><br><span class="line"><span class="javascript">				<span class="built_in">window</span>.location.href = <span class="string">"data?method=selAllUsers"</span>;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-3-总结"><a href="#5-3-总结" class="headerlink" title="5.3 总结"></a>5.3 总结</h2><blockquote>
<ol>
<li><p>通过使用拦截器，可以通过 session 管理的方式控制用户权限，只让用户访问自己权限内的页面和数据。</p>
</li>
<li><p>数据库权限表的设计可以为每个用户分配权限。</p>
</li>
</ol>
</blockquote>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://zwer.xyz/2019/03/12/20190312 AJax 异步技术和 json /">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zwer">
      <meta itemprop="description" content="记录学习的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zwer 的博客空间">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/03/12/20190312 AJax 异步技术和 json /" class="post-title-link" itemprop="url">20190312 AJax 异步技术和json</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-03-12 00:00:00" itemprop="dateCreated datePublished" datetime="2019-03-12T00:00:00+08:00">2019-03-12</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-09-08 19:50:10" itemprop="dateModified" datetime="2019-09-08T19:50:10+08:00">2019-09-08</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-删除用户信息"><a href="#1-删除用户信息" class="headerlink" title="1 删除用户信息"></a>1 删除用户信息</h1><blockquote>
<p>·delUserInfo 方法</p>
<p>将当前用户的信息删除，浏览器会刷新当前页，转向新的响应内容页面。</p>
<p>缺点：不能在保留当前页的情况下，将用户删除并显示。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span>  t_user <span class="keyword">where</span> uid = ？;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"button border-red"</span> </span><br><span class="line">    href=<span class="string">"data?method=delUserInfo&amp;uid=$&#123;user.uid&#125;"</span> </span><br><span class="line">    onclick=<span class="string">"return del()"</span>&gt;</span><br><span class="line">     &lt;span class="icon-trash-o"&gt;&lt;/span&gt; 删除</span><br><span class="line">&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function">function <span class="title">del</span><span class="params">()</span></span>&#123;	</span><br><span class="line">	<span class="keyword">return</span> confirm(<span class="string">"您确定要删除吗?"</span>);	</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除用户信息</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delUserInfo</span><span class="params">(HttpServletRequest req,HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		</span><br><span class="line">			<span class="comment">//获取请求信息</span></span><br><span class="line">				String uid = req.getParameter(<span class="string">"uid"</span>);</span><br><span class="line">			<span class="comment">//处理请求信息</span></span><br><span class="line">				<span class="comment">// 创建业务层对象</span></span><br><span class="line">				UserService us = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">				<span class="keyword">int</span> i = us.delUserInfo(uid);</span><br><span class="line">				<span class="keyword">if</span>(i &gt; <span class="number">0</span>)&#123;</span><br><span class="line">					resp.getWriter().print(<span class="string">"uid为 "</span>+uid+<span class="string">" 的用户已被删除"</span>);</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					resp.getWriter().print(<span class="string">"uid为 "</span>+uid+<span class="string">" 的用户删除失败"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="comment">//响应处理结果</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-AJax-技术概述和访问原理"><a href="#2-AJax-技术概述和访问原理" class="headerlink" title="2 AJax 技术概述和访问原理"></a>2 AJax 技术概述和访问原理</h1><blockquote>
<p>ajax 学习：</p>
<p>​    问题： 怎么在保留当前页面信息的基础上显示新的信息呢?</p>
<p>​    解决：使用 ajax</p>
<p>​    特点： 实现网页的局部刷新</p>
<p>   应用前景:  </p>
<p>​         搜索框提示语</p>
<p>​         地图</p>
<p>​         网页的其他功能(增加删除)</p>
</blockquote>
<h2 id="2-1-Ajax-访问原理"><a href="#2-1-Ajax-访问原理" class="headerlink" title="2.1  Ajax 访问原理"></a>2.1  Ajax 访问原理</h2><blockquote>
<p>请求方式：</p>
<p>​    form 标签中 action属性</p>
<p>​    a 标签中 href 属性</p>
<p>​    js中 window.location.href=””</p>
<p>对于服务器来说，请求方式来自哪里服务器不知道，只处理请求。</p>
<p>ajax 引擎对象：XMLHttpRequest </p>
<p>open 方法，创建请求对象</p>
<p>send 方法，发送请求数据</p>
</blockquote>
<p><img src="http://www.zwer.xyz/picGo/20190313083321.png" alt></p>
<h2 id="2-2-ajax-与-非ajax"><a href="#2-2-ajax-与-非ajax" class="headerlink" title="2.2 ajax 与 非ajax"></a>2.2 ajax 与 非ajax</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;title&gt; ajax 技术 &lt;/title&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"pragma"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"cache-control"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"expires"</span> content=<span class="string">"0"</span>&gt;    </span><br><span class="line">	&lt;meta http-equiv=<span class="string">"keywords"</span> content=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"description"</span> content=<span class="string">"This is my page"</span>&gt;</span><br><span class="line">	&lt;!--</span><br><span class="line">	&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"styles.css"</span>&gt;</span><br><span class="line">	--&gt;</span><br><span class="line">	&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		<span class="comment">//非 ajax</span></span><br><span class="line">		<span class="function">function <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			window.location.href=<span class="string">"my"</span>;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// ajax</span></span><br><span class="line">		<span class="function">function <span class="title">testAjax</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="comment">//声明 ajax 对象</span></span><br><span class="line">			<span class="keyword">var</span> ajax;</span><br><span class="line">			<span class="comment">//创建 ajax 对象</span></span><br><span class="line">			<span class="keyword">if</span>(window.XMLHttpRequest)&#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line">				<span class="comment">// 获取 ajax 引擎对象</span></span><br><span class="line">				ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">				</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(window.addObject)&#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">				ajax = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//声明 接受服务器的响应结果</span></span><br><span class="line">			<span class="comment">// 存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</span></span><br><span class="line">			ajax.onreadystatechange=function()&#123;</span><br><span class="line">				</span><br><span class="line">				 <span class="comment">//获取响应内容	</span></span><br><span class="line">				 <span class="keyword">var</span> data = ajax.responseText;</span><br><span class="line">				 <span class="comment">// 获取 div 对象</span></span><br><span class="line">				 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">				 <span class="comment">// 将 响应显示在 div 中</span></span><br><span class="line">				 div.innerHTML = data;</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//向服务器发送请求</span></span><br><span class="line">			ajax.open(<span class="string">"get"</span>,<span class="string">"my"</span>);</span><br><span class="line">			ajax.send(<span class="keyword">null</span>);</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="function">function <span class="title">testJs</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">var</span>  btn = document.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">			<span class="comment">//绑定事件</span></span><br><span class="line">			btn.onclick = function()&#123;</span><br><span class="line">				</span><br><span class="line">				alert(<span class="string">"绑定事件提示"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">	</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body onload=<span class="string">"testJs()"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"非ajax"</span>  onclick=<span class="string">"test()"</span>&gt;</span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"ajax"</span>  onclick=<span class="string">"testAjax()"</span>&gt;</span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"ajax"</span> id=<span class="string">"btn"</span>&gt;</span><br><span class="line">    	&lt;hr /&gt;</span><br><span class="line">    	&lt;div id=<span class="string">"divShow"</span> style=<span class="string">"width: 200px;height:200px;border:solid 1px"</span>&gt;</span><br><span class="line">    	</span><br><span class="line">    	</span><br><span class="line">    	&lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-Ajax-流程"><a href="#2-3-Ajax-流程" class="headerlink" title="2.3  Ajax 流程"></a>2.3  Ajax 流程</h2><blockquote>
<ol>
<li><p>创建 Ajax 引擎对象</p>
</li>
<li><p>声明 事件监听：监听ajax对象的属性readyState的值，一旦 readyState 的值发生变化就会触发声明函数的执行</p>
<ol>
<li><p>ajax 状态码 之 readyState的值</p>
<p>0： 表示创建 ajax 独享</p>
<p>1： 表示请求创建但是未发送</p>
<p>2： 表示请求发送</p>
<p>3： 请求处理完毕，正在接收响应内容</p>
<p>4：响应内容接收完毕</p>
</li>
</ol>
</li>
<li><p>创建并发送 ajax 对象</p>
<ol>
<li><p>创建 ajax 请求(设置异步或者同步)</p>
<p>ajax.open(method,url,ansyc)</p>
<p>method: 表示请求方式</p>
<p>​    get 方法：以  ？ 方法拼接在 url 的后面参数间用 &amp; 隔开。注意请求数据不能写在               send方法中</p>
<p>​    post 方法：需要单独的进行请求数据的设置。使用 ajax.</p>
<p>​             设置请求数据为键值对数据。如果有请求数据则 ajax.send(“键值对数据&amp;键值对数据…”) ，如果没有请求数据，则 ajax.send(null)</p>
<p>​    </p>
<p>url: 请求地址</p>
<p>ansyc 设置异步或者同步</p>
<p>​    异步：当前 Js 函数继续执行，无须等待ajax响应及响应处理</p>
<p>​    同步：当前 JS 函数不不继续执行，等待 ajax 响应及响应处理</p>
</li>
</ol>
</li>
</ol>
</blockquote>
<h1 id="3-Ajax-状态码-之-readyState"><a href="#3-Ajax-状态码-之-readyState" class="headerlink" title="3 Ajax 状态码 之 readyState"></a>3 Ajax 状态码 之 readyState</h1><blockquote>
<p> 0： 表示创建 ajax 引擎对象</p>
<p>1： 表示请求创建但是未发送</p>
<p>2： 表示请求发送</p>
<p>3： 请求处理完毕，正在接收响应内容</p>
<p>4：响应内容接收完毕(重要状态)</p>
<p>通过 ajax 状态码，可以明确知道请求在什么时候创建，什么时候发送，以及什么时候接受响应数据，响应数据完全接受的状态。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查看 ajax 状态码</span></span><br><span class="line">alert(ajax.readyState);</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;title&gt; ajax 技术 &lt;/title&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"pragma"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"cache-control"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"expires"</span> content=<span class="string">"0"</span>&gt;    </span><br><span class="line">	&lt;meta http-equiv=<span class="string">"keywords"</span> content=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"description"</span> content=<span class="string">"This is my page"</span>&gt;</span><br><span class="line">	&lt;!--</span><br><span class="line">	&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"styles.css"</span>&gt;</span><br><span class="line">	--&gt;</span><br><span class="line">	&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		<span class="comment">//非 ajax</span></span><br><span class="line">		<span class="function">function <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			window.location.href=<span class="string">"my"</span>;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// ajax</span></span><br><span class="line">		<span class="function">function <span class="title">testAjax</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="comment">//声明 ajax 对象</span></span><br><span class="line">			<span class="keyword">var</span> ajax;</span><br><span class="line">			<span class="comment">//创建 ajax 对象</span></span><br><span class="line">			<span class="keyword">if</span>(window.XMLHttpRequest)&#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line">				<span class="comment">// 获取 ajax 引擎对象</span></span><br><span class="line">				ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">					</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(window.addObject)&#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">				ajax = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//声明 接受服务器的响应结果</span></span><br><span class="line">			<span class="comment">// 存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</span></span><br><span class="line">			ajax.onreadystatechange=function()&#123;</span><br><span class="line">				<span class="comment">//小优化</span></span><br><span class="line">				<span class="comment">// 当响应内容完全接受完毕时，将响应内容显示到页面中</span></span><br><span class="line">				<span class="keyword">if</span>(ajax.readyState == <span class="number">4</span>)&#123;</span><br><span class="line">					 <span class="comment">//获取响应内容	</span></span><br><span class="line">					 <span class="keyword">var</span> data = ajax.responseText;</span><br><span class="line">					 <span class="comment">// 获取 div 对象</span></span><br><span class="line">					 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">					 <span class="comment">// 将 响应显示在 div 中</span></span><br><span class="line">					 div.innerHTML = data; 						</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//向服务器发送请求</span></span><br><span class="line">			ajax.open(<span class="string">"get"</span>,<span class="string">"my"</span>);</span><br><span class="line">			ajax.send(<span class="keyword">null</span>);</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="function">function <span class="title">testJs</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">var</span>  btn = document.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">			<span class="comment">//绑定事件</span></span><br><span class="line">			btn.onclick = function()&#123;</span><br><span class="line">				</span><br><span class="line">				alert(<span class="string">"绑定事件提示"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">	</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body onload=<span class="string">"testJs()"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"非ajax"</span>  onclick=<span class="string">"test()"</span>&gt;</span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"ajax"</span>  onclick=<span class="string">"testAjax()"</span>&gt;</span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"ajax"</span> id=<span class="string">"btn"</span>&gt;</span><br><span class="line">    	&lt;hr /&gt;</span><br><span class="line">    	&lt;div id=<span class="string">"divShow"</span> style=<span class="string">"width: 200px;height:200px;border:solid 1px"</span>&gt;</span><br><span class="line">    	</span><br><span class="line">    	</span><br><span class="line">    	&lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="4-Ajax-响应状态码-status"><a href="#4-Ajax-响应状态码-status" class="headerlink" title="4 Ajax 响应状态码 status"></a>4 Ajax 响应状态码 status</h1><blockquote>
<p>200  表示一切正常</p>
<p>404 请求资源不存在</p>
<p>500 服务内部错误(繁忙)</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ajax.status == <span class="number">404</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;title&gt; ajax 技术 &lt;/title&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"pragma"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"cache-control"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"expires"</span> content=<span class="string">"0"</span>&gt;    </span><br><span class="line">	&lt;meta http-equiv=<span class="string">"keywords"</span> content=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"description"</span> content=<span class="string">"This is my page"</span>&gt;</span><br><span class="line">	&lt;!--</span><br><span class="line">	&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"styles.css"</span>&gt;</span><br><span class="line">	--&gt;</span><br><span class="line">	&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		<span class="comment">//非 ajax</span></span><br><span class="line">		<span class="function">function <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			window.location.href=<span class="string">"my"</span>;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// ajax</span></span><br><span class="line">		<span class="function">function <span class="title">testAjax</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="comment">//声明 ajax 对象</span></span><br><span class="line">			<span class="keyword">var</span> ajax;</span><br><span class="line">			<span class="comment">//创建 ajax 对象</span></span><br><span class="line">			<span class="keyword">if</span>(window.XMLHttpRequest)&#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line">				<span class="comment">// 获取 ajax 引擎对象</span></span><br><span class="line">				ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">					</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(window.addObject)&#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">				ajax = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//声明 接受服务器的响应结果</span></span><br><span class="line">			<span class="comment">// 存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</span></span><br><span class="line">			ajax.onreadystatechange=function()&#123;</span><br><span class="line">				<span class="comment">//小优化</span></span><br><span class="line">				<span class="comment">// 当响应内容完全接受完毕时，将响应内容显示到页面中</span></span><br><span class="line">				<span class="keyword">if</span>(ajax.readyState == <span class="number">4</span>)&#123;</span><br><span class="line">					<span class="comment">//如果响应码正常</span></span><br><span class="line">					<span class="keyword">if</span>(ajax.status == <span class="number">200</span>)&#123;</span><br><span class="line">						 <span class="comment">//获取响应内容	</span></span><br><span class="line">						 <span class="keyword">var</span> data = ajax.responseText;</span><br><span class="line">						 <span class="comment">// 获取 div 对象</span></span><br><span class="line">						 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">						 <span class="comment">// 将 响应显示在 div 中</span></span><br><span class="line">						 div.innerHTML = data; 	</span><br><span class="line">						 </span><br><span class="line">						&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ajax.status == <span class="number">404</span>)&#123;</span><br><span class="line">							 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">							 div.innerHTML = <span class="string">"请求资源不存在"</span>; 	</span><br><span class="line">						&#125;</span><br><span class="line">						&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ajax.status == <span class="number">500</span>)&#123;</span><br><span class="line">							 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">							 div.innerHTML = <span class="string">"内部服务器繁忙"</span>; 	</span><br><span class="line">						&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">							 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">							 div.innerHTML = <span class="string">"未知错误"</span>; 		</span><br><span class="line">						&#125;</span><br><span class="line">	</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//向服务器发送请求</span></span><br><span class="line">			ajax.open(<span class="string">"get"</span>,<span class="string">"my"</span>);</span><br><span class="line">			ajax.send(<span class="keyword">null</span>);</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="function">function <span class="title">testJs</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">var</span>  btn = document.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">			<span class="comment">//绑定事件</span></span><br><span class="line">			btn.onclick = function()&#123;</span><br><span class="line">				</span><br><span class="line">				alert(<span class="string">"绑定事件提示"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">	</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body onload=<span class="string">"testJs()"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"非ajax"</span>  onclick=<span class="string">"test()"</span>&gt;</span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"ajax"</span>  onclick=<span class="string">"testAjax()"</span>&gt;</span><br><span class="line">    	&lt;input type=<span class="string">"button"</span>  value=<span class="string">"ajax"</span> id=<span class="string">"btn"</span>&gt;</span><br><span class="line">    	&lt;hr /&gt;</span><br><span class="line">    	&lt;div id=<span class="string">"divShow"</span> style=<span class="string">"width: 200px;height:200px;border:solid 1px"</span>&gt;</span><br><span class="line">    	</span><br><span class="line">    	</span><br><span class="line">    	&lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="5-异步同步技术-async"><a href="#5-异步同步技术-async" class="headerlink" title="5  异步同步技术 async"></a>5  异步同步技术 async</h1><blockquote>
<p>​    ansyc 设置异步或者同步</p>
<p>​    异步：当前 Js 函数继续执行，无须等待ajax响应及响应处理</p>
<p>​    同步：当前 JS 函数不不继续执行，等待 ajax 响应及响应处理</p>
<p>​    <code>ajax.open(method,url,asyn);</code></p>
<p>​    <code>asyn = true</code> 表示异步，默认为异步</p>
<p>​     <code>asyn = false</code> 表示异步同步，等待服务器响应结果回来，再继续执行该函数</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="built_in">String</span> path = request.getContextPath();</span><br><span class="line"><span class="built_in">String</span> basePath = request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;base href=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;title&gt;ajax 技术&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;meta http-equiv="pragma" content="no-cache"&gt;</span></span><br><span class="line"><span class="regexp">&lt;meta http-equiv="cache-control" content="no-cache"&gt;</span></span><br><span class="line"><span class="regexp">&lt;meta http-equiv="expires" content="0"&gt;</span></span><br><span class="line"><span class="regexp">&lt;meta http-equiv="keywords" content="keyword1,keyword2,keyword3"&gt;</span></span><br><span class="line"><span class="regexp">&lt;meta http-equiv="description" content="This is my page"&gt;</span></span><br><span class="line"><span class="regexp">&lt;!--</span></span><br><span class="line"><span class="regexp">	&lt;link rel="stylesheet" type="text/</span>css<span class="string">" href="</span>styles.css<span class="string">"&gt;</span></span><br><span class="line"><span class="string">	--&gt;</span></span><br><span class="line"><span class="string">&lt;script type="</span>text/javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">		//非 ajax</span></span><br><span class="line"><span class="string">		function test()&#123;</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string">			window.location.href="</span>my<span class="string">";</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">		// ajax</span></span><br><span class="line"><span class="string">		function testAjax()&#123;</span></span><br><span class="line"><span class="string">			//声明 ajax 对象</span></span><br><span class="line"><span class="string">			var ajax;</span></span><br><span class="line"><span class="string">			//创建 ajax 对象</span></span><br><span class="line"><span class="string">			if(window.XMLHttpRequest)&#123;// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line"><span class="string">				// 获取 ajax 引擎对象</span></span><br><span class="line"><span class="string">				ajax = new XMLHttpRequest();</span></span><br><span class="line"><span class="string">					</span></span><br><span class="line"><span class="string">			&#125;else if(window.addObject)&#123;// code for IE6, IE5</span></span><br><span class="line"><span class="string">				ajax = new ActiveXObject("</span>Microsoft.XMLHTTP<span class="string">");</span></span><br><span class="line"><span class="string">			&#125;</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string">			//声明 接受服务器的响应结果</span></span><br><span class="line"><span class="string">			// 存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</span></span><br><span class="line"><span class="string">			ajax.onreadystatechange=function()&#123;</span></span><br><span class="line"><span class="string">				//小优化</span></span><br><span class="line"><span class="string">				// 当响应内容完全接受完毕时，将响应内容显示到页面中</span></span><br><span class="line"><span class="string">				if(ajax.readyState == 4)&#123;</span></span><br><span class="line"><span class="string">					//如果响应码正常</span></span><br><span class="line"><span class="string">					if(ajax.status == 200)&#123;</span></span><br><span class="line"><span class="string">						 //获取响应内容	</span></span><br><span class="line"><span class="string">						 var data = ajax.responseText;</span></span><br><span class="line"><span class="string">						 // 获取 div 对象</span></span><br><span class="line"><span class="string">						 var div = document.getElementById("</span>divShow<span class="string">");</span></span><br><span class="line"><span class="string">						 // 将 响应显示在 div 中</span></span><br><span class="line"><span class="string">						 div.innerHTML = data; 		 </span></span><br><span class="line"><span class="string">					&#125;else if(ajax.status == 404)&#123;</span></span><br><span class="line"><span class="string">						 var div = document.getElementById("</span>divShow<span class="string">");</span></span><br><span class="line"><span class="string">						 div.innerHTML = "</span>请求资源不存在<span class="string">"; 	</span></span><br><span class="line"><span class="string">					&#125;else if(ajax.status == 500)&#123;</span></span><br><span class="line"><span class="string">						 var div = document.getElementById("</span>divShow<span class="string">");</span></span><br><span class="line"><span class="string">						 div.innerHTML = "</span>内部服务器繁忙<span class="string">"; 	</span></span><br><span class="line"><span class="string">					&#125;else&#123;</span></span><br><span class="line"><span class="string">						 var div = document.getElementById("</span>divShow<span class="string">");</span></span><br><span class="line"><span class="string">						 div.innerHTML = "</span>未知错误<span class="string">"; 		</span></span><br><span class="line"><span class="string">					&#125;</span></span><br><span class="line"><span class="string">				&#125;</span></span><br><span class="line"><span class="string">			&#125;</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string">			//创建 ajax 请求</span></span><br><span class="line"><span class="string">			ajax.open("</span><span class="keyword">get</span>","my",false);</span><br><span class="line">			//发送 ajax 请求</span><br><span class="line">			ajax.send(null);</span><br><span class="line">			//异步同步</span><br><span class="line">			alert("异步同步");</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		function testJs()&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">var</span>  btn = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">			<span class="comment">//绑定事件</span></span><br><span class="line">			btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">				</span><br><span class="line">				alert(<span class="string">"绑定事件提示"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body onload=<span class="string">"testJs()"</span>&gt;</span><br><span class="line"></span><br><span class="line">	&lt;input type=<span class="string">"button"</span> value=<span class="string">"非ajax"</span> onclick=<span class="string">"test()"</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">"button"</span> value=<span class="string">"ajax"</span> onclick=<span class="string">"testAjax()"</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">"button"</span> value=<span class="string">"ajax"</span> id=<span class="string">"btn"</span>&gt;</span><br><span class="line">	&lt;hr /&gt;</span><br><span class="line">	&lt;div id=<span class="string">"divShow"</span> style=<span class="string">"width: 200px;height:200px;border:solid 1px"</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://www.zwer.xyz/picGo/ajax%E4%B9%8Basyn.gif" alt></p>
<h1 id="6-Get-和-Post-请求方法"><a href="#6-Get-和-Post-请求方法" class="headerlink" title="6 Get 和 Post 请求方法"></a>6 Get 和 Post 请求方法</h1><blockquote>
<p>get 方法：以  ？ 方法拼接在 url 的后面参数间用 &amp; 隔开。</p>
<p>​        注意请求数据不能写在send方法中。</p>
<p>post 方法：需要单独的进行请求数据的设置。使用 ajax.</p>
<p>​             设置请求数据为键值对数据。如果有请求数据则 ajax.send(“键值对数据&amp;键值对数据…”) ，</p>
<p>​          如果没有请求数据，则 ajax.send(null)</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建 ajax 请求</span></span><br><span class="line">ajax.open(<span class="string">"get"</span>,<span class="string">"my?uname=张三&amp;pwd=123"</span>,<span class="literal">false</span>);</span><br><span class="line"><span class="comment">//发送 ajax 请求</span></span><br><span class="line">ajax.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// post 请求</span></span><br><span class="line"><span class="comment">// 创建 ajax 请求</span></span><br><span class="line">ajax.open(<span class="string">"post"</span>, <span class="string">"my"</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">//设置请求头</span></span><br><span class="line">ajax.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>)</span><br><span class="line"><span class="comment">//发送 ajax 请求</span></span><br><span class="line">ajax.send(<span class="string">"uname=张三&amp;pwd=123"</span>);</span><br></pre></td></tr></table></figure>

<h1 id="7-Json-对象与响应数据"><a href="#7-Json-对象与响应数据" class="headerlink" title="7 Json 对象与响应数据"></a>7 Json 对象与响应数据</h1><h2 id="7-1-Json-对象"><a href="#7-1-Json-对象" class="headerlink" title="7.1 Json 对象"></a>7.1 Json 对象</h2><blockquote>
<p>json 是一种 Js 创建对象中声明的一种格式</p>
<p>使用 Json 对象的好处：保证对象中数据的紧密性和完整性</p>
<p>使用 ：在服务器端将要响应的数据拼接成 json 格式的字符串。这样客户端（浏览器端）在接受到响应数据后可以 使用 eval 方法将 json 格式的字符串数据直接转换为 对应的 JS 对象，便于数据的操作。在服务器端使用类似 Gson 的工具包完成 json格式的字符串的拼接。</p>
<p>Json 的格式：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var 对象名 = &#123;</span><br><span class="line"></span><br><span class="line">	键名："值"，</span><br><span class="line">	键名："值"，</span><br><span class="line">	...</span><br><span class="line">	键名："值"，</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种方法创建 json 对象</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">obj.name = <span class="string">"张三"</span>;</span><br><span class="line">obj.pwd = <span class="string">"123"</span>;</span><br><span class="line"><span class="comment">//第二种方法创建 json 对象</span></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">    name:<span class="string">"李四"</span>,</span><br><span class="line">    pwd:<span class="string">"123"</span>,</span><br><span class="line">    sex:<span class="string">"男"</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//输出</span></span><br><span class="line">alert(obj.name+<span class="string">"  "</span>+obj2.name);</span><br></pre></td></tr></table></figure>

<h2 id="7-2-Ajax-之-响应数据"><a href="#7-2-Ajax-之-响应数据" class="headerlink" title="7.2 Ajax 之 响应数据"></a>7.2 Ajax 之 响应数据</h2><blockquote>
<p>服务器响应给浏览器的数据应该是字符串类型</p>
<p>但是如果数据量比较大，我们就需要在服务端将数据拼接上一个良好的字符串格式数据，</p>
<p>响应给浏览器根据格式进行数据的解析和使用</p>
<p>问题： </p>
<p>​    什么昂的格式算是良好格式呢？</p>
<p>解决：</p>
<p>​    使用 json 数据格式  </p>
<p>​    使用  js 中 eval 方法将字符串转成 JS 对象</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.szxy.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAjax</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">				<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">				</span><br><span class="line">			</span><br><span class="line">					<span class="comment">//设置请求编码格式</span></span><br><span class="line">					req.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">					<span class="comment">//设置响应编码格式</span></span><br><span class="line">					resp.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">					<span class="comment">//获取请求数据</span></span><br><span class="line">					String uname = req.getParameter(<span class="string">"uname"</span>);</span><br><span class="line">					String pwd = req.getParameter(<span class="string">"pwd"</span>);</span><br><span class="line">					</span><br><span class="line">					System.out.println(uname+<span class="string">"----"</span>+pwd);</span><br><span class="line">					</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="keyword">new</span> Thread().sleep(<span class="number">2000</span>);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="comment">//处理请求数据</span></span><br><span class="line">					<span class="comment">//int i = 1/0;</span></span><br><span class="line">					User user = <span class="keyword">new</span> User();</span><br><span class="line">					user.setName(<span class="string">"张三"</span>);</span><br><span class="line">					user.setPwd(<span class="string">"123"</span>);</span><br><span class="line">					user.setSex(<span class="string">"男"</span>);</span><br><span class="line">					user.setAge(<span class="number">20</span>);</span><br><span class="line">					</span><br><span class="line">					<span class="comment">//将 user 对象中的数据转换成 json 格式的数据</span></span><br><span class="line">				<span class="comment">//	String str = new String("&#123;uname:'张三',pwd:'123',sex:'男',age:20&#125;");</span></span><br><span class="line">					String str= <span class="keyword">new</span> Gson().toJson(user);</span><br><span class="line">					System.out.println(str);</span><br><span class="line">					</span><br><span class="line">					<span class="comment">//响应处理结果</span></span><br><span class="line">					PrintWriter out = resp.getWriter();</span><br><span class="line">					<span class="comment">/*out.write("ajax学习");*/</span></span><br><span class="line">					out.write(str);</span><br><span class="line">				</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;base href=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;title&gt;ajax 技术&lt;/title&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"pragma"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"cache-control"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"expires"</span> content=<span class="string">"0"</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"keywords"</span> content=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"description"</span> content=<span class="string">"This is my page"</span>&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">	&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"styles.css"</span>&gt;</span><br><span class="line">	--&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		<span class="comment">//非 ajax</span></span><br><span class="line">		<span class="function">function <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			window.location.href=<span class="string">"my"</span>;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// ajax</span></span><br><span class="line">		<span class="function">function <span class="title">testAjax</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="comment">//声明 ajax 对象</span></span><br><span class="line">			<span class="keyword">var</span> ajax;</span><br><span class="line">			<span class="comment">//创建 ajax 对象</span></span><br><span class="line">			<span class="keyword">if</span>(window.XMLHttpRequest)&#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line">				<span class="comment">// 获取 ajax 引擎对象</span></span><br><span class="line">				ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">					</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(window.addObject)&#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">				ajax = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//声明 接受服务器的响应结果</span></span><br><span class="line">			<span class="comment">// 存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</span></span><br><span class="line">			ajax.onreadystatechange=function()&#123;</span><br><span class="line">				<span class="comment">//小优化</span></span><br><span class="line">				<span class="comment">// 当响应内容完全接受完毕时，将响应内容显示到页面中</span></span><br><span class="line">				<span class="keyword">if</span>(ajax.readyState == <span class="number">4</span>)&#123;</span><br><span class="line">					<span class="comment">//如果响应码正常</span></span><br><span class="line">					<span class="keyword">if</span>(ajax.status == <span class="number">200</span>)&#123;</span><br><span class="line">						 <span class="comment">//获取响应内容	</span></span><br><span class="line">						 <span class="keyword">var</span> data = ajax.responseText;</span><br><span class="line">						 <span class="comment">//处理响应内容</span></span><br><span class="line">						 eval(<span class="string">"var obj="</span>+data);</span><br><span class="line">						 <span class="comment">// 获取 div 对象</span></span><br><span class="line">						 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">						 <span class="comment">// 将 响应显示在 div 中</span></span><br><span class="line">						 div.innerHTML = obj.name; 		 </span><br><span class="line">					&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ajax.status == <span class="number">404</span>)&#123;</span><br><span class="line">						 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">						 div.innerHTML = <span class="string">"请求资源不存在"</span>; 	</span><br><span class="line">					&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ajax.status == <span class="number">500</span>)&#123;</span><br><span class="line">						 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">						 div.innerHTML = <span class="string">"内部服务器繁忙"</span>; 	</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">						 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);</span><br><span class="line">						 div.innerHTML = <span class="string">"未知错误"</span>; 		</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// get 请求</span></span><br><span class="line">			<span class="comment">/* //创建 ajax 请求</span></span><br><span class="line"><span class="comment">			ajax.open("get","my?uname=张三&amp;pwd=123",false);</span></span><br><span class="line"><span class="comment">			//发送 ajax 请求</span></span><br><span class="line"><span class="comment">			ajax.send(null); */</span></span><br><span class="line">			<span class="comment">// post 请求</span></span><br><span class="line">			<span class="comment">// 创建 ajax 请求</span></span><br><span class="line">			ajax.open(<span class="string">"post"</span>, <span class="string">"my"</span>, <span class="keyword">false</span>);</span><br><span class="line">			<span class="comment">//设置请求头</span></span><br><span class="line">			ajax.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>)</span><br><span class="line">			<span class="comment">//发送 ajax 请求</span></span><br><span class="line">			ajax.send(<span class="string">"uname=张三&amp;pwd=123"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//异步同步</span></span><br><span class="line">			 <span class="keyword">var</span> div = document.getElementById(<span class="string">"divShow"</span>);			</span><br><span class="line">			alert(div.innerHTML);</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="function">function <span class="title">testJs</span><span class="params">()</span></span>&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">var</span>  btn = document.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">			<span class="comment">//绑定事件</span></span><br><span class="line">			btn.onclick = function()&#123;</span><br><span class="line">				</span><br><span class="line">				alert(<span class="string">"绑定事件提示"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//第一种方法创建 json 对象</span></span><br><span class="line">		<span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">		obj.name = <span class="string">"张三"</span>;</span><br><span class="line">		obj.pwd = <span class="string">"123"</span>;</span><br><span class="line">		<span class="comment">//第二种方法创建 json 对象</span></span><br><span class="line">		<span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">				name:<span class="string">"李四"</span>,</span><br><span class="line">				pwd:<span class="string">"123"</span>,</span><br><span class="line">				sex:<span class="string">"男"</span></span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="comment">//输出</span></span><br><span class="line">		alert(obj.name+<span class="string">"  "</span>+obj2.name);</span><br><span class="line">		</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body onload=<span class="string">"testJs()"</span>&gt;</span><br><span class="line"></span><br><span class="line">	&lt;input type=<span class="string">"button"</span> value=<span class="string">"非ajax"</span> onclick=<span class="string">"test()"</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">"button"</span> value=<span class="string">"ajax"</span> onclick=<span class="string">"testAjax()"</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">"button"</span> value=<span class="string">"ajax"</span> id=<span class="string">"btn"</span>&gt;</span><br><span class="line">	&lt;hr /&gt;</span><br><span class="line">	&lt;div id=<span class="string">"divShow"</span> style=<span class="string">"width: 200px;height:200px;border:solid 1px"</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="8-Ajax-流程"><a href="#8-Ajax-流程" class="headerlink" title="8 Ajax 流程"></a>8 Ajax 流程</h1><blockquote>
<ol>
<li><p>创建 ajax 引擎对象  XMLHttpRequest</p>
</li>
<li><p>声明事件监听</p>
<p>​    ajax 状态码等于 4</p>
<p>​         ajax 响应码</p>
<p>​            获取响应内容(普通格式字符串或者 Json格式的字符串)</p>
<p>​            处理响应内容</p>
</li>
<li><p>创建并发送 ajax 请求</p>
<ol>
<li>创建 ajax 请求(请求方式，请求地址，同步或异步)</li>
<li>发送 ajax 请求</li>
</ol>
</li>
<li><p>其他操作</p>
</li>
</ol>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[创建 Ajax 对象] --&gt; B[声明事件监听]</span><br><span class="line">B--&gt;C[创建并发送 ajax 请求]</span><br><span class="line">C--&gt;D[其他操作]</span><br></pre></td></tr></table></figure>

<h1 id="9-用户注册"><a href="#9-用户注册" class="headerlink" title="9 用户注册"></a>9 用户注册</h1><blockquote>
<p>功能：用户名是否被注册校验</p>
<p>思路：</p>
<pre><code>1. 用户书写用户名信息，在失去焦点是进行用户校验
2. 失去焦点发送请求到服务器，服务器根据用户名信息去数据库中查询该用户名是否存在
3. 将校验结果响应客户端
4. 在当前页面，失去焦点后用户名输入框后显示提示语</code></pre><p>技术：</p>
<p>​    使用 ajax 技术</p>
</blockquote>
<h2 id="9-1-前端代码"><a href="#9-1-前端代码" class="headerlink" title="9.1 前端代码"></a>9.1 前端代码</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String path = request.getContextPath();</span><br><span class="line">String basePath = request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;title&gt;注册&lt;/title&gt;</span><br><span class="line">    </span><br><span class="line">	&lt;meta http-equiv=<span class="string">"pragma"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"cache-control"</span> content=<span class="string">"no-cache"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"expires"</span> content=<span class="string">"0"</span>&gt;    </span><br><span class="line">	&lt;meta http-equiv=<span class="string">"keywords"</span> content=<span class="string">"keyword1,keyword2,keyword3"</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"description"</span> content=<span class="string">"This is my page"</span>&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;script&gt;</span><br><span class="line">		<span class="comment">// 检查用户是否已被注册</span></span><br><span class="line">		<span class="function">function <span class="title">checkName</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="comment">// 创建 ajax 对象</span></span><br><span class="line">			<span class="keyword">var</span> ajax = <span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">if</span>(window.XMLHttpRequest)&#123;</span><br><span class="line">				ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(window.addObject)&#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">				ajax = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//声明事件监听</span></span><br><span class="line">			ajax.onreadystatechange=function()&#123;</span><br><span class="line">				<span class="comment">//判断 ajax 状态码</span></span><br><span class="line">				<span class="keyword">if</span>(ajax.readyState == <span class="number">4</span>)&#123;</span><br><span class="line">					<span class="comment">//判断 ajax 响应码</span></span><br><span class="line">					<span class="keyword">if</span>(ajax.status == <span class="number">200</span>)&#123;</span><br><span class="line">						<span class="comment">// 获取响应内容</span></span><br><span class="line">						<span class="keyword">var</span> data = ajax.responseText;</span><br><span class="line">						<span class="comment">// 处理响应内容</span></span><br><span class="line">						<span class="keyword">var</span> span = document.getElementById(<span class="string">"unameSpan"</span>);</span><br><span class="line">						<span class="keyword">if</span>(eval(data))&#123;</span><br><span class="line">							span.innerHTML = <span class="string">"用户名 OK"</span>;</span><br><span class="line">							span.style.color = <span class="string">"green"</span>;</span><br><span class="line">						&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">							span.innerHTML = <span class="string">"用户名已被注册"</span>;</span><br><span class="line">							span.style.color = <span class="string">"red"</span>;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; </span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 创建并发送请求</span></span><br><span class="line">			<span class="comment">//声明事件监听</span></span><br><span class="line">			<span class="keyword">var</span> input = document.getElementById(<span class="string">"uname"</span>);</span><br><span class="line">			<span class="keyword">var</span> val = input.value;</span><br><span class="line">			ajax.open(<span class="string">"get"</span>, <span class="string">"data?uname="</span>+val,<span class="keyword">true</span>);</span><br><span class="line">			<span class="comment">//发送请求</span></span><br><span class="line">			ajax.send(<span class="keyword">null</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;body&gt;</span><br><span class="line">   		&lt;form action=<span class="string">"#"</span> &gt;</span><br><span class="line">   			&lt;label&gt;用户名: &lt;/label&gt;</span><br><span class="line">   			&lt;input type="text" name="uname" id="uname" onblur="checkName()"/&gt;&amp;nbsp;&lt;span id="unameSpan"&gt;&lt;/span&gt;</span><br><span class="line">   		&lt;/form&gt;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9-2-后端代码"><a href="#9-2-后端代码" class="headerlink" title="9.2 后端代码"></a>9.2 后端代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.szxy.service.DataService;</span><br><span class="line"><span class="keyword">import</span> cn.szxy.service.impl.DataServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="comment">//声明  业务层对象</span></span><br><span class="line">	DataService service = <span class="keyword">new</span> DataServiceImpl();</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//设置请求编码格式</span></span><br><span class="line">			req.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">			<span class="comment">//设置响应编码格式</span></span><br><span class="line">			resp.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">			<span class="comment">//获取请求数据</span></span><br><span class="line">			String uname = req.getParameter(<span class="string">"uname"</span>);</span><br><span class="line">			<span class="comment">//处理请求数据</span></span><br><span class="line">			<span class="keyword">boolean</span> flag = service.selUserByName(uname);</span><br><span class="line">			<span class="comment">//响应处理结果</span></span><br><span class="line">			<span class="keyword">if</span>(!flag)&#123;<span class="comment">//表示该用户名未被注册</span></span><br><span class="line">				resp.getWriter().write(<span class="string">"true"</span>);<span class="comment">//直接响应 true ,可以降低 前端与后端之间的耦合</span></span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;<span class="comment">//表示该用户名已被注册</span></span><br><span class="line">				resp.getWriter().write(<span class="string">"false"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.szxy.dao.DataDao;</span><br><span class="line"><span class="keyword">import</span> cn.szxy.dao.impl.DataDaoImpl;</span><br><span class="line"><span class="keyword">import</span> cn.szxy.service.DataService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataServiceImpl</span> <span class="keyword">implements</span> <span class="title">DataService</span></span>&#123;</span><br><span class="line">	<span class="comment">// 获取 dao 层对象</span></span><br><span class="line">	DataDao dao = <span class="keyword">new</span> DataDaoImpl();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//根据用户名查询指定用户信息</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">selUserByName</span><span class="params">(String uname)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dao.selUserByName(uname);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.szxy.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.szxy.dao.DataDao;</span><br><span class="line"><span class="keyword">import</span> cn.szxy.util.DBUtil;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataDaoImpl</span> <span class="keyword">implements</span> <span class="title">DataDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 查询用户是否已经被注册</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">selUserByName</span><span class="params">(String uname)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//声明变量</span></span><br><span class="line">		Connection conn = <span class="keyword">null</span>;</span><br><span class="line">		PreparedStatement pstmt = <span class="keyword">null</span>;</span><br><span class="line">		ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 判断用户是否已被注册的标志，false 表示未被注册</span></span><br><span class="line">		<span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//获取数据库连接</span></span><br><span class="line">			conn = DBUtil.getConnection();</span><br><span class="line">			<span class="comment">//定义 sql 语句</span></span><br><span class="line">			String sql = <span class="string">"select * from t_user where name = ?"</span>;</span><br><span class="line">			<span class="comment">//获取 预处理发射器</span></span><br><span class="line">			pstmt = conn.prepareStatement(sql);</span><br><span class="line">			<span class="comment">//占位符</span></span><br><span class="line">			pstmt.setString(<span class="number">1</span>, uname);</span><br><span class="line">			<span class="comment">//执行 sql 语句，得到结果集</span></span><br><span class="line">			rs = pstmt.executeQuery();</span><br><span class="line">			<span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">				flag = <span class="keyword">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//判断</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="comment">//关闭资源</span></span><br><span class="line">			DBUtil.closeAll(rs, pstmt, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//返回结果</span></span><br><span class="line">		<span class="keyword">return</span> flag;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-3-效果图"><a href="#9-3-效果图" class="headerlink" title="9.3 效果图"></a>9.3 效果图</h2><p><img src="http://www.zwer.xyz/picGo/%E6%B5%8B%E8%AF%95ajax112.gif" alt></p>
<h1 id="10-Ajax-封装"><a href="#10-Ajax-封装" class="headerlink" title="10  Ajax 封装"></a>10  Ajax 封装</h1><blockquote>
<p>解决：编写代码时出现了重复编写，影响了开发的效率</p>
<p>实现：相同的保留，不同的传参</p>
<p>请求方式：method</p>
<p>请求地址：url</p>
<p>请求参数：data 请求参数的格式为键值对，不同的键值对使用&amp;隔开</p>
<p>​         实例：”a=1&amp;b=2”</p>
<p>异步同步设置：ansyc</p>
<p>响应处理函数：deal200 该参数接受一个 JS 的 函数对象，函数对象中声明 ajax 响应数据的处理逻辑代码。</p>
<p>​            注意：函数对象需要声明一个形参用来接受要处理的响应数据</p>
<p>JS 函数可以不传值，默认值</p>
</blockquote>
<ul>
<li>ajax.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装 Ajax 工具类</span></span><br><span class="line"><span class="comment"> * @param method  	请求方式 Get、Post</span></span><br><span class="line"><span class="comment"> * @param url    	请求地址</span></span><br><span class="line"><span class="comment"> * @param data	  	请求路径</span></span><br><span class="line"><span class="comment"> * @param deal200	处理请求的函数</span></span><br><span class="line"><span class="comment"> * @param ansyc		异步同步</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myAjax</span>(<span class="params">method, url, data, deal200, ansyc</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//创建 ajax 引擎对象</span></span><br><span class="line">	<span class="keyword">var</span> ajax = <span class="literal">null</span>;</span><br><span class="line">	<span class="comment">//判断浏览器类型</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span><br><span class="line">		ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">window</span>.addObject)&#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">		ajax = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//声明事件监听</span></span><br><span class="line">	ajax.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="comment">//判断 ajax状态码   等于4表示响应结果接受完毕</span></span><br><span class="line">		<span class="keyword">if</span> (ajax.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">			<span class="comment">//判断 ajax 响应码</span></span><br><span class="line">			<span class="keyword">if</span> (ajax.status == <span class="number">200</span>) &#123;</span><br><span class="line">				<span class="comment">//获取响应数据</span></span><br><span class="line">				<span class="keyword">var</span> data = ajax.responseText;</span><br><span class="line">				<span class="keyword">if</span> (deal200) &#123;</span><br><span class="line">					deal200(data);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断请求方式</span></span><br><span class="line">	<span class="keyword">if</span> (method == <span class="string">"get"</span>) &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建并发送 ajax 请求</span></span><br><span class="line">		ajax.open(method, url + (data == <span class="literal">null</span> ? <span class="string">""</span> : <span class="string">"?"</span>+data), ansyc);</span><br><span class="line">		ajax.send(<span class="literal">null</span>);</span><br><span class="line">		</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (method == <span class="string">"post"</span>) &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建 ajax 请求</span></span><br><span class="line">		ajax.open(method, url, ansyc);</span><br><span class="line">		<span class="comment">//设置请求头,以键值对的方式发送表单数据</span></span><br><span class="line">		ajax.setRequestHeader(<span class="string">"Content-Type"</span>,</span><br><span class="line">				<span class="string">"application/x-www-form-urlencoded"</span>);</span><br><span class="line">		<span class="comment">//发送 ajax 请求	</span></span><br><span class="line">		ajax.send((data == <span class="literal">null</span> ? <span class="string">""</span> : data));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试 ajax.js 工具类</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>封装 Ajax <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  引入 ajax 工具类 --&gt;</span>  </span><br><span class="line">  	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>  <span class="attr">src</span>=<span class="string">"js/ajaxUtil.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  	</span><br><span class="line">  	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">  		<span class="comment">// 调用 工具类</span></span></span><br><span class="line"><span class="javascript">		myAjax(<span class="string">"get"</span>,<span class="string">"/ajax/my"</span>,<span class="literal">null</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			alert(<span class="string">"Test"</span>);</span></span><br><span class="line">			alert(data);</span><br><span class="line"><span class="javascript">		&#125;,<span class="literal">true</span>);</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"测试 ajax"</span>  <span class="attr">onclick</span>=<span class="string">"myAjax()"</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="11-Jquery-封装-AJax"><a href="#11-Jquery-封装-AJax" class="headerlink" title="11  Jquery 封装  AJax"></a>11  Jquery 封装  AJax</h1><blockquote>
<p>Jquery 是 Js 的一个轻量性框架，已经将 JS 创建的操作进行了封装，而 Ajax 也是</p>
<p>一部分，所以 JQuery 也已经将 ajax 进行了封装。</p>
</blockquote>
<h2 id="11-1-封装"><a href="#11-1-封装" class="headerlink" title="11.1  封装"></a>11.1  封装</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="keyword">get</span>(url,data,function)   //<span class="keyword">get</span>  请求方式   适用于简单的业务逻辑规则</span><br><span class="line">$.post(url,data,function)  //post 请求方式   适用于简单的业务逻辑规则</span><br><span class="line">$.ajax(&#123;json格式&#125;)  <span class="comment">// 适用于复杂的业务逻辑规则</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// url 请求地址</span></span><br><span class="line"><span class="comment">// data 请求参数</span></span><br></pre></td></tr></table></figure>

<h2 id="11-2-栗子"><a href="#11-2-栗子" class="headerlink" title="11.2 栗子"></a>11.2 栗子</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="comment">// ajax 方式发送请求</span></span></span><br><span class="line"><span class="javascript">    $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">    type: <span class="string">"get"</span>,</span></span><br><span class="line"><span class="javascript">    url: <span class="string">"data"</span>,</span></span><br><span class="line"><span class="javascript">    data: <span class="string">"uname="</span>+$(<span class="string">"#uname"</span>).val(),</span></span><br><span class="line"><span class="javascript">    success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;alert(data)&#125;</span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入 Jquery  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#uname"</span>).blur(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $.<span class="keyword">get</span>("data",&#123;uname:($(<span class="string">"#uname"</span>).val())&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// 处理响应内容</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> span = $(<span class="string">"#unameSpan"</span>);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(<span class="built_in">eval</span>(data))&#123;</span></span><br><span class="line"><span class="javascript">                    span.html(<span class="string">"用户名 OK"</span>);</span></span><br><span class="line"><span class="javascript">                    span.css(<span class="string">"color"</span>,<span class="string">"green"</span>);</span></span><br><span class="line"><span class="javascript">                &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">                    span.html(<span class="string">"用户名已被注册"</span>);</span></span><br><span class="line"><span class="javascript">                    span.css(<span class="string">"color"</span>,<span class="string">"red"</span>);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="12-Ajax-案例之省市区三级联动"><a href="#12-Ajax-案例之省市区三级联动" class="headerlink" title="12 Ajax 案例之省市区三级联动"></a>12 Ajax 案例之省市区三级联动</h1><blockquote>
<p>三级联动定义：页面中有三个下拉框选项，分别为</p>
<p>省、市、县下拉框，选择对应的框，显示对应的省、市、县信息。</p>
<p>技术分析：ajax技术+jsp+servlet+jdbc</p>
<p>需求分析（思路）：</p>
<p>​    1、 创建页面：页面中有三个下拉框，分别为省、市、县区</p>
<p>​    2、页面加载成功发起 ajax 请求，请求省的信息，并将响应的经过填充到省下拉框中</p>
<p>​    3、选择省信息，请求对应的市信息，并将响应结果填充到下拉框中</p>
<p>​    4、选择市信息，请求对应的区/县信息，并将响应结果填充到下拉框中</p>
<p>数据库设计：</p>
<p>​    创建表（area） ： 存储了省、市、区/县信息</p>
<p>​    设计表实现一：只存储了数据，但是数据的层次关系没有体现</p>
<p>​        地区id：areaid</p>
<p>​        地区名：areaname</p>
<p>​    设计表实现二：</p>
<p>​        地区id：areaid</p>
<p>​        地区名：areaname</p>
<p>​        地区上级id：parentid </p>
<p>​    sql语句设计：</p>
<p>​        查询所有的省信息 ：select * from area where parentid=0; </p>
<p>​        查询选择的省下的市信息（假如：选择的省的areaid 为110000）</p>
<p>​                        select * from area  where areaid  = 110000；</p>
<p>​        查询选择市下的县/区信息（假如：选择的市的areaid 为120000）：</p>
<p>​                        select * from area where areaid =  120000；</p>
<p>​        代码： select  * from area  where areaid = ？；</p>
<p>​    数据库实现：导入 area.sql 语句执行</p>
<p>代码缺陷：</p>
<p>​    代码的重复冗余大</p>
<p>解决：相同的保留，不同的传参</p>
</blockquote>
<p>​        </p>
<h2 id="12-1-代码实现"><a href="#12-1-代码实现" class="headerlink" title="12.1 代码实现"></a>12.1 代码实现</h2><blockquote>
<p>只展现前端代码，后面只做一个事情。</p>
<p>bug，选择每个下拉框的第一个地区，体验不好。</p>
</blockquote>
<h3 id="12-1-1-未加联动"><a href="#12-1-1-未加联动" class="headerlink" title="12.1.1 未加联动"></a>12.1.1 未加联动</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>地区<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入 Jquery  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">  			$.<span class="keyword">get</span>("area",&#123;<span class="string">"parentid"</span>:<span class="number">0</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    		<span class="comment">/* 	 alert(data); */</span></span></span><br><span class="line"><span class="javascript">    			<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">    			<span class="built_in">eval</span>(<span class="string">"var areas ="</span>+data);</span></span><br><span class="line"><span class="javascript">    			<span class="comment">//获取省下拉框</span></span></span><br><span class="line"><span class="javascript">    			<span class="keyword">var</span> prov = $(<span class="string">"#province"</span>);</span></span><br><span class="line"><span class="javascript">    			<span class="comment">//清空省下拉框</span></span></span><br><span class="line">    			prov.empty();</span><br><span class="line"><span class="javascript">    			<span class="comment">//将所有省的信息填充到省下拉框中</span></span></span><br><span class="line"><span class="javascript">    			<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i &lt; areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">    				<span class="built_in">console</span>.log(i+<span class="string">"\t"</span>+areas[i].areaname);</span></span><br><span class="line"><span class="javascript">    				prov.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>);</span></span><br><span class="line">    			&#125;</span><br><span class="line"><span class="javascript">    			<span class="comment">//选择对应省下的市信息</span></span></span><br><span class="line"><span class="javascript">    			$(<span class="string">"#province"</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    				<span class="comment">//获取省的地区号</span></span></span><br><span class="line"><span class="javascript">    				<span class="keyword">var</span> areaid = $(<span class="string">"#province"</span>).val();</span></span><br><span class="line"><span class="javascript">    				<span class="comment">/* alert(areaid); */</span></span></span><br><span class="line"><span class="javascript">    				$.<span class="keyword">get</span>("area",&#123;<span class="string">"parentid"</span>:areaid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    					<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">    					<span class="built_in">eval</span>(<span class="string">"var areas="</span>+data);</span></span><br><span class="line"><span class="javascript">    					<span class="comment">//获取区对象</span></span></span><br><span class="line"><span class="javascript">    					<span class="keyword">var</span> city = $(<span class="string">"#city"</span>);</span></span><br><span class="line"><span class="javascript">    					<span class="comment">//清空市下拉框</span></span></span><br><span class="line">    					city.empty();</span><br><span class="line"><span class="javascript">    					<span class="comment">//将所有市的信息填充到市下拉框</span></span></span><br><span class="line"><span class="javascript">    					<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">    						city.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>)</span></span><br><span class="line">    					&#125;</span><br><span class="line">    				&#125;);</span><br><span class="line">    			&#125;);</span><br><span class="line"><span class="javascript">    			<span class="comment">//获取区/县信息</span></span></span><br><span class="line"><span class="javascript">    			$(<span class="string">"#city"</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    				<span class="comment">//获取市的地区号</span></span></span><br><span class="line"><span class="javascript">    				<span class="keyword">var</span> areaid = $(<span class="string">"#city"</span>).val();</span></span><br><span class="line"><span class="javascript">    				<span class="comment">//ajax 请求</span></span></span><br><span class="line"><span class="javascript">    				$.<span class="keyword">get</span>("area",&#123;parentid:areaid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    					<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">    					<span class="built_in">eval</span>(<span class="string">"var areas="</span>+data);</span></span><br><span class="line"><span class="javascript">    					<span class="comment">//获取区/县</span></span></span><br><span class="line"><span class="javascript">    					<span class="keyword">var</span> area = $(<span class="string">"#area"</span>);</span></span><br><span class="line"><span class="javascript">    					<span class="comment">//清空下拉框</span></span></span><br><span class="line">    					area.empty();</span><br><span class="line"><span class="javascript">    					<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">    						area.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>)</span></span><br><span class="line">    					&#125;</span><br><span class="line">    				&#125;);</span><br><span class="line">    				</span><br><span class="line">    			&#125;);</span><br><span class="line"><span class="javascript">    			<span class="comment">//选择对应市下的区/县信息</span></span></span><br><span class="line">    			</span><br><span class="line">    		&#125;);</span><br><span class="line">  		&#125;);</span><br><span class="line">    	</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"background-color:gray;"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin:auto;width:1000px;margin-top:200px;"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">"text-align: center;font-weight:500;font-family:楷体;"</span>&gt;</span>地区选择三级联动<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line">  			 省/直辖市：<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"province"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span>dsf<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  			 市:<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"city"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  			县/区：<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"area"</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span>	</span><br><span class="line">  		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    	</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="12-1-2-添加联动"><a href="#12-1-2-添加联动" class="headerlink" title="12.1.2 添加联动"></a>12.1.2 添加联动</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>地区<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入 Jquery  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">  			<span class="comment">//获取省信息</span></span></span><br><span class="line"><span class="javascript">  			$.<span class="keyword">get</span>("area",&#123;<span class="string">"parentid"</span>:<span class="number">0</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    		<span class="comment">/* 	 alert(data); */</span></span></span><br><span class="line"><span class="javascript">    			<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">    			<span class="built_in">eval</span>(<span class="string">"var areas ="</span>+data);</span></span><br><span class="line"><span class="javascript">    			<span class="comment">//获取省下拉框</span></span></span><br><span class="line"><span class="javascript">    			<span class="keyword">var</span> prov = $(<span class="string">"#province"</span>);</span></span><br><span class="line"><span class="javascript">    			<span class="comment">//清空省下拉框</span></span></span><br><span class="line">    			prov.empty();</span><br><span class="line"><span class="javascript">    			<span class="comment">//将所有省的信息填充到省下拉框中</span></span></span><br><span class="line"><span class="javascript">    			<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i &lt; areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">    				<span class="comment">/* console.log(i+"\t"+areas[i].areaname); */</span></span></span><br><span class="line"><span class="javascript">    				prov.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>);</span></span><br><span class="line">    			&#125;</span><br><span class="line"><span class="javascript">    			<span class="comment">//填充省下拉框时触发市的信息,联动的关键</span></span></span><br><span class="line"><span class="javascript">    			 $(<span class="string">"#province"</span>).trigger(<span class="string">"change"</span>);</span></span><br><span class="line">    		&#125;);</span><br><span class="line"><span class="javascript">  			<span class="comment">//选择对应省下的市信息</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#province"</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="comment">//获取省的地区号</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> areaid = $(<span class="string">"#province"</span>).val();</span></span><br><span class="line"><span class="javascript">				<span class="comment">/* alert(areaid); */</span></span></span><br><span class="line"><span class="javascript">				$.<span class="keyword">get</span>("area",&#123;<span class="string">"parentid"</span>:areaid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">					<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">					<span class="built_in">eval</span>(<span class="string">"var areas="</span>+data);</span></span><br><span class="line"><span class="javascript">					<span class="comment">//获取区对象</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">var</span> city = $(<span class="string">"#city"</span>);</span></span><br><span class="line"><span class="javascript">					<span class="comment">//清空市下拉框</span></span></span><br><span class="line">					city.empty();</span><br><span class="line"><span class="javascript">					<span class="comment">//将所有市的信息填充到市下拉框</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">						city.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>);</span></span><br><span class="line">					&#125;</span><br><span class="line"><span class="javascript">					<span class="comment">////填充市下拉框时触发区/县的信息，联动的关键</span></span></span><br><span class="line"><span class="javascript">					$(<span class="string">"#city"</span>).trigger(<span class="string">"change"</span>);</span></span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br><span class="line">  			</span><br><span class="line"><span class="javascript">			<span class="comment">//获取区/县信息</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#city"</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="comment">//获取市的地区号</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> areaid = $(<span class="string">"#city"</span>).val();</span></span><br><span class="line"><span class="javascript">				<span class="comment">//ajax 请求</span></span></span><br><span class="line"><span class="javascript">				$.<span class="keyword">get</span>("area",&#123;parentid:areaid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">					<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">					<span class="built_in">eval</span>(<span class="string">"var areas="</span>+data);</span></span><br><span class="line"><span class="javascript">					<span class="comment">//获取区/县</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">var</span> area = $(<span class="string">"#area"</span>);</span></span><br><span class="line"><span class="javascript">					<span class="comment">//清空下拉框</span></span></span><br><span class="line">					area.empty();</span><br><span class="line"><span class="javascript">					<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">						area.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>);</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;);</span><br><span class="line">				</span><br><span class="line">			&#125;);</span><br><span class="line"><span class="javascript">			<span class="comment">//选择对应市下的区/县信息</span></span></span><br><span class="line">			</span><br><span class="line">  			</span><br><span class="line">  			</span><br><span class="line">  		&#125;);</span><br><span class="line">    	</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"background-color:gray;"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin:auto;width:720px;margin-top:200px;"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">"text-align: center;font-weight:500;font-family:楷体;margin-bottom: 50px;"</span>&gt;</span>地区选择三级联动<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line">  			 省/直辖市：<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"province"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  			 市:<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"city"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  			县/区：<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"area"</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span>	</span><br><span class="line">  		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    	</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="12-1-3-封装"><a href="#12-1-3-封装" class="headerlink" title="12.1.3 封装"></a>12.1.3 封装</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>地区<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入 Jquery  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">  			<span class="comment">//获取省信息</span></span></span><br><span class="line"><span class="javascript">  			getArea(<span class="string">"province"</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">  			<span class="comment">//选择对应省下的市信息</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#province"</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="comment">//获取省的地区号</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> areaid = $(<span class="string">"#province"</span>).val();</span></span><br><span class="line"><span class="javascript">				getArea(<span class="string">"city"</span>,areaid);</span></span><br><span class="line">			&#125;);</span><br><span class="line">  			</span><br><span class="line"><span class="javascript">			<span class="comment">//获取区/县信息</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#city"</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="comment">//获取市的地区号</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> areaid = $(<span class="string">"#city"</span>).val();</span></span><br><span class="line"><span class="javascript">				getArea(<span class="string">"area"</span>,areaid);</span></span><br><span class="line">			&#125;);</span><br><span class="line"><span class="javascript">			<span class="comment">//封装</span></span></span><br><span class="line"><span class="javascript">			<span class="function"><span class="keyword">function</span> <span class="title">getArea</span>(<span class="params">areaname,sid</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">   				<span class="comment">//获取地区信息</span></span></span><br><span class="line"><span class="javascript">    			 $.<span class="keyword">get</span>("area",&#123;<span class="string">"parentid"</span>:sid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    				<span class="comment">//将字符串对象转为 JS 对象</span></span></span><br><span class="line"><span class="javascript">    	    			<span class="built_in">eval</span>(<span class="string">"var areas ="</span>+data);</span></span><br><span class="line"><span class="javascript">    	    			<span class="comment">//获取省下拉框</span></span></span><br><span class="line"><span class="javascript">    	    			<span class="keyword">var</span> prov = $(<span class="string">"#"</span>+areaname);</span></span><br><span class="line"><span class="javascript">    	    			<span class="comment">//清空省下拉框</span></span></span><br><span class="line">    	    			prov.empty();</span><br><span class="line"><span class="javascript">    	    			<span class="comment">//将所有省的信息填充到省下拉框中</span></span></span><br><span class="line"><span class="javascript">    	    			<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i &lt; areas.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">    	    				prov.append(<span class="string">"&lt;option value="</span>+areas[i].areaid+<span class="string">"&gt;"</span>+areas[i].areaname+<span class="string">"&lt;/option&gt;"</span>);</span></span><br><span class="line">    	    			&#125;</span><br><span class="line"><span class="javascript">    	    			<span class="comment">//填充省下拉框时触发市的信息</span></span></span><br><span class="line"><span class="javascript">    	    			$(<span class="string">"#"</span>+areaname).trigger(<span class="string">"change"</span>);		</span></span><br><span class="line">    		    &#125;);</span><br><span class="line">			&#125;</span><br><span class="line">  		&#125;);</span><br><span class="line">    	</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"background-color:gray;"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin:auto;width:720px;margin-top:200px;"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">"text-align: center;font-weight:500;font-family:楷体;margin-bottom: 50px;"</span>&gt;</span>地区选择三级联动<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line">  			 省/直辖市：<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"province"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  			 市:<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"city"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  			县/区：<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"area"</span> <span class="attr">style</span>=<span class="string">"width:180px;height: 30px;border-radius:6px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span>	</span><br><span class="line">  		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    	</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="12-2-效果图"><a href="#12-2-效果图" class="headerlink" title="12.2 效果图"></a>12.2 效果图</h2><ul>
<li>未加联动</li>
</ul>
<p><img src="http://www.zwer.xyz/picGo/ajax%E5%9C%B0%E5%8C%BA%E4%B8%89%E7%BA%A7%E8%81%94%E5%8A%A8.gif" alt></p>
<ul>
<li>加联动</li>
</ul>
<p>![](<a href="http://www.zwer.xyz/picGo/ajax_area" target="_blank" rel="noopener">http://www.zwer.xyz/picGo/ajax_area</a> - 副本.gif)</p>
<h2 id="12-3-总结"><a href="#12-3-总结" class="headerlink" title="12.3 总结"></a>12.3 总结</h2><ol>
<li><p>良好的数据库设计，可让后期操作更加便捷。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  * <span class="keyword">from</span> area  <span class="keyword">where</span> areaid = ？；</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现联动的代码<strong>举例</strong>：</p>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="comment">//填充省下拉框时触发市的信息,联动的关键</span></span></span><br><span class="line"><span class="javascript">	$(<span class="string">"#province"</span>).trigger(<span class="string">"change"</span>);	</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="13-ajax-案例之搜索框提示语"><a href="#13-ajax-案例之搜索框提示语" class="headerlink" title="13 ajax 案例之搜索框提示语"></a>13 ajax 案例之搜索框提示语</h1><blockquote>
<p>功能需求：</p>
<p>​    用户再搜索框中输入关键字，然后搜索框习出现下拉选项，提示关键字的提示语</p>
<p>​    用户可以使用鼠标进行提示语的选择，也可以使用键盘的上下键选择</p>
<p>技术分析：</p>
<p>​    ajax技术+servlet+jsp+jdbc</p>
<p>功能分析（思路）：</p>
<p>​    1、创建搜索界面（搜索框和提示语div 和搜索按钮）</p>
<p>​    2、 给搜索框添加 onkeyup 时间， 键盘弹起时发送 ajax 请求</p>
<p>​        请求当前用户输入的信息对应的提示语数据</p>
<p>​    3、将提示语数据填充到搜索框下的div 中</p>
<p>​    4、实现使用鼠标选择提示语</p>
<p>​    5、实现使用键盘的上和下键选择提示语</p>
<p>​    6、实现鼠标和键盘的联动操作</p>
<p>​    7、将显示提示语的 div 进行隐藏，当有提示语的时候进行显示</p>
<p>完善：</p>
<p>​    问题：只要用户在搜索框中出现键盘点击动作，都会触发键盘事件的执行</p>
<p>​    而只要数据符合要求，都会发送 ajax 请求，请求提示语信息。点击一次都发一次。</p>
<p>​    但是其实只需求最后一次进行请求发生即可。</p>
<p>​    解决1：</p>
<p>​        使用延迟发送请求</p>
<p>​    使用1：</p>
<p>​        window.setTimeout()</p>
<p>​    问题2：</p>
<p>​        even 对象在火狐浏览器中使用window.event 获取不到</p>
<p>​    解决：</p>
<p>​        函数声明形参 event，必须是event </p>
<p>​     var reg =  /^\s+$/g/ 空格校验</p>
</blockquote>
<blockquote>
<p>数据库设计：</p>
<p>​    创建表：（data）存储了常用的关键字数据</p>
<p>​        关键字编号：id</p>
<p>​        关键字数据：title     </p>
<p>​        次数：count</p>
<p>​        说明：remark</p>
<p>​    添加测试数据：要求前期测试数据为英文单词</p>
<p>​    SQL 语句设计：查询以用户当前搜索框数据开头的关键字    </p>
<p>​            select * from data where title  like ‘a%’;</p>
<p>​    </p>
</blockquote>
<h2 id="13-1-添加鼠标悬停事件"><a href="#13-1-添加鼠标悬停事件" class="headerlink" title="13.1 添加鼠标悬停事件"></a>13.1 添加鼠标悬停事件</h2><blockquote>
<p>小技巧：将 css 赋于空字符串，即可清空属性值</p>
<p>注意：事件一定是添加已经存在的 html 代码上的，即注意事件添加的位置</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="comment">// 等服务器把提示语发送给客户端，再添加鼠标放上事件</span></span></span><br><span class="line"><span class="javascript">    $(<span class="string">"#prompt-box div"</span>).mouseover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//清空提示框中提示语的背景颜色</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#prompt-box div"</span>).css(<span class="string">"background-color"</span>,<span class="string">""</span>); </span></span><br><span class="line"><span class="javascript">        <span class="comment">//选择当前鼠标选择的 div ,并修改其 div 上的背景颜色</span></span></span><br><span class="line"><span class="javascript">        $(<span class="keyword">this</span>).css(<span class="string">"background-color"</span>,<span class="string">"gray"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//获取当前选择提示语的位置</span></span></span><br><span class="line"><span class="javascript">        count = $(<span class="keyword">this</span>).index();</span></span><br><span class="line"><span class="javascript">        <span class="comment">//通过鼠标单击提示语，将提示语放在搜索框中</span></span></span><br><span class="line"><span class="javascript">        $(<span class="keyword">this</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#input-search"</span>).val($(<span class="keyword">this</span>).html());</span></span><br><span class="line"><span class="javascript">            <span class="comment">//隐藏 提示语 div</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#prompt-box"</span>).css(<span class="string">"display"</span>,<span class="string">"none"</span>);</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;); </span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="13-2-键盘上下键选择"><a href="#13-2-键盘上下键选择" class="headerlink" title="13.2 键盘上下键选择"></a>13.2 键盘上下键选择</h2><blockquote>
<p>选择当前 div 的位置，通过全局变量 count 控制。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//添加键盘下键，选择提示语</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span>(code == <span class="number">40</span> ||code == <span class="number">38</span>)&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> divLength = ($(<span class="string">"#prompt-box div"</span>).length<span class="number">-1</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//注意要使用 ++count，而不是 count++</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(code == <span class="number">40</span>)&#123;</span></span><br><span class="line">            count = count &lt; divLength?++count:0;						</span><br><span class="line"><span class="javascript">        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line">            count = count &gt;= 0?--count:divLength;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="comment">//清空提示语背景颜色</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#prompt-box div"</span>).css(<span class="string">"background-color"</span>,<span class="string">""</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//选择提示语，修改背景颜色</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#prompt-box div:eq("</span>+count+<span class="string">")"</span>).css(<span class="string">"background-color"</span>,<span class="string">"gray"</span>);	</span></span><br><span class="line"><span class="javascript">        <span class="comment">//将提示语放入搜索框中</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#input-search"</span>).val($(<span class="string">"#prompt-box div:eq("</span>+count+<span class="string">")"</span>).html());</span></span><br><span class="line">    &#125;	</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="13-3-获取键盘输入的-javascript-码值"><a href="#13-3-获取键盘输入的-javascript-码值" class="headerlink" title="13.3 获取键盘输入的 javascript 码值"></a>13.3 获取键盘输入的 javascript 码值</h2><blockquote>
<p>利用 BOM 对象中 window.event.keyCode </p>
<p>注意：keyCode 中 k  小写</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> event = <span class="built_in">window</span>.event || event;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 获取 javascript 对应的键盘的值</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> code  = event.keyCode; <span class="comment">//k 小写</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// code = 8  表示删除键</span></span></span><br><span class="line"><span class="xml">    if((code &gt;=65 &amp;&amp; code <span class="tag">&lt;<span class="name">=90)</span> || <span class="attr">code</span> == <span class="string">8</span> || <span class="attr">code</span> == <span class="string">32</span> || (<span class="attr">code</span> &gt;</span>=49 &amp;&amp; code <span class="tag">&lt;<span class="name">=57))&#123;</span></span></span></span><br><span class="line"><span class="javascript">    	<span class="comment">//省略代码</span></span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="13-4-延迟函数"><a href="#13-4-延迟函数" class="headerlink" title="13.4 延迟函数"></a>13.4 延迟函数</h2><blockquote>
<p>var id = window.setTimeout(function(){},delay) ,注意 id 相当于线程号</p>
<p>window.clearTimeout(id) ，清空当前延时线程，防止每次键盘弹出都发送一个 ajax 请求，浪费资源</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="comment">// 清空延时 线程，防止每次键盘弹出都发送一个 ajax 请求，浪费资源</span></span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.clearTimeout(id);</span></span><br><span class="line"><span class="javascript"><span class="comment">// 设置延时,延迟发送 ajax</span></span></span><br><span class="line"><span class="javascript">id = <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">$.<span class="keyword">get</span>("search",&#123;title:search_title&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">sdata</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"><span class="comment">/* alert(sdata);  */</span></span></span><br><span class="line"><span class="javascript"><span class="built_in">eval</span>(<span class="string">"var data="</span>+sdata);</span></span><br><span class="line"><span class="javascript"><span class="keyword">if</span>(data.length &gt; <span class="number">0</span>)&#123;<span class="comment">//有提示语才显示提示框</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 显示提示框</span></span></span><br><span class="line"><span class="javascript">$(<span class="string">"#prompt-box"</span>).css(<span class="string">"display"</span>,<span class="string">""</span>);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="comment">//清空提示框中的内容</span></span></span><br><span class="line"><span class="javascript">$(<span class="string">"#prompt-box"</span>).empty();</span></span><br><span class="line"><span class="javascript"><span class="comment">//注意单词使用 区分 sdata ，data</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;data.length<span class="number">-1</span>;i++)&#123;</span></span><br><span class="line"><span class="javascript">   $(<span class="string">"#prompt-box"</span>).append(<span class="string">"&lt;div style='margin-bottom:3px;'&gt;"</span>+data[i].title+<span class="string">"&lt;/div&gt;"</span>);	    &#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">// 等服务器把提示语发送给客户端，再添加鼠标放上事件</span></span></span><br><span class="line"><span class="javascript">$(<span class="string">"#prompt-box div"</span>).mouseover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">	<span class="comment">//清空提示框中提示语的背景颜色</span></span></span><br><span class="line"><span class="javascript">	 $(<span class="string">"#prompt-box div"</span>).css(<span class="string">"background-color"</span>,<span class="string">""</span>); </span></span><br><span class="line"><span class="javascript">   		 <span class="comment">//选择当前鼠标选择的 div ,并修改其 div 上的背景颜色</span></span></span><br><span class="line"><span class="javascript">   		 $(<span class="keyword">this</span>).css(<span class="string">"background-color"</span>,<span class="string">"gray"</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    	 <span class="comment">//获取当前选择提示语的位置</span></span></span><br><span class="line"><span class="javascript">     	 count = $(<span class="keyword">this</span>).index();</span></span><br><span class="line"><span class="javascript">    	 <span class="comment">//通过鼠标单击提示语，将提示语放在搜索框中</span></span></span><br><span class="line"><span class="javascript">      	 $(<span class="keyword">this</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">         $(<span class="string">"#input-search"</span>).val($(<span class="keyword">this</span>).html());</span></span><br><span class="line"><span class="javascript">         <span class="comment">//隐藏 提示语 div</span></span></span><br><span class="line"><span class="javascript">         $(<span class="string">"#prompt-box"</span>).css(<span class="string">"display"</span>,<span class="string">"none"</span>);</span></span><br><span class="line"> 	&#125;);</span><br><span class="line">  			&#125;); </span><br><span class="line"> 	&#125;);		</span><br><span class="line">  &#125;, 500);				</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="13-5-代码"><a href="#13-5-代码" class="headerlink" title="13. 5 代码"></a>13. 5 代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span> <span class="attr">basePath</span> = <span class="string">request.getScheme()+</span>"<span class="attr">:</span>//"+<span class="attr">request.getServerName</span>()+"<span class="attr">:</span>"+<span class="attr">request.getServerPort</span>()+<span class="attr">path</span>+"/";</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"&lt;%=basePath%&gt;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>搜索框提示语<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入 Jquery 库 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">// 计数器</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> count = <span class="number">-1</span>;</span></span><br><span class="line"><span class="javascript">			<span class="comment">// 获取当前 延时线程的 id </span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> id = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">			<span class="comment">/* 键盘弹起 */</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#input-search"</span>).keyup(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;<span class="comment">//形参 event，兼容低版本的火狐浏览器</span></span></span><br><span class="line"><span class="javascript">				<span class="comment">//只发送符合条件的关键字数据</span></span></span><br><span class="line"><span class="javascript">				<span class="comment">//获取 event 对象</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> event = <span class="built_in">window</span>.event || event;</span></span><br><span class="line"><span class="javascript">				<span class="comment">// 获取 javascript 对应的键盘的值</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> code  = event.keyCode; <span class="comment">//k 小写</span></span></span><br><span class="line"><span class="javascript">				<span class="comment">// code = 8  表示删除键</span></span></span><br><span class="line"><span class="xml">				if((code &gt;=65 &amp;&amp; code <span class="tag">&lt;<span class="name">=90)</span> || <span class="attr">code</span> == <span class="string">8</span> || <span class="attr">code</span> == <span class="string">32</span> || (<span class="attr">code</span> &gt;</span>=49 &amp;&amp; code <span class="tag">&lt;<span class="name">=57))&#123;</span></span></span></span><br><span class="line"><span class="javascript">					<span class="comment">// 发送 ajax 请求,返回响应是搜索提示语语句</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">var</span> search_title = $(<span class="string">"#input-search"</span>).val(); </span></span><br><span class="line"><span class="javascript">					<span class="comment">/* alert(search_title); */</span></span></span><br><span class="line"><span class="javascript">					<span class="comment">//判断搜索框中的值是否空，若为空，则直接返回</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">if</span>(search_title == <span class="string">""</span>)&#123;</span></span><br><span class="line"><span class="javascript">						<span class="comment">//清空提示框中提示语</span></span></span><br><span class="line"><span class="javascript">						$(<span class="string">"#prompt-box"</span>).empty();</span></span><br><span class="line"><span class="javascript">						<span class="keyword">return</span>; <span class="comment">//即不执行下面的代码，不发送 ajax 请求</span></span></span><br><span class="line">					&#125;</span><br><span class="line"><span class="javascript">					<span class="comment">// 清空延时 线程，防止每次键盘弹出都发送一个 ajax 请求，浪费资源</span></span></span><br><span class="line"><span class="javascript">					<span class="built_in">window</span>.clearTimeout(id);</span></span><br><span class="line"><span class="javascript">					<span class="comment">// 设置延时,延迟发送 ajax</span></span></span><br><span class="line"><span class="javascript">					id = <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">						$.<span class="keyword">get</span>("search",&#123;title:search_title&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">sdata</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">							 <span class="comment">/* alert(sdata);  */</span></span></span><br><span class="line"><span class="javascript">							<span class="built_in">eval</span>(<span class="string">"var data="</span>+sdata);</span></span><br><span class="line"><span class="javascript">							<span class="keyword">if</span>(data.length &gt; <span class="number">0</span>)&#123;<span class="comment">//有提示语才显示提示框</span></span></span><br><span class="line"><span class="javascript">								<span class="comment">// 显示提示框</span></span></span><br><span class="line"><span class="javascript">							 	$(<span class="string">"#prompt-box"</span>).css(<span class="string">"display"</span>,<span class="string">""</span>);</span></span><br><span class="line">							&#125;</span><br><span class="line"><span class="javascript">							<span class="comment">//清空提示框中的内容</span></span></span><br><span class="line"><span class="javascript">							$(<span class="string">"#prompt-box"</span>).empty();</span></span><br><span class="line"><span class="javascript">							<span class="comment">//注意单词使用 区分 sdata ，data</span></span></span><br><span class="line"><span class="javascript">							<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;data.length<span class="number">-1</span>;i++)&#123;</span></span><br><span class="line"><span class="javascript">								$(<span class="string">"#prompt-box"</span>).append(<span class="string">"&lt;div style='margin-bottom:3px;'&gt;"</span>+data[i].title+<span class="string">"&lt;/div&gt;"</span>);					</span></span><br><span class="line">							&#125;</span><br><span class="line"><span class="javascript">							<span class="comment">// 等服务器把提示语发送给客户端，再添加鼠标放上事件</span></span></span><br><span class="line"><span class="javascript">							$(<span class="string">"#prompt-box div"</span>).mouseover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">								<span class="comment">//清空提示框中提示语的背景颜色</span></span></span><br><span class="line"><span class="javascript">							 	$(<span class="string">"#prompt-box div"</span>).css(<span class="string">"background-color"</span>,<span class="string">""</span>); </span></span><br><span class="line"><span class="javascript">								<span class="comment">//选择当前鼠标选择的 div ,并修改其 div 上的背景颜色</span></span></span><br><span class="line"><span class="javascript">								$(<span class="keyword">this</span>).css(<span class="string">"background-color"</span>,<span class="string">"gray"</span>);</span></span><br><span class="line">								</span><br><span class="line"><span class="javascript">								<span class="comment">//获取当前选择提示语的位置</span></span></span><br><span class="line"><span class="javascript">								count = $(<span class="keyword">this</span>).index();</span></span><br><span class="line"><span class="javascript">								<span class="comment">//通过鼠标单击提示语，将提示语放在搜索框中</span></span></span><br><span class="line"><span class="javascript">								$(<span class="keyword">this</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">									$(<span class="string">"#input-search"</span>).val($(<span class="keyword">this</span>).html());</span></span><br><span class="line"><span class="javascript">									<span class="comment">//隐藏 提示语 div</span></span></span><br><span class="line"><span class="javascript">									$(<span class="string">"#prompt-box"</span>).css(<span class="string">"display"</span>,<span class="string">"none"</span>);</span></span><br><span class="line">								&#125;);</span><br><span class="line">							&#125;); </span><br><span class="line">						&#125;);		</span><br><span class="line">					&#125;, 500);</span><br><span class="line">				&#125;</span><br><span class="line">			/* 	//添加键盘下键，选择提示语</span><br><span class="line"><span class="javascript">				$(<span class="string">"#input-search"</span>).focus(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">					alert(<span class="string">"------"</span>) *<span class="regexp">/</span></span></span><br><span class="line"><span class="javascript">				<span class="comment">//添加键盘下键，选择提示语</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">if</span>(code == <span class="number">40</span> ||code == <span class="number">38</span>)&#123;</span></span><br><span class="line"><span class="javascript">					<span class="keyword">var</span> divLength = ($(<span class="string">"#prompt-box div"</span>).length<span class="number">-1</span>);</span></span><br><span class="line"><span class="javascript">					<span class="comment">//注意要使用 ++count，而不是 count++</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">if</span>(code == <span class="number">40</span>)&#123;</span></span><br><span class="line">						count = count &lt; divLength?++count:0;						</span><br><span class="line"><span class="javascript">					&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line">						count = count &gt;= 0?--count:divLength;</span><br><span class="line">					&#125;</span><br><span class="line"><span class="javascript">					<span class="comment">//清空提示语背景颜色</span></span></span><br><span class="line"><span class="javascript">					$(<span class="string">"#prompt-box div"</span>).css(<span class="string">"background-color"</span>,<span class="string">""</span>);</span></span><br><span class="line"><span class="javascript">					<span class="comment">//选择提示语，修改背景颜色</span></span></span><br><span class="line"><span class="javascript">					$(<span class="string">"#prompt-box div:eq("</span>+count+<span class="string">")"</span>).css(<span class="string">"background-color"</span>,<span class="string">"gray"</span>);	</span></span><br><span class="line"><span class="javascript">					<span class="comment">//将提示语放入搜索框中</span></span></span><br><span class="line"><span class="javascript">					$(<span class="string">"#input-search"</span>).val($(<span class="string">"#prompt-box div:eq("</span>+count+<span class="string">")"</span>).html());</span></span><br><span class="line">				&#125;	</span><br><span class="line">			&#125;);</span><br><span class="line">			</span><br><span class="line"><span class="javascript">			<span class="comment">//注意该事件不能放在这里，因为ajax 请求选择是异步</span></span></span><br><span class="line"><span class="javascript">			<span class="comment">// 这时 服务器响应还没有发过来，但是事件已经执行完毕了。</span></span></span><br><span class="line">			/* //通过鼠标选择提示语</span><br><span class="line"><span class="javascript">			$(<span class="string">"#prompt-box div"</span>).mouseover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"123"</span>);</span></span><br><span class="line">			&#125;); */</span><br><span class="line">		&#125;);</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  		<span class="comment">&lt;!-- 容器框 ，作用：将搜索框和提示语框绑定在一定--&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"containter"</span> <span class="attr">style</span>=<span class="string">"width:650px;margin:auto;"</span>&gt;</span></span><br><span class="line">  			<span class="comment">&lt;!-- 标题 --&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">"font-family:微软雅黑;font-size:50px;font-weight:600;color:#2ECC71;text-align:center;margin-top:100px;margin-left:-50px;"</span>&gt;</span>搜索框提示语<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	  		<span class="comment">&lt;!-- 搜索框  --&gt;</span></span><br><span class="line">	  		<span class="comment">&lt;!-- margin:auto; 是相对于离它最近的外层 div 居中 --&gt;</span></span><br><span class="line">	    	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div-search"</span> <span class="attr">style</span>=<span class="string">"width:650px;margin:auto;"</span>&gt;</span></span><br><span class="line">	    		<span class="comment">&lt;!-- 搜索输入框 --&gt;</span></span><br><span class="line">	    		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"input-search"</span> <span class="attr">style</span>=<span class="string">"width:500px;height:40px;border:solid 2px #AED6F1;"</span>&gt;</span></span><br><span class="line">	    		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"搜索"</span> <span class="attr">style</span>=<span class="string">"width:120px;height:43px;border:solid 2px #AED6F1;border-radius:10px;background-color:#5499C7 ;color:white;"</span>&gt;</span></span><br><span class="line">	    	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	    	<span class="comment">&lt;!-- 搜索提示语提示框 --&gt;</span></span><br><span class="line">	    	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"prompt-box"</span> <span class="attr">style</span>=<span class="string">"width:496px;height:300px;border:solid 2px #AED6F1;border-top:none;display: none"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  		</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="13-6-总结"><a href="#13-6-总结" class="headerlink" title="13.6 总结"></a>13.6 总结</h2><ol>
<li>搜索提示语设计涉及的 js 知识较多，其中 BOM 对象使用不太熟悉。</li>
<li>搜索提示语其中的细节比较多。</li>
</ol>
<h1 id="14-ajax-整合项目之删除用户"><a href="#14-ajax-整合项目之删除用户" class="headerlink" title="14 ajax  整合项目之删除用户"></a>14 ajax  整合项目之删除用户</h1><blockquote>
<p>功能分析：在当前页面上删除用户，然后刷新当前浏览器。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params">uid</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">if</span>( confirm(<span class="string">"您确定要删除吗?"</span>))&#123;</span></span><br><span class="line"><span class="javascript">		<span class="comment">//使用 ajax 发送请求</span></span></span><br><span class="line"><span class="javascript">		$.<span class="keyword">get</span>("data",&#123;method:<span class="string">"delUserInfo"</span>,<span class="attr">uid</span>:uid&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//响应数据</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span>(<span class="built_in">eval</span>(data))&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"该用户已被删除"</span>);</span></span><br><span class="line"><span class="javascript">				<span class="comment">//刷新当前浏览器，重新发送请求</span></span></span><br><span class="line"><span class="javascript">				<span class="built_in">window</span>.location.href = <span class="string">"data?method=selAllUsers"</span>;</span></span><br><span class="line"><span class="javascript">			&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">"该用户删除失败"</span>)</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zwer</p>
  <div class="site-description" itemprop="description">记录学习的日常</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">68</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span>
        
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">tags</span>
        
      </div>
    
  </nav>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zwer</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.4.0</div>

        












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/muse.js?v=7.4.0"></script>
<script src="/js/next-boot.js?v=7.4.0"></script>



  





















  

  

  

</body>
</html>
